// @maplibre/maplibre-gl-directions@0.8.0 downloaded from https://ga.jspm.io/npm:@maplibre/maplibre-gl-directions@0.8.0/dist/maplibre-gl-directions.js

var e=Object.defineProperty;var Ae=(t,i,n)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n;var u=(e,t,i)=>(Ae(e,typeof t!="symbol"?t+"":t,i),i);class Ne{constructor(e){u(this,"map");u(this,"listeners",{});u(this,"oneTimeListeners",{});this.map=e}fire(e){var t,i;e.target=this.map;const n=e.type;(t=this.listeners[n])==null||t.forEach((t=>t(e))),(i=this.oneTimeListeners[n])==null||i.forEach((t=>{var i,o;t(e);const s=(i=this.oneTimeListeners[n])==null?void 0:i.indexOf(t);s!==void 0&&~s&&((o=this.oneTimeListeners[n])==null||o.splice(s,1))}))}on(e,t){this.listeners[e]=this.listeners[e]??[],this.listeners[e].push(t)}off(e,t){var i,n;const o=(i=this.listeners[e])==null?void 0:i.indexOf(t);o!==void 0&&~o&&((n=this.listeners[e])==null||n.splice(o,1))}once(e,t){this.oneTimeListeners[e]=this.oneTimeListeners[e]??[],this.oneTimeListeners[e].push(t)}}class ${constructor(e,t,i){u(this,"type");u(this,"target");u(this,"originalEvent");u(this,"data");this.type=e,this.originalEvent=t,this.data=i}}class ae{constructor(e,t,i){u(this,"type");u(this,"target");u(this,"originalEvent");u(this,"data");this.type=e,this.originalEvent=t,this.data=i}}const t={api:"https://router.project-osrm.org/route/v1",profile:"driving",requestOptions:{},requestTimeout:null,makePostRequest:!1,sourceName:"maplibre-gl-directions",pointsScalingFactor:1,linesScalingFactor:1,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint","maplibre-gl-directions-waypoint-casing"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint","maplibre-gl-directions-snappoint-casing"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline","maplibre-gl-directions-routeline-casing"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline","maplibre-gl-directions-alt-routeline-casing"],dragThreshold:10,refreshOnMove:!1,bearings:!1},i={snapline:"#34343f",altRouteline:"#9e91be",routelineFoot:"#3665ff",routelineBike:"#63c4ff",routeline:"#7b51f8",congestionLow:"#42c74c",congestionHigh:"#d72359",hoverpoint:"#30a856",snappoint:"#cb3373",snappointHighlight:"#e50d3f",waypointFoot:"#3665ff",waypointFootHighlight:"#0942ff",waypointBike:"#63c4ff",waypointBikeHighlight:"#0bb8ff",waypoint:"#7b51f8",waypointHighlight:"#6d26d7"},n=["case",["==",["get","profile",["get","arriveSnappointProperties"]],"foot"],i.routelineFoot,["==",["get","profile",["get","arriveSnappointProperties"]],"bike"],i.routelineBike,["interpolate-hcl",["linear"],["get","congestion"],0,i.routeline,1,i.congestionLow,100,i.congestionHigh]],o=["case",["==",["get","profile"],"foot"],["case",["boolean",["get","highlight"],!1],i.waypointFootHighlight,i.waypointFoot],["==",["get","profile"],"bike"],["case",["boolean",["get","highlight"],!1],i.waypointBikeHighlight,i.waypointBike],["case",["boolean",["get","highlight"],!1],i.waypointHighlight,i.waypoint]],s=["case",["boolean",["get","highlight"],!1],i.snappointHighlight,i.snappoint];function $e(e=1,t=1,a="maplibre-gl-directions"){const h=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],14*e,12*e],5,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],14*e,12*e],18,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],33*e,28*e]],c=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],9*e,7*e],5,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],9*e,7*e],18,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],21*e,16*e]],y=["interpolate",["exponential",1.5],["zoom"],0,3*t,5,3*t,18,10*t],m=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],10*t,7*t],5,["case",["boolean",["get","highlight"],!1],10*t,7*t],18,["case",["boolean",["get","highlight"],!1],32*t,23*t]];return[{id:`${a}-snapline`,type:"line",source:a,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":i.snapline,"line-opacity":.65,"line-width":3},filter:["==",["get","type"],"SNAPLINE"]},{id:`${a}-alt-routeline-casing`,type:"line",source:a,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":i.altRouteline,"line-opacity":.55,"line-width":m},filter:["==",["get","route"],"ALT"]},{id:`${a}-alt-routeline`,type:"line",source:a,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":i.altRouteline,"line-opacity":.85,"line-width":y},filter:["==",["get","route"],"ALT"]},{id:`${a}-routeline-casing`,type:"line",source:a,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":n,"line-opacity":.55,"line-width":m},filter:["==",["get","route"],"SELECTED"]},{id:`${a}-routeline`,type:"line",source:a,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":n,"line-opacity":.85,"line-width":y},filter:["==",["get","route"],"SELECTED"]},{id:`${a}-hoverpoint-casing`,type:"circle",source:a,paint:{"circle-radius":h,"circle-color":i.hoverpoint,"circle-opacity":.65},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${a}-hoverpoint`,type:"circle",source:a,paint:{"circle-radius":c,"circle-color":i.hoverpoint},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${a}-snappoint-casing`,type:"circle",source:a,paint:{"circle-radius":h,"circle-color":s,"circle-opacity":.65},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${a}-snappoint`,type:"circle",source:a,paint:{"circle-radius":c,"circle-color":s},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${a}-waypoint-casing`,type:"circle",source:a,paint:{"circle-radius":h,"circle-color":o,"circle-opacity":.65},filter:["==",["get","type"],"WAYPOINT"]},{id:`${a}-waypoint`,type:"circle",source:a,paint:{"circle-radius":c,"circle-color":o},filter:["==",["get","type"],"WAYPOINT"]}]}const a="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let we=(e=21)=>{let t="",i=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=a[i[e]&63];return t};function ce(e){return e&1?~(e>>1):e>>1}function de(e,t=5){const i=Math.pow(10,t);let n=0,o=0,s=0;const a=[];let h,c,y=0,m=0,b=null;for(;n<e.length;){b=null,y=0,m=0;do{b=e.charCodeAt(n++)-63,m|=(b&31)<<y,y+=5}while(b>=32);h=ce(m),y=m=0;do{b=e.charCodeAt(n++)-63,m|=(b&31)<<y,y+=5}while(b>=32);c=ce(m),o+=h,s+=c,a.push([s/i,o/i])}return a}function ze(e,t){return e.geometries==="geojson"?t.coordinates:e.geometries==="polyline6"?de(t,6):de(t,5)}function qe(e,t,i){var n,o,s,a;if((n=e.annotations)!=null&&n.includes("congestion_numeric"))return((o=t==null?void 0:t.congestion_numeric)==null?void 0:o[i])??0;if((s=e.annotations)==null||!s.includes("congestion"))return 0;switch(((a=t==null?void 0:t.congestion)==null?void 0:a[i])??""){case"unknown":return 0;case"low":return 1;case"moderate":return 34;case"heavy":return 77;case"severe":return 100;default:return 0}}function Ue(e,t,i){return e.geometries&&e.geometries!=="polyline"?t[0]===i[0]&&t[1]===i[1]:Math.abs(t[0]-i[0])<=1e-5&&Math.abs(t[1]-i[1])<=1e-5}function ge(e){return e.map((e=>[e.geometry.coordinates[0],e.geometry.coordinates[1]]))}function ue(e){return e.map((e=>{var t,i,n;return Array.isArray((t=e.properties)==null?void 0:t.bearing)?[(i=e.properties)==null?void 0:i.bearing[0],(n=e.properties)==null?void 0:n.bearing[1]]:void 0}))}function De(e){const i=$e(e==null?void 0:e.pointsScalingFactor,e==null?void 0:e.linesScalingFactor,e==null?void 0:e.sourceName);return Object.assign({},t,{layers:i},e)}function Ee(e,t,i){const n=e.makePostRequest?"post":"get";let o,s;if(n==="get")o=`${e.api}/${e.profile}/${t.join(";")}`,s=new URLSearchParams(e.requestOptions);else{o=`${e.api}/${e.profile}${e.requestOptions.access_token?`?access_token=${e.requestOptions.access_token}`:""}`;const i=new FormData;Object.entries(e.requestOptions).forEach((([e,t])=>{e!=="access_token"&&i.set(e,t)})),i.set("coordinates",t.join(";")),s=new URLSearchParams(i)}return e.bearings&&i&&s.set("bearings",i.map((e=>e?`${e[0]},${e[1]}`:"")).join(";")),{method:n,url:o,payload:s}}function Le(e,t,i){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{type:t,id:we(),...i??{}}}}function Me(e,t,i,n,o=!1){if(e.length!==t.length)return[];const s=e.map(((e,i)=>({type:"Feature",geometry:{type:"LineString",coordinates:[[e[0],e[1]],[t[i][0],t[i][1]]]},properties:{type:"SNAPLINE"}})));return~n&&i!==void 0&&o&&(s.push({type:"Feature",geometry:{type:"LineString",coordinates:[[i[0],i[1]],[t[n][0],t[n][1]]]},properties:{type:"SNAPLINE"}}),s.push({type:"Feature",geometry:{type:"LineString",coordinates:[[i[0],i[1]],[t[n+1][0],t[n+1][1]]]},properties:{type:"SNAPLINE"}})),s}function Se(e,t,i,n){return t.map(((t,o)=>{const s=ze(e,t.geometry),a=n.map((e=>e.geometry.coordinates));let h=0;const c=a.map(((t,i)=>{const n=s.slice(h).findIndex((i=>Ue(e,i,t))),o=i===a.length-1;if(n!==-1)h+=n;else if(o)return s.length-1;return h})).slice(1);let y=0;const m=c.map((e=>s.slice(y,y=e+1))),b=[];return m.forEach(((s,a)=>{const h=we();s.forEach(((s,c)=>{var y,m,x;const L=b[b.length-1],M=qe(e,(y=t.legs[a])==null?void 0:y.annotation,c);if(a===((m=L==null?void 0:L.properties)==null?void 0:m.legIndex)&&((x=L.properties)==null?void 0:x.congestion)===M)L.geometry.coordinates.push(s);else{const e=n[a].properties??{},t=n[a+1].properties??{},c={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{id:h,routeIndex:o,route:o===i?"SELECTED":"ALT",legIndex:a,congestion:M,departSnappointProperties:e,arriveSnappointProperties:t}};L&&c.geometry.coordinates.push(L.geometry.coordinates[L.geometry.coordinates.length-1]),c.geometry.coordinates.push(s),b.push(c)}}))})),b}))}const h=Object.freeze(Object.defineProperty({__proto__:null,buildConfiguration:De,buildPoint:Le,buildRequest:Ee,buildRoutelines:Se,buildSnaplines:Me},Symbol.toStringTag,{value:"Module"}));class _t extends Ne{constructor(e,t){super(e);u(this,"configuration");u(this,"_interactive",!1);u(this,"_hoverable",!1);u(this,"buildRequest",Ee);u(this,"buildPoint",Le);u(this,"buildSnaplines",Me);u(this,"buildRoutelines",Se);u(this,"onMoveHandler");u(this,"onDragDownHandler");u(this,"onDragMoveHandler");u(this,"onDragUpHandler");u(this,"onClickHandler");u(this,"liveRefreshHandler");u(this,"profiles",[]);u(this,"_waypoints",[]);u(this,"snappoints",[]);u(this,"routelines",[]);u(this,"selectedRouteIndex",0);u(this,"hoverpoint");u(this,"highlightedWaypoints",[]);u(this,"highlightedSnappoints",[]);u(this,"dragDownPosition",{x:0,y:0});u(this,"waypointBeingDragged");u(this,"waypointBeingDraggedInitialCoordinates");u(this,"departSnappointIndex",-1);u(this,"currentMousePosition",{x:0,y:0});u(this,"refreshOnMoveIsRefreshing",!1);u(this,"noMouseMovementTimer");u(this,"lastRequestMousePosition",{x:0,y:0});u(this,"allowRouteSwitch",!1);u(this,"abortController");this.map=e,this.configuration=De(t),this.onMoveHandler=this.onMove.bind(this),this.onDragDownHandler=this.onDragDown.bind(this),this.onDragMoveHandler=this.onDragMove.bind(this),this.onDragUpHandler=this.onDragUp.bind(this),this.onClickHandler=this.onClick.bind(this),this.liveRefreshHandler=this.liveRefresh.bind(this),this.init()}get waypointsCoordinates(){return ge(this._waypoints)}get snappointsCoordinates(){return this.snappoints.map((e=>[e.geometry.coordinates[0],e.geometry.coordinates[1]]))}get snaplines(){var e,t,i;return this.buildSnaplines(this.waypointsCoordinates,this.snappointsCoordinates,(e=this.hoverpoint)==null?void 0:e.geometry.coordinates,this.departSnappointIndex,(i=(t=this.hoverpoint)==null?void 0:t.properties)==null?void 0:i.showSnaplines)}init(){this.map.addSource(this.configuration.sourceName,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.configuration.layers.forEach((e=>{this.map.addLayer(e)}))}async fetch({method:e,url:t,payload:i}){var n,o;const s=await(e==="get"?await fetch(`${t}?${i}`,{signal:(n=this.abortController)==null?void 0:n.signal}):await fetch(`${t}`,{signal:(o=this.abortController)==null?void 0:o.signal,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i})).json();if(s.code!=="Ok")throw new Error(s.message??"An unexpected error occurred.");return s}async fetchDirections(e){var t;if((t=this.abortController)==null||t.abort(),this._waypoints.length>=2){this.fire(new ae("fetchroutesstart",e)),this.abortController=new AbortController;let t;this.configuration.requestTimeout!==null&&(t=setTimeout((()=>{var e;return(e=this.abortController)==null?void 0:e.abort()}),this.configuration.requestTimeout)),this.profiles.length||(this.profiles=[this.configuration.profile]);const i=[],n=[];this.profiles.reduce(((e,t,o)=>{const s=o===this.profiles.length-1,a=o>0?this.profiles[o-1]:void 0,h=t===a,c=s?this._waypoints.length:h?e+1:e+2;return h?n[n.length-1].push(...this._waypoints.slice(e,c)):(n.push(this._waypoints.slice(e,c)),i.push(t)),c}),0);const o=i.map(((e,t)=>this.buildRequest({...this.configuration,profile:e},ge(n[t]),this.configuration.bearings?ue(n[t]):void 0)));let s;try{s=await Promise.all(o.map((async t=>{let i;try{i=await this.fetch(t)}finally{this.fire(new ae("fetchroutesend",e,i))}return i})))}finally{clearTimeout(t)}const a=s.flatMap(((e,t)=>{const o=i[t],s=e.waypoints.map(((e,i)=>this.buildPoint(e.location,"SNAPPOINT",{profile:o,waypointProperties:n[t][i].properties??{}}))),a=this.buildRoutelines(this.configuration.requestOptions,e.routes,this.selectedRouteIndex,s);return{snappoints:s,routelines:a}})),h=s.flatMap((e=>e.routes));this.snappoints=a.flatMap((e=>e.snappoints)),this.routelines=a.flatMap((e=>e.routelines)),h.length<=this.selectedRouteIndex&&(this.selectedRouteIndex=0)}else this.snappoints=[],this.routelines=[];this.draw(!1)}draw(e=!0){const t=[...this._waypoints,...this.snappoints,...this.snaplines,...this.routelines.reduce(((t,i)=>e?t.concat(...i):t.concat(...i.map((e=>(e.properties&&(e.properties.route=e.properties.routeIndex===this.selectedRouteIndex?"SELECTED":"ALT"),e))))),[])];this.hoverpoint&&t.push(this.hoverpoint);const i={type:"FeatureCollection",features:t};this.map.getSource(this.configuration.sourceName)&&this.map.getSource(this.configuration.sourceName).setData(i)}deHighlight(){this.highlightedWaypoints.forEach((e=>{e!=null&&e.properties&&(e.properties.highlight=!1)})),this.highlightedSnappoints.forEach((e=>{e!=null&&e.properties&&(e.properties.highlight=!1)})),this.routelines.forEach((e=>{e.forEach((e=>{e.properties&&(e.properties.highlight=!1)}))}))}onMove(e){var t,i,n,o;const s=this.map.queryRenderedFeatures(e.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveRoutelineLayers,...this.configuration.sensitiveAltRoutelineLayers]})[0];if(this.deHighlight(),this.configuration.sensitiveWaypointLayers.includes((s==null?void 0:s.layer.id)??"")){this.map.getCanvas().style.cursor="pointer",this.interactive&&this.map.dragPan.disable();const e=this._waypoints.find((e=>{var t,i;return((t=e.properties)==null?void 0:t.id)===((i=s==null?void 0:s.properties)==null?void 0:i.id)})),n=e&&this.snappoints.find((t=>{var i,n,o;return((n=(i=t.properties)==null?void 0:i.waypointProperties)==null?void 0:n.id)===((o=e.properties)==null?void 0:o.id)}));e&&(this.highlightedWaypoints=[e]),n&&(this.highlightedSnappoints=[n]),(t=this.highlightedWaypoints[0])!=null&&t.properties&&(this.highlightedWaypoints[0].properties.highlight=!0),(i=this.highlightedSnappoints[0])!=null&&i.properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else if(this.configuration.sensitiveSnappointLayers.includes((s==null?void 0:s.layer.id)??"")){this.map.getCanvas().style.cursor="pointer";const e=this.snappoints.findIndex((e=>{var t,i;return((t=e.properties)==null?void 0:t.id)===((i=s==null?void 0:s.properties)==null?void 0:i.id)}));this.highlightedSnappoints=[this.snappoints[e]],this.highlightedWaypoints=[this._waypoints[e]],this.highlightedSnappoints[0].properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.highlightedWaypoints[0].properties&&(this.highlightedWaypoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else this.configuration.sensitiveRoutelineLayers.includes((s==null?void 0:s.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.interactive&&(this.map.dragPan.disable(),this.hoverpoint?this.hoverpoint.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat]:this.hoverpoint=this.buildPoint([e.lngLat.lng,e.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse(((n=s==null?void 0:s.properties)==null?void 0:n.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse(((o=s==null?void 0:s.properties)==null?void 0:o.arriveSnappointProperties)??"{}")}})),this.routelines.forEach((e=>{e.forEach((e=>{var t,i;e.properties&&((t=e.properties)==null?void 0:t.id)===((i=s==null?void 0:s.properties)==null?void 0:i.id)&&(e.properties.highlight=!0)}))}))):this.configuration.sensitiveAltRoutelineLayers.includes((s==null?void 0:s.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.routelines.forEach((e=>{e.forEach((e=>{var t,i;e.properties&&((t=e.properties)==null?void 0:t.id)===((i=s==null?void 0:s.properties)==null?void 0:i.id)&&(e.properties.highlight=!0)}))})),this.hoverpoint&&(this.hoverpoint=void 0)):(this.map.dragPan.enable(),this.map.getCanvas().style.cursor="",this.hoverpoint=void 0);this.draw()}onDragDown(e){var t,i,n,o,s,a;if(e.type==="touchstart"&&e.originalEvent.touches.length!==1||e.type==="mousedown"&&e.originalEvent.which!==1)return;const h=this.map.queryRenderedFeatures(e.point);if(h.length&&h[0].source===this.configuration.sourceName){const c=h.filter((e=>this.configuration.sensitiveWaypointLayers.includes((e==null?void 0:e.layer.id)??"")||this.configuration.sensitiveSnappointLayers.includes((e==null?void 0:e.layer.id)??"")||this.configuration.sensitiveRoutelineLayers.includes((e==null?void 0:e.layer.id)??"")))[0];if(this.dragDownPosition=e.point,this.currentMousePosition=e.point,this.configuration.sensitiveWaypointLayers.includes((c==null?void 0:c.layer.id)??""))this.waypointBeingDragged=this._waypoints.find((e=>{var t,i;return((t=e.properties)==null?void 0:t.id)===((i=c==null?void 0:c.properties)==null?void 0:i.id)})),this.waypointBeingDraggedInitialCoordinates=(t=this.waypointBeingDragged)==null?void 0:t.geometry.coordinates;else if(this.configuration.sensitiveRoutelineLayers.includes((c==null?void 0:c.layer.id)??"")){if(this.departSnappointIndex=JSON.parse((i=c==null?void 0:c.properties)==null?void 0:i.legIndex),this.hoverpoint)if(this.configuration.refreshOnMove){const t=this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0;this._addWaypoint([e.lngLat.lng,e.lngLat.lat],t,e),this.waypointBeingDragged=t?this._waypoints[t]:void 0,this.hoverpoint=void 0}else this.hoverpoint.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat];else this.hoverpoint=this.buildPoint([e.lngLat.lng,e.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse(((n=c==null?void 0:c.properties)==null?void 0:n.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse(((o=c==null?void 0:c.properties)==null?void 0:o.arriveSnappointProperties)??"{}")}});(s=this.hoverpoint)!=null&&s.properties&&(this.hoverpoint.properties.showSnaplines=!0),~this.departSnappointIndex&&(a=this.snappoints[this.departSnappointIndex])!=null&&a.properties&&(this.snappoints[this.departSnappointIndex].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex]),this.snappoints[this.departSnappointIndex+1].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex+1]))}this.map.off("touchstart",this.onMoveHandler),this.map.off("mousemove",this.onMoveHandler),e.type==="touchstart"?(this.map.on("touchmove",this.onDragMoveHandler),this.map.on("touchend",this.onDragUpHandler)):e.type==="mousedown"&&(this.map.on("mousemove",this.onDragMoveHandler),this.map.on("mouseup",this.onDragUpHandler)),this.draw()}}onDragMove(e){if(this.configuration.refreshOnMove&&(clearTimeout(this.noMouseMovementTimer),this.noMouseMovementTimer=setTimeout(this.liveRefreshHandler,300,e)),e.type==="touchmove"&&e.originalEvent.touches.length!==1)return e.originalEvent.preventDefault();e.type==="mousemove"&&e.originalEvent.which!==1||(this.waypointBeingDragged?this.waypointBeingDragged.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat]:this.hoverpoint&&(this.hoverpoint.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat]),this.currentMousePosition=e.point,this.draw(),this.configuration.refreshOnMove&&!this.refreshOnMoveIsRefreshing&&this.liveRefreshHandler(e))}onDragUp(e){var t,i,n;if(this.configuration.refreshOnMove&&clearTimeout(this.noMouseMovementTimer),!(e.type==="mouseup"&&e.originalEvent.which!==1)){if((t=this.hoverpoint)!=null&&t.properties&&(this.hoverpoint.properties.showSnaplines=!1),Math.abs(e.point.x-((i=this.dragDownPosition)==null?void 0:i.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(e.point.y-((n=this.dragDownPosition)==null?void 0:n.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0))if(this.waypointBeingDragged){this.waypointBeingDragged.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat];const t=new $("movewaypoint",e,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(t),this.fetchDirections(t).catch((e=>{e instanceof DOMException&&e.name=="AbortError"||this.waypointBeingDragged&&this.waypointBeingDraggedInitialCoordinates&&(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates)})),this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0}else this.hoverpoint&&(this._addWaypoint([e.lngLat.lng,e.lngLat.lat],this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0,e),this.hoverpoint=void 0);else this.waypointBeingDragged&&this.waypointBeingDraggedInitialCoordinates?(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates,this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0):this.hoverpoint&&(this.hoverpoint=void 0);this.deHighlight(),e.type==="touchend"?(this.map.off("touchmove",this.onDragMoveHandler),this.map.off("touchend",this.onDragUpHandler)):e.type==="mouseup"&&(this.map.off("mousemove",this.onDragMoveHandler),this.map.off("mouseup",this.onDragUpHandler)),this.map.on("touchstart",this.onMoveHandler),this.map.on("mousemove",this.onMoveHandler),this.map.dragPan.enable(),this.draw(),this.map.once("idle",(()=>{this.onMove(e)}))}}async liveRefresh(e){var t,i,n,o;if(Math.abs(((t=this.lastRequestMousePosition)==null?void 0:t.x)-((i=this.currentMousePosition)==null?void 0:i.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(((n=this.lastRequestMousePosition)==null?void 0:n.y)-((o=this.currentMousePosition)==null?void 0:o.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)){if(this.refreshOnMoveIsRefreshing=!0,this.lastRequestMousePosition=this.currentMousePosition,this.waypointBeingDragged){const t=new $("movewaypoint",e,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});this.fire(t);try{await this.fetchDirections(t)}catch{}}this.refreshOnMoveIsRefreshing=!1}}onClick(e){const t=this.map.queryRenderedFeatures(e.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveAltRoutelineLayers,...this.configuration.sensitiveRoutelineLayers]})[0];if(this.interactive&&this.configuration.sensitiveWaypointLayers.includes((t==null?void 0:t.layer.id)??"")){const i=this._waypoints.findIndex((e=>{var i,n;return((i=e.properties)==null?void 0:i.id)===((n=t==null?void 0:t.properties)==null?void 0:n.id)}));~i&&this._removeWaypoint(i,e)}else if(this.interactive&&this.configuration.sensitiveSnappointLayers.includes((t==null?void 0:t.layer.id)??"")){const i=this.snappoints.findIndex((e=>{var i,n;return((i=e.properties)==null?void 0:i.id)===((n=t==null?void 0:t.properties)==null?void 0:n.id)}));~i&&this._removeWaypoint(i,e)}else(this.interactive||this.allowRouteSwitch)&&this.configuration.sensitiveAltRoutelineLayers.includes((t==null?void 0:t.layer.id)??"")?this.selectedRouteIndex=this.routelines.findIndex((e=>!!e.find((e=>{var i,n;return((i=e.properties)==null?void 0:i.id)===((n=t==null?void 0:t.properties)==null?void 0:n.id)})))):this.interactive&&!this.configuration.sensitiveRoutelineLayers.includes((t==null?void 0:t.layer.id)??"")&&this._addWaypoint([e.lngLat.lng,e.lngLat.lat],void 0,e);this.draw(!1),this.map.once("idle",(()=>{this.onMove(e)}))}assignWaypointsCategories(){this._waypoints.forEach(((e,t)=>{const i=t===0?"ORIGIN":t===this._waypoints.length-1?"DESTINATION":void 0;e.properties&&(e.properties.index=t,e.properties.category=i)}))}async _addWaypoint(e,t,i){var n;(n=this.abortController)==null||n.abort(),t=t??this._waypoints.length,this._waypoints.splice(t,0,this.buildPoint(e,"WAYPOINT",this.configuration.bearings?{bearing:void 0}:void 0)),this.assignWaypointsCategories();const o=new $("addwaypoint",i,{index:t});this.fire(o),this.draw();try{await this.fetchDirections(o)}catch{}}async _removeWaypoint(e,t){var i;(i=this.abortController)==null||i.abort(),this._waypoints.splice(e,1),this.snappoints.splice(e,1),this.assignWaypointsCategories();const n=new $("removewaypoint",t,{index:e});this.fire(n),this.draw();try{await this.fetchDirections(n)}catch{}}get interactive(){return this._interactive}set interactive(e){this._interactive=e,e?(this.map.on("touchstart",this.onMoveHandler),this.map.on("touchstart",this.onDragDownHandler),this.map.on("mousedown",this.onDragDownHandler),this.map.on("click",this.onClickHandler),this.hoverable||(this.map.on("mousemove",this.onMoveHandler),this.map.on("click",this.onClickHandler))):(this.map.off("touchstart",this.onMoveHandler),this.map.off("touchstart",this.onDragDownHandler),this.map.off("mousedown",this.onDragDownHandler),this.hoverable||(this.map.off("mousemove",this.onMoveHandler),this.map.off("click",this.onClickHandler)),this.map.dragPan.enable())}get hoverable(){return this._hoverable}set hoverable(e){this._hoverable=e,e&&!this.interactive?(this.map.on("mousemove",this.onMoveHandler),this.map.on("click",this.onClickHandler)):this.interactive||(this.map.off("mousemove",this.onMoveHandler),this.map.off("click",this.onClickHandler))}get waypoints(){return this.waypointsCoordinates}set waypoints(e){this.setWaypoints(e)}get waypointsBearings(){return this.configuration.bearings?ue(this._waypoints):(console.warn("The `waypointsBearings` getter was referred to, but the `bearings` configuration option is not enabled!"),[])}set waypointsBearings(e){if(!this.configuration.bearings){console.warn("The `waypointsBearings` setter was referred to, but the `bearings` configuration option is not enabled!");return}this._waypoints.forEach(((t,i)=>{(t.properties||(t.properties={})).bearing=e[i]}));const t=new $("rotatewaypoints",void 0);this.fire(t),this.draw();try{this.fetchDirections(t)}catch{}}
/**
   * Replaces all the waypoints with the specified ones and re-fetches the routes.
   *
   * @param waypoints The coordinates at which the waypoints should be added
   * @param profiles Profiles for fetching directions between waypoints.
   * @return Resolved after the routing request has finished
   */async setWaypoints(e,t=[]){var i;(i=this.abortController)==null||i.abort(),this.profiles=t.slice(0,e.length-1),this.profiles.length===0&&this.profiles.push(this.configuration.profile),this._waypoints=this.profiles.flatMap(((t,i)=>{const n=i===this.profiles.length-1,o=i>0?this.profiles[i-1]:void 0,s=t===o?i+1:i,a=n?e.length:i+2;return e.slice(s,a).map(((e,i)=>this.buildPoint(e,"WAYPOINT",{profile:t,...this.configuration.bearings?{bearing:this.waypointsBearings[i]}:void 0})))})),this.assignWaypointsCategories();const n=new $("setwaypoints",void 0);this.fire(n),this.draw();try{await this.fetchDirections(n)}catch{}}
/**
   * Adds a waypoint at the specified coordinates to the map and re-fetches the routes.
   *
   * @param waypoint The coordinates at which the waypoint should be added
   * @param index The index the waypoint should be inserted at. If omitted, the waypoint is inserted at the end
   * @return Resolved after the routing request has finished
   */async addWaypoint(e,t){await this._addWaypoint(e,t)}
/**
   * Removes a waypoint and its related snappoint by the waypoint's index from the map and re-fetches the routes.
   *
   * @param index The index of the waypoint to remove
   * @return Resolved after the routing request has finished
   */async removeWaypoint(e){await this._removeWaypoint(e)}clear(){this.setWaypoints([]),this.routelines=[]}destroy(){var e;(e=this.abortController)==null||e.abort(),this.clear(),this.hoverable=!1,this.interactive=!1,this.configuration.layers.forEach((e=>{this.map.removeLayer(e.id)})),this.map.removeSource(this.configuration.sourceName)}}function N(){}function Pe(e){return e()}function fe(){return Object.create(null)}function J(e){e.forEach(Pe)}function Re(e){return typeof e=="function"}function Ie(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Ve(e){return Object.keys(e).length===0}function w(e,t){e.appendChild(t)}function B(e,t,i){e.insertBefore(t,i||null)}function O(e){e.parentNode&&e.parentNode.removeChild(e)}function Ge(e,t){for(let i=0;i<e.length;i+=1)e[i]&&e[i].d(t)}function S(e){return document.createElement(e)}function P(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function X(e){return document.createTextNode(e)}function k(){return X(" ")}function Je(){return X("")}function F(e,t,i,n){return e.addEventListener(t,i,n),()=>e.removeEventListener(t,i,n)}function p(e,t,i){i==null?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function K(e){return e===""?null:+e}function Ye(e){return Array.from(e.childNodes)}function Fe(e,t){t=""+t,e.data!==t&&(e.data=/** @type {string} */
t)}function Q(e,t){e.value=t??""}function A(e,t,i,n){i==null?e.style.removeProperty(t):e.style.setProperty(t,i,n?"important":"")}let c;function V(e){c=e}function Xe(){if(!c)throw new Error("Function called outside component initialization");return c}function Ke(e){Xe().$$.on_destroy.push(e)}const y=[],m=[];let b=[];const x=[],L=Promise.resolve();let M=!1;function Ze(){M||(M=!0,L.then(Te))}function ie(e){b.push(e)}const I=new Set;let C=0;function Te(){if(C!==0)return;const e=c;do{try{for(;C<y.length;){const e=y[C];C++,V(e),et(e.$$)}}catch(e){throw y.length=0,C=0,e}for(V(null),y.length=0,C=0;m.length;)m.pop()();for(let e=0;e<b.length;e+=1){const t=b[e];I.has(t)||(I.add(t),t())}b.length=0}while(y.length);for(;x.length;)x.pop()();M=!1,I.clear(),V(e)}function et(e){if(e.fragment!==null){e.update(),J(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ie)}}function tt(e){const t=[],i=[];b.forEach((n=>e.indexOf(n)===-1?t.push(n):i.push(n))),i.forEach((e=>e())),b=t}const R=new Set;function nt(e,t){e&&e.i&&(R.delete(e),e.i(t))}function ye(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function ot(e,t,i){const{fragment:n,after_update:o}=e.$$;n&&n.m(t,i),ie((()=>{const t=e.$$.on_mount.map(Pe).filter(Re);e.$$.on_destroy?e.$$.on_destroy.push(...t):J(t),e.$$.on_mount=[]})),o.forEach(ie)}function st(e,t){const i=e.$$;i.fragment!==null&&(tt(i.after_update),J(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}function rt(e,t){e.$$.dirty[0]===-1&&(y.push(e),Ze(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ce(e,t,i,n,o,s,a=null,h=[-1]){const y=c;V(e);const m=e.$$={fragment:null,ctx:[],props:s,update:N,not_equal:o,bound:fe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(y?y.$$.context:[])),callbacks:fe(),dirty:h,skip_bound:!1,root:t.target||y.$$.root};a&&a(m.root);let b=!1;if(m.ctx=i?i(e,t.props||{},((t,i,...n)=>{const s=n.length?n[0]:i;return m.ctx&&o(m.ctx[t],m.ctx[t]=s)&&(!m.skip_bound&&m.bound[t]&&m.bound[t](s),b&&rt(e,t)),i})):[],m.update(),b=!0,J(m.before_update),m.fragment=!!n&&n(m.ctx),t.target){if(t.hydrate){const e=Ye(t.target);m.fragment&&m.fragment.l(e),e.forEach(O)}else m.fragment&&m.fragment.c();t.intro&&nt(e.$$.fragment),ot(e,t.target,t.anchor),Te()}V(y)}class He{constructor(){
/**
     * ### PRIVATE API
     *
     * Do not use, may change at any time
     *
     * @type {any}
     */
u(this,"$$");
/**
     * ### PRIVATE API
     *
     * Do not use, may change at any time
     *
     * @type {any}
     */u(this,"$$set")}
/** @returns {void} */$destroy(){st(this,1),this.$destroy=N
/**
   * @template {Extract<keyof Events, string>} K
   * @param {K} type
   * @param {((e: Events[K]) => void) | null | undefined} callback
   * @returns {() => void}
   */}$on(e,t){if(!Re(t))return N;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const e=i.indexOf(t);e!==-1&&i.splice(e,1)}
/**
   * @param {Partial<Props>} props
   * @returns {void}
   */}$set(e){this.$$set&&!Ve(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const T="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(T);function ve(e){let t,i,n,o,s,a,h,c,y,m,b,x,L,M,I,C;return{c(){t=P("svg"),i=P("circle"),o=P("path"),a=P("g"),h=P("path"),y=P("path"),b=P("path"),L=P("animateTransform"),p(i,"cx","64.13"),p(i,"cy","64.13"),p(i,"r","27.63"),p(i,"fill",n=e[0].fill),p(o,"d","M64.13 18.5A45.63 45.63 0 1 1 18.5 64.13 45.63 45.63 0 0 1 64.13 18.5zm0 7.85a37.78 37.78 0 1 1-37.78 37.78 37.78 37.78 0 0 1 37.78-37.78z"),p(o,"fill-rule","evenodd"),p(o,"fill",s=e[0].fill),p(h,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),p(h,"fill",c=e[0].fill),p(y,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),p(y,"fill",m=e[0].fill),p(y,"transform","rotate(120 64 64)"),p(b,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),p(b,"fill",x=e[0].fill),p(b,"transform","rotate(240 64 64)"),p(L,"attributeName","transform"),p(L,"type","rotate"),p(L,"from","0 64 64"),p(L,"to","120 64 64"),p(L,"dur","360ms"),p(L,"repeatCount","indefinite"),p(t,"xmlns","http://www.w3.org/2000/svg"),p(t,"width",M=e[0].size),p(t,"height",I=e[0].size),p(t,"viewBox","0 0 128 128"),p(t,"xml:space","preserve"),p(t,"class",C=e[0].class)},m(e,n){B(e,t,n),w(t,i),w(t,o),w(t,a),w(a,h),w(a,y),w(a,b),w(a,L)},p(e,a){a&1&&n!==(n=e[0].fill)&&p(i,"fill",n),a&1&&s!==(s=e[0].fill)&&p(o,"fill",s),a&1&&c!==(c=e[0].fill)&&p(h,"fill",c),a&1&&m!==(m=e[0].fill)&&p(y,"fill",m),a&1&&x!==(x=e[0].fill)&&p(b,"fill",x),a&1&&M!==(M=e[0].size)&&p(t,"width",M),a&1&&I!==(I=e[0].size)&&p(t,"height",I),a&1&&C!==(C=e[0].class)&&p(t,"class",C)},d(e){e&&O(t)}}}function lt(e){let t,i=e[1]&&ve(e);return{c(){i&&i.c(),t=Je()},m(e,n){i&&i.m(e,n),B(e,t,n)},p(e,[n]){e[1]?i?i.p(e,n):(i=ve(e),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},i:N,o:N,d(e){e&&O(t),i&&i.d(e)}}}function ht(e,t,i){let n,{directions:o}=t,{configuration:s}=t;return o.on("fetchroutesstart",(()=>{i(1,n=!0)})),o.on("fetchroutesend",(()=>{i(1,n=!1)})),e.$$set=e=>{"directions"in e&&i(2,o=e.directions),"configuration"in e&&i(0,s=e.configuration)},[s,n,o]}class pt extends He{constructor(e){super(),Ce(this,e,ht,lt,Ie,{directions:2,configuration:0})}}const H={fill:"#6d26d7",size:"24px",class:""};class wt{constructor(e,t){u(this,"controlElement");u(this,"directions");u(this,"configuration");this.directions=e,this.configuration=Object.assign({},H,t)}onAdd(){return this.controlElement=document.createElement("div"),new pt({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}function be(e,t,i){const n=e.slice();return n[16]=t[i],n[17]=t,n[18]=i,n}function dt(e){let t,i,n,o,s,a,h,c,y;function d(){e[11].call(t,e[17],e[18])}return{c(){t=S("input"),a=k(),h=S("span"),h.textContent="°",p(t,"type","number"),t.disabled=i=!e[16].enabled,p(t,"min",n=e[0].degreesMin),p(t,"max",o=e[0].degreesMax),p(t,"step",s=e[0].degreesStep),p(t,"class","maplibre-gl-directions-bearings-control__input"),p(h,"class","maplibre-gl-directions-bearings-control__text")},m(i,n){B(i,t,n),Q(t,e[16].degrees),B(i,a,n),B(i,h,n),c||(y=F(t,"input",d),c=!0)},p(a,h){e=a,h&2&&i!==(i=!e[16].enabled)&&(t.disabled=i),h&1&&n!==(n=e[0].degreesMin)&&p(t,"min",n),h&1&&o!==(o=e[0].degreesMax)&&p(t,"max",o),h&1&&s!==(s=e[0].degreesStep)&&p(t,"step",s),h&2&&K(t.value)!==e[16].degrees&&Q(t,e[16].degrees)},d(e){e&&(O(t),O(a),O(h)),c=!1,y()}}}function gt(e){let t,i,n,o=e[0].fixedDegrees+"";return{c(){t=S("span"),i=X(o),n=X("°"),p(t,"class","maplibre-gl-directions-bearings-control__text")},m(e,o){B(e,t,o),w(t,i),w(t,n)},p(e,t){t&1&&o!==(o=e[0].fixedDegrees+"")&&Fe(i,o)},d(e){e&&O(t)}}}function _e(e){let t,i,n,o,s,a,h,c,y,m,b,x,L,M,I,C,R,T,H,W,z,q,j,U,Y,G,Z=e[18];function Oe(){e[7].call(o,e[17],e[18])}const oe=()=>e[8](a,Z),se=()=>e[8](null,Z);function ke(...t){return e[9](e[18],...t)}function Be(){e[10].call(L,e[17],e[18])}function re(e,t){return e[0].fixedDegrees?gt:dt}let ee=re(e),te=ee(e);return{c(){t=S("div"),i=S("span"),i.textContent=`${e[18]+1}.`,n=k(),o=S("input"),s=k(),a=S("div"),h=P("svg"),c=P("circle"),b=P("circle"),x=k(),L=S("input"),T=k(),H=S("span"),H.textContent="°",W=k(),z=S("span"),z.textContent="±",q=k(),te.c(),j=k(),p(i,"class","maplibre-gl-directions-bearings-control__number text-slate-800"),p(o,"type","checkbox"),p(o,"class","maplibre-gl-directions-bearings-control__checkbox"),p(c,"r","5"),p(c,"cx","10"),p(c,"cy","10"),p(c,"fill","transparent"),p(c,"stroke","rgba(109, 38, 215, 0.65)"),p(c,"stroke-width","10"),p(c,"stroke-dasharray",y=e[16].degrees/3.6*31.42/100+" 31.42"),p(c,"transform",m="rotate("+(-90-e[16].degrees/2+e[16].angle-e[3])+")"),A(c,"transform-origin","10px 10px"),p(b,"r","6"),p(b,"cx","10"),p(b,"cy","10"),p(b,"fill","rgb(109, 38, 215)"),p(h,"height","20"),p(h,"width","20"),p(h,"viewBox","0 0 20 20"),p(h,"class","maplibre-gl-directions-bearings-control__waypoint-image"),A(h,"width",e[0].imageSize+"px"),A(h,"height",e[0].imageSize+"px"),A(h,"opacity",e[16].enabled?1:.25),p(a,"role","spinbutton"),p(a,"tabindex","0"),p(L,"type","number"),L.disabled=M=!e[16].enabled,p(L,"min",I=e[0].angleMin),p(L,"max",C=e[0].angleMax),p(L,"step",R=e[0].angleStep),p(L,"class","maplibre-gl-directions-bearings-control__input"),p(H,"class","maplibre-gl-directions-bearings-control__text"),p(z,"class","maplibre-gl-directions-bearings-control__text"),p(t,"class",U="maplibre-gl-directions-bearings-control__list-item "+(e[16].enabled?"maplibre-gl-directions-bearings-control__list-item--enabled":"maplibre-gl-directions-bearings-control__list-item--disabled")+" flex items-center gap-2 text-slate-800"+(e[16].enabled?"":"/50"))},m(y,m){B(y,t,m),w(t,i),w(t,n),w(t,o),o.checked=e[16].enabled,w(t,s),w(t,a),w(a,h),w(h,c),w(h,b),oe(),w(t,x),w(t,L),Q(L,e[16].angle),w(t,T),w(t,H),w(t,W),w(t,z),w(t,q),te.m(t,null),w(t,j),Y||(G=[F(o,"change",Oe),F(a,"mousedown",ke),F(L,"input",Be)],Y=!0)},p(i,n){e=i,n&2&&(o.checked=e[16].enabled),n&2&&y!==(y=e[16].degrees/3.6*31.42/100+" 31.42")&&p(c,"stroke-dasharray",y),n&10&&m!==(m="rotate("+(-90-e[16].degrees/2+e[16].angle-e[3])+")")&&p(c,"transform",m),n&1&&A(h,"width",e[0].imageSize+"px"),n&1&&A(h,"height",e[0].imageSize+"px"),n&2&&A(h,"opacity",e[16].enabled?1:.25),Z!==e[18]&&(se(),Z=e[18],oe()),n&2&&M!==(M=!e[16].enabled)&&(L.disabled=M),n&1&&I!==(I=e[0].angleMin)&&p(L,"min",I),n&1&&C!==(C=e[0].angleMax)&&p(L,"max",C),n&1&&R!==(R=e[0].angleStep)&&p(L,"step",R),n&2&&K(L.value)!==e[16].angle&&Q(L,e[16].angle),ee===(ee=re(e))&&te?te.p(e,n):(te.d(1),te=ee(e),te&&(te.c(),te.m(t,j))),n&2&&U!==(U="maplibre-gl-directions-bearings-control__list-item "+(e[16].enabled?"maplibre-gl-directions-bearings-control__list-item--enabled":"maplibre-gl-directions-bearings-control__list-item--disabled")+" flex items-center gap-2 text-slate-800"+(e[16].enabled?"":"/50"))&&p(t,"class",U)},d(e){e&&O(t),se(),te.d(),Y=!1,J(G)}}}function ut(e){let t,i,n,o=ye(e[1]),s=[];for(let t=0;t<o.length;t+=1)s[t]=_e(be(e,o,t));return{c(){t=S("div"),i=S("div");for(let e=0;e<s.length;e+=1)s[e].c();p(i,"class","maplibre-gl-directions-bearings-control__list flex flex-col max-h-96 overflow-y-auto"),p(t,"class",n="maplibre-gl-directions-bearings-control maplibregl-ctrl maplibregl-ctrl-group p-4 "+(e[1].length?"block":"hidden")+" bg-white text-base rounded")},m(e,n){B(e,t,n),w(t,i);for(let e=0;e<s.length;e+=1)s[e]&&s[e].m(i,null)},p(e,[a]){if(a&31){o=ye(e[1]);let t;for(t=0;t<o.length;t+=1){const n=be(e,o,t);s[t]?s[t].p(n,a):(s[t]=_e(n),s[t].c(),s[t].m(i,null))}for(;t<s.length;t+=1)s[t].d(1);s.length=o.length}a&2&&n!==(n="maplibre-gl-directions-bearings-control maplibregl-ctrl maplibregl-ctrl-group p-4 "+(e[1].length?"block":"hidden")+" bg-white text-base rounded")&&p(t,"class",n)},i:N,o:N,d(e){e&&O(t),Ge(s,e)}}}function ft(e,t,i){let{directions:n}=t,{configuration:o}=t;n.configuration.bearings||console.warn("The Bearings Control is used, but the `bearings` configuration option is not enabled!");let s=[];n.on("addwaypoint",r),n.on("removewaypoint",r),n.on("movewaypoint",r),n.on("setwaypoints",r);function r(){i(1,s=n.waypointsBearings.map(((e,t)=>s[t]?s[t]:{enabled:o.defaultEnabled||!!e,angle:e?e[0]:o.angleDefault,degrees:e?e[1]:o.fixedDegrees?o.fixedDegrees:o.degreesDefault})))}r();let a;const h=[];let c=-1;function d(e,t){var i;(i=s[t])!=null&&i.enabled&&(c=t,document.addEventListener("mouseup",l),document.addEventListener("mousemove",g))}function l(){c=-1,document.removeEventListener("mouseup",l),document.removeEventListener("mousemove",g)}function g(e){const t=h[c];if(t){const n=t.getBoundingClientRect().x+o.imageSize/2,a=t.getBoundingClientRect().y+o.imageSize/2,h=e.pageX,m=e.pageY,b=Math.atan2(h-n,m-a)*(180/Math.PI)*-1+90;i(1,s[c].angle=90+b+y|0,s)}}Ke((()=>{document.removeEventListener("mouseup",l),document.removeEventListener("mousemove",g)}));let y=0;o.respectMapBearing&&n.map.on("rotate",(()=>i(3,y=n.map.getBearing())));function f(e,t){e[t].enabled=this.checked,i(1,s)}function E(e,t){m[e?"unshift":"push"]((()=>{h[t]=e,i(2,h)}))}const D=(e,t)=>d(t,e);function v(e,t){e[t].angle=K(this.value),i(1,s)}function _(e,t){e[t].degrees=K(this.value),i(1,s)}return e.$$set=e=>{"directions"in e&&i(5,n=e.directions),"configuration"in e&&i(0,o=e.configuration)},e.$$.update=()=>{e.$$.dirty&67&&(a&&clearTimeout(a),i(6,a=setTimeout((()=>{i(5,n.waypointsBearings=s.map((e=>e.enabled?[e.angle,e.degrees]:void 0)),n)}),o.debounceTimeout)))},[o,s,h,y,d,n,a,f,E,D,v,_]}let W=class extends He{constructor(e){super(),Ce(this,e,ft,ut,Ie,{directions:5,configuration:0})}};const z={defaultEnabled:!1,debounceTimeout:150,angleDefault:0,angleMin:0,angleMax:359,angleStep:1,fixedDegrees:0,degreesDefault:45,degreesMin:15,degreesMax:360,degreesStep:15,respectMapBearing:!1,imageSize:50};class Et{constructor(e,t){u(this,"controlElement");u(this,"directions");u(this,"configuration");this.directions=e,this.configuration=Object.assign({},z,t)}onAdd(){return this.controlElement=document.createElement("div"),new W({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}export{Et as BearingsControl,wt as LoadingIndicatorControl,ae as MapLibreGlDirectionsRoutingEvent,$ as MapLibreGlDirectionsWaypointEvent,_t as default,$e as layersFactory,h as utils};

