var e=Object.defineProperty;var t=(t,i,n)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n;var i=(e,i,n)=>(t(e,typeof i!="symbol"?i+"":i,n),n);class xe{constructor(e){i(this,"map");i(this,"listeners",{});i(this,"oneTimeListeners",{});this.map=e}
/**
   * Fires an event and notifies all listeners.
   *
   * @param event The event object to fire.
   * @returns `false` if the event's `preventDefault()` method was called, `true` otherwise.
   */fire(e){e.target=this.map;const t=e.type,i={...this.oneTimeListeners[t]};i&&i.length>0&&(this.oneTimeListeners[t]=[],i.forEach((t=>{t(e)})));const n=this.listeners[t];return n&&[...n].forEach((t=>{t(e)})),!e.defaultPrevented
/**
   * Registers an event listener.
   *
   * @param type The event type to listen for.
   * @param listener The listener function.
   * @returns `this` for method chaining.
   */}on(e,t){return this.listeners[e]=this.listeners[e]??[],this.listeners[e].push(t),this
/**
   * Un-registers an event listener.
   *
   * @param type The event type.
   * @param listener The listener function to remove.
   * @returns `this` for method chaining.
   */}off(e,t){var i,n;const o=(i=this.listeners[e])==null?void 0:i.indexOf(t);return o!==void 0&&o>-1&&((n=this.listeners[e])==null||n.splice(o,1)),this
/**
   * Registers an event listener to be invoked only once.
   *
   * @param type The event type to listen for.
   * @param listener The listener function.
   * @returns `this` for method chaining.
   */}once(e,t){return this.oneTimeListeners[e]=this.oneTimeListeners[e]??[],this.oneTimeListeners[e].push(t),this}}class _e{constructor(e,t,n,o){i(this,"type");i(this,"target");i(this,"originalEvent");i(this,"data");i(this,"_cancelable");i(this,"_defaultPrevented",!1);this.type=e,this.originalEvent=t,this.data=n,this._cancelable=o}get defaultPrevented(){return this._defaultPrevented}}class A extends _e{constructor(e,t,i){super(e,t,i,!1)}}class j extends _e{constructor(e,t,i){super(e,t,i,!0)}preventDefault(){this._defaultPrevented=!0}}const n={api:"https://router.project-osrm.org/route/v1",profile:"driving",requestOptions:{},requestTimeout:null,makePostRequest:!1,sourceName:"maplibre-gl-directions",pointsScalingFactor:1,linesScalingFactor:1,sensitiveWaypointLayers:["maplibre-gl-directions-waypoint","maplibre-gl-directions-waypoint-casing"],sensitiveSnappointLayers:["maplibre-gl-directions-snappoint","maplibre-gl-directions-snappoint-casing"],sensitiveRoutelineLayers:["maplibre-gl-directions-routeline","maplibre-gl-directions-routeline-casing"],sensitiveAltRoutelineLayers:["maplibre-gl-directions-alt-routeline","maplibre-gl-directions-alt-routeline-casing"],dragThreshold:10,refreshOnMove:!1,bearings:!1},o={snapline:"#34343f",altRouteline:"#9e91be",routelineFoot:"#3665ff",routelineBike:"#63c4ff",routeline:"#7b51f8",congestionLow:"#42c74c",congestionHigh:"#d72359",hoverpoint:"#30a856",snappoint:"#cb3373",snappointHighlight:"#e50d3f",waypointFoot:"#3665ff",waypointFootHighlight:"#0942ff",waypointBike:"#63c4ff",waypointBikeHighlight:"#0bb8ff",waypoint:"#7b51f8",waypointHighlight:"#6d26d7"},s=["case",["==",["get","profile",["get","arriveSnappointProperties"]],"foot"],o.routelineFoot,["==",["get","profile",["get","arriveSnappointProperties"]],"bike"],o.routelineBike,["interpolate-hcl",["linear"],["get","congestion"],0,o.routeline,1,o.congestionLow,100,o.congestionHigh]],r=["case",["==",["get","profile"],"foot"],["case",["boolean",["get","highlight"],!1],o.waypointFootHighlight,o.waypointFoot],["==",["get","profile"],"bike"],["case",["boolean",["get","highlight"],!1],o.waypointBikeHighlight,o.waypointBike],["case",["boolean",["get","highlight"],!1],o.waypointHighlight,o.waypoint]],a=["case",["boolean",["get","highlight"],!1],o.snappointHighlight,o.snappoint];function l(e=1,t=1,i="maplibre-gl-directions"){const n=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],14*e,12*e],5,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],14*e,12*e],18,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],33*e,28*e]],l=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],9*e,7*e],5,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],9*e,7*e],18,["case",["boolean",["get","highlight"],["==",["get","type"],"HOVERPOINT"]],21*e,16*e]],h=["interpolate",["exponential",1.5],["zoom"],0,3*t,5,3*t,18,10*t],p=["interpolate",["exponential",1.5],["zoom"],0,["case",["boolean",["get","highlight"],!1],10*t,7*t],5,["case",["boolean",["get","highlight"],!1],10*t,7*t],18,["case",["boolean",["get","highlight"],!1],32*t,23*t]];return[{id:`${i}-snapline`,type:"line",source:i,layout:{"line-cap":"round","line-join":"round"},paint:{"line-dasharray":[3,3],"line-color":o.snapline,"line-opacity":.65,"line-width":3},filter:["==",["get","type"],"SNAPLINE"]},{id:`${i}-alt-routeline-casing`,type:"line",source:i,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":o.altRouteline,"line-opacity":.55,"line-width":p},filter:["==",["get","route"],"ALT"]},{id:`${i}-alt-routeline`,type:"line",source:i,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":o.altRouteline,"line-opacity":.85,"line-width":h},filter:["==",["get","route"],"ALT"]},{id:`${i}-routeline-casing`,type:"line",source:i,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":s,"line-opacity":.55,"line-width":p},filter:["==",["get","route"],"SELECTED"]},{id:`${i}-routeline`,type:"line",source:i,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":s,"line-opacity":.85,"line-width":h},filter:["==",["get","route"],"SELECTED"]},{id:`${i}-hoverpoint-casing`,type:"circle",source:i,paint:{"circle-radius":n,"circle-color":o.hoverpoint,"circle-opacity":.65},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${i}-hoverpoint`,type:"circle",source:i,paint:{"circle-radius":l,"circle-color":o.hoverpoint},filter:["==",["get","type"],"HOVERPOINT"]},{id:`${i}-snappoint-casing`,type:"circle",source:i,paint:{"circle-radius":n,"circle-color":a,"circle-opacity":.65},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${i}-snappoint`,type:"circle",source:i,paint:{"circle-radius":l,"circle-color":a},filter:["==",["get","type"],"SNAPPOINT"]},{id:`${i}-waypoint-casing`,type:"circle",source:i,paint:{"circle-radius":n,"circle-color":r,"circle-opacity":.65},filter:["==",["get","type"],"WAYPOINT"]},{id:`${i}-waypoint`,type:"circle",source:i,paint:{"circle-radius":l,"circle-color":r},filter:["==",["get","type"],"WAYPOINT"]}]}const h="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let p=(e=21)=>{let t="",i=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=h[i[e]&63];return t};function c(e){return e&1?~(e>>1):e>>1}function d(e,t=5){const i=Math.pow(10,t);let n=0,o=0,s=0;const r=[];let a,l,h=0,p=0,d=null;for(;n<e.length;){d=null,h=0,p=0;do{d=e.charCodeAt(n++)-63,p|=(d&31)<<h,h+=5}while(d>=32);a=c(p),h=p=0;do{d=e.charCodeAt(n++)-63,p|=(d&31)<<h,h+=5}while(d>=32);l=c(p),o+=a,s+=l,r.push([s/i,o/i])}return r}function u(e,t){return e.geometries==="geojson"?t.coordinates:e.geometries==="polyline6"?d(t,6):d(t,5)}function g(e,t,i){var n,o,s,r;if((n=e.annotations)!=null&&n.includes("congestion_numeric"))return((o=t==null?void 0:t.congestion_numeric)==null?void 0:o[i])??0;if((s=e.annotations)==null||!s.includes("congestion"))return 0;switch(((r=t==null?void 0:t.congestion)==null?void 0:r[i])??""){case"unknown":return 0;case"low":return 1;case"moderate":return 34;case"heavy":return 77;case"severe":return 100;default:return 0}}function f(e,t,i){return e.geometries&&e.geometries!=="polyline"?t[0]===i[0]&&t[1]===i[1]:Math.abs(t[0]-i[0])<=1e-5&&Math.abs(t[1]-i[1])<=1e-5}function v(e){return e.map((e=>[e.geometry.coordinates[0],e.geometry.coordinates[1]]))}function y(e){return e.map((e=>{var t,i,n;return Array.isArray((t=e.properties)==null?void 0:t.bearing)?[(i=e.properties)==null?void 0:i.bearing[0],(n=e.properties)==null?void 0:n.bearing[1]]:void 0}))}function m(e){const t=l(e==null?void 0:e.pointsScalingFactor,e==null?void 0:e.linesScalingFactor,e==null?void 0:e.sourceName);return Object.assign({},n,{layers:t},e)}function b(e,t,i){const n=e.makePostRequest?"post":"get";let o,s;if(n==="get")o=`${e.api}/${e.profile}/${t.join(";")}`,s=new URLSearchParams(e.requestOptions);else{o=`${e.api}/${e.profile}${e.requestOptions.access_token?`?access_token=${e.requestOptions.access_token}`:""}`;const i=new FormData;Object.entries(e.requestOptions).forEach((([e,t])=>{e!=="access_token"&&i.set(e,t)})),i.set("coordinates",t.join(";")),s=new URLSearchParams(i)}return e.bearings&&i&&s.set("bearings",i.map((e=>e?`${e[0]},${e[1]}`:"")).join(";")),{method:n,url:o,payload:s}}function w(e,t,i){return{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{type:t,id:p(),...i??{}}}}function x(e,t,i,n,o=!1){if(e.length!==t.length)return[];const s=e.map(((e,i)=>({type:"Feature",geometry:{type:"LineString",coordinates:[[e[0],e[1]],[t[i][0],t[i][1]]]},properties:{type:"SNAPLINE"}})));return~n&&i!==void 0&&o&&(s.push({type:"Feature",geometry:{type:"LineString",coordinates:[[i[0],i[1]],[t[n][0],t[n][1]]]},properties:{type:"SNAPLINE"}}),s.push({type:"Feature",geometry:{type:"LineString",coordinates:[[i[0],i[1]],[t[n+1][0],t[n+1][1]]]},properties:{type:"SNAPLINE"}})),s}function _(e,t,i,n){return t.map(((t,o)=>{const s=u(e,t.geometry),r=n.map((e=>e.geometry.coordinates));let a=0;const l=r.map(((t,i)=>{const n=s.slice(a).findIndex((i=>f(e,i,t))),o=i===r.length-1;if(n!==-1)a+=n;else if(o)return s.length-1;return a})).slice(1);let h=0;const c=l.map((e=>s.slice(h,h=e+1))),d=[];return c.forEach(((s,r)=>{const a=p();s.forEach(((s,l)=>{var h,p,c;const u=d[d.length-1],f=g(e,(h=t.legs[r])==null?void 0:h.annotation,l);if(r===((p=u==null?void 0:u.properties)==null?void 0:p.legIndex)&&((c=u.properties)==null?void 0:c.congestion)===f)u.geometry.coordinates.push(s);else{const e=n[r].properties??{},t=n[r+1].properties??{},l={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{id:a,routeIndex:o,route:o===i?"SELECTED":"ALT",legIndex:r,congestion:f,departSnappointProperties:e,arriveSnappointProperties:t}};u&&l.geometry.coordinates.push(u.geometry.coordinates[u.geometry.coordinates.length-1]),l.geometry.coordinates.push(s),d.push(l)}}))})),d}))}const S=Object.freeze(Object.defineProperty({__proto__:null,buildConfiguration:m,buildPoint:w,buildRequest:b,buildRoutelines:_,buildSnaplines:x},Symbol.toStringTag,{value:"Module"}));class _t extends xe{constructor(e,t){super(e);i(this,"configuration");i(this,"_interactive",!1);i(this,"_hoverable",!1);i(this,"buildRequest",b);i(this,"buildPoint",w);i(this,"buildSnaplines",x);i(this,"buildRoutelines",_);i(this,"onMoveHandler");i(this,"onDragDownHandler");i(this,"onDragMoveHandler");i(this,"onDragUpHandler");i(this,"onClickHandler");i(this,"liveRefreshHandler");i(this,"profiles",[]);i(this,"_waypoints",[]);i(this,"snappoints",[]);i(this,"routelines",[]);i(this,"selectedRouteIndex",0);i(this,"hoverpoint");i(this,"highlightedWaypoints",[]);i(this,"highlightedSnappoints",[]);i(this,"dragDownPosition",{x:0,y:0});i(this,"waypointBeingDragged");i(this,"waypointBeingDraggedInitialCoordinates");i(this,"departSnappointIndex",-1);i(this,"currentMousePosition",{x:0,y:0});i(this,"refreshOnMoveIsRefreshing",!1);i(this,"noMouseMovementTimer");i(this,"lastRequestMousePosition",{x:0,y:0});i(this,"allowRouteSwitch",!1);i(this,"abortController");this.map=e,this.configuration=m(t),this.onMoveHandler=this.onMove.bind(this),this.onDragDownHandler=this.onDragDown.bind(this),this.onDragMoveHandler=this.onDragMove.bind(this),this.onDragUpHandler=this.onDragUp.bind(this),this.onClickHandler=this.onClick.bind(this),this.liveRefreshHandler=this.liveRefresh.bind(this),this.init()}get waypointsCoordinates(){return v(this._waypoints)}get snappointsCoordinates(){return this.snappoints.map((e=>[e.geometry.coordinates[0],e.geometry.coordinates[1]]))}get snaplines(){var e,t,i;return this.buildSnaplines(this.waypointsCoordinates,this.snappointsCoordinates,(e=this.hoverpoint)==null?void 0:e.geometry.coordinates,this.departSnappointIndex,(i=(t=this.hoverpoint)==null?void 0:t.properties)==null?void 0:i.showSnaplines)}init(){this.map.addSource(this.configuration.sourceName,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.configuration.layers.forEach((e=>{this.map.addLayer(e)}))}async fetch({method:e,url:t,payload:i}){var n,o;const s=await(e==="get"?await fetch(`${t}?${i}`,{signal:(n=this.abortController)==null?void 0:n.signal}):await fetch(`${t}`,{signal:(o=this.abortController)==null?void 0:o.signal,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i})).json();if(s.code!=="Ok")throw new Error(s.message??"An unexpected error occurred.");return s}async fetchDirections(e){var t;if((t=this.abortController)==null||t.abort(),this._waypoints.length>=2){if(!this.fire(new j("fetchroutesstart",e,{})))return;this.abortController=new AbortController;let t;this.configuration.requestTimeout!==null&&(t=setTimeout((()=>{var e;return(e=this.abortController)==null?void 0:e.abort()}),this.configuration.requestTimeout)),this.profiles.length||(this.profiles=[this.configuration.profile]);const i=[],n=[];this.profiles.reduce(((e,t,o)=>{const s=o===this.profiles.length-1,r=o>0?this.profiles[o-1]:void 0,a=t===r,l=s?this._waypoints.length:a?e+1:e+2;return a?n[n.length-1].push(...this._waypoints.slice(e,l)):(n.push(this._waypoints.slice(e,l)),i.push(t)),l}),0);const o=i.map(((e,t)=>this.buildRequest({...this.configuration,profile:e},v(n[t]),this.configuration.bearings?y(n[t]):void 0)));let s;try{s=await Promise.all(o.map((async t=>{let i;try{i=await this.fetch(t)}finally{this.fire(new A("fetchroutesend",e,{directions:i}))}return i})))}finally{clearTimeout(t)}const r=s.flatMap(((e,t)=>{const o=i[t],s=e.waypoints.map(((e,i)=>this.buildPoint(e.location,"SNAPPOINT",{profile:o,waypointProperties:n[t][i].properties??{}}))),r=this.buildRoutelines(this.configuration.requestOptions,e.routes,this.selectedRouteIndex,s);return{snappoints:s,routelines:r}})),a=s.flatMap((e=>e.routes));this.snappoints=r.flatMap((e=>e.snappoints)),this.routelines=r.flatMap((e=>e.routelines)),a.length<=this.selectedRouteIndex&&(this.selectedRouteIndex=0)}else this.snappoints=[],this.routelines=[];this.draw(!1)}draw(e=!0){const t=[...this._waypoints,...this.snappoints,...this.snaplines,...this.routelines.reduce(((t,i)=>e?t.concat(...i):t.concat(...i.map((e=>(e.properties&&(e.properties.route=e.properties.routeIndex===this.selectedRouteIndex?"SELECTED":"ALT"),e))))),[])];this.hoverpoint&&t.push(this.hoverpoint);const i={type:"FeatureCollection",features:t};this.map.getSource(this.configuration.sourceName)&&this.map.getSource(this.configuration.sourceName).setData(i)}deHighlight(){this.highlightedWaypoints.forEach((e=>{e!=null&&e.properties&&(e.properties.highlight=!1)})),this.highlightedSnappoints.forEach((e=>{e!=null&&e.properties&&(e.properties.highlight=!1)})),this.routelines.forEach((e=>{e.forEach((e=>{e.properties&&(e.properties.highlight=!1)}))}))}onMove(e){var t,i,n,o;const s=this.map.queryRenderedFeatures(e.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveRoutelineLayers,...this.configuration.sensitiveAltRoutelineLayers]})[0];if(this.deHighlight(),this.configuration.sensitiveWaypointLayers.includes((s==null?void 0:s.layer.id)??"")){this.map.getCanvas().style.cursor="pointer",this.interactive&&this.map.dragPan.disable();const e=this._waypoints.find((e=>{var t,i;return((t=e.properties)==null?void 0:t.id)===((i=s==null?void 0:s.properties)==null?void 0:i.id)})),n=e&&this.snappoints.find((t=>{var i,n,o;return((n=(i=t.properties)==null?void 0:i.waypointProperties)==null?void 0:n.id)===((o=e.properties)==null?void 0:o.id)}));e&&(this.highlightedWaypoints=[e]),n&&(this.highlightedSnappoints=[n]),(t=this.highlightedWaypoints[0])!=null&&t.properties&&(this.highlightedWaypoints[0].properties.highlight=!0),(i=this.highlightedSnappoints[0])!=null&&i.properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else if(this.configuration.sensitiveSnappointLayers.includes((s==null?void 0:s.layer.id)??"")){this.map.getCanvas().style.cursor="pointer";const e=this.snappoints.findIndex((e=>{var t,i;return((t=e.properties)==null?void 0:t.id)===((i=s==null?void 0:s.properties)==null?void 0:i.id)}));this.highlightedSnappoints=[this.snappoints[e]],this.highlightedWaypoints=[this._waypoints[e]],this.highlightedSnappoints[0].properties&&(this.highlightedSnappoints[0].properties.highlight=!0),this.highlightedWaypoints[0].properties&&(this.highlightedWaypoints[0].properties.highlight=!0),this.hoverpoint&&(this.hoverpoint=void 0)}else if(this.configuration.sensitiveRoutelineLayers.includes((s==null?void 0:s.layer.id)??"")){if(this.map.getCanvas().style.cursor="pointer",this.interactive)if(this.map.dragPan.disable(),this.hoverpoint)this.hoverpoint.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat];else{const t=new j("beforecreatehoverpoint",e,{departSnappointIndex:JSON.parse(s.properties.legIndex)});if(!this.fire(t)){this.map.getCanvas().style.cursor="",this.map.dragPan.enable();return}this.hoverpoint=this.buildPoint([e.lngLat.lng,e.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse(((n=s==null?void 0:s.properties)==null?void 0:n.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse(((o=s==null?void 0:s.properties)==null?void 0:o.arriveSnappointProperties)??"{}")}})}this.routelines.forEach((e=>{e.forEach((e=>{var t,i;e.properties&&((t=e.properties)==null?void 0:t.id)===((i=s==null?void 0:s.properties)==null?void 0:i.id)&&(e.properties.highlight=!0)}))}))}else this.configuration.sensitiveAltRoutelineLayers.includes((s==null?void 0:s.layer.id)??"")?(this.map.getCanvas().style.cursor="pointer",this.routelines.forEach((e=>{e.forEach((e=>{var t,i;e.properties&&((t=e.properties)==null?void 0:t.id)===((i=s==null?void 0:s.properties)==null?void 0:i.id)&&(e.properties.highlight=!0)}))})),this.hoverpoint&&(this.hoverpoint=void 0)):(this.map.dragPan.enable(),this.map.getCanvas().style.cursor="",this.hoverpoint=void 0);this.draw()}onDragDown(e){var t,i,n,o,s,r;if(e.type==="touchstart"&&e.originalEvent.touches.length!==1||e.type==="mousedown"&&e.originalEvent.which!==1)return;const a=this.map.queryRenderedFeatures(e.point);if(a.length&&a[0].source===this.configuration.sourceName){const l=a.filter((e=>this.configuration.sensitiveWaypointLayers.includes((e==null?void 0:e.layer.id)??"")||this.configuration.sensitiveSnappointLayers.includes((e==null?void 0:e.layer.id)??"")||this.configuration.sensitiveRoutelineLayers.includes((e==null?void 0:e.layer.id)??"")))[0];if(this.dragDownPosition=e.point,this.currentMousePosition=e.point,this.configuration.sensitiveWaypointLayers.includes((l==null?void 0:l.layer.id)??"")){if(this.waypointBeingDragged=this._waypoints.find((e=>{var t,i;return((t=e.properties)==null?void 0:t.id)===((i=l==null?void 0:l.properties)==null?void 0:i.id)})),this.waypointBeingDraggedInitialCoordinates=(t=this.waypointBeingDragged)==null?void 0:t.geometry.coordinates,this.waypointBeingDragged&&this.waypointBeingDraggedInitialCoordinates){const t=new j("beforemovewaypoint",e,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates});if(!this.fire(t))return}}else if(this.configuration.sensitiveRoutelineLayers.includes((l==null?void 0:l.layer.id)??"")){if(this.departSnappointIndex=JSON.parse((i=l==null?void 0:l.properties)==null?void 0:i.legIndex),this.hoverpoint)if(this.configuration.refreshOnMove){const t=this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0;this._addWaypoint([e.lngLat.lng,e.lngLat.lat],t,e),this.waypointBeingDragged=t?this._waypoints[t]:void 0,this.hoverpoint=void 0}else this.hoverpoint.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat];else{const t=new j("beforecreatehoverpoint",e,{departSnappointIndex:this.departSnappointIndex});if(!this.fire(t))return;this.hoverpoint=this.buildPoint([e.lngLat.lng,e.lngLat.lat],"HOVERPOINT",{departSnappointProperties:{...JSON.parse(((n=l==null?void 0:l.properties)==null?void 0:n.departSnappointProperties)??"{}")},arriveSnappointProperties:{...JSON.parse(((o=l==null?void 0:l.properties)==null?void 0:o.arriveSnappointProperties)??"{}")}})}(s=this.hoverpoint)!=null&&s.properties&&(this.hoverpoint.properties.showSnaplines=!0),~this.departSnappointIndex&&(r=this.snappoints[this.departSnappointIndex])!=null&&r.properties&&(this.snappoints[this.departSnappointIndex].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex]),this.snappoints[this.departSnappointIndex+1].properties.highlight=!0,this.highlightedSnappoints.push(this.snappoints[this.departSnappointIndex+1]))}this.map.off("touchstart",this.onMoveHandler),this.map.off("mousemove",this.onMoveHandler),e.type==="touchstart"?(this.map.on("touchmove",this.onDragMoveHandler),this.map.on("touchend",this.onDragUpHandler)):e.type==="mousedown"&&(this.map.on("mousemove",this.onDragMoveHandler),this.map.on("mouseup",this.onDragUpHandler)),this.draw()}}onDragMove(e){if(this.configuration.refreshOnMove&&(clearTimeout(this.noMouseMovementTimer),this.noMouseMovementTimer=setTimeout(this.liveRefreshHandler,300,e)),e.type==="touchmove"&&e.originalEvent.touches.length!==1)return e.originalEvent.preventDefault();e.type==="mousemove"&&e.originalEvent.which!==1||(this.waypointBeingDragged?this.waypointBeingDragged.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat]:this.hoverpoint&&(this.hoverpoint.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat]),this.currentMousePosition=e.point,this.draw(),this.configuration.refreshOnMove&&!this.refreshOnMoveIsRefreshing&&this.liveRefreshHandler(e))}onDragUp(e){var t,i,n;if(this.configuration.refreshOnMove&&clearTimeout(this.noMouseMovementTimer),!(e.type==="mouseup"&&e.originalEvent.which!==1)){if((t=this.hoverpoint)!=null&&t.properties&&(this.hoverpoint.properties.showSnaplines=!1),Math.abs(e.point.x-((i=this.dragDownPosition)==null?void 0:i.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(e.point.y-((n=this.dragDownPosition)==null?void 0:n.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0))if(this.waypointBeingDragged){this.waypointBeingDragged.geometry.coordinates=[e.lngLat.lng,e.lngLat.lat];const t=new A("movewaypoint",e,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates,newCoordinates:this.waypointBeingDragged.geometry.coordinates});this.fire(t),this.fetchDirections(t).catch((e=>{e instanceof DOMException&&e.name=="AbortError"||this.waypointBeingDragged&&this.waypointBeingDraggedInitialCoordinates&&(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates)})),this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0}else this.hoverpoint&&(this._addWaypoint([e.lngLat.lng,e.lngLat.lat],this.departSnappointIndex!==void 0?this.departSnappointIndex+1:void 0,e),this.hoverpoint=void 0);else this.waypointBeingDragged&&this.waypointBeingDraggedInitialCoordinates?(this.waypointBeingDragged.geometry.coordinates=this.waypointBeingDraggedInitialCoordinates,this.waypointBeingDragged=void 0,this.waypointBeingDraggedInitialCoordinates=void 0):this.hoverpoint&&(this.hoverpoint=void 0);this.deHighlight(),e.type==="touchend"?(this.map.off("touchmove",this.onDragMoveHandler),this.map.off("touchend",this.onDragUpHandler)):e.type==="mouseup"&&(this.map.off("mousemove",this.onDragMoveHandler),this.map.off("mouseup",this.onDragUpHandler)),this.map.on("touchstart",this.onMoveHandler),this.map.on("mousemove",this.onMoveHandler),this.map.dragPan.enable(),this.draw(),this.map.once("idle",(()=>{this.onMove(e)}))}}async liveRefresh(e){var t,i,n,o;if(Math.abs(((t=this.lastRequestMousePosition)==null?void 0:t.x)-((i=this.currentMousePosition)==null?void 0:i.x))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)||Math.abs(((n=this.lastRequestMousePosition)==null?void 0:n.y)-((o=this.currentMousePosition)==null?void 0:o.y))>(this.configuration.dragThreshold>=0?this.configuration.dragThreshold:0)){if(this.refreshOnMoveIsRefreshing=!0,this.lastRequestMousePosition=this.currentMousePosition,this.waypointBeingDragged){const t=new A("movewaypoint",e,{index:this._waypoints.indexOf(this.waypointBeingDragged),initialCoordinates:this.waypointBeingDraggedInitialCoordinates,newCoordinates:this.waypointBeingDragged.geometry.coordinates});this.fire(t);try{await this.fetchDirections(t)}catch{}}this.refreshOnMoveIsRefreshing=!1}}onClick(e){const t=this.map.queryRenderedFeatures(e.point,{layers:[...this.configuration.sensitiveWaypointLayers,...this.configuration.sensitiveSnappointLayers,...this.configuration.sensitiveAltRoutelineLayers,...this.configuration.sensitiveRoutelineLayers]})[0];if(this.interactive&&this.configuration.sensitiveWaypointLayers.includes((t==null?void 0:t.layer.id)??"")){const i=this._waypoints.findIndex((e=>{var i,n;return((i=e.properties)==null?void 0:i.id)===((n=t==null?void 0:t.properties)==null?void 0:n.id)}));~i&&this._removeWaypoint(i,e)}else if(this.interactive&&this.configuration.sensitiveSnappointLayers.includes((t==null?void 0:t.layer.id)??"")){const i=this.snappoints.findIndex((e=>{var i,n;return((i=e.properties)==null?void 0:i.id)===((n=t==null?void 0:t.properties)==null?void 0:n.id)}));~i&&this._removeWaypoint(i,e)}else(this.interactive||this.allowRouteSwitch)&&this.configuration.sensitiveAltRoutelineLayers.includes((t==null?void 0:t.layer.id)??"")?this.selectedRouteIndex=this.routelines.findIndex((e=>!!e.find((e=>{var i,n;return((i=e.properties)==null?void 0:i.id)===((n=t==null?void 0:t.properties)==null?void 0:n.id)})))):this.interactive&&!this.configuration.sensitiveRoutelineLayers.includes((t==null?void 0:t.layer.id)??"")&&this._addWaypoint([e.lngLat.lng,e.lngLat.lat],void 0,e);this.draw(!1),this.map.once("idle",(()=>{this.onMove(e)}))}assignWaypointsCategories(){this._waypoints.forEach(((e,t)=>{const i=t===0?"ORIGIN":t===this._waypoints.length-1?"DESTINATION":"WAYPOINT";e.properties&&(e.properties.index=t,e.properties.category=i)}))}async _addWaypoint(e,t,i){var n;(n=this.abortController)==null||n.abort(),t=t??this._waypoints.length;const o=new j("beforeaddwaypoint",i,{index:t,coordinates:e});if(!this.fire(o))return;this._waypoints.splice(t,0,this.buildPoint(e,"WAYPOINT",this.configuration.bearings?{bearing:void 0}:void 0)),this.assignWaypointsCategories(),this.draw();const s=new A("addwaypoint",o,{index:t,coordinates:e});this.fire(s);try{await this.fetchDirections(s)}catch{}}async _removeWaypoint(e,t){var i;(i=this.abortController)==null||i.abort();const n=new j("beforeremovewaypoint",t,{index:e});if(!this.fire(n))return;this._waypoints.splice(e,1),this.snappoints.splice(e,1),this.assignWaypointsCategories(),this.draw();const o=new A("removewaypoint",n,{index:e});this.fire(o);try{await this.fetchDirections(o)}catch{}}get interactive(){return this._interactive}set interactive(e){this._interactive=e,e?(this.map.on("touchstart",this.onMoveHandler),this.map.on("touchstart",this.onDragDownHandler),this.map.on("mousedown",this.onDragDownHandler),this.map.on("click",this.onClickHandler),this.hoverable||(this.map.on("mousemove",this.onMoveHandler),this.map.on("click",this.onClickHandler))):(this.map.off("touchstart",this.onMoveHandler),this.map.off("touchstart",this.onDragDownHandler),this.map.off("mousedown",this.onDragDownHandler),this.hoverable||(this.map.off("mousemove",this.onMoveHandler),this.map.off("click",this.onClickHandler)),this.map.dragPan.enable())}get hoverable(){return this._hoverable}set hoverable(e){this._hoverable=e,e&&!this.interactive?(this.map.on("mousemove",this.onMoveHandler),this.map.on("click",this.onClickHandler)):this.interactive||(this.map.off("mousemove",this.onMoveHandler),this.map.off("click",this.onClickHandler))}get waypoints(){return this.waypointsCoordinates}set waypoints(e){this.setWaypoints(e)}get waypointsBearings(){return this.configuration.bearings?y(this._waypoints):(console.warn("The `waypointsBearings` getter was referred to, but the `bearings` configuration option is not enabled!"),[])}set waypointsBearings(e){if(!this.configuration.bearings){console.warn("The `waypointsBearings` setter was referred to, but the `bearings` configuration option is not enabled!");return}this._waypoints.forEach(((t,i)=>{(t.properties||(t.properties={})).bearing=e[i]}));const t=new A("rotatewaypoints",void 0,{});this.fire(t),this.draw();try{this.fetchDirections(t)}catch{}}
/**
   * Replaces all the waypoints with the specified ones and re-fetches the routes.
   *
   * @param waypoints The coordinates at which the waypoints should be added
   * @param profiles Profiles for fetching directions between waypoints.
   * @return Resolved after the routing request has finished
   */async setWaypoints(e,t=[]){var i;(i=this.abortController)==null||i.abort(),this.profiles=t.slice(0,e.length-1),this.profiles.length===0&&this.profiles.push(this.configuration.profile),this._waypoints=this.profiles.flatMap(((t,i)=>{const n=i===this.profiles.length-1,o=i>0?this.profiles[i-1]:void 0,s=t===o?i+1:i,r=n?e.length:i+2;return e.slice(s,r).map(((e,i)=>this.buildPoint(e,"WAYPOINT",{profile:t,...this.configuration.bearings?{bearing:this.waypointsBearings[i]}:void 0})))})),this.assignWaypointsCategories();const n=new A("setwaypoints",void 0,{});this.fire(n),this.draw();try{await this.fetchDirections(n)}catch{}}
/**
   * Adds a waypoint at the specified coordinates to the map and re-fetches the routes.
   *
   * @param waypoint The coordinates at which the waypoint should be added
   * @param index The index the waypoint should be inserted at. If omitted, the waypoint is inserted at the end
   * @return Resolved after the routing request has finished
   */async addWaypoint(e,t){await this._addWaypoint(e,t)}
/**
   * Removes a waypoint and its related snappoint by the waypoint's index from the map and re-fetches the routes.
   *
   * @param index The index of the waypoint to remove
   * @return Resolved after the routing request has finished
   */async removeWaypoint(e){await this._removeWaypoint(e)}clear(){this.setWaypoints([]),this.routelines=[]}destroy(){var e;(e=this.abortController)==null||e.abort(),this.clear(),this.hoverable=!1,this.interactive=!1,this.configuration.layers.forEach((e=>{this.map.removeLayer(e.id)})),this.map.removeSource(this.configuration.sourceName)}}function D(){}function M(e){return e()}function E(){return Object.create(null)}function L(e){e.forEach(M)}function P(e){return typeof e=="function"}function $(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function I(e){return Object.keys(e).length===0}function C(e,t){e.appendChild(t)}function O(e,t,i){e.insertBefore(t,i||null)}function T(e){e.parentNode&&e.parentNode.removeChild(e)}function R(e,t){for(let i=0;i<e.length;i+=1)e[i]&&e[i].d(t)}function H(e){return document.createElement(e)}function B(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function N(e){return document.createTextNode(e)}function k(){return N(" ")}function W(){return N("")}function z(e,t,i,n){return e.addEventListener(t,i,n),()=>e.removeEventListener(t,i,n)}function F(e,t,i){i==null?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function q(e){return e===""?null:+e}function U(e){return Array.from(e.childNodes)}function V(e,t){t=""+t,e.data!==t&&(e.data=/** @type {string} */
t)}function J(e,t){e.value=t??""}function Y(e,t,i,n){i==null?e.style.removeProperty(t):e.style.setProperty(t,i,n?"important":"")}let G;function X(e){G=e}function K(){if(!G)throw new Error("Function called outside component initialization");return G}function Q(e){K().$$.on_destroy.push(e)}const Z=[],ee=[];let te=[];const ie=[],ne=Promise.resolve();let oe=!1;function se(){oe||(oe=!0,ne.then(he))}function re(e){te.push(e)}const ae=new Set;let le=0;function he(){if(le!==0)return;const e=G;do{try{for(;le<Z.length;){const e=Z[le];le++,X(e),pe(e.$$)}}catch(e){throw Z.length=0,le=0,e}for(X(null),Z.length=0,le=0;ee.length;)ee.pop()();for(let e=0;e<te.length;e+=1){const t=te[e];ae.has(t)||(ae.add(t),t())}te.length=0}while(Z.length);for(;ie.length;)ie.pop()();oe=!1,ae.clear(),X(e)}function pe(e){if(e.fragment!==null){e.update(),L(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(re)}}function ce(e){const t=[],i=[];te.forEach((n=>e.indexOf(n)===-1?t.push(n):i.push(n))),i.forEach((e=>e())),te=t}const de=new Set;function ue(e,t){e&&e.i&&(de.delete(e),e.i(t))}function ge(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function fe(e,t,i){const{fragment:n,after_update:o}=e.$$;n&&n.m(t,i),re((()=>{const t=e.$$.on_mount.map(M).filter(P);e.$$.on_destroy?e.$$.on_destroy.push(...t):L(t),e.$$.on_mount=[]})),o.forEach(re)}function ve(e,t){const i=e.$$;i.fragment!==null&&(ce(i.after_update),L(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}function ye(e,t){e.$$.dirty[0]===-1&&(Z.push(e),se(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function me(e,t,i,n,o,s,r=null,a=[-1]){const l=G;X(e);const h=e.$$={fragment:null,ctx:[],props:s,update:D,not_equal:o,bound:E(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:E(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};r&&r(h.root);let p=!1;if(h.ctx=i?i(e,t.props||{},((t,i,...n)=>{const s=n.length?n[0]:i;return h.ctx&&o(h.ctx[t],h.ctx[t]=s)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](s),p&&ye(e,t)),i})):[],h.update(),p=!0,L(h.before_update),h.fragment=!!n&&n(h.ctx),t.target){if(t.hydrate){const e=U(t.target);h.fragment&&h.fragment.l(e),e.forEach(T)}else h.fragment&&h.fragment.c();t.intro&&ue(e.$$.fragment),fe(e,t.target,t.anchor),he()}X(l)}class Oe{constructor(){
/**
     * ### PRIVATE API
     *
     * Do not use, may change at any time
     *
     * @type {any}
     */
i(this,"$$");
/**
     * ### PRIVATE API
     *
     * Do not use, may change at any time
     *
     * @type {any}
     */i(this,"$$set")}
/** @returns {void} */$destroy(){ve(this,1),this.$destroy=D
/**
   * @template {Extract<keyof Events, string>} K
   * @param {K} type
   * @param {((e: Events[K]) => void) | null | undefined} callback
   * @returns {() => void}
   */}$on(e,t){if(!P(t))return D;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const e=i.indexOf(t);e!==-1&&i.splice(e,1)}
/**
   * @param {Partial<Props>} props
   * @returns {void}
   */}$set(e){this.$$set&&!I(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const be="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(be);function we(e){let t,i,n,o,s,r,a,l,h,p,c,d,u,g,f,v;return{c(){t=B("svg"),i=B("circle"),o=B("path"),r=B("g"),a=B("path"),h=B("path"),c=B("path"),u=B("animateTransform"),F(i,"cx","64.13"),F(i,"cy","64.13"),F(i,"r","27.63"),F(i,"fill",n=e[0].fill),F(o,"d","M64.13 18.5A45.63 45.63 0 1 1 18.5 64.13 45.63 45.63 0 0 1 64.13 18.5zm0 7.85a37.78 37.78 0 1 1-37.78 37.78 37.78 37.78 0 0 1 37.78-37.78z"),F(o,"fill-rule","evenodd"),F(o,"fill",s=e[0].fill),F(a,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),F(a,"fill",l=e[0].fill),F(h,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),F(h,"fill",p=e[0].fill),F(h,"transform","rotate(120 64 64)"),F(c,"d","M95.25 17.4a56.26 56.26 0 0 0-76.8 13.23L12.1 26.2a64 64 0 0 1 87.6-15.17z"),F(c,"fill",d=e[0].fill),F(c,"transform","rotate(240 64 64)"),F(u,"attributeName","transform"),F(u,"type","rotate"),F(u,"from","0 64 64"),F(u,"to","120 64 64"),F(u,"dur","360ms"),F(u,"repeatCount","indefinite"),F(t,"xmlns","http://www.w3.org/2000/svg"),F(t,"width",g=e[0].size),F(t,"height",f=e[0].size),F(t,"viewBox","0 0 128 128"),F(t,"xml:space","preserve"),F(t,"class",v=e[0].class)},m(e,n){O(e,t,n),C(t,i),C(t,o),C(t,r),C(r,a),C(r,h),C(r,c),C(r,u)},p(e,r){r&1&&n!==(n=e[0].fill)&&F(i,"fill",n),r&1&&s!==(s=e[0].fill)&&F(o,"fill",s),r&1&&l!==(l=e[0].fill)&&F(a,"fill",l),r&1&&p!==(p=e[0].fill)&&F(h,"fill",p),r&1&&d!==(d=e[0].fill)&&F(c,"fill",d),r&1&&g!==(g=e[0].size)&&F(t,"width",g),r&1&&f!==(f=e[0].size)&&F(t,"height",f),r&1&&v!==(v=e[0].class)&&F(t,"class",v)},d(e){e&&T(t)}}}function Se(e){let t,i=e[1]&&we(e);return{c(){i&&i.c(),t=W()},m(e,n){i&&i.m(e,n),O(e,t,n)},p(e,[n]){e[1]?i?i.p(e,n):(i=we(e),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},i:D,o:D,d(e){e&&T(t),i&&i.d(e)}}}function De(e,t,i){let n,{directions:o}=t,{configuration:s}=t;return o.on("fetchroutesstart",(()=>{i(1,n=!0)})),o.on("fetchroutesend",(()=>{i(1,n=!1)})),e.$$set=e=>{"directions"in e&&i(2,o=e.directions),"configuration"in e&&i(0,s=e.configuration)},[s,n,o]}class ct extends Oe{constructor(e){super(),me(this,e,De,Se,$,{directions:2,configuration:0})}}const Me={fill:"#6d26d7",size:"24px",class:""};class Dt{constructor(e,t){i(this,"controlElement");i(this,"directions");i(this,"configuration");this.directions=e,this.configuration=Object.assign({},Me,t)}onAdd(){return this.controlElement=document.createElement("div"),new ct({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}function Ee(e,t,i){const n=e.slice();return n[16]=t[i],n[17]=t,n[18]=i,n}function Le(e){let t,i,n,o,s,r,a,l,h;function p(){e[11].call(t,e[17],e[18])}return{c(){t=H("input"),r=k(),a=H("span"),a.textContent="°",F(t,"type","number"),t.disabled=i=!e[16].enabled,F(t,"min",n=e[0].degreesMin),F(t,"max",o=e[0].degreesMax),F(t,"step",s=e[0].degreesStep),F(t,"class","maplibre-gl-directions-bearings-control__input"),F(a,"class","maplibre-gl-directions-bearings-control__text")},m(i,n){O(i,t,n),J(t,e[16].degrees),O(i,r,n),O(i,a,n),l||(h=z(t,"input",p),l=!0)},p(r,a){e=r,a&2&&i!==(i=!e[16].enabled)&&(t.disabled=i),a&1&&n!==(n=e[0].degreesMin)&&F(t,"min",n),a&1&&o!==(o=e[0].degreesMax)&&F(t,"max",o),a&1&&s!==(s=e[0].degreesStep)&&F(t,"step",s),a&2&&q(t.value)!==e[16].degrees&&J(t,e[16].degrees)},d(e){e&&(T(t),T(r),T(a)),l=!1,h()}}}function Pe(e){let t,i,n,o=e[0].fixedDegrees+"";return{c(){t=H("span"),i=N(o),n=N("°"),F(t,"class","maplibre-gl-directions-bearings-control__text")},m(e,o){O(e,t,o),C(t,i),C(t,n)},p(e,t){t&1&&o!==(o=e[0].fixedDegrees+"")&&V(i,o)},d(e){e&&T(t)}}}function $e(e){let t,i,n,o,s,r,a,l,h,p,c,d,u,g,f,v,y,m,b,w,x,_,S,D,M,E,P=e[18];function $(){e[7].call(o,e[17],e[18])}const I=()=>e[8](r,P),R=()=>e[8](null,P);function N(...t){return e[9](e[18],...t)}function W(){e[10].call(u,e[17],e[18])}function U(e,t){return e[0].fixedDegrees?Pe:Le}let V=U(e),G=V(e);return{c(){t=H("div"),i=H("span"),i.textContent=`${e[18]+1}.`,n=k(),o=H("input"),s=k(),r=H("div"),a=B("svg"),l=B("circle"),c=B("circle"),d=k(),u=H("input"),m=k(),b=H("span"),b.textContent="°",w=k(),x=H("span"),x.textContent="±",_=k(),G.c(),S=k(),F(i,"class","maplibre-gl-directions-bearings-control__number text-slate-800"),F(o,"type","checkbox"),F(o,"class","maplibre-gl-directions-bearings-control__checkbox"),F(l,"r","5"),F(l,"cx","10"),F(l,"cy","10"),F(l,"fill","transparent"),F(l,"stroke","rgba(109, 38, 215, 0.65)"),F(l,"stroke-width","10"),F(l,"stroke-dasharray",h=e[16].degrees/3.6*31.42/100+" 31.42"),F(l,"transform",p="rotate("+(-90-e[16].degrees/2+e[16].angle-e[3])+")"),Y(l,"transform-origin","10px 10px"),F(c,"r","6"),F(c,"cx","10"),F(c,"cy","10"),F(c,"fill","rgb(109, 38, 215)"),F(a,"height","20"),F(a,"width","20"),F(a,"viewBox","0 0 20 20"),F(a,"class","maplibre-gl-directions-bearings-control__waypoint-image"),Y(a,"width",e[0].imageSize+"px"),Y(a,"height",e[0].imageSize+"px"),Y(a,"opacity",e[16].enabled?1:.25),F(r,"role","spinbutton"),F(r,"tabindex","0"),F(u,"type","number"),u.disabled=g=!e[16].enabled,F(u,"min",f=e[0].angleMin),F(u,"max",v=e[0].angleMax),F(u,"step",y=e[0].angleStep),F(u,"class","maplibre-gl-directions-bearings-control__input"),F(b,"class","maplibre-gl-directions-bearings-control__text"),F(x,"class","maplibre-gl-directions-bearings-control__text"),F(t,"class",D="maplibre-gl-directions-bearings-control__list-item "+(e[16].enabled?"maplibre-gl-directions-bearings-control__list-item--enabled":"maplibre-gl-directions-bearings-control__list-item--disabled")+" flex items-center gap-2 text-slate-800"+(e[16].enabled?"":"/50"))},m(h,p){O(h,t,p),C(t,i),C(t,n),C(t,o),o.checked=e[16].enabled,C(t,s),C(t,r),C(r,a),C(a,l),C(a,c),I(),C(t,d),C(t,u),J(u,e[16].angle),C(t,m),C(t,b),C(t,w),C(t,x),C(t,_),G.m(t,null),C(t,S),M||(E=[z(o,"change",$),z(r,"mousedown",N),z(u,"input",W)],M=!0)},p(i,n){e=i,n&2&&(o.checked=e[16].enabled),n&2&&h!==(h=e[16].degrees/3.6*31.42/100+" 31.42")&&F(l,"stroke-dasharray",h),n&10&&p!==(p="rotate("+(-90-e[16].degrees/2+e[16].angle-e[3])+")")&&F(l,"transform",p),n&1&&Y(a,"width",e[0].imageSize+"px"),n&1&&Y(a,"height",e[0].imageSize+"px"),n&2&&Y(a,"opacity",e[16].enabled?1:.25),P!==e[18]&&(R(),P=e[18],I()),n&2&&g!==(g=!e[16].enabled)&&(u.disabled=g),n&1&&f!==(f=e[0].angleMin)&&F(u,"min",f),n&1&&v!==(v=e[0].angleMax)&&F(u,"max",v),n&1&&y!==(y=e[0].angleStep)&&F(u,"step",y),n&2&&q(u.value)!==e[16].angle&&J(u,e[16].angle),V===(V=U(e))&&G?G.p(e,n):(G.d(1),G=V(e),G&&(G.c(),G.m(t,S))),n&2&&D!==(D="maplibre-gl-directions-bearings-control__list-item "+(e[16].enabled?"maplibre-gl-directions-bearings-control__list-item--enabled":"maplibre-gl-directions-bearings-control__list-item--disabled")+" flex items-center gap-2 text-slate-800"+(e[16].enabled?"":"/50"))&&F(t,"class",D)},d(e){e&&T(t),R(),G.d(),M=!1,L(E)}}}function Ie(e){let t,i,n,o=ge(e[1]),s=[];for(let t=0;t<o.length;t+=1)s[t]=$e(Ee(e,o,t));return{c(){t=H("div"),i=H("div");for(let e=0;e<s.length;e+=1)s[e].c();F(i,"class","maplibre-gl-directions-bearings-control__list flex flex-col max-h-96 overflow-y-auto"),F(t,"class",n="maplibre-gl-directions-bearings-control maplibregl-ctrl maplibregl-ctrl-group p-4 "+(e[1].length?"block":"hidden")+" bg-white text-base rounded")},m(e,n){O(e,t,n),C(t,i);for(let e=0;e<s.length;e+=1)s[e]&&s[e].m(i,null)},p(e,[r]){if(r&31){o=ge(e[1]);let t;for(t=0;t<o.length;t+=1){const n=Ee(e,o,t);s[t]?s[t].p(n,r):(s[t]=$e(n),s[t].c(),s[t].m(i,null))}for(;t<s.length;t+=1)s[t].d(1);s.length=o.length}r&2&&n!==(n="maplibre-gl-directions-bearings-control maplibregl-ctrl maplibregl-ctrl-group p-4 "+(e[1].length?"block":"hidden")+" bg-white text-base rounded")&&F(t,"class",n)},i:D,o:D,d(e){e&&T(t),R(s,e)}}}function Ce(e,t,i){let{directions:n}=t,{configuration:o}=t;n.configuration.bearings||console.warn("The Bearings Control is used, but the `bearings` configuration option is not enabled!");let s=[];n.on("addwaypoint",r),n.on("removewaypoint",r),n.on("movewaypoint",r),n.on("setwaypoints",r);function r(){i(1,s=n.waypointsBearings.map(((e,t)=>s[t]?s[t]:{enabled:o.defaultEnabled||!!e,angle:e?e[0]:o.angleDefault,degrees:e?e[1]:o.fixedDegrees?o.fixedDegrees:o.degreesDefault})))}r();let a;const l=[];let h=-1;function p(e,t){var i;(i=s[t])!=null&&i.enabled&&(h=t,document.addEventListener("mouseup",c),document.addEventListener("mousemove",d))}function c(){h=-1,document.removeEventListener("mouseup",c),document.removeEventListener("mousemove",d)}function d(e){const t=l[h];if(t){const n=t.getBoundingClientRect().x+o.imageSize/2,r=t.getBoundingClientRect().y+o.imageSize/2,a=e.pageX,l=e.pageY,p=Math.atan2(a-n,l-r)*(180/Math.PI)*-1+90;i(1,s[h].angle=90+p+u|0,s)}}Q((()=>{document.removeEventListener("mouseup",c),document.removeEventListener("mousemove",d)}));let u=0;o.respectMapBearing&&n.map.on("rotate",(()=>i(3,u=n.map.getBearing())));function g(e,t){e[t].enabled=this.checked,i(1,s)}function f(e,t){ee[e?"unshift":"push"]((()=>{l[t]=e,i(2,l)}))}const v=(e,t)=>p(t,e);function y(e,t){e[t].angle=q(this.value),i(1,s)}function m(e,t){e[t].degrees=q(this.value),i(1,s)}return e.$$set=e=>{"directions"in e&&i(5,n=e.directions),"configuration"in e&&i(0,o=e.configuration)},e.$$.update=()=>{e.$$.dirty&67&&(a&&clearTimeout(a),i(6,a=setTimeout((()=>{i(5,n.waypointsBearings=s.map((e=>e.enabled?[e.angle,e.degrees]:void 0)),n)}),o.debounceTimeout)))},[o,s,l,u,p,n,a,g,f,v,y,m]}let Te=class extends Oe{constructor(e){super(),me(this,e,Ce,Ie,$,{directions:5,configuration:0})}};const Re={defaultEnabled:!1,debounceTimeout:150,angleDefault:0,angleMin:0,angleMax:359,angleStep:1,fixedDegrees:0,degreesDefault:45,degreesMin:15,degreesMax:360,degreesStep:15,respectMapBearing:!1,imageSize:50};class Mt{constructor(e,t){i(this,"controlElement");i(this,"directions");i(this,"configuration");this.directions=e,this.configuration=Object.assign({},Re,t)}onAdd(){return this.controlElement=document.createElement("div"),new Te({target:this.controlElement,props:{directions:this.directions,configuration:this.configuration}}),this.controlElement}onRemove(){this.controlElement.remove()}}export{Mt as BearingsControl,Dt as LoadingIndicatorControl,j as MapLibreGlDirectionsCancelableEvent,A as MapLibreGlDirectionsNonCancelableEvent,_t as default,l as layersFactory,S as utils};

