var e=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var l={};
/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.17.0/LICENSE.txt
 */(function(e,c){l=c()})(0,(function(){var l={};var c={};function d(e,d,p){c[e]=p;if(e==="index"){var f="var sharedModule = {}; ("+c.shared+")(sharedModule); ("+c.worker+")(sharedModule);";var m={};c.shared(m);c.index(l,m);typeof window!=="undefined"&&l.setWorkerUrl(window.URL.createObjectURL(new Blob([f],{type:"text/javascript"})));return l}}d("shared",["exports"],(function(l){function c(e,l,c,d){return new(c||(c=Promise))((function(p,f){function m(e){try{g(d.next(e))}catch(e){f(e)}}function _(e){try{g(d.throw(e))}catch(e){f(e)}}function g(e){var l;e.done?p(e.value):(l=e.value,l instanceof c?l:new c((function(e){e(l)}))).then(m,_)}g((d=d.apply(e,l||[])).next())}))}function d(l,c){(this||e).x=l,(this||e).y=c}function p(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var f,m;"function"==typeof SuppressedError&&SuppressedError,d.prototype={clone(){return new d((this||e).x,(this||e).y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,l){return this.clone()._rotateAround(e,l)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt((this||e).x*(this||e).x+(this||e).y*(this||e).y)},equals(l){return(this||e).x===l.x&&(this||e).y===l.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(l){const c=l.x-(this||e).x,d=l.y-(this||e).y;return c*c+d*d},angle(){return Math.atan2((this||e).y,(this||e).x)},angleTo(l){return Math.atan2((this||e).y-l.y,(this||e).x-l.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(l,c){return Math.atan2((this||e).x*c-(this||e).y*l,(this||e).x*l+(this||e).y*c)},_matMult(l){const c=l[2]*(this||e).x+l[3]*(this||e).y;return(this||e).x=l[0]*(this||e).x+l[1]*(this||e).y,(this||e).y=c,this||e},_add(l){return(this||e).x+=l.x,(this||e).y+=l.y,this||e},_sub(l){return(this||e).x-=l.x,(this||e).y-=l.y,this||e},_mult(l){return(this||e).x*=l,(this||e).y*=l,this||e},_div(l){return(this||e).x/=l,(this||e).y/=l,this||e},_multByPoint(l){return(this||e).x*=l.x,(this||e).y*=l.y,this||e},_divByPoint(l){return(this||e).x/=l.x,(this||e).y/=l.y,this||e},_unit(){return this._div(this.mag()),this||e},_perp(){const l=(this||e).y;return(this||e).y=(this||e).x,(this||e).x=-l,this||e},_rotate(l){const c=Math.cos(l),d=Math.sin(l),p=d*(this||e).x+c*(this||e).y;return(this||e).x=c*(this||e).x-d*(this||e).y,(this||e).y=p,this||e},_rotateAround(l,c){const d=Math.cos(l),p=Math.sin(l),f=c.y+p*((this||e).x-c.x)+d*((this||e).y-c.y);return(this||e).x=c.x+d*((this||e).x-c.x)-p*((this||e).y-c.y),(this||e).y=f,this||e},_round(){return(this||e).x=Math.round((this||e).x),(this||e).y=Math.round((this||e).y),this||e},constructor:d},d.convert=function(e){if(e instanceof d)return e;if(Array.isArray(e))return new d(+e[0],+e[1]);if(void 0!==e.x&&void 0!==e.y)return new d(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};var _=function(){if(m)return f;function l(l,c,d,p){(this||e).cx=3*l,(this||e).bx=3*(d-l)-(this||e).cx,(this||e).ax=1-(this||e).cx-(this||e).bx,(this||e).cy=3*c,(this||e).by=3*(p-c)-(this||e).cy,(this||e).ay=1-(this||e).cy-(this||e).by,(this||e).p1x=l,(this||e).p1y=c,(this||e).p2x=d,(this||e).p2y=p}return m=1,f=l,l.prototype={sampleCurveX:function(l){return(((this||e).ax*l+(this||e).bx)*l+(this||e).cx)*l},sampleCurveY:function(l){return(((this||e).ay*l+(this||e).by)*l+(this||e).cy)*l},sampleCurveDerivativeX:function(l){return(3*(this||e).ax*l+2*(this||e).bx)*l+(this||e).cx},solveCurveX:function(e,l){if(void 0===l&&(l=1e-6),e<0)return 0;if(e>1)return 1;for(var c=e,d=0;d<8;d++){var p=this.sampleCurveX(c)-e;if(Math.abs(p)<l)return c;var f=this.sampleCurveDerivativeX(c);if(Math.abs(f)<1e-6)break;c-=p/f}var m=0,_=1;for(c=e,d=0;d<20&&(p=this.sampleCurveX(c),!(Math.abs(p-e)<l));d++)e>p?m=c:_=c,c=.5*(_-m)+m;return c},solve:function(e,l){return this.sampleCurveY(this.solveCurveX(e,l))}},f}(),g=p(_);let y,b;function T(){return null==y&&(y="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),y}function S(){if(null==b&&(b=!1,T())){const e=5,l=new OffscreenCanvas(e,e).getContext("2d",{willReadFrequently:!0});if(l){for(let c=0;c<e*e;c++){const d=4*c;l.fillStyle=`rgb(${d},${d+1},${d+2})`,l.fillRect(c%e,Math.floor(c/e),1,1)}const c=l.getImageData(0,0,e,e).data;for(let l=0;l<e*e*4;l++)if(l%4!=3&&c[l]!==l){b=!0;break}}}return b||!1}var P=1e-6,I="undefined"!=typeof Float32Array?Float32Array:Array;function C(){var e=new I(9);return I!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function R(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function L(){var e=new I(3);return I!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function F(e){var l=e[0],c=e[1],d=e[2];return Math.sqrt(l*l+c*c+d*d)}function B(e,l,c){var d=new I(3);return d[0]=e,d[1]=l,d[2]=c,d}function O(e,l,c){return e[0]=l[0]+c[0],e[1]=l[1]+c[1],e[2]=l[2]+c[2],e}function V(e,l,c){return e[0]=l[0]*c,e[1]=l[1]*c,e[2]=l[2]*c,e}function j(e,l,c){var d=l[0],p=l[1],f=l[2],m=c[0],_=c[1],g=c[2];return e[0]=p*g-f*_,e[1]=f*m-d*g,e[2]=d*_-p*m,e}var G,U=F;function q(e,l,c){var d=l[0],p=l[1],f=l[2],m=l[3];return e[0]=c[0]*d+c[4]*p+c[8]*f+c[12]*m,e[1]=c[1]*d+c[5]*p+c[9]*f+c[13]*m,e[2]=c[2]*d+c[6]*p+c[10]*f+c[14]*m,e[3]=c[3]*d+c[7]*p+c[11]*f+c[15]*m,e}function Z(){var e=new I(4);return I!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function W(e,l,c,d){var p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"zyx",f=Math.PI/360;l*=f,d*=f,c*=f;var m=Math.sin(l),_=Math.cos(l),g=Math.sin(c),y=Math.cos(c),b=Math.sin(d),T=Math.cos(d);switch(p){case"xyz":e[0]=m*y*T+_*g*b,e[1]=_*g*T-m*y*b,e[2]=_*y*b+m*g*T,e[3]=_*y*T-m*g*b;break;case"xzy":e[0]=m*y*T-_*g*b,e[1]=_*g*T-m*y*b,e[2]=_*y*b+m*g*T,e[3]=_*y*T+m*g*b;break;case"yxz":e[0]=m*y*T+_*g*b,e[1]=_*g*T-m*y*b,e[2]=_*y*b-m*g*T,e[3]=_*y*T+m*g*b;break;case"yzx":e[0]=m*y*T+_*g*b,e[1]=_*g*T+m*y*b,e[2]=_*y*b-m*g*T,e[3]=_*y*T-m*g*b;break;case"zxy":e[0]=m*y*T-_*g*b,e[1]=_*g*T+m*y*b,e[2]=_*y*b+m*g*T,e[3]=_*y*T-m*g*b;break;case"zyx":e[0]=m*y*T-_*g*b,e[1]=_*g*T+m*y*b,e[2]=_*y*b-m*g*T,e[3]=_*y*T+m*g*b;break;default:throw new Error("Unknown angle order "+p)}return e}function Q(){var e=new I(2);return I!=Float32Array&&(e[0]=0,e[1]=0),e}function J(e,l){var c=new I(2);return c[0]=e,c[1]=l,c}L(),G=new I(4),I!=Float32Array&&(G[0]=0,G[1]=0,G[2]=0,G[3]=0),L(),B(1,0,0),B(0,1,0),Z(),Z(),C(),Q();const re=8192;function oe(e,l,c){return l*(re/(e.tileSize*Math.pow(2,c-e.tileID.overscaledZ)))}function le(e,l){return(e%l+l)%l}function ce(e,l,c){return e*(1-c)+l*c}function he(e){if(e<=0)return 0;if(e>=1)return 1;const l=e*e,c=l*e;return 4*(e<.5?c:3*(e-l)+c-.75)}function ue(e,l,c,d){const p=new g(e,l,c,d);return e=>p.solve(e)}const pe=ue(.25,.1,.25,1);function fe(e,l,c){return Math.min(c,Math.max(l,e))}function me(e,l,c){const d=c-l,p=((e-l)%d+d)%d+l;return p===l?c:p}function ge(e,...l){for(const c of l)for(const l in c)e[l]=c[l];return e}let ye=1;function xe(l,c,d){const p={};for(const d in l)p[d]=c.call(this||e,l[d],d,l);return p}function ve(l,c,d){const p={};for(const d in l)c.call(this||e,l[d],d,l)&&(p[d]=l[d]);return p}function be(e){return Array.isArray(e)?e.map(be):"object"==typeof e&&e?xe(e,be):e}const we={};function Se(e){we[e]||("undefined"!=typeof console&&console.warn(e),we[e]=!0)}function Me(e,l,c){return(c.y-e.y)*(l.x-e.x)>(l.y-e.y)*(c.x-e.x)}function Ee(e){return"undefined"!=typeof WorkerGlobalScope&&void 0!==e&&e instanceof WorkerGlobalScope}let Ce=null;function Ae(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}const Ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ge(l,d,p,f,m){return c(this||e,void 0,void 0,(function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const e=new VideoFrame(l,{timestamp:0});try{const c=null==e?void 0:e.format;if(!c||!c.startsWith("BGR")&&!c.startsWith("RGB"))throw new Error(`Unrecognized format ${c}`);const _=c.startsWith("BGR"),g=new Uint8ClampedArray(f*m*4);if(yield e.copyTo(g,function(e,l,c,d,p){const f=4*Math.max(-l,0),m=(Math.max(0,c)-c)*d*4+f,_=4*d,g=Math.max(0,l),y=Math.max(0,c);return{rect:{x:g,y:y,width:Math.min(e.width,l+d)-g,height:Math.min(e.height,c+p)-y},layout:[{offset:m,stride:_}]}}(l,d,p,f,m)),_)for(let e=0;e<g.length;e+=4){const l=g[e];g[e]=g[e+2],g[e+2]=l}return g}finally{e.close()}}))}let Ue,qe;function $e(e,l,c,d){return e.addEventListener(l,c,d),{unsubscribe:()=>{e.removeEventListener(l,c,d)}}}function He(e){return e*Math.PI/180}function Ye(e){return e/Math.PI*180}const et={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},tt={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},it="AbortError";class st extends Error{constructor(e=it){super(e instanceof Error?e.message:e),this.name=it,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function rt(e){return e.name===it}const ot={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function at(e){return ot.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))]}const ft="global-dispatcher";class ct extends Error{constructor(e,l,c,d){super(`AJAXError: ${l} (${e}): ${c}`),this.status=e,this.statusText=l,this.url=c,this.body=d}}const _t=()=>Ee(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,yt=function(l,d){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){const e=at(l.url);if(e)return e(l,d);if(Ee(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,targetMapId:ft},d)}if(!(/^file:/.test(p=l.url)||/^file:/.test(_t())&&!/^\w+:/.test(p))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(l,d){return c(this||e,void 0,void 0,(function*(){const e=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:_t(),signal:d.signal});let c,p;"json"!==l.type||e.headers.has("Accept")||e.headers.set("Accept","application/json");try{c=yield fetch(e)}catch(e){if(rt(e))throw e;throw new ct(0,e.message,l.url,new Blob)}if(!c.ok){const e=yield c.blob();throw new ct(c.status,c.statusText,l.url,e)}p="arrayBuffer"===l.type||"image"===l.type?c.arrayBuffer():"json"===l.type?c.json():c.text();const f=yield p;return d.signal.throwIfAborted(),{data:f,cacheControl:c.headers.get("Cache-Control"),expires:c.headers.get("Expires")}}))}(l,d);if(Ee(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,mustQueue:!0,targetMapId:ft},d)}var p;return function(e,l){return new Promise(((c,d)=>{var p;const f=new XMLHttpRequest;f.open(e.method||"GET",e.url,!0),"arrayBuffer"!==e.type&&"image"!==e.type||(f.responseType="arraybuffer");for(const l in e.headers)f.setRequestHeader(l,e.headers[l]);"json"===e.type&&(f.responseType="text",(null===(p=e.headers)||void 0===p?void 0:p.Accept)||f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===e.credentials,f.onerror=()=>{d(new Error(f.statusText))},f.onload=()=>{if(!l.signal.aborted)if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let l=f.response;if("json"===e.type)try{l=JSON.parse(f.response)}catch(e){return void d(e)}c({data:l,cacheControl:f.getResponseHeader("Cache-Control"),expires:f.getResponseHeader("Expires")})}else{const l=new Blob([f.response],{type:f.getResponseHeader("Content-Type")});d(new ct(f.status,f.statusText,e.url,l))}},l.signal.addEventListener("abort",(()=>{f.abort(),d(new st(l.signal.reason))})),f.send(e.body)}))}(l,d)};function vt(e){if(!e||e.indexOf("://")<=0||0===e.indexOf("data:image/")||0===e.indexOf("blob:"))return!0;const l=new URL(e),c=window.location;return l.protocol===c.protocol&&l.host===c.host}function bt(e,l,c){c[e]&&-1!==c[e].indexOf(l)||(c[e]=c[e]||[],c[e].push(l))}function wt(e,l,c){if(c&&c[e]){const d=c[e].indexOf(l);-1!==d&&c[e].splice(d,1)}}class mt{constructor(e,l={}){ge(this,l),this.type=e}}class gt extends mt{constructor(e,l={}){super("error",ge({error:e},l))}}class xt{on(e,l){return this._listeners=this._listeners||{},bt(e,l,this._listeners),{unsubscribe:()=>{this.off(e,l)}}}off(e,l){return wt(e,l,this._listeners),wt(e,l,this._oneTimeListeners),this}once(e,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},bt(e,l,this._oneTimeListeners),this):new Promise((l=>this.once(e,l)))}fire(e,l){"string"==typeof e&&(e=new mt(e,l||{}));const c=e.type;if(this.listens(c)){e.target=this;const l=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const c of l)c.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const l of d)wt(c,l,this._oneTimeListeners),l.call(this,e);const p=this._eventedParent;p&&(ge(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof gt&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,l){return this._eventedParent=e,this._eventedParentData=l,this}}var Tt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Mt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function At(e,l){const c={};for(const l in e)"ref"!==l&&(c[l]=e[l]);return Mt.forEach((e=>{e in l&&(c[e]=l[e])})),c}function Lt(e,l){if(Array.isArray(e)){if(!Array.isArray(l)||e.length!==l.length)return!1;for(let c=0;c<e.length;c++)if(!Lt(e[c],l[c]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==l){if("object"!=typeof l)return!1;if(Object.keys(e).length!==Object.keys(l).length)return!1;for(const c in e)if(!Lt(e[c],l[c]))return!1;return!0}return e===l}function Ft(e,l){e.push(l)}function Ot(e,l,c){Ft(c,{command:"addSource",args:[e,l[e]]})}function Ut(e,l,c){Ft(l,{command:"removeSource",args:[e]}),c[e]=!0}function Zt(e,l,c,d){Ut(e,c,d),Ot(e,l,c)}function Ht(e,l,c){let d;for(d in e[c])if(Object.prototype.hasOwnProperty.call(e[c],d)&&"data"!==d&&!Lt(e[c][d],l[c][d]))return!1;for(d in l[c])if(Object.prototype.hasOwnProperty.call(l[c],d)&&"data"!==d&&!Lt(e[c][d],l[c][d]))return!1;return!0}function Xt(e,l,c,d,p,f){e=e||{},l=l||{};for(const m in e)Object.prototype.hasOwnProperty.call(e,m)&&(Lt(e[m],l[m])||c.push({command:f,args:[d,m,l[m],p]}));for(const m in l)Object.prototype.hasOwnProperty.call(l,m)&&!Object.prototype.hasOwnProperty.call(e,m)&&(Lt(e[m],l[m])||c.push({command:f,args:[d,m,l[m],p]}))}function Kt(e){return e.id}function Jt(e,l){return e[l.id]=l,e}class Dt{constructor(e,l,c,d){this.message=(e?`${e}: `:"")+c,d&&(this.identifier=d),null!=l&&l.__line__&&(this.line=l.__line__)}}function ri(e,...l){for(const c of l)for(const l in c)e[l]=c[l];return e}class Pt extends Error{constructor(e,l){super(l),this.message=l,this.key=e}}class Bt{constructor(e,l=[]){this.parent=e,this.bindings={};for(const[e,c]of l)this.bindings[e]=c}concat(e){return new Bt(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ni={kind:"null"},li={kind:"number"},ci={kind:"string"},ui={kind:"boolean"},pi={kind:"color"},fi={kind:"projectionDefinition"},mi={kind:"object"},_i={kind:"value"},gi={kind:"collator"},yi={kind:"formatted"},xi={kind:"padding"},vi={kind:"colorArray"},bi={kind:"numberArray"},wi={kind:"resolvedImage"},Ii={kind:"variableAnchorOffsetCollection"};function Ei(e,l){return{kind:"array",itemType:e,N:l}}function Ci(e){if("array"===e.kind){const l=Ci(e.itemType);return"number"==typeof e.N?`array<${l}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${l}>`}return e.kind}const Ai=[ni,li,ci,ui,pi,fi,yi,mi,Ei(_i),xi,bi,vi,wi,Ii];function Li(e,l){if("error"===l.kind)return null;if("array"===e.kind){if("array"===l.kind&&(0===l.N&&"value"===l.itemType.kind||!Li(e.itemType,l.itemType))&&("number"!=typeof e.N||e.N===l.N))return null}else{if(e.kind===l.kind)return null;if("value"===e.kind)for(const e of Ai)if(!Li(e,l))return null}return`Expected ${Ci(e)} but found ${Ci(l)} instead.`}function Fi(e,l){return l.some((l=>l.kind===e.kind))}function Oi(e,l){return l.some((l=>"null"===l?null===e:"array"===l?Array.isArray(e):"object"===l?e&&!Array.isArray(e)&&"object"==typeof e:l===typeof e))}function Vi(e,l){return"array"===e.kind&&"array"===l.kind?e.itemType.kind===l.itemType.kind&&"number"==typeof e.N:e.kind===l.kind}const ji=.96422,Ni=.82521,Gi=4/29,Ui=6/29,qi=3*Ui*Ui,$i=Ui*Ui*Ui,Wi=Math.PI/180,Hi=180/Math.PI;function Xi(e){return(e%=360)<0&&(e+=360),e}function Yi([e,l,c,d]){let p,f;const m=Qi((.2225045*(e=Ki(e))+.7168786*(l=Ki(l))+.0606169*(c=Ki(c)))/1);e===l&&l===c?p=f=m:(p=Qi((.4360747*e+.3850649*l+.1430804*c)/ji),f=Qi((.0139322*e+.0971045*l+.7141733*c)/Ni));const _=116*m-16;return[_<0?0:_,500*(p-m),200*(m-f),d]}function Ki(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Qi(e){return e>$i?Math.pow(e,1/3):e/qi+Gi}function Ji([e,l,c,d]){let p=(e+16)/116,f=isNaN(l)?p:p+l/500,m=isNaN(c)?p:p-c/200;return p=1*ur(p),f=ji*ur(f),m=Ni*ur(m),[ar(3.1338561*f-1.6168667*p-.4906146*m),ar(-.9787684*f+1.9161415*p+.033454*m),ar(.0719453*f-.2289914*p+1.4052427*m),d]}function ar(e){return(e=e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055)<0?0:e>1?1:e}function ur(e){return e>Ui?e*e*e:qi*(e-Gi)}const gr=Object.hasOwn||function(e,l){return Object.prototype.hasOwnProperty.call(e,l)};function vr(e,l){return gr(e,l)?e[l]:void 0}function wr(e){return parseInt(e.padEnd(2,e),16)/255}function Cr(e,l){return Dr(l?e/100:e,0,1)}function Dr(e,l,c){return Math.min(Math.max(l,e),c)}function zr(e){return!e.some(Number.isNaN)}const kr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Lr(e,l,c){return e+c*(l-e)}function qr(e,l,c){return e.map(((e,d)=>Lr(e,l[d],c)))}class Te{constructor(e,l,c,d=1,p=!0){this.r=e,this.g=l,this.b=c,this.a=d,p||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[e,l,c,d]))}static parse(e){if(e instanceof Te)return e;if("string"!=typeof e)return;const l=function(e){if("transparent"===(e=e.toLowerCase().trim()))return[0,0,0,0];const l=vr(kr,e);if(l){const[e,c,d]=l;return[e/255,c/255,d/255,1]}if(e.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(e)){const l=e.length<6?1:2;let c=1;return[wr(e.slice(c,c+=l)),wr(e.slice(c,c+=l)),wr(e.slice(c,c+=l)),wr(e.slice(c,c+l)||"ff")]}if(e.startsWith("rgb")){const l=e.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(l){const[e,c,d,p,f,m,_,g,y,b,T,S]=l,P=[p||" ",_||" ",b].join("");if("  "===P||"  /"===P||",,"===P||",,,"===P){const e=[d,m,y].join(""),l="%%%"===e?100:""===e?255:0;if(l){const e=[Dr(+c/l,0,1),Dr(+f/l,0,1),Dr(+g/l,0,1),T?Cr(+T,S):1];if(zr(e))return e}}return}}const c=e.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(c){const[e,l,d,p,f,m,_,g,y]=c,b=[d||" ",f||" ",_].join("");if("  "===b||"  /"===b||",,"===b||",,,"===b){const e=[+l,Dr(+p,0,100),Dr(+m,0,100),g?Cr(+g,y):1];if(zr(e))return function([e,l,c,d]){function p(d){const p=(d+e/30)%12,f=l*Math.min(c,1-c);return c-f*Math.max(-1,Math.min(p-3,9-p,1))}return e=Xi(e),l/=100,c/=100,[p(0),p(8),p(4),d]}(e)}}}(e);return l?new Te(...l,!1):void 0}get rgb(){const{r:e,g:l,b:c,a:d}=this,p=d||1/0;return this.overwriteGetter("rgb",[e/p,l/p,c/p,d])}get hcl(){return this.overwriteGetter("hcl",function(e){const[l,c,d,p]=Yi(e),f=Math.sqrt(c*c+d*d);return[Math.round(1e4*f)?Xi(Math.atan2(d,c)*Hi):NaN,f,l,p]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Yi(this.rgb))}overwriteGetter(e,l){return Object.defineProperty(this,e,{value:l}),l}toString(){const[e,l,c,d]=this.rgb;return`rgba(${[e,l,c].map((e=>Math.round(255*e))).join(",")},${d})`}static interpolate(e,l,c,d="rgb"){switch(d){case"rgb":{const[d,p,f,m]=qr(e.rgb,l.rgb,c);return new Te(d,p,f,m,!1)}case"hcl":{const[d,p,f,m]=e.hcl,[_,g,y,b]=l.hcl;let T,S;if(isNaN(d)||isNaN(_))isNaN(d)?isNaN(_)?T=NaN:(T=_,1!==f&&0!==f||(S=g)):(T=d,1!==y&&0!==y||(S=p));else{let e=_-d;_>d&&e>180?e-=360:_<d&&d-_>180&&(e+=360),T=d+c*e}const[P,I,C,R]=function([e,l,c,d]){return e=isNaN(e)?0:e*Wi,Ji([c,Math.cos(e)*l,Math.sin(e)*l,d])}([T,null!=S?S:Lr(p,g,c),Lr(f,y,c),Lr(m,b,c)]);return new Te(P,I,C,R,!1)}case"lab":{const[d,p,f,m]=Ji(qr(e.lab,l.lab,c));return new Te(d,p,f,m,!1)}}}}Te.black=new Te(0,0,0,1),Te.white=new Te(1,1,1,1),Te.transparent=new Te(0,0,0,0),Te.red=new Te(1,0,0,1);class Ie{constructor(e,l,c){this.sensitivity=e?l?"variant":"case":l?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,l){return this.collator.compare(e,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const $r=["bottom","center","top"];class Fe{constructor(e,l,c,d,p,f){this.text=e,this.image=l,this.scale=c,this.fontStack=d,this.textColor=p,this.verticalAlign=f}}class De{constructor(e){this.sections=e}static fromString(e){return new De([new Fe(e,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof De?e:De.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}}class ze{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ze)return e;if("number"==typeof e)return new ze([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const l of e)if("number"!=typeof l)return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new ze(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,l,c){return new ze(qr(e.values,l.values,c))}}class Pe{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Pe)return e;if("number"==typeof e)return new Pe([e]);if(Array.isArray(e)){for(const l of e)if("number"!=typeof l)return;return new Pe(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,l,c){return new Pe(qr(e.values,l.values,c))}}class Be{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Be)return e;if("string"==typeof e){const l=Te.parse(e);if(!l)return;return new Be([l])}if(!Array.isArray(e))return;const l=[];for(const c of e){if("string"!=typeof c)return;const e=Te.parse(c);if(!e)return;l.push(e)}return new Be(l)}toString(){return JSON.stringify(this.values)}static interpolate(e,l,c,d="rgb"){const p=[];if(e.values.length!=l.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${l.values.length}), cannot interpolate.`);for(let f=0;f<e.values.length;f++)p.push(Te.interpolate(e.values[f],l.values[f],c,d));return new Be(p)}}class Ve extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Kr=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Le{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Le)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let l=0;l<e.length;l+=2){const c=e[l],d=e[l+1];if("string"!=typeof c||!Kr.has(c))return;if(!Array.isArray(d)||2!==d.length||"number"!=typeof d[0]||"number"!=typeof d[1])return}return new Le(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,l,c){const d=e.values,p=l.values;if(d.length!==p.length)throw new Ve(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${l.toString()}`);const f=[];for(let e=0;e<d.length;e+=2){if(d[e]!==p[e])throw new Ve(`Cannot interpolate values containing mismatched anchors. from[${e}]: ${d[e]}, to[${e}]: ${p[e]}`);f.push(d[e]);const[l,m]=d[e+1],[_,g]=p[e+1];f.push([Lr(l,_,c),Lr(m,g,c)])}return new Le(f)}}class Oe{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Oe({name:e,available:!1}):null}}class Re{constructor(e,l,c){this.from=e,this.to=l,this.transition=c}static interpolate(e,l,c){return new Re(e,l,c)}static parse(e){return e instanceof Re?e:Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]?new Re(e[0],e[1],e[2]):"object"==typeof e&&"string"==typeof e.from&&"string"==typeof e.to&&"number"==typeof e.transition?new Re(e.from,e.to,e.transition):"string"==typeof e?new Re(e,e,1):void 0}}function en(e,l,c,d){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof l&&l>=0&&l<=255&&"number"==typeof c&&c>=0&&c<=255?void 0===d||"number"==typeof d&&d>=0&&d<=1?null:`Invalid rgba value [${[e,l,c,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof d?[e,l,c,d]:[e,l,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function tn(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof Re||e instanceof Te||e instanceof Ie||e instanceof De||e instanceof ze||e instanceof Pe||e instanceof Be||e instanceof Le||e instanceof Oe)return!0;if(Array.isArray(e)){for(const l of e)if(!tn(l))return!1;return!0}if("object"==typeof e){for(const l in e)if(!tn(e[l]))return!1;return!0}return!1}function rn(e){if(null===e)return ni;if("string"==typeof e)return ci;if("boolean"==typeof e)return ui;if("number"==typeof e)return li;if(e instanceof Te)return pi;if(e instanceof Re)return fi;if(e instanceof Ie)return gi;if(e instanceof De)return yi;if(e instanceof ze)return xi;if(e instanceof Pe)return bi;if(e instanceof Be)return vi;if(e instanceof Le)return Ii;if(e instanceof Oe)return wi;if(Array.isArray(e)){const l=e.length;let c;for(const l of e){const e=rn(l);if(c){if(c===e)continue;c=_i;break}c=e}return Ei(c||_i,l)}return mi}function nn(e){const l=typeof e;return null===e?"":"string"===l||"number"===l||"boolean"===l?String(e):e instanceof Te||e instanceof Re||e instanceof De||e instanceof ze||e instanceof Pe||e instanceof Be||e instanceof Le||e instanceof Oe?e.toString():JSON.stringify(e)}class je{constructor(e,l){this.type=e,this.value=l}static parse(e,l){if(2!==e.length)return l.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!tn(e[1]))return l.error("invalid value");const c=e[1];let d=rn(c);const p=l.expectedType;return"array"!==d.kind||0!==d.N||!p||"array"!==p.kind||"number"==typeof p.N&&0!==p.N||(d=p),new je(d,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const sn={string:ci,number:li,boolean:ui,object:mi};class Xe{constructor(e,l){this.type=e,this.args=l}static parse(e,l){if(e.length<2)return l.error("Expected at least one argument.");let c,d=1;const p=e[0];if("array"===p){let p,f;if(e.length>2){const c=e[1];if("string"!=typeof c||!(c in sn)||"object"===c)return l.error('The item type argument of "array" must be one of string, number, boolean',1);p=sn[c],d++}else p=_i;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return l.error('The length argument to "array" must be a positive integer literal',2);f=e[2],d++}c=Ei(p,f)}else{if(!sn[p])throw new Error(`Types doesn't contain name = ${p}`);c=sn[p]}const f=[];for(;d<e.length;d++){const c=l.parse(e[d],d,_i);if(!c)return null;f.push(c)}return new Xe(c,f)}evaluate(e){for(let l=0;l<this.args.length;l++){const c=this.args[l].evaluate(e);if(!Li(this.type,rn(c)))return c;if(l===this.args.length-1)throw new Ve(`Expected value to be of type ${Ci(this.type)}, but found ${Ci(rn(c))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const an={"to-boolean":ui,"to-color":pi,"to-number":li,"to-string":ci};class Ze{constructor(e,l){this.type=e,this.args=l}static parse(e,l){if(e.length<2)return l.error("Expected at least one argument.");const c=e[0];if(!an[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if(("to-boolean"===c||"to-string"===c)&&2!==e.length)return l.error("Expected one argument.");const d=an[c],p=[];for(let c=1;c<e.length;c++){const d=l.parse(e[c],c,_i);if(!d)return null;p.push(d)}return new Ze(d,p)}evaluate(e){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(e));case"color":{let l,c;for(const d of this.args){if(l=d.evaluate(e),c=null,l instanceof Te)return l;if("string"==typeof l){const c=e.parseColor(l);if(c)return c}else if(Array.isArray(l)&&(c=l.length<3||l.length>4?`Invalid rgba value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:en(l[0],l[1],l[2],l[3]),!c))return new Te(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Ve(c||`Could not parse color from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const c of this.args){l=c.evaluate(e);const d=ze.parse(l);if(d)return d}throw new Ve(`Could not parse padding from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}case"numberArray":{let l;for(const c of this.args){l=c.evaluate(e);const d=Pe.parse(l);if(d)return d}throw new Ve(`Could not parse numberArray from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}case"colorArray":{let l;for(const c of this.args){l=c.evaluate(e);const d=Be.parse(l);if(d)return d}throw new Ve(`Could not parse colorArray from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const c of this.args){l=c.evaluate(e);const d=Le.parse(l);if(d)return d}throw new Ve(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const c of this.args){if(l=c.evaluate(e),null===l)return 0;const d=Number(l);if(!isNaN(d))return d}throw new Ve(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return De.fromString(nn(this.args[0].evaluate(e)));case"resolvedImage":return Oe.fromString(nn(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return nn(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const ln=["Unknown","Point","LineString","Polygon"];class Ke{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ln[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let l=this._parseColorCache.get(e);return l||(l=Te.parse(e),this._parseColorCache.set(e,l)),l}}class We{constructor(e,l,c=[],d,p=new Bt,f=[]){this.registry=e,this.path=c,this.key=c.map((e=>`[${e}]`)).join(""),this.scope=p,this.errors=f,this.expectedType=d,this._isConstant=l}parse(e,l,c,d,p={}){return l?this.concat(l,c,d)._parse(e,p):this._parse(e,p)}_parse(e,l){function c(e,l,c){return"assert"===c?new Xe(l,[e]):"coerce"===c?new Ze(l,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if("string"!=typeof d)return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[d];if(p){let d=p.parse(e,this);if(!d)return null;if(this.expectedType){const e=this.expectedType,p=d.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==p.kind){if("projectionDefinition"===e.kind&&["string","array"].includes(p.kind)||["color","formatted","resolvedImage"].includes(e.kind)&&["value","string"].includes(p.kind)||["padding","numberArray"].includes(e.kind)&&["value","number","array"].includes(p.kind)||"colorArray"===e.kind&&["value","string","array"].includes(p.kind)||"variableAnchorOffsetCollection"===e.kind&&["value","array"].includes(p.kind))d=c(d,e,l.typeAnnotation||"coerce");else if(this.checkSubtype(e,p))return null}else d=c(d,e,l.typeAnnotation||"assert")}if(!(d instanceof je)&&"resolvedImage"!==d.type.kind&&this._isConstant(d)){const l=new Ke;try{d=new je(d.type,d.evaluate(l))}catch(e){return this.error(e.message),null}}return d}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,l,c){const d="number"==typeof e?this.path.concat(e):this.path,p=c?this.scope.concat(c):this.scope;return new We(this.registry,this._isConstant,d,l||null,p,this.errors)}error(e,...l){const c=`${this.key}${l.map((e=>`[${e}]`)).join("")}`;this.errors.push(new Pt(c,e))}checkSubtype(e,l){const c=Li(e,l);return c&&this.error(c),c}}class Je{constructor(e,l){this.type=l.type,this.bindings=[].concat(e),this.result=l}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const l of this.bindings)e(l[1]);e(this.result)}static parse(e,l){if(e.length<4)return l.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const c=[];for(let d=1;d<e.length-1;d+=2){const p=e[d];if("string"!=typeof p)return l.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return l.error("Variable names must contain only alphanumeric characters or '_'.",d);const f=l.parse(e[d+1],d+1);if(!f)return null;c.push([p,f])}const d=l.parse(e[e.length-1],e.length-1,l.expectedType,c);return d?new Je(c,d):null}outputDefined(){return this.result.outputDefined()}}class Qe{constructor(e,l){this.type=l.type,this.name=e,this.boundExpression=l}static parse(e,l){if(2!==e.length||"string"!=typeof e[1])return l.error("'var' expression requires exactly one string literal argument.");const c=e[1];return l.scope.has(c)?new Qe(c,l.scope.get(c)):l.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class tr{constructor(e,l,c){this.type=e,this.index=l,this.input=c}static parse(e,l){if(3!==e.length)return l.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=l.parse(e[1],1,li),d=l.parse(e[2],2,Ei(l.expectedType||_i));return c&&d?new tr(d.type.itemType,c,d):null}evaluate(e){const l=this.index.evaluate(e),c=this.input.evaluate(e);if(l<0)throw new Ve(`Array index out of bounds: ${l} < 0.`);if(l>=c.length)throw new Ve(`Array index out of bounds: ${l} > ${c.length-1}.`);if(l!==Math.floor(l))throw new Ve(`Array index must be an integer, but found ${l} instead.`);return c[l]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class er{constructor(e,l){this.type=ui,this.needle=e,this.haystack=l}static parse(e,l){if(3!==e.length)return l.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=l.parse(e[1],1,_i),d=l.parse(e[2],2,_i);return c&&d?Fi(c.type,[ui,ci,li,ni,_i])?new er(c,d):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ci(c.type)} instead`):null}evaluate(e){const l=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!c)return!1;if(!Oi(l,["boolean","string","number","null"]))throw new Ve(`Expected first argument to be of type boolean, string, number or null, but found ${Ci(rn(l))} instead.`);if(!Oi(c,["string","array"]))throw new Ve(`Expected second argument to be of type array or string, but found ${Ci(rn(c))} instead.`);return c.indexOf(l)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class rr{constructor(e,l,c){this.type=li,this.needle=e,this.haystack=l,this.fromIndex=c}static parse(e,l){if(e.length<=2||e.length>=5)return l.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const c=l.parse(e[1],1,_i),d=l.parse(e[2],2,_i);if(!c||!d)return null;if(!Fi(c.type,[ui,ci,li,ni,_i]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ci(c.type)} instead`);if(4===e.length){const p=l.parse(e[3],3,li);return p?new rr(c,d,p):null}return new rr(c,d)}evaluate(e){const l=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!Oi(l,["boolean","string","number","null"]))throw new Ve(`Expected first argument to be of type boolean, string, number or null, but found ${Ci(rn(l))} instead.`);let d;if(this.fromIndex&&(d=this.fromIndex.evaluate(e)),Oi(c,["string"])){const e=c.indexOf(l,d);return-1===e?-1:[...c.slice(0,e)].length}if(Oi(c,["array"]))return c.indexOf(l,d);throw new Ve(`Expected second argument to be of type array or string, but found ${Ci(rn(c))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class nr{constructor(e,l,c,d,p,f){this.inputType=e,this.type=l,this.input=c,this.cases=d,this.outputs=p,this.otherwise=f}static parse(e,l){if(e.length<5)return l.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return l.error("Expected an even number of arguments.");let c,d;l.expectedType&&"value"!==l.expectedType.kind&&(d=l.expectedType);const p={},f=[];for(let m=2;m<e.length-1;m+=2){let _=e[m];const g=e[m+1];Array.isArray(_)||(_=[_]);const y=l.concat(m);if(0===_.length)return y.error("Expected at least one branch label.");for(const e of _){if("number"!=typeof e&&"string"!=typeof e)return y.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return y.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return y.error("Numeric branch labels must be integer values.");if(c){if(y.checkSubtype(c,rn(e)))return null}else c=rn(e);if(void 0!==p[String(e)])return y.error("Branch labels must be unique.");p[String(e)]=f.length}const b=l.parse(g,m,d);if(!b)return null;d=d||b.type,f.push(b)}const m=l.parse(e[1],1,_i);if(!m)return null;const _=l.parse(e[e.length-1],e.length-1,d);return _?"value"!==m.type.kind&&l.concat(1).checkSubtype(c,m.type)?null:new nr(c,d,m,p,f,_):null}evaluate(e){const l=this.input.evaluate(e);return(rn(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class ir{constructor(e,l,c){this.type=e,this.branches=l,this.otherwise=c}static parse(e,l){if(e.length<4)return l.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return l.error("Expected an odd number of arguments.");let c;l.expectedType&&"value"!==l.expectedType.kind&&(c=l.expectedType);const d=[];for(let p=1;p<e.length-1;p+=2){const f=l.parse(e[p],p,ui);if(!f)return null;const m=l.parse(e[p+1],p+1,c);if(!m)return null;d.push([f,m]),c=c||m.type}const p=l.parse(e[e.length-1],e.length-1,c);if(!p)return null;if(!c)throw new Error("Can't infer output type");return new ir(c,d,p)}evaluate(e){for(const[l,c]of this.branches)if(l.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[l,c]of this.branches)e(l),e(c);e(this.otherwise)}outputDefined(){return this.branches.every((([e,l])=>l.outputDefined()))&&this.otherwise.outputDefined()}}class sr{constructor(e,l,c,d){this.type=e,this.input=l,this.beginIndex=c,this.endIndex=d}static parse(e,l){if(e.length<=2||e.length>=5)return l.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const c=l.parse(e[1],1,_i),d=l.parse(e[2],2,li);if(!c||!d)return null;if(!Fi(c.type,[Ei(_i),ci,_i]))return l.error(`Expected first argument to be of type array or string, but found ${Ci(c.type)} instead`);if(4===e.length){const p=l.parse(e[3],3,li);return p?new sr(c.type,c,d,p):null}return new sr(c.type,c,d)}evaluate(e){const l=this.input.evaluate(e),c=this.beginIndex.evaluate(e);let d;if(this.endIndex&&(d=this.endIndex.evaluate(e)),Oi(l,["string"]))return[...l].slice(c,d).join("");if(Oi(l,["array"]))return l.slice(c,d);throw new Ve(`Expected first argument to be of type array or string, but found ${Ci(rn(l))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function cn(e,l){const c=e.length-1;let d,p,f=0,m=c,_=0;for(;f<=m;)if(_=Math.floor((f+m)/2),d=e[_],p=e[_+1],d<=l){if(_===c||l<p)return _;f=_+1}else{if(!(d>l))throw new Ve("Input is not a number.");m=_-1}return 0}class or{constructor(e,l,c){this.type=e,this.input=l,this.labels=[],this.outputs=[];for(const[e,l]of c)this.labels.push(e),this.outputs.push(l)}static parse(e,l){if(e.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return l.error("Expected an even number of arguments.");const c=l.parse(e[1],1,li);if(!c)return null;const d=[];let p=null;l.expectedType&&"value"!==l.expectedType.kind&&(p=l.expectedType);for(let c=1;c<e.length;c+=2){const f=1===c?-1/0:e[c],m=e[c+1],_=c,g=c+1;if("number"!=typeof f)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_);if(d.length&&d[d.length-1][0]>=f)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',_);const y=l.parse(m,g,p);if(!y)return null;p=p||y.type,d.push([f,y])}return new or(p,c,d)}evaluate(e){const l=this.labels,c=this.outputs;if(1===l.length)return c[0].evaluate(e);const d=this.input.evaluate(e);if(d<=l[0])return c[0].evaluate(e);const p=l.length;return d>=l[p-1]?c[p-1].evaluate(e):c[cn(l,d)].evaluate(e)}eachChild(e){e(this.input);for(const l of this.outputs)e(l)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function hn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var un,dn,pn=function(){if(dn)return un;function l(l,c,d,p){(this||e).cx=3*l,(this||e).bx=3*(d-l)-(this||e).cx,(this||e).ax=1-(this||e).cx-(this||e).bx,(this||e).cy=3*c,(this||e).by=3*(p-c)-(this||e).cy,(this||e).ay=1-(this||e).cy-(this||e).by,(this||e).p1x=l,(this||e).p1y=c,(this||e).p2x=d,(this||e).p2y=p}return dn=1,un=l,l.prototype={sampleCurveX:function(l){return(((this||e).ax*l+(this||e).bx)*l+(this||e).cx)*l},sampleCurveY:function(l){return(((this||e).ay*l+(this||e).by)*l+(this||e).cy)*l},sampleCurveDerivativeX:function(l){return(3*(this||e).ax*l+2*(this||e).bx)*l+(this||e).cx},solveCurveX:function(e,l){if(void 0===l&&(l=1e-6),e<0)return 0;if(e>1)return 1;for(var c=e,d=0;d<8;d++){var p=this.sampleCurveX(c)-e;if(Math.abs(p)<l)return c;var f=this.sampleCurveDerivativeX(c);if(Math.abs(f)<1e-6)break;c-=p/f}var m=0,_=1;for(c=e,d=0;d<20&&(p=this.sampleCurveX(c),!(Math.abs(p-e)<l));d++)e>p?m=c:_=c,c=.5*(_-m)+m;return c},solve:function(e,l){return this.sampleCurveY(this.solveCurveX(e,l))}},un}(),fn=hn(pn);class fr{constructor(e,l,c,d,p){this.type=e,this.operator=l,this.interpolation=c,this.input=d,this.labels=[],this.outputs=[];for(const[e,l]of p)this.labels.push(e),this.outputs.push(l)}static interpolationFactor(e,l,c,d){let p=0;if("exponential"===e.name)p=mn(l,e.base,c,d);else if("linear"===e.name)p=mn(l,1,c,d);else if("cubic-bezier"===e.name){const f=e.controlPoints;p=new fn(f[0],f[1],f[2],f[3]).solve(mn(l,1,c,d))}return p}static parse(e,l){let[c,d,p,...f]=e;if(!Array.isArray(d)||0===d.length)return l.error("Expected an interpolation type expression.",1);if("linear"===d[0])d={name:"linear"};else if("exponential"===d[0]){const e=d[1];if("number"!=typeof e)return l.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:e}}else{if("cubic-bezier"!==d[0])return l.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const e=d.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(p=l.parse(p,2,li),!p)return null;const m=[];let _=null;"interpolate-hcl"!==c&&"interpolate-lab"!==c||l.expectedType==vi?l.expectedType&&"value"!==l.expectedType.kind&&(_=l.expectedType):_=pi;for(let e=0;e<f.length;e+=2){const c=f[e],d=f[e+1],p=e+3,g=e+4;if("number"!=typeof c)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(m.length&&m[m.length-1][0]>=c)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',p);const y=l.parse(d,g,_);if(!y)return null;_=_||y.type,m.push([c,y])}return Vi(_,li)||Vi(_,fi)||Vi(_,pi)||Vi(_,xi)||Vi(_,bi)||Vi(_,vi)||Vi(_,Ii)||Vi(_,Ei(li))?new fr(_,c,d,p,m):l.error(`Type ${Ci(_)} is not interpolatable.`)}evaluate(e){const l=this.labels,c=this.outputs;if(1===l.length)return c[0].evaluate(e);const d=this.input.evaluate(e);if(d<=l[0])return c[0].evaluate(e);const p=l.length;if(d>=l[p-1])return c[p-1].evaluate(e);const f=cn(l,d),m=fr.interpolationFactor(this.interpolation,d,l[f],l[f+1]),_=c[f].evaluate(e),g=c[f+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Lr(_,g,m);case"color":return Te.interpolate(_,g,m);case"padding":return ze.interpolate(_,g,m);case"colorArray":return Be.interpolate(_,g,m);case"numberArray":return Pe.interpolate(_,g,m);case"variableAnchorOffsetCollection":return Le.interpolate(_,g,m);case"array":return qr(_,g,m);case"projectionDefinition":return Re.interpolate(_,g,m)}case"interpolate-hcl":switch(this.type.kind){case"color":return Te.interpolate(_,g,m,"hcl");case"colorArray":return Be.interpolate(_,g,m,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Te.interpolate(_,g,m,"lab");case"colorArray":return Be.interpolate(_,g,m,"lab")}}}eachChild(e){e(this.input);for(const l of this.outputs)e(l)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function mn(e,l,c,d){const p=d-c,f=e-c;return 0===p?0:1===l?f/p:(Math.pow(l,f)-1)/(Math.pow(l,p)-1)}const _n={color:Te.interpolate,number:Lr,padding:ze.interpolate,numberArray:Pe.interpolate,colorArray:Be.interpolate,variableAnchorOffsetCollection:Le.interpolate,array:qr};class mr{constructor(e,l){this.type=e,this.args=l}static parse(e,l){if(e.length<2)return l.error("Expected at least one argument.");let c=null;const d=l.expectedType;d&&"value"!==d.kind&&(c=d);const p=[];for(const d of e.slice(1)){const e=l.parse(d,1+p.length,c,void 0,{typeAnnotation:"omit"});if(!e)return null;c=c||e.type,p.push(e)}if(!c)throw new Error("No output type");const f=d&&p.some((e=>Li(d,e.type)));return new mr(f?_i:c,p)}evaluate(e){let l,c=null,d=0;for(const p of this.args)if(d++,c=p.evaluate(e),c&&c instanceof Oe&&!c.available&&(l||(l=c.name),c=null,d===this.args.length&&(c=l)),null!==c)break;return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function gn(e,l){return"=="===e||"!="===e?"boolean"===l.kind||"string"===l.kind||"number"===l.kind||"null"===l.kind||"value"===l.kind:"string"===l.kind||"number"===l.kind||"value"===l.kind}function yn(e,l,c,d){return 0===d.compare(l,c)}function xn(e,l,c){const d="=="!==e&&"!="!==e;return class i{constructor(e,l,c){this.type=ui,this.lhs=e,this.rhs=l,this.collator=c,this.hasUntypedArgument="value"===e.type.kind||"value"===l.type.kind}static parse(e,l){if(3!==e.length&&4!==e.length)return l.error("Expected two or three arguments.");const c=e[0];let p=l.parse(e[1],1,_i);if(!p)return null;if(!gn(c,p.type))return l.concat(1).error(`"${c}" comparisons are not supported for type '${Ci(p.type)}'.`);let f=l.parse(e[2],2,_i);if(!f)return null;if(!gn(c,f.type))return l.concat(2).error(`"${c}" comparisons are not supported for type '${Ci(f.type)}'.`);if(p.type.kind!==f.type.kind&&"value"!==p.type.kind&&"value"!==f.type.kind)return l.error(`Cannot compare types '${Ci(p.type)}' and '${Ci(f.type)}'.`);d&&("value"===p.type.kind&&"value"!==f.type.kind?p=new Xe(f.type,[p]):"value"!==p.type.kind&&"value"===f.type.kind&&(f=new Xe(p.type,[f])));let m=null;if(4===e.length){if("string"!==p.type.kind&&"string"!==f.type.kind&&"value"!==p.type.kind&&"value"!==f.type.kind)return l.error("Cannot use collator to compare non-string types.");if(m=l.parse(e[3],3,gi),!m)return null}return new i(p,f,m)}evaluate(p){const f=this.lhs.evaluate(p),m=this.rhs.evaluate(p);if(d&&this.hasUntypedArgument){const l=rn(f),c=rn(m);if(l.kind!==c.kind||"string"!==l.kind&&"number"!==l.kind)throw new Ve(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${l.kind}, ${c.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const e=rn(f),c=rn(m);if("string"!==e.kind||"string"!==c.kind)return l(p,f,m)}return this.collator?c(p,f,m,this.collator.evaluate(p)):l(p,f,m)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}}}const vn=xn("==",(function(e,l,c){return l===c}),yn),bn=xn("!=",(function(e,l,c){return l!==c}),(function(e,l,c,d){return!yn(0,l,c,d)})),wn=xn("<",(function(e,l,c){return l<c}),(function(e,l,c,d){return d.compare(l,c)<0})),Tn=xn(">",(function(e,l,c){return l>c}),(function(e,l,c,d){return d.compare(l,c)>0})),Sn=xn("<=",(function(e,l,c){return l<=c}),(function(e,l,c,d){return d.compare(l,c)<=0})),Pn=xn(">=",(function(e,l,c){return l>=c}),(function(e,l,c,d){return d.compare(l,c)>=0}));class Er{constructor(e,l,c){this.type=gi,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=l}static parse(e,l){if(2!==e.length)return l.error("Expected one argument.");const c=e[1];if("object"!=typeof c||Array.isArray(c))return l.error("Collator options argument must be an object.");const d=l.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,ui);if(!d)return null;const p=l.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,ui);if(!p)return null;let f=null;return c.locale&&(f=l.parse(c.locale,1,ci),!f)?null:new Er(d,p,f)}evaluate(e){return new Ie(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Tr{constructor(e,l,c,d,p){this.type=ci,this.number=e,this.locale=l,this.currency=c,this.minFractionDigits=d,this.maxFractionDigits=p}static parse(e,l){if(3!==e.length)return l.error("Expected two arguments.");const c=l.parse(e[1],1,li);if(!c)return null;const d=e[2];if("object"!=typeof d||Array.isArray(d))return l.error("NumberFormat options argument must be an object.");let p=null;if(d.locale&&(p=l.parse(d.locale,1,ci),!p))return null;let f=null;if(d.currency&&(f=l.parse(d.currency,1,ci),!f))return null;let m=null;if(d["min-fraction-digits"]&&(m=l.parse(d["min-fraction-digits"],1,li),!m))return null;let _=null;return d["max-fraction-digits"]&&(_=l.parse(d["max-fraction-digits"],1,li),!_)?null:new Tr(c,p,f,m,_)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ir{constructor(e){this.type=yi,this.sections=e}static parse(e,l){if(e.length<2)return l.error("Expected at least one argument.");const c=e[1];if(!Array.isArray(c)&&"object"==typeof c)return l.error("First argument must be an image or text section.");const d=[];let p=!1;for(let c=1;c<=e.length-1;++c){const f=e[c];if(p&&"object"==typeof f&&!Array.isArray(f)){p=!1;let e=null;if(f["font-scale"]&&(e=l.parse(f["font-scale"],1,li),!e))return null;let c=null;if(f["text-font"]&&(c=l.parse(f["text-font"],1,Ei(ci)),!c))return null;let m=null;if(f["text-color"]&&(m=l.parse(f["text-color"],1,pi),!m))return null;let _=null;if(f["vertical-align"]){if("string"==typeof f["vertical-align"]&&!$r.includes(f["vertical-align"]))return l.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${f["vertical-align"]}' instead.`);if(_=l.parse(f["vertical-align"],1,ci),!_)return null}const g=d[d.length-1];g.scale=e,g.font=c,g.textColor=m,g.verticalAlign=_}else{const f=l.parse(e[c],1,_i);if(!f)return null;const m=f.type.kind;if("string"!==m&&"value"!==m&&"null"!==m&&"resolvedImage"!==m)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,d.push({content:f,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ir(d)}evaluate(e){return new De(this.sections.map((l=>{const c=l.content.evaluate(e);return rn(c)===wi?new Fe("",c,null,null,null,l.verticalAlign?l.verticalAlign.evaluate(e):null):new Fe(nn(c),null,l.scale?l.scale.evaluate(e):null,l.font?l.font.evaluate(e).join(","):null,l.textColor?l.textColor.evaluate(e):null,l.verticalAlign?l.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const l of this.sections)e(l.content),l.scale&&e(l.scale),l.font&&e(l.font),l.textColor&&e(l.textColor),l.verticalAlign&&e(l.verticalAlign)}outputDefined(){return!1}}class Mr{constructor(e){this.type=wi,this.input=e}static parse(e,l){if(2!==e.length)return l.error("Expected two arguments.");const c=l.parse(e[1],1,ci);return c?new Mr(c):l.error("No image name provided.")}evaluate(e){const l=this.input.evaluate(e),c=Oe.fromString(l);return c&&e.availableImages&&(c.available=e.availableImages.indexOf(l)>-1),c}eachChild(e){e(this.input)}outputDefined(){return!1}}class Fr{constructor(e){this.type=li,this.input=e}static parse(e,l){if(2!==e.length)return l.error(`Expected 1 argument, but found ${e.length-1} instead.`);const c=l.parse(e[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?l.error(`Expected argument of type string or array, but found ${Ci(c.type)} instead.`):new Fr(c):null}evaluate(e){const l=this.input.evaluate(e);if("string"==typeof l)return[...l].length;if(Array.isArray(l))return l.length;throw new Ve(`Expected value to be of type string or array, but found ${Ci(rn(l))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const In=8192;function En(e,l){const c=(180+e[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,p=Math.pow(2,l.z);return[Math.round(c*p*In),Math.round(d*p*In)]}function Cn(e,l){const c=Math.pow(2,l.z);return[(p=(e[0]/In+l.x)/c,360*p-180),(d=(e[1]/In+l.y)/c,360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90)];var d,p}function An(e,l){e[0]=Math.min(e[0],l[0]),e[1]=Math.min(e[1],l[1]),e[2]=Math.max(e[2],l[0]),e[3]=Math.max(e[3],l[1])}function Dn(e,l){return!(e[0]<=l[0]||e[2]>=l[2]||e[1]<=l[1]||e[3]>=l[3])}function kn(e,l,c){const d=e[0]-l[0],p=e[1]-l[1],f=e[0]-c[0],m=e[1]-c[1];return d*m-f*p==0&&d*f<=0&&p*m<=0}function Rn(e,l,c,d){return 0!=(p=[d[0]-c[0],d[1]-c[1]])[0]*(f=[l[0]-e[0],l[1]-e[1]])[1]-p[1]*f[0]&&!(!Nn(e,l,c,d)||!Nn(c,d,e,l));var p,f}function Ln(e,l,c){for(const d of c)for(let c=0;c<d.length-1;++c)if(Rn(e,l,d[c],d[c+1]))return!0;return!1}function Bn(e,l,c=!1){let d=!1;for(const _ of l)for(let l=0;l<_.length-1;l++){if(kn(e,_[l],_[l+1]))return c;(f=_[l])[1]>(p=e)[1]!=(m=_[l+1])[1]>p[1]&&p[0]<(m[0]-f[0])*(p[1]-f[1])/(m[1]-f[1])+f[0]&&(d=!d)}var p,f,m;return d}function On(e,l){for(const c of l)if(Bn(e,c))return!0;return!1}function Vn(e,l){for(const c of e)if(!Bn(c,l))return!1;for(let c=0;c<e.length-1;++c)if(Ln(e[c],e[c+1],l))return!1;return!0}function jn(e,l){for(const c of l)if(Vn(e,c))return!0;return!1}function Nn(e,l,c,d){const p=d[0]-c[0],f=d[1]-c[1],m=(e[0]-c[0])*f-p*(e[1]-c[1]),_=(l[0]-c[0])*f-p*(l[1]-c[1]);return m>0&&_<0||m<0&&_>0}function Gn(e,l,c){const d=[];for(let p=0;p<e.length;p++){const f=[];for(let d=0;d<e[p].length;d++){const m=En(e[p][d],c);An(l,m),f.push(m)}d.push(f)}return d}function Un(e,l,c){const d=[];for(let p=0;p<e.length;p++){const f=Gn(e[p],l,c);d.push(f)}return d}function qn(e,l,c,d){if(e[0]<c[0]||e[0]>c[2]){const l=.5*d;let p=e[0]-c[0]>l?-d:c[0]-e[0]>l?d:0;0===p&&(p=e[0]-c[2]>l?-d:c[2]-e[0]>l?d:0),e[0]+=p}An(l,e)}function Zn(e,l,c,d){const p=Math.pow(2,d.z)*In,f=[d.x*In,d.y*In],m=[];for(const d of e)for(const e of d){const d=[e.x+f[0],e.y+f[1]];qn(d,l,c,p),m.push(d)}return m}function $n(e,l,c,d){const p=Math.pow(2,d.z)*In,f=[d.x*In,d.y*In],m=[];for(const c of e){const e=[];for(const d of c){const c=[d.x+f[0],d.y+f[1]];An(l,c),e.push(c)}m.push(e)}if(l[2]-l[0]<=p/2){(_=l)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const e of m)for(const d of e)qn(d,l,c,p)}var _;return m}class Hr{constructor(e,l){this.type=ui,this.geojson=e,this.geometries=l}static parse(e,l){if(2!==e.length)return l.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(tn(e[1])){const l=e[1];if("FeatureCollection"===l.type){const e=[];for(const c of l.features){const{type:l,coordinates:d}=c.geometry;"Polygon"===l&&e.push(d),"MultiPolygon"===l&&e.push(...d)}if(e.length)return new Hr(l,{type:"MultiPolygon",coordinates:e})}else if("Feature"===l.type){const e=l.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Hr(l,l.geometry)}else if("Polygon"===l.type||"MultiPolygon"===l.type)return new Hr(l,l)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,l){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=e.canonicalID();if("Polygon"===l.type){const f=Gn(l.coordinates,d,p),m=Zn(e.geometry(),c,d,p);if(!Dn(c,d))return!1;for(const e of m)if(!Bn(e,f))return!1}if("MultiPolygon"===l.type){const f=Un(l.coordinates,d,p),m=Zn(e.geometry(),c,d,p);if(!Dn(c,d))return!1;for(const e of m)if(!On(e,f))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,l){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=e.canonicalID();if("Polygon"===l.type){const f=Gn(l.coordinates,d,p),m=$n(e.geometry(),c,d,p);if(!Dn(c,d))return!1;for(const e of m)if(!Vn(e,f))return!1}if("MultiPolygon"===l.type){const f=Un(l.coordinates,d,p),m=$n(e.geometry(),c,d,p);if(!Dn(c,d))return!1;for(const e of m)if(!jn(e,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Wn=class{constructor(e=[],l=(e,l)=>e<l?-1:e>l?1:0){if(this.data=e,this.length=this.data.length,this.compare=l,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:l,compare:c}=this,d=l[e];for(;e>0;){const p=e-1>>1,f=l[p];if(c(d,f)>=0)break;l[e]=f,e=p}l[e]=d}_down(e){const{data:l,compare:c}=this,d=this.length>>1,p=l[e];for(;e<d;){let d=1+(e<<1);const f=d+1;if(f<this.length&&c(l[f],l[d])<0&&(d=f),c(l[d],p)>=0)break;l[e]=l[d],e=d}l[e]=p}};function Hn(e,l,c=0,d=e.length-1,p=Yn){for(;d>c;){if(d-c>600){const f=d-c+1,m=l-c+1,_=Math.log(f),g=.5*Math.exp(2*_/3),y=.5*Math.sqrt(_*g*(f-g)/f)*(m-f/2<0?-1:1);Hn(e,l,Math.max(c,Math.floor(l-m*g/f+y)),Math.min(d,Math.floor(l+(f-m)*g/f+y)),p)}const f=e[l];let m=c,_=d;for(Xn(e,c,l),p(e[d],f)>0&&Xn(e,c,d);m<_;){for(Xn(e,m,_),m++,_--;p(e[m],f)<0;)m++;for(;p(e[_],f)>0;)_--}0===p(e[c],f)?Xn(e,c,_):(_++,Xn(e,_,d)),_<=l&&(c=_+1),l<=_&&(d=_-1)}}function Xn(e,l,c){const d=e[l];e[l]=e[c],e[c]=d}function Yn(e,l){return e<l?-1:e>l?1:0}function Kn(e,l){if(e.length<=1)return[e];const c=[];let d,p;for(const l of e){const e=Jn(l);0!==e&&(l.area=Math.abs(e),void 0===p&&(p=e<0),p===e<0?(d&&c.push(d),d=[l]):d.push(l))}if(d&&c.push(d),l>1)for(let e=0;e<c.length;e++)c[e].length<=l||(Hn(c[e],l,1,c[e].length-1,Qn),c[e]=c[e].slice(0,l));return c}function Qn(e,l){return l.area-e.area}function Jn(e){let l=0;for(let c,d,p=0,f=e.length,m=f-1;p<f;m=p++)c=e[p],d=e[m],l+=(d.x-c.x)*(c.y+d.y);return l}const es=1/298.257223563,ns=es*(2-es),ss=Math.PI/180;class on{constructor(e){const l=6378.137*ss*1e3,c=Math.cos(e*ss),d=1/(1-ns*(1-c*c)),p=Math.sqrt(d);this.kx=l*p*c,this.ky=l*p*d*(1-ns)}distance(e,l){const c=this.wrap(e[0]-l[0])*this.kx,d=(e[1]-l[1])*this.ky;return Math.sqrt(c*c+d*d)}pointOnLine(e,l){let c,d,p,f,m=1/0;for(let _=0;_<e.length-1;_++){let g=e[_][0],y=e[_][1],b=this.wrap(e[_+1][0]-g)*this.kx,T=(e[_+1][1]-y)*this.ky,S=0;0===b&&0===T||(S=(this.wrap(l[0]-g)*this.kx*b+(l[1]-y)*this.ky*T)/(b*b+T*T),S>1?(g=e[_+1][0],y=e[_+1][1]):S>0&&(g+=b/this.kx*S,y+=T/this.ky*S)),b=this.wrap(l[0]-g)*this.kx,T=(l[1]-y)*this.ky;const P=b*b+T*T;P<m&&(m=P,c=g,d=y,p=_,f=S)}return{point:[c,d],index:p,t:Math.max(0,Math.min(1,f))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function os(e,l){return l[0]-e[0]}function ls(e){return e[1]-e[0]+1}function us(e,l){return e[1]>=e[0]&&e[1]<l}function ds(e,l){if(e[0]>e[1])return[null,null];const c=ls(e);if(l){if(2===c)return[e,null];const l=Math.floor(c/2);return[[e[0],e[0]+l],[e[0]+l,e[1]]]}if(1===c)return[e,null];const d=Math.floor(c/2)-1;return[[e[0],e[0]+d],[e[0]+d+1,e[1]]]}function ps(e,l){if(!us(l,e.length))return[1/0,1/0,-1/0,-1/0];const c=[1/0,1/0,-1/0,-1/0];for(let d=l[0];d<=l[1];++d)An(c,e[d]);return c}function fs(e){const l=[1/0,1/0,-1/0,-1/0];for(const c of e)for(const e of c)An(l,e);return l}function _s(e){return e[0]!==-1/0&&e[1]!==-1/0&&e[2]!==1/0&&e[3]!==1/0}function gs(e,l,c){if(!_s(e)||!_s(l))return NaN;let d=0,p=0;return e[2]<l[0]&&(d=l[0]-e[2]),e[0]>l[2]&&(d=e[0]-l[2]),e[1]>l[3]&&(p=e[1]-l[3]),e[3]<l[1]&&(p=l[1]-e[3]),c.distance([0,0],[d,p])}function ys(e,l,c){const d=c.pointOnLine(l,e);return c.distance(e,d.point)}function vs(e,l,c,d,p){const f=Math.min(ys(e,[c,d],p),ys(l,[c,d],p)),m=Math.min(ys(c,[e,l],p),ys(d,[e,l],p));return Math.min(f,m)}function bs(e,l,c,d,p){if(!us(l,e.length)||!us(d,c.length))return 1/0;let f=1/0;for(let m=l[0];m<l[1];++m){const l=e[m],_=e[m+1];for(let e=d[0];e<d[1];++e){const d=c[e],m=c[e+1];if(Rn(l,_,d,m))return 0;f=Math.min(f,vs(l,_,d,m,p))}}return f}function ws(e,l,c,d,p){if(!us(l,e.length)||!us(d,c.length))return NaN;let f=1/0;for(let m=l[0];m<=l[1];++m)for(let l=d[0];l<=d[1];++l)if(f=Math.min(f,p.distance(e[m],c[l])),0===f)return f;return f}function Ts(e,l,c){if(Bn(e,l,!0))return 0;let d=1/0;for(const p of l){const l=p[0],f=p[p.length-1];if(l!==f&&(d=Math.min(d,ys(e,[f,l],c)),0===d))return d;const m=c.pointOnLine(p,e);if(d=Math.min(d,c.distance(e,m.point)),0===d)return d}return d}function Ss(e,l,c,d){if(!us(l,e.length))return NaN;for(let d=l[0];d<=l[1];++d)if(Bn(e[d],c,!0))return 0;let p=1/0;for(let f=l[0];f<l[1];++f){const l=e[f],m=e[f+1];for(const e of c)for(let c=0,f=e.length,_=f-1;c<f;_=c++){const f=e[_],g=e[c];if(Rn(l,m,f,g))return 0;p=Math.min(p,vs(l,m,f,g,d))}}return p}function Ms(e,l){for(const c of e)for(const e of c)if(Bn(e,l,!0))return!0;return!1}function Is(e,l,c,d=1/0){const p=fs(e),f=fs(l);if(d!==1/0&&gs(p,f,c)>=d)return d;if(Dn(p,f)){if(Ms(e,l))return 0}else if(Ms(l,e))return 0;let m=1/0;for(const d of e)for(let e=0,p=d.length,f=p-1;e<p;f=e++){const p=d[f],_=d[e];for(const e of l)for(let l=0,d=e.length,f=d-1;l<d;f=l++){const d=e[f],g=e[l];if(Rn(p,_,d,g))return 0;m=Math.min(m,vs(p,_,d,g,c))}}return m}function Es(e,l,c,d,p,f){if(!f)return;const m=gs(ps(d,f),p,c);m<l&&e.push([m,f,[0,0]])}function As(e,l,c,d,p,f,m){if(!f||!m)return;const _=gs(ps(d,f),ps(p,m),c);_<l&&e.push([_,f,m])}function Ds(e,l,c,d,p=1/0){let f=Math.min(d.distance(e[0],c[0][0]),p);if(0===f)return f;const m=new Wn([[0,[0,e.length-1],[0,0]]],os),_=fs(c);for(;m.length>0;){const p=m.pop();if(p[0]>=f)continue;const g=p[1],y=l?50:100;if(ls(g)<=y){if(!us(g,e.length))return NaN;if(l){const l=Ss(e,g,c,d);if(isNaN(l)||0===l)return l;f=Math.min(f,l)}else for(let l=g[0];l<=g[1];++l){const p=Ts(e[l],c,d);if(f=Math.min(f,p),0===f)return 0}}else{const c=ds(g,l);Es(m,f,d,e,_,c[0]),Es(m,f,d,e,_,c[1])}}return f}function zs(e,l,c,d,p,f=1/0){let m=Math.min(f,p.distance(e[0],c[0]));if(0===m)return m;const _=new Wn([[0,[0,e.length-1],[0,c.length-1]]],os);for(;_.length>0;){const f=_.pop();if(f[0]>=m)continue;const g=f[1],y=f[2],b=l?50:100,T=d?50:100;if(ls(g)<=b&&ls(y)<=T){if(!us(g,e.length)&&us(y,c.length))return NaN;let f;if(l&&d)f=bs(e,g,c,y,p),m=Math.min(m,f);else if(l&&!d){const l=e.slice(g[0],g[1]+1);for(let e=y[0];e<=y[1];++e)if(f=ys(c[e],l,p),m=Math.min(m,f),0===m)return m}else if(!l&&d){const l=c.slice(y[0],y[1]+1);for(let c=g[0];c<=g[1];++c)if(f=ys(e[c],l,p),m=Math.min(m,f),0===m)return m}else f=ws(e,g,c,y,p),m=Math.min(m,f)}else{const f=ds(g,l),b=ds(y,d);As(_,m,p,e,c,f[0],b[0]),As(_,m,p,e,c,f[0],b[1]),As(_,m,p,e,c,f[1],b[0]),As(_,m,p,e,c,f[1],b[1])}}return m}function ks(e){return"MultiPolygon"===e.type?e.coordinates.map((e=>({type:"Polygon",coordinates:e}))):"MultiLineString"===e.type?e.coordinates.map((e=>({type:"LineString",coordinates:e}))):"MultiPoint"===e.type?e.coordinates.map((e=>({type:"Point",coordinates:e}))):[e]}class Mn{constructor(e,l){this.type=li,this.geojson=e,this.geometries=l}static parse(e,l){if(2!==e.length)return l.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(tn(e[1])){const l=e[1];if("FeatureCollection"===l.type)return new Mn(l,l.features.map((e=>ks(e.geometry))).flat());if("Feature"===l.type)return new Mn(l,ks(l.geometry));if("type"in l&&"coordinates"in l)return new Mn(l,ks(l))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,l){const c=e.geometry(),d=c.flat().map((l=>Cn([l.x,l.y],e.canonical)));if(0===c.length)return NaN;const p=new on(d[0][1]);let f=1/0;for(const e of l){switch(e.type){case"Point":f=Math.min(f,zs(d,!1,[e.coordinates],!1,p,f));break;case"LineString":f=Math.min(f,zs(d,!1,e.coordinates,!0,p,f));break;case"Polygon":f=Math.min(f,Ds(d,!1,e.coordinates,p,f))}if(0===f)return f}return f}(e,this.geometries);if("LineString"===e.geometryType())return function(e,l){const c=e.geometry(),d=c.flat().map((l=>Cn([l.x,l.y],e.canonical)));if(0===c.length)return NaN;const p=new on(d[0][1]);let f=1/0;for(const e of l){switch(e.type){case"Point":f=Math.min(f,zs(d,!0,[e.coordinates],!1,p,f));break;case"LineString":f=Math.min(f,zs(d,!0,e.coordinates,!0,p,f));break;case"Polygon":f=Math.min(f,Ds(d,!0,e.coordinates,p,f))}if(0===f)return f}return f}(e,this.geometries);if("Polygon"===e.geometryType())return function(e,l){const c=e.geometry();if(0===c.length||0===c[0].length)return NaN;const d=Kn(c,0).map((l=>l.map((l=>l.map((l=>Cn([l.x,l.y],e.canonical))))))),p=new on(d[0][0][0][1]);let f=1/0;for(const e of l)for(const l of d){switch(e.type){case"Point":f=Math.min(f,Ds([e.coordinates],!1,l,p,f));break;case"LineString":f=Math.min(f,Ds(e.coordinates,!0,l,p,f));break;case"Polygon":f=Math.min(f,Is(l,e.coordinates,p,f))}if(0===f)return f}return f}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Fn{constructor(e){this.type=_i,this.key=e}static parse(e,l){if(2!==e.length)return l.error(`Expected 1 argument, but found ${e.length-1} instead.`);const c=e[1];return null==c?l.error("Global state property must be defined."):"string"!=typeof c?l.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Fn(c)}evaluate(e){var l;const c=null===(l=e.globals)||void 0===l?void 0:l.globalState;return c&&0!==Object.keys(c).length?vr(c,this.key):null}eachChild(){}outputDefined(){return!1}}const Fs={"==":vn,"!=":bn,">":Tn,"<":wn,">=":Pn,"<=":Sn,array:Xe,at:tr,boolean:Xe,case:ir,coalesce:mr,collator:Er,format:Ir,image:Mr,in:er,"index-of":rr,interpolate:fr,"interpolate-hcl":fr,"interpolate-lab":fr,length:Fr,let:Je,literal:je,match:nr,number:Xe,"number-format":Tr,object:Xe,slice:sr,step:or,string:Xe,"to-boolean":Ze,"to-color":Ze,"to-number":Ze,"to-string":Ze,var:Qe,within:Hr,distance:Mn,"global-state":Fn};class zn{constructor(e,l,c,d){this.name=e,this.type=l,this._evaluate=c,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,l){const c=e[0],d=zn.definitions[c];if(!d)return l.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(d)?d[0]:d.type,f=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,m=f.filter((([l])=>!Array.isArray(l)||l.length===e.length-1));let _=null;for(const[d,f]of m){_=new We(l.registry,ro,l.path,null,l.scope);const m=[];let g=!1;for(let l=1;l<e.length;l++){const c=e[l],p=Array.isArray(d)?d[l-1]:d.type,f=_.parse(c,1+m.length,p);if(!f){g=!0;break}m.push(f)}if(!g)if(Array.isArray(d)&&d.length!==m.length)_.error(`Expected ${d.length} arguments, but found ${m.length} instead.`);else{for(let e=0;e<m.length;e++){const l=Array.isArray(d)?d[e]:d.type,c=m[e];_.concat(e+1).checkSubtype(l,c.type)}if(0===_.errors.length)return new zn(c,p,f,m)}}if(1===m.length)l.errors.push(..._.errors);else{const c=(m.length?m:f).map((([e])=>{return l=e,Array.isArray(l)?`(${l.map(Ci).join(", ")})`:`(${Ci(l.type)}...)`;var l})).join(" | "),d=[];for(let c=1;c<e.length;c++){const p=l.parse(e[c],1+d.length);if(!p)return null;d.push(Ci(p.type))}l.error(`Expected arguments of type ${c}, but found (${d.join(", ")}) instead.`)}return null}static register(e,l){zn.definitions=l;for(const c in l)e[c]=zn}}function Bs(e,[l,c,d,p]){l=l.evaluate(e),c=c.evaluate(e),d=d.evaluate(e);const f=p?p.evaluate(e):1,m=en(l,c,d,f);if(m)throw new Ve(m);return new Te(l/255,c/255,d/255,f,!1)}function Vs(e,l){return e in l}function Ws(e,l){const c=l[e];return void 0===c?null:c}function Js(e){return{type:e}}function ro(e){if(e instanceof Qe)return ro(e.boundExpression);if(e instanceof zn&&"error"===e.name)return!1;if(e instanceof Er)return!1;if(e instanceof Hr)return!1;if(e instanceof Mn)return!1;if(e instanceof Fn)return!1;const l=e instanceof Ze||e instanceof Xe;let c=!0;return e.eachChild((e=>{c=l?c&&ro(e):c&&e instanceof je})),!!c&&lo(e)&&ho(e,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function lo(e){if(e instanceof zn){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Hr)return!1;if(e instanceof Mn)return!1;let l=!0;return e.eachChild((e=>{l&&!lo(e)&&(l=!1)})),l}function co(e){if(e instanceof zn&&"feature-state"===e.name)return!1;let l=!0;return e.eachChild((e=>{l&&!co(e)&&(l=!1)})),l}function ho(e,l){if(e instanceof zn&&l.indexOf(e.name)>=0)return!1;let c=!0;return e.eachChild((e=>{c&&!ho(e,l)&&(c=!1)})),c}function uo(e){return{result:"success",value:e}}function po(e){return{result:"error",value:e}}function fo(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function mo(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function yo(e){return!!e.expression&&e.expression.interpolated}function xo(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function vo(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&rn(e)===mi}function bo(e){return e}function Eo(e,l){const c=e.stops&&"object"==typeof e.stops[0][0],d=c||!(c||void 0!==e.property),p=e.type||(yo(l)?"exponential":"interval"),f=function(e){switch(e.type){case"color":return Te.parse;case"padding":return ze.parse;case"numberArray":return Pe.parse;case"colorArray":return Be.parse;default:return null}}(l);if(f&&((e=ri({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],f(e[1])]))),e.default=f(e.default?e.default:l.default)),e.colorSpace&&"rgb"!==(m=e.colorSpace)&&"hcl"!==m&&"lab"!==m)throw new Error(`Unknown color space: "${e.colorSpace}"`);var m;const _=function(e){switch(e){case"exponential":return Lo;case"interval":return Ro;case"categorical":return ko;case"identity":return Oo;default:throw new Error(`Unknown function type "${e}"`)}}(p);let g,y;if("categorical"===p){g=Object.create(null);for(const l of e.stops)g[l[0]]=l[1];y=typeof e.stops[0][0]}if(c){const c={},d=[];for(let l=0;l<e.stops.length;l++){const p=e.stops[l],f=p[0].zoom;void 0===c[f]&&(c[f]={zoom:f,type:e.type,property:e.property,default:e.default,stops:[]},d.push(f)),c[f].stops.push([p[0].value,p[1]])}const p=[];for(const e of d)p.push([c[e].zoom,Eo(c[e],l)]);const f={name:"linear"};return{kind:"composite",interpolationType:f,interpolationFactor:fr.interpolationFactor.bind(void 0,f),zoomStops:p.map((e=>e[0])),evaluate:({zoom:c},d)=>Lo({stops:p,base:e.base},l,c).evaluate(c,d)}}if(d){const c="exponential"===p?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:c,interpolationFactor:fr.interpolationFactor.bind(void 0,c),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:c})=>_(e,l,c,g,y)}}return{kind:"source",evaluate(c,d){const p=d&&d.properties?d.properties[e.property]:void 0;return void 0===p?Co(e.default,l.default):_(e,l,p,g,y)}}}function Co(e,l,c){return void 0!==e?e:void 0!==l?l:void 0!==c?c:void 0}function ko(e,l,c,d,p){return Co(typeof c===p?d[c]:void 0,e.default,l.default)}function Ro(e,l,c){if("number"!==xo(c))return Co(e.default,l.default);const d=e.stops.length;if(1===d)return e.stops[0][1];if(c<=e.stops[0][0])return e.stops[0][1];if(c>=e.stops[d-1][0])return e.stops[d-1][1];const p=cn(e.stops.map((e=>e[0])),c);return e.stops[p][1]}function Lo(e,l,c){const d=void 0!==e.base?e.base:1;if("number"!==xo(c))return Co(e.default,l.default);const p=e.stops.length;if(1===p)return e.stops[0][1];if(c<=e.stops[0][0])return e.stops[0][1];if(c>=e.stops[p-1][0])return e.stops[p-1][1];const f=cn(e.stops.map((e=>e[0])),c),m=function(e,l,c,d){const p=d-c,f=e-c;return 0===p?0:1===l?f/p:(Math.pow(l,f)-1)/(Math.pow(l,p)-1)}(c,d,e.stops[f][0],e.stops[f+1][0]),_=e.stops[f][1],g=e.stops[f+1][1],y=_n[l.type]||bo;return"function"==typeof _.evaluate?{evaluate(...l){const c=_.evaluate.apply(void 0,l),d=g.evaluate.apply(void 0,l);if(void 0!==c&&void 0!==d)return y(c,d,m,e.colorSpace)}}:y(_,g,m,e.colorSpace)}function Oo(e,l,c){switch(l.type){case"color":c=Te.parse(c);break;case"formatted":c=De.fromString(c.toString());break;case"resolvedImage":c=Oe.fromString(c.toString());break;case"padding":c=ze.parse(c);break;case"colorArray":c=Be.parse(c);break;case"numberArray":c=Pe.parse(c);break;default:xo(c)===l.type||"enum"===l.type&&l.values[c]||(c=void 0)}return Co(c,e.default,l.default)}zn.register(Fs,{error:[{kind:"error"},[ci],(e,[l])=>{throw new Ve(l.evaluate(e))}],typeof:[ci,[_i],(e,[l])=>Ci(rn(l.evaluate(e)))],"to-rgba":[Ei(li,4),[pi],(e,[l])=>{const[c,d,p,f]=l.evaluate(e).rgb;return[255*c,255*d,255*p,f]}],rgb:[pi,[li,li,li],Bs],rgba:[pi,[li,li,li,li],Bs],has:{type:ui,overloads:[[[ci],(e,[l])=>Vs(l.evaluate(e),e.properties())],[[ci,mi],(e,[l,c])=>Vs(l.evaluate(e),c.evaluate(e))]]},get:{type:_i,overloads:[[[ci],(e,[l])=>Ws(l.evaluate(e),e.properties())],[[ci,mi],(e,[l,c])=>Ws(l.evaluate(e),c.evaluate(e))]]},"feature-state":[_i,[ci],(e,[l])=>Ws(l.evaluate(e),e.featureState||{})],properties:[mi,[],e=>e.properties()],"geometry-type":[ci,[],e=>e.geometryType()],id:[_i,[],e=>e.id()],zoom:[li,[],e=>e.globals.zoom],"heatmap-density":[li,[],e=>e.globals.heatmapDensity||0],elevation:[li,[],e=>e.globals.elevation||0],"line-progress":[li,[],e=>e.globals.lineProgress||0],accumulated:[_i,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[li,Js(li),(e,l)=>{let c=0;for(const d of l)c+=d.evaluate(e);return c}],"*":[li,Js(li),(e,l)=>{let c=1;for(const d of l)c*=d.evaluate(e);return c}],"-":{type:li,overloads:[[[li,li],(e,[l,c])=>l.evaluate(e)-c.evaluate(e)],[[li],(e,[l])=>-l.evaluate(e)]]},"/":[li,[li,li],(e,[l,c])=>l.evaluate(e)/c.evaluate(e)],"%":[li,[li,li],(e,[l,c])=>l.evaluate(e)%c.evaluate(e)],ln2:[li,[],()=>Math.LN2],pi:[li,[],()=>Math.PI],e:[li,[],()=>Math.E],"^":[li,[li,li],(e,[l,c])=>Math.pow(l.evaluate(e),c.evaluate(e))],sqrt:[li,[li],(e,[l])=>Math.sqrt(l.evaluate(e))],log10:[li,[li],(e,[l])=>Math.log(l.evaluate(e))/Math.LN10],ln:[li,[li],(e,[l])=>Math.log(l.evaluate(e))],log2:[li,[li],(e,[l])=>Math.log(l.evaluate(e))/Math.LN2],sin:[li,[li],(e,[l])=>Math.sin(l.evaluate(e))],cos:[li,[li],(e,[l])=>Math.cos(l.evaluate(e))],tan:[li,[li],(e,[l])=>Math.tan(l.evaluate(e))],asin:[li,[li],(e,[l])=>Math.asin(l.evaluate(e))],acos:[li,[li],(e,[l])=>Math.acos(l.evaluate(e))],atan:[li,[li],(e,[l])=>Math.atan(l.evaluate(e))],min:[li,Js(li),(e,l)=>Math.min(...l.map((l=>l.evaluate(e))))],max:[li,Js(li),(e,l)=>Math.max(...l.map((l=>l.evaluate(e))))],abs:[li,[li],(e,[l])=>Math.abs(l.evaluate(e))],round:[li,[li],(e,[l])=>{const c=l.evaluate(e);return c<0?-Math.round(-c):Math.round(c)}],floor:[li,[li],(e,[l])=>Math.floor(l.evaluate(e))],ceil:[li,[li],(e,[l])=>Math.ceil(l.evaluate(e))],"filter-==":[ui,[ci,_i],(e,[l,c])=>e.properties()[l.value]===c.value],"filter-id-==":[ui,[_i],(e,[l])=>e.id()===l.value],"filter-type-==":[ui,[ci],(e,[l])=>e.geometryType()===l.value],"filter-<":[ui,[ci,_i],(e,[l,c])=>{const d=e.properties()[l.value],p=c.value;return typeof d==typeof p&&d<p}],"filter-id-<":[ui,[_i],(e,[l])=>{const c=e.id(),d=l.value;return typeof c==typeof d&&c<d}],"filter->":[ui,[ci,_i],(e,[l,c])=>{const d=e.properties()[l.value],p=c.value;return typeof d==typeof p&&d>p}],"filter-id->":[ui,[_i],(e,[l])=>{const c=e.id(),d=l.value;return typeof c==typeof d&&c>d}],"filter-<=":[ui,[ci,_i],(e,[l,c])=>{const d=e.properties()[l.value],p=c.value;return typeof d==typeof p&&d<=p}],"filter-id-<=":[ui,[_i],(e,[l])=>{const c=e.id(),d=l.value;return typeof c==typeof d&&c<=d}],"filter->=":[ui,[ci,_i],(e,[l,c])=>{const d=e.properties()[l.value],p=c.value;return typeof d==typeof p&&d>=p}],"filter-id->=":[ui,[_i],(e,[l])=>{const c=e.id(),d=l.value;return typeof c==typeof d&&c>=d}],"filter-has":[ui,[_i],(e,[l])=>l.value in e.properties()],"filter-has-id":[ui,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[ui,[Ei(ci)],(e,[l])=>l.value.indexOf(e.geometryType())>=0],"filter-id-in":[ui,[Ei(_i)],(e,[l])=>l.value.indexOf(e.id())>=0],"filter-in-small":[ui,[ci,Ei(_i)],(e,[l,c])=>c.value.indexOf(e.properties()[l.value])>=0],"filter-in-large":[ui,[ci,Ei(_i)],(e,[l,c])=>function(e,l,c,d){for(;c<=d;){const p=c+d>>1;if(l[p]===e)return!0;l[p]>e?d=p-1:c=p+1}return!1}(e.properties()[l.value],c.value,0,c.value.length-1)],all:{type:ui,overloads:[[[ui,ui],(e,[l,c])=>l.evaluate(e)&&c.evaluate(e)],[Js(ui),(e,l)=>{for(const c of l)if(!c.evaluate(e))return!1;return!0}]]},any:{type:ui,overloads:[[[ui,ui],(e,[l,c])=>l.evaluate(e)||c.evaluate(e)],[Js(ui),(e,l)=>{for(const c of l)if(c.evaluate(e))return!0;return!1}]]},"!":[ui,[ui],(e,[l])=>!l.evaluate(e)],"is-supported-script":[ui,[ci],(e,[l])=>{const c=e.globals&&e.globals.isSupportedScript;return!c||c(l.evaluate(e))}],upcase:[ci,[ci],(e,[l])=>l.evaluate(e).toUpperCase()],downcase:[ci,[ci],(e,[l])=>l.evaluate(e).toLowerCase()],concat:[ci,Js(_i),(e,l)=>l.map((l=>nn(l.evaluate(e)))).join("")],"resolved-locale":[ci,[gi],(e,[l])=>l.evaluate(e).resolvedLocale()]});class ei{constructor(e,l,c){this.expression=e,this._warningHistory={},this._evaluator=new Ke,this._defaultValue=l?function(e){if("color"===e.type&&vo(e.default))return new Te(0,0,0,0);switch(e.type){case"color":return Te.parse(e.default)||null;case"padding":return ze.parse(e.default)||null;case"numberArray":return Pe.parse(e.default)||null;case"colorArray":return Be.parse(e.default)||null;case"variableAnchorOffsetCollection":return Le.parse(e.default)||null;case"projectionDefinition":return Re.parse(e.default)||null;default:return void 0===e.default?null:e.default}}(l):null,this._enumValues=l&&"enum"===l.type?l.values:null,this._globalState=c}evaluateWithoutErrorHandling(e,l,c,d,p,f){return this._globalState&&(e=$o(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=l,this._evaluator.featureState=c,this._evaluator.canonical=d,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(e,l,c,d,p,f){this._globalState&&(e=$o(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=l||null,this._evaluator.featureState=c||null,this._evaluator.canonical=d,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=f||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Ve(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function No(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Fs}function Go(e,l,c){const d=new We(Fs,ro,[],l?function(e){const l={color:pi,string:ci,number:li,enum:ci,boolean:ui,formatted:yi,padding:xi,numberArray:bi,colorArray:vi,projectionDefinition:fi,resolvedImage:wi,variableAnchorOffsetCollection:Ii};return"array"===e.type?Ei(l[e.value]||_i,e.length):l[e.type]}(l):void 0),p=d.parse(e,void 0,void 0,void 0,l&&"string"===l.type?{typeAnnotation:"coerce"}:void 0);return p?uo(new ei(p,l,c)):po(d.errors)}class ii{constructor(e,l,c){this.kind=e,this._styleExpression=l,this.isStateDependent="constant"!==e&&!co(l.expression),this.globalStateRefs=Zo(l.expression),this._globalState=c}evaluateWithoutErrorHandling(e,l,c,d,p,f){return this._globalState&&(e=$o(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,l,c,d,p,f)}evaluate(e,l,c,d,p,f){return this._globalState&&(e=$o(e,this._globalState)),this._styleExpression.evaluate(e,l,c,d,p,f)}}class si{constructor(e,l,c,d,p){this.kind=e,this.zoomStops=c,this._styleExpression=l,this.isStateDependent="camera"!==e&&!co(l.expression),this.globalStateRefs=Zo(l.expression),this.interpolationType=d,this._globalState=p}evaluateWithoutErrorHandling(e,l,c,d,p,f){return this._globalState&&(e=$o(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,l,c,d,p,f)}evaluate(e,l,c,d,p,f){return this._globalState&&(e=$o(e,this._globalState)),this._styleExpression.evaluate(e,l,c,d,p,f)}interpolationFactor(e,l,c){return this.interpolationType?fr.interpolationFactor(this.interpolationType,e,l,c):0}}function Uo(e,l,c){const d=Go(e,l,c);if("error"===d.result)return d;const p=d.value.expression,f=lo(p);if(!f&&!fo(l))return po([new Pt("","data expressions not supported")]);const m=ho(p,["zoom"]);if(!m&&!mo(l))return po([new Pt("","zoom expressions not supported")]);const _=qo(p);return _||m?_ instanceof Pt?po([_]):_ instanceof fr&&!yo(l)?po([new Pt("",'"interpolate" expressions cannot be used with this property')]):uo(_?new si(f?"camera":"composite",d.value,_.labels,_ instanceof fr?_.interpolation:void 0,c):new ii(f?"constant":"source",d.value,c)):po([new Pt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class oi{constructor(e,l){this._parameters=e,this._specification=l,ri(this,Eo(this._parameters,this._specification))}static deserialize(e){return new oi(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function qo(e){let l=null;if(e instanceof Je)l=qo(e.result);else if(e instanceof mr){for(const c of e.args)if(l=qo(c),l)break}else(e instanceof or||e instanceof fr)&&e.input instanceof zn&&"zoom"===e.input.name&&(l=e);return l instanceof Pt||e.eachChild((e=>{const c=qo(e);c instanceof Pt?l=c:!l&&c?l=new Pt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&c&&l!==c&&(l=new Pt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),l}function Zo(e,l=new Set){return e instanceof Fn&&l.add(e.key),e.eachChild((e=>{Zo(e,l)})),l}function $o(e,l){const{zoom:c,heatmapDensity:d,elevation:p,lineProgress:f,isSupportedScript:m,accumulated:_}=null!=e?e:{};return{zoom:c,heatmapDensity:d,elevation:p,lineProgress:f,isSupportedScript:m,accumulated:_,globalState:l}}function Xo(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const l of e.slice(1))if(!Xo(l)&&"boolean"!=typeof l)return!1;return!0;default:return!0}}const Yo={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ko(e,l){if(null==e)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Xo(e)||(e=ta(e));const c=Go(e,Yo,l);if("error"===c.result)throw new Error(c.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return{filter:(e,l,d)=>c.value.evaluate(e,l,{},d),needGeometry:Jo(e),getGlobalStateRefs:()=>Zo(c.value.expression)}}function Qo(e,l){return e<l?-1:e>l?1:0}function Jo(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let l=1;l<e.length;l++)if(Jo(e[l]))return!0;return!1}function ta(e){if(!e)return!0;const l=e[0];return e.length<=1?"any"!==l:"=="===l?ia(e[1],e[2],"=="):"!="===l?tl(ia(e[1],e[2],"==")):"<"===l||">"===l||"<="===l||">="===l?ia(e[1],e[2],l):"any"===l?(c=e.slice(1),["any"].concat(c.map(ta))):"all"===l?["all"].concat(e.slice(1).map(ta)):"none"===l?["all"].concat(e.slice(1).map(ta).map(tl)):"in"===l?na(e[1],e.slice(2)):"!in"===l?tl(na(e[1],e.slice(2))):"has"===l?el(e[1]):"!has"!==l||tl(el(e[1]));var c}function ia(e,l,c){switch(e){case"$type":return[`filter-type-${c}`,l];case"$id":return[`filter-id-${c}`,l];default:return[`filter-${c}`,e,l]}}function na(e,l){if(0===l.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some((e=>typeof e!=typeof l[0]))?["filter-in-large",e,["literal",l.sort(Qo)]]:["filter-in-small",e,["literal",l]]}}function el(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function tl(e){return["!",e]}function il(e){const l=typeof e;if("number"===l||"boolean"===l||"string"===l||null==e)return JSON.stringify(e);if(Array.isArray(e)){let l="[";for(const c of e)l+=`${il(c)},`;return`${l}]`}const c=Object.keys(e).sort();let d="{";for(let l=0;l<c.length;l++)d+=`${JSON.stringify(c[l])}:${il(e[c[l]])},`;return`${d}}`}function rl(e){let l="";for(const c of Mt)l+=`/${il(e[c])}`;return l}function nl(e){const l=e.value;return l?[new Dt(e.key,l,"constants have been deprecated as of v8")]:[]}function sl(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function ol(e){if(Array.isArray(e))return e.map(ol);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const l={};for(const c in e)l[c]=ol(e[c]);return l}return sl(e)}function al(e){const l=e.key,c=e.value,d=e.valueSpec||{},p=e.objectElementValidators||{},f=e.style,m=e.styleSpec,_=e.validateSpec;let g=[];const y=xo(c);if("object"!==y)return[new Dt(l,c,`object expected, ${y} found`)];for(const e in c){const y=e.split(".")[0],b=vr(d,y)||d["*"];let T;if(vr(p,y))T=p[y];else if(vr(d,y)){if(void 0===c[e])continue;T=_}else if(p["*"])T=p["*"];else{if(!d["*"]){g.push(new Dt(l,c[e],`unknown property "${e}"`));continue}T=_}g=g.concat(T({key:(l?`${l}.`:l)+e,value:c[e],valueSpec:b,style:f,styleSpec:m,object:c,objectKey:e,validateSpec:_},c))}for(const e in d)p[e]||d[e].required&&void 0===d[e].default&&void 0===c[e]&&g.push(new Dt(l,c,`missing required property "${e}"`));return g}function ll(e){const l=e.value,c=e.valueSpec,d=e.style,p=e.styleSpec,f=e.key,m=e.arrayElementValidator||e.validateSpec;if("array"!==xo(l))return[new Dt(f,l,`array expected, ${xo(l)} found`)];if(c.length&&l.length!==c.length)return[new Dt(f,l,`array length ${c.length} expected, length ${l.length} found`)];let _={type:c.value,values:c.values};p.$version<7&&(_.function=c.function),"object"===xo(c.value)&&(_=c.value);let g=[];for(let c=0;c<l.length;c++)g=g.concat(m({array:l,arrayIndex:c,value:l[c],valueSpec:_,validateSpec:e.validateSpec,style:d,styleSpec:p,key:`${f}[${c}]`}));return g}function cl(e){const l=e.key,c=e.value,d=e.valueSpec;let p=xo(c);return"number"===p&&c!=c&&(p="NaN"),"number"!==p?[new Dt(l,c,`number expected, ${p} found`)]:"minimum"in d&&c<d.minimum?[new Dt(l,c,`${c} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&c>d.maximum?[new Dt(l,c,`${c} is greater than the maximum value ${d.maximum}`)]:[]}function hl(e){const l=e.valueSpec,c=sl(e.value.type);let d,p,f,m={};const _="categorical"!==c&&void 0===e.value.property,g=!_,y="array"===xo(e.value.stops)&&"array"===xo(e.value.stops[0])&&"object"===xo(e.value.stops[0][0]),b=al({key:e.key,value:e.value,valueSpec:e.styleSpec.function,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===c)return[new Dt(e.key,e.value,'identity function may not have a "stops" property')];let l=[];const d=e.value;return l=l.concat(ll({key:e.key,value:d,valueSpec:e.valueSpec,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:T})),"array"===xo(d)&&0===d.length&&l.push(new Dt(e.key,d,"array must have at least one stop")),l},default:function(e){return e.validateSpec({key:e.key,value:e.value,valueSpec:l,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===c&&_&&b.push(new Dt(e.key,e.value,'missing required property "property"')),"identity"===c||e.value.stops||b.push(new Dt(e.key,e.value,'missing required property "stops"')),"exponential"===c&&e.valueSpec.expression&&!yo(e.valueSpec)&&b.push(new Dt(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(g&&!fo(e.valueSpec)?b.push(new Dt(e.key,e.value,"property functions not supported")):_&&!mo(e.valueSpec)&&b.push(new Dt(e.key,e.value,"zoom functions not supported"))),"categorical"!==c&&!y||void 0!==e.value.property||b.push(new Dt(e.key,e.value,'"property" property is required')),b;function T(e){let c=[];const d=e.value,_=e.key;if("array"!==xo(d))return[new Dt(_,d,`array expected, ${xo(d)} found`)];if(2!==d.length)return[new Dt(_,d,`array length 2 expected, length ${d.length} found`)];if(y){if("object"!==xo(d[0]))return[new Dt(_,d,`object expected, ${xo(d[0])} found`)];if(void 0===d[0].zoom)return[new Dt(_,d,"object stop key must have zoom")];if(void 0===d[0].value)return[new Dt(_,d,"object stop key must have value")];if(f&&f>sl(d[0].zoom))return[new Dt(_,d[0].zoom,"stop zoom values must appear in ascending order")];sl(d[0].zoom)!==f&&(f=sl(d[0].zoom),p=void 0,m={}),c=c.concat(al({key:`${_}[0]`,value:d[0],valueSpec:{zoom:{}},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:cl,value:S}}))}else c=c.concat(S({key:`${_}[0]`,value:d[0],validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec},d));return No(ol(d[1]))?c.concat([new Dt(`${_}[1]`,d[1],"expressions are not allowed in function stops.")]):c.concat(e.validateSpec({key:`${_}[1]`,value:d[1],valueSpec:l,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec}))}function S(e,f){const _=xo(e.value),g=sl(e.value),y=null!==e.value?e.value:f;if(d){if(_!==d)return[new Dt(e.key,y,`${_} stop domain type must match previous stop domain type ${d}`)]}else d=_;if("number"!==_&&"string"!==_&&"boolean"!==_)return[new Dt(e.key,y,"stop domain value must be a number, string, or boolean")];if("number"!==_&&"categorical"!==c){let d=`number expected, ${_} found`;return fo(l)&&void 0===c&&(d+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Dt(e.key,y,d)]}return"categorical"!==c||"number"!==_||isFinite(g)&&Math.floor(g)===g?"categorical"!==c&&"number"===_&&void 0!==p&&g<p?[new Dt(e.key,y,"stop domain values must appear in ascending order")]:(p=g,"categorical"===c&&g in m?[new Dt(e.key,y,"stop domain values must be unique")]:(m[g]=!0,[])):[new Dt(e.key,y,`integer expected, found ${g}`)]}}function ul(e){const l=("property"===e.expressionContext?Uo:Go)(ol(e.value),e.valueSpec);if("error"===l.result)return l.value.map((l=>new Dt(`${e.key}${l.key}`,e.value,l.message)));const c=l.value.expression||l.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!c.outputDefined())return[new Dt(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!co(c))return[new Dt(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!co(c))return[new Dt(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!ho(c,["zoom","feature-state"]))return[new Dt(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!lo(c))return[new Dt(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function dl(e){const l=e.key,c=e.value,d=xo(c);return"string"!==d?[new Dt(l,c,`color expected, ${d} found`)]:Te.parse(String(c))?[]:[new Dt(l,c,`color expected, "${c}" found`)]}function pl(e){const l=e.key,c=e.value,d=e.valueSpec,p=[];return Array.isArray(d.values)?-1===d.values.indexOf(sl(c))&&p.push(new Dt(l,c,`expected one of [${d.values.join(", ")}], ${JSON.stringify(c)} found`)):-1===Object.keys(d.values).indexOf(sl(c))&&p.push(new Dt(l,c,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(c)} found`)),p}function fl(e){return Xo(ol(e.value))?ul(ri({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):gl(e)}function gl(e){const l=e.value,c=e.key;if("array"!==xo(l))return[new Dt(c,l,`array expected, ${xo(l)} found`)];const d=e.styleSpec;let p,f=[];if(l.length<1)return[new Dt(c,l,"filter array must have at least 1 element")];switch(f=f.concat(pl({key:`${c}[0]`,value:l[0],valueSpec:d.filter_operator,style:e.style,styleSpec:e.styleSpec})),sl(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&"$type"===sl(l[1])&&f.push(new Dt(c,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":3!==l.length&&f.push(new Dt(c,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(p=xo(l[1]),"string"!==p&&f.push(new Dt(`${c}[1]`,l[1],`string expected, ${p} found`)));for(let m=2;m<l.length;m++)p=xo(l[m]),"$type"===sl(l[1])?f=f.concat(pl({key:`${c}[${m}]`,value:l[m],valueSpec:d.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==p&&"number"!==p&&"boolean"!==p&&f.push(new Dt(`${c}[${m}]`,l[m],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let d=1;d<l.length;d++)f=f.concat(gl({key:`${c}[${d}]`,value:l[d],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":p=xo(l[1]),2!==l.length?f.push(new Dt(c,l,`filter array for "${l[0]}" operator must have 2 elements`)):"string"!==p&&f.push(new Dt(`${c}[1]`,l[1],`string expected, ${p} found`))}return f}function xl(e,l){const c=e.key,d=e.validateSpec,p=e.style,f=e.styleSpec,m=e.value,_=e.objectKey,g=f[`${l}_${e.layerType}`];if(!g)return[];const y=_.match(/^(.*)-transition$/);if("paint"===l&&y&&g[y[1]]&&g[y[1]].transition)return d({key:c,value:m,valueSpec:f.transition,style:p,styleSpec:f});const b=e.valueSpec||g[_];if(!b)return[new Dt(c,m,`unknown property "${_}"`)];let T;if("string"===xo(m)&&fo(b)&&!b.tokens&&(T=/^{([^}]+)}$/.exec(m)))return[new Dt(c,m,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(T[1])} }\`.`)];const S=[];return"symbol"===e.layerType&&"text-font"===_&&vo(ol(m))&&"identity"===sl(m.type)&&S.push(new Dt(c,m,'"text-font" does not support identity functions')),S.concat(d({key:e.key,value:m,valueSpec:b,style:p,styleSpec:f,expressionContext:"property",propertyType:l,propertyKey:_}))}function vl(e){return xl(e,"paint")}function bl(e){return xl(e,"layout")}function wl(e){let l=[];const c=e.value,d=e.key,p=e.style,f=e.styleSpec;if("object"!==xo(c))return[new Dt(d,c,`object expected, ${xo(c)} found`)];c.type||c.ref||l.push(new Dt(d,c,'either "type" or "ref" is required'));let m=sl(c.type);const _=sl(c.ref);if(c.id){const f=sl(c.id);for(let m=0;m<e.arrayIndex;m++){const e=p.layers[m];sl(e.id)===f&&l.push(new Dt(d,c.id,`duplicate layer id "${c.id}", previously used at line ${e.id.__line__}`))}}if("ref"in c){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in c&&l.push(new Dt(d,c[e],`"${e}" is prohibited for ref layers`))})),p.layers.forEach((l=>{sl(l.id)===_&&(e=l)})),e?e.ref?l.push(new Dt(d,c.ref,"ref cannot reference another ref layer")):m=sl(e.type):l.push(new Dt(d,c.ref,`ref layer "${_}" not found`))}else if("background"!==m)if(c.source){const e=p.sources&&p.sources[c.source],f=e&&sl(e.type);e?"vector"===f&&"raster"===m?l.push(new Dt(d,c.source,`layer "${c.id}" requires a raster source`)):"raster-dem"!==f&&"hillshade"===m||"raster-dem"!==f&&"color-relief"===m?l.push(new Dt(d,c.source,`layer "${c.id}" requires a raster-dem source`)):"raster"===f&&"raster"!==m?l.push(new Dt(d,c.source,`layer "${c.id}" requires a vector source`)):"vector"!==f||c["source-layer"]?"raster-dem"===f&&"hillshade"!==m&&"color-relief"!==m?l.push(new Dt(d,c.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):"line"!==m||!c.paint||!c.paint["line-gradient"]||"geojson"===f&&e.lineMetrics||l.push(new Dt(d,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new Dt(d,c,`layer "${c.id}" must specify a "source-layer"`)):l.push(new Dt(d,c.source,`source "${c.source}" not found`))}else l.push(new Dt(d,c,'missing required property "source"'));return l=l.concat(al({key:d,value:c,valueSpec:f.layer,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":()=>[],type:()=>e.validateSpec({key:`${d}.type`,value:c.type,valueSpec:f.layer.type,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,object:c,objectKey:"type"}),filter:fl,layout:e=>al({layer:c,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>bl(ri({layerType:m},e))}}),paint:e=>al({layer:c,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>vl(ri({layerType:m},e))}})}})),l}function Tl(e){const l=e.value,c=e.key,d=xo(l);return"string"!==d?[new Dt(c,l,`string expected, ${d} found`)]:[]}const Il={promoteId:function({key:e,value:l}){if("string"===xo(l))return Tl({key:e,value:l});{const c=[];for(const d in l)c.push(...Tl({key:`${e}.${d}`,value:l[d]}));return c}}};function Cl(e){const l=e.value,c=e.key,d=e.styleSpec,p=e.style,f=e.validateSpec;if(!l.type)return[new Dt(c,l,'"type" is required')];const m=sl(l.type);let _;switch(m){case"vector":case"raster":return _=al({key:c,value:l,valueSpec:d[`source_${m.replace("-","_")}`],style:e.style,styleSpec:d,objectElementValidators:Il,validateSpec:f}),_;case"raster-dem":return _=function(e){var l;const c=null!==(l=e.sourceName)&&void 0!==l?l:"",d=e.value,p=e.styleSpec,f=p.source_raster_dem,m=e.style;let _=[];const g=xo(d);if(void 0===d)return _;if("object"!==g)return _.push(new Dt("source_raster_dem",d,`object expected, ${g} found`)),_;const y="custom"===sl(d.encoding),b=["redFactor","greenFactor","blueFactor","baseShift"],T=e.value.encoding?`"${e.value.encoding}"`:"Default";for(const l in d)!y&&b.includes(l)?_.push(new Dt(l,d[l],`In "${c}": "${l}" is only valid when "encoding" is set to "custom". ${T} encoding found`)):f[l]?_=_.concat(e.validateSpec({key:l,value:d[l],valueSpec:f[l],validateSpec:e.validateSpec,style:m,styleSpec:p})):_.push(new Dt(l,d[l],`unknown property "${l}"`));return _}({sourceName:c,value:l,style:e.style,styleSpec:d,validateSpec:f}),_;case"geojson":if(_=al({key:c,value:l,valueSpec:d.source_geojson,style:p,styleSpec:d,validateSpec:f,objectElementValidators:Il}),l.cluster)for(const e in l.clusterProperties){const[d,p]=l.clusterProperties[e],f="string"==typeof d?[d,["accumulated"],["get",e]]:d;_.push(...ul({key:`${c}.${e}.map`,value:p,expressionContext:"cluster-map"})),_.push(...ul({key:`${c}.${e}.reduce`,value:f,expressionContext:"cluster-reduce"}))}return _;case"video":return al({key:c,value:l,valueSpec:d.source_video,style:p,validateSpec:f,styleSpec:d});case"image":return al({key:c,value:l,valueSpec:d.source_image,style:p,validateSpec:f,styleSpec:d});case"canvas":return[new Dt(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return pl({key:`${c}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Al(e){const l=e.value,c=e.styleSpec,d=c.light,p=e.style;let f=[];const m=xo(l);if(void 0===l)return f;if("object"!==m)return f=f.concat([new Dt("light",l,`object expected, ${m} found`)]),f;for(const m in l){const _=m.match(/^(.*)-transition$/);f=f.concat(_&&d[_[1]]&&d[_[1]].transition?e.validateSpec({key:m,value:l[m],valueSpec:c.transition,validateSpec:e.validateSpec,style:p,styleSpec:c}):d[m]?e.validateSpec({key:m,value:l[m],valueSpec:d[m],validateSpec:e.validateSpec,style:p,styleSpec:c}):[new Dt(m,l[m],`unknown property "${m}"`)])}return f}function Dl(e){const l=e.value,c=e.styleSpec,d=c.sky,p=e.style,f=xo(l);if(void 0===l)return[];if("object"!==f)return[new Dt("sky",l,`object expected, ${f} found`)];let m=[];for(const f in l)m=m.concat(d[f]?e.validateSpec({key:f,value:l[f],valueSpec:d[f],style:p,styleSpec:c}):[new Dt(f,l[f],`unknown property "${f}"`)]);return m}function kl(e){const l=e.value,c=e.styleSpec,d=c.terrain,p=e.style;let f=[];const m=xo(l);if(void 0===l)return f;if("object"!==m)return f=f.concat([new Dt("terrain",l,`object expected, ${m} found`)]),f;for(const m in l)f=f.concat(d[m]?e.validateSpec({key:m,value:l[m],valueSpec:d[m],validateSpec:e.validateSpec,style:p,styleSpec:c}):[new Dt(m,l[m],`unknown property "${m}"`)]);return f}function Rl(e){let l=[];const c=e.value,d=e.key;if(Array.isArray(c)){const p=[],f=[];for(const m in c)c[m].id&&p.includes(c[m].id)&&l.push(new Dt(d,c,`all the sprites' ids must be unique, but ${c[m].id} is duplicated`)),p.push(c[m].id),c[m].url&&f.includes(c[m].url)&&l.push(new Dt(d,c,`all the sprites' URLs must be unique, but ${c[m].url} is duplicated`)),f.push(c[m].url),l=l.concat(al({key:`${d}[${m}]`,value:c[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:e.validateSpec}));return l}return Tl({key:d,value:c})}function Ll(e){return Boolean(e)&&e.constructor===Object}function Fl(e){return Ll(e.value)?[]:[new Dt(e.key,e.value,`object expected, ${xo(e.value)} found`)]}const Bl={"*":()=>[],array:ll,boolean:function(e){const l=e.value,c=e.key,d=xo(l);return"boolean"!==d?[new Dt(c,l,`boolean expected, ${d} found`)]:[]},number:cl,color:dl,constants:nl,enum:pl,filter:fl,function:hl,layer:wl,object:al,source:Cl,light:Al,sky:Dl,terrain:kl,projection:function(e){const l=e.value,c=e.styleSpec,d=c.projection,p=e.style,f=xo(l);if(void 0===l)return[];if("object"!==f)return[new Dt("projection",l,`object expected, ${f} found`)];let m=[];for(const f in l)m=m.concat(d[f]?e.validateSpec({key:f,value:l[f],valueSpec:d[f],style:p,styleSpec:c}):[new Dt(f,l[f],`unknown property "${f}"`)]);return m},projectionDefinition:function(e){const l=e.key;let c=e.value;c=c instanceof String?c.valueOf():c;const d=xo(c);return"array"!==d||function(e){return Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]}(c)||function(e){return!!["interpolate","step","literal"].includes(e[0])}(c)?["array","string"].includes(d)?[]:[new Dt(l,c,`projection expected, invalid type "${d}" found`)]:[new Dt(l,c,`projection expected, invalid array ${JSON.stringify(c)} found`)]},string:Tl,formatted:function(e){return 0===Tl(e).length?[]:ul(e)},resolvedImage:function(e){return 0===Tl(e).length?[]:ul(e)},padding:function(e){const l=e.key,c=e.value;if("array"===xo(c)){if(c.length<1||c.length>4)return[new Dt(l,c,`padding requires 1 to 4 values; ${c.length} values found`)];const d={type:"number"};let p=[];for(let f=0;f<c.length;f++)p=p.concat(e.validateSpec({key:`${l}[${f}]`,value:c[f],validateSpec:e.validateSpec,valueSpec:d}));return p}return cl({key:l,value:c,valueSpec:{}})},numberArray:function(e){const l=e.key,c=e.value;if("array"===xo(c)){const d={type:"number"};if(c.length<1)return[new Dt(l,c,"array length at least 1 expected, length 0 found")];let p=[];for(let f=0;f<c.length;f++)p=p.concat(e.validateSpec({key:`${l}[${f}]`,value:c[f],validateSpec:e.validateSpec,valueSpec:d}));return p}return cl({key:l,value:c,valueSpec:{}})},colorArray:function(e){const l=e.key,c=e.value;if("array"===xo(c)){if(c.length<1)return[new Dt(l,c,"array length at least 1 expected, length 0 found")];let e=[];for(let d=0;d<c.length;d++)e=e.concat(dl({key:`${l}[${d}]`,value:c[d]}));return e}return dl({key:l,value:c})},variableAnchorOffsetCollection:function(e){const l=e.key,c=e.value,d=xo(c),p=e.styleSpec;if("array"!==d||c.length<1||c.length%2!=0)return[new Dt(l,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let d=0;d<c.length;d+=2)f=f.concat(pl({key:`${l}[${d}]`,value:c[d],valueSpec:p.layout_symbol["text-anchor"]})),f=f.concat(ll({key:`${l}[${d+1}]`,value:c[d+1],valueSpec:{length:2,value:"number"},validateSpec:e.validateSpec,style:e.style,styleSpec:p}));return f},sprite:Rl,state:Fl,fontFaces:function(e){const l=e.key,c=e.value,d=e.validateSpec,p=e.styleSpec,f=e.style;if(!Ll(c))return[new Dt(l,c,`object expected, ${xo(c)} found`)];const m=[];for(const e in c){const _=c[e],g=xo(_);if("string"===g)m.push(...Tl({key:`${l}.${e}`,value:_}));else if("array"===g){const c={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[g,y]of _.entries())m.push(...al({key:`${l}.${e}[${g}]`,value:y,valueSpec:c,styleSpec:p,style:f,validateSpec:d}))}else m.push(new Dt(`${l}.${e}`,_,`string or array expected, ${g} found`))}return m}};function Ol(e){const l=e.value,c=e.valueSpec,d=e.styleSpec;return e.validateSpec=Ol,c.expression&&vo(sl(l))?hl(e):c.expression&&No(ol(l))?ul(e):c.type&&Bl[c.type]?Bl[c.type](e):al(ri({},e,{valueSpec:c.type?d[c.type]:c}))}function jl(e){const l=e.value,c=e.key,d=Tl(e);return d.length||(-1===l.indexOf("{fontstack}")&&d.push(new Dt(c,l,'"glyphs" url must include a "{fontstack}" token')),-1===l.indexOf("{range}")&&d.push(new Dt(c,l,'"glyphs" url must include a "{range}" token'))),d}function Nl(e,l=Tt){let c=[];return c=c.concat(Ol({key:"",value:e,valueSpec:l.$root,styleSpec:l,style:e,validateSpec:Ol,objectElementValidators:{glyphs:jl,"*":()=>[]}})),e.constants&&(c=c.concat(nl({key:"constants",value:e.constants}))),Ul(c)}function Gl(e){return function(l){return e(Object.assign({},l,{validateSpec:Ol}))}}function Ul(e){return[].concat(e).sort(((e,l)=>e.line-l.line))}function ql(l){return function(...c){return Ul(l.apply(this||e,c))}}Nl.source=ql(Gl(Cl)),Nl.sprite=ql(Gl(Rl)),Nl.glyphs=ql(Gl(jl)),Nl.light=ql(Gl(Al)),Nl.sky=ql(Gl(Dl)),Nl.terrain=ql(Gl(kl)),Nl.state=ql(Gl(Fl)),Nl.layer=ql(Gl(wl)),Nl.filter=ql(Gl(fl)),Nl.paintProperty=ql(Gl(vl)),Nl.layoutProperty=ql(Gl(bl));const Zl={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class rs{constructor(e,l){this._globalState=l,this.setValue(e)}evaluate(){var e;return null!==(e=this._literalValue)&&void 0!==e?e:this._compiledValue.evaluate({})}setValue(e){if(null==e||"visible"===e||"none"===e)return this._literalValue="none"===e?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const l=Go(e,Zl,this._globalState);if("error"===l.result)throw this._literalValue="visible",this._compiledValue=void 0,new Error(l.value.map((e=>`${e.key}: ${e.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=l.value,this._globalStateRefs=Zo(l.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const $l=Tt,Wl=Nl,Hl=Wl.light,Xl=Wl.sky,Yl=Wl.paintProperty,Kl=Wl.layoutProperty;function Ql(e,l){let c=!1;if(l&&l.length)for(const d of l)e.fire(new gt(new Error(d.message))),c=!0;return c}class cs{constructor(e,l,c){const d=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(l=p[1])+2*(c=p[2]);for(let e=0;e<this.d*this.d;e++){const l=p[3+e],c=p[3+e+1];d.push(l===c?null:p.subarray(l,c))}const f=p[3+d.length+1];this.keys=p.subarray(p[3+d.length],f),this.bboxes=p.subarray(f),this.insert=this._insertReadonly}else{this.d=l+2*c;for(let e=0;e<this.d*this.d;e++)d.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=e,this.padding=c,this.scale=l/e,this.uid=0;const p=c/l*e;this.min=-p,this.max=e+p}insert(e,l,c,d,p){this._forEachCell(l,c,d,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(l),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,l,c,d,p,f){this.cells[p].push(f)}query(e,l,c,d,p){const f=this.min,m=this.max;if(e<=f&&l<=f&&m<=c&&m<=d&&!p)return Array.prototype.slice.call(this.keys);{const f=[];return this._forEachCell(e,l,c,d,this._queryCell,f,{},p),f}}_queryCell(e,l,c,d,p,f,m,_){const g=this.cells[p];if(null!==g){const p=this.keys,y=this.bboxes;for(let b=0;b<g.length;b++){const T=g[b];if(void 0===m[T]){const g=4*T;(_?_(y[g+0],y[g+1],y[g+2],y[g+3]):e<=y[g+2]&&l<=y[g+3]&&c>=y[g+0]&&d>=y[g+1])?(m[T]=!0,f.push(p[T])):m[T]=!1}}}}_forEachCell(e,l,c,d,p,f,m,_){const g=this._convertToCellCoord(e),y=this._convertToCellCoord(l),b=this._convertToCellCoord(c),T=this._convertToCellCoord(d);for(let S=g;S<=b;S++)for(let g=y;g<=T;g++){const y=this.d*g+S;if((!_||_(this._convertFromCellCoord(S),this._convertFromCellCoord(g),this._convertFromCellCoord(S+1),this._convertFromCellCoord(g+1)))&&p.call(this,e,l,c,d,y,f,m,_))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,l=3+this.cells.length+1+1;let c=0;for(let e=0;e<this.cells.length;e++)c+=this.cells[e].length;const d=new Int32Array(l+c+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let p=l;for(let l=0;l<e.length;l++){const c=e[l];d[3+l]=p,d.set(c,p),p+=c.length}return d[3+e.length]=p,d.set(this.keys,p),p+=this.keys.length,d[3+e.length+1]=p,d.set(this.bboxes,p),p+=this.bboxes.length,d.buffer}static serialize(e,l){const c=e.toArrayBuffer();return l&&l.push(c),{buffer:c}}static deserialize(e){return new cs(e.buffer)}}const Jl={};function ec(e,l,c={}){if(Jl[e])throw new Error(`${e} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:e,writeable:!1}),Jl[e]={klass:l,omit:c.omit||[],shallow:c.shallow||[]}}ec("Object",Object),ec("Set",Set),ec("TransferableGridIndex",cs),ec("Color",Te),ec("Error",Error),ec("AJAXError",ct),ec("ResolvedImage",Oe),ec("StylePropertyFunction",oi),ec("StyleExpression",ei,{omit:["_evaluator"]}),ec("ZoomDependentExpression",si),ec("ZoomConstantExpression",ii),ec("CompoundExpression",zn,{omit:["_evaluate"]});for(const e in Fs)Fs[e]._classRegistryKey||ec(`Expression_${e}`,Fs[e]);function rc(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function nc(e){return e.$name||e.constructor._classRegistryKey}function sc(e){return!function(e){if(null===e||"object"!=typeof e)return!1;const l=nc(e);return!(!l||"Object"===l)}(e)&&(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof Blob||e instanceof Error||rc(e)||Ae(e)||ArrayBuffer.isView(e)||e instanceof ImageData)}function oc(e,l){if(sc(e))return(rc(e)||Ae(e))&&l&&l.push(e),ArrayBuffer.isView(e)&&l&&l.push(e.buffer),e instanceof ImageData&&l&&l.push(e.data.buffer),e;if(Array.isArray(e)){const c=[];for(const d of e)c.push(oc(d,l));return c}if("object"!=typeof e)throw new Error("can't serialize object of type "+typeof e);const c=nc(e);if(!c)throw new Error(`can't serialize object of unregistered class ${e.constructor.name}`);if(!Jl[c])throw new Error(`${c} is not registered.`);const{klass:d}=Jl[c],p=d.serialize?d.serialize(e,l):{};if(d.serialize){if(l&&p===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in e){if(!e.hasOwnProperty(d))continue;if(Jl[c].omit.indexOf(d)>=0)continue;const f=e[d];p[d]=Jl[c].shallow.indexOf(d)>=0?f:oc(f,l)}e instanceof Error&&(p.message=e.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(p.$name=c),p}function lc(e){if(sc(e))return e;if(Array.isArray(e))return e.map(lc);if("object"!=typeof e)throw new Error("can't deserialize object of type "+typeof e);const l=nc(e)||"Object";if(!Jl[l])throw new Error(`can't deserialize unregistered class ${l}`);const{klass:c}=Jl[l];if(!c)throw new Error(`can't deserialize unregistered class ${l}`);if(c.deserialize)return c.deserialize(e);const d=Object.create(c.prototype);for(const c of Object.keys(e)){if("$name"===c)continue;const p=e[c];d[c]=Jl[l].shallow.indexOf(c)>=0?p:lc(p)}return d}class xs{constructor(){this.first=!0}update(e,l){const c=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=l),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=c,!0))}}function cc(e){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(e))}function hc(e){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(e))}function uc(e){return/\s/u.test(String.fromCodePoint(e))}function dc(e){for(const l of e)if(hc(l.codePointAt(0)))return!0;return!1}function pc(e){for(const l of e)if(!_c(l.codePointAt(0)))return!1;return!0}function fc(e){const l=e.map((e=>{try{return new RegExp(`\\p{sc=${e}}`,"u").source}catch(e){return null}})).filter((e=>e));return new RegExp(l.join("|"),"u")}const mc=fc(["Arab","Dupl","Mong","Ougr","Syrc"]);function _c(e){return!mc.test(String.fromCodePoint(e))}function gc(e){return!(hc(e)||(l=e,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(l))));var l}const yc=fc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function xc(e){return yc.test(String.fromCodePoint(e))}function vc(e,l){return!(!l&&xc(e)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(e)))}function bc(e){for(const l of e)if(xc(l.codePointAt(0)))return!0;return!1}const wc=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(e){this.pluginStatus=e.pluginStatus,this.pluginURL=e.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(e){if(wc.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=e.applyArabicShaping,this.processBidirectionalText=e.processBidirectionalText,this.processStyledBidirectionalText=e.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getRTLTextPluginStatus(){return this.pluginStatus}syncState(e,l){return c(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if("loading"!==e.pluginStatus)return this.setState(e),e;const c=e.pluginURL,d=new Promise((e=>{this.loadScriptResolve=e}));l(c);const p=new Promise((e=>setTimeout((()=>e()),this.TIMEOUT)));if(yield Promise.race([d,p]),this.isParsed()){const e={pluginStatus:"loaded",pluginURL:c};return this.setState(e),e}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${c}`)}))}};class Ps{constructor(e,l){this.isSupportedScript=Pc,this.zoom=e,l?(this.now=l.now||0,this.fadeDuration=l.fadeDuration||0,this.zoomHistory=l.zoomHistory||new xs,this.transition=l.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new xs,this.transition={})}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,l=e-Math.floor(e),c=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*l}}}function Pc(e){return function(e,l){for(const c of e)if(!vc(c.codePointAt(0),l))return!1;return!0}(e,"loaded"===wc.getRTLTextPluginStatus())}const Mc="-transition";class Cs{constructor(e,l,c){this.property=e,this.value=l,this.expression=function(e,l,c){if(vo(e))return new oi(e,l);if(No(e)){const d=Uo(e,l,c);if("error"===d.result)throw new Error(d.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return d.value}{let c=e;return"color"===l.type&&"string"==typeof e?c=Te.parse(e):"padding"!==l.type||"number"!=typeof e&&!Array.isArray(e)?"numberArray"!==l.type||"number"!=typeof e&&!Array.isArray(e)?"colorArray"!==l.type||"string"!=typeof e&&!Array.isArray(e)?"variableAnchorOffsetCollection"===l.type&&Array.isArray(e)?c=Le.parse(e):"projectionDefinition"===l.type&&"string"==typeof e&&(c=Re.parse(e)):c=Be.parse(e):c=Pe.parse(e):c=ze.parse(e),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>c}}}(void 0===l?e.specification.default:l,e.specification,c)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,l,c){return this.property.possiblyEvaluate(this,e,l,c)}}class Ls{constructor(e,l){this.property=e,this.value=new Cs(e,void 0,l)}transitioned(e,l){return new Rs(this.property,this.value,l,ge({},e.transition,this.transition),e.now)}untransitioned(){return new Rs(this.property,this.value,null,{},0)}}class Os{constructor(e,l){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=l}getValue(e){return be(this._values[e].value.value)}setValue(e,l){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ls(this._values[e].property,this._globalState)),this._values[e].value=new Cs(this._values[e].property,null===l?void 0:be(l),this._globalState)}getTransition(e){return be(this._values[e].transition)}setTransition(e,l){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ls(this._values[e].property,this._globalState)),this._values[e].transition=be(l)||void 0}serialize(){const e={};for(const l of Object.keys(this._values)){const c=this.getValue(l);void 0!==c&&(e[l]=c);const d=this.getTransition(l);void 0!==d&&(e[`${l}${Mc}`]=d)}return e}transitioned(e,l){const c=new Ns(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].transitioned(e,l._values[d]);return c}untransitioned(){const e=new Ns(this._properties);for(const l of Object.keys(this._values))e._values[l]=this._values[l].untransitioned();return e}}class Rs{constructor(e,l,c,d,p){this.property=e,this.value=l,this.begin=p+d.delay||0,this.end=this.begin+d.duration||0,e.specification.transition&&(d.delay||d.duration)&&(this.prior=c)}possiblyEvaluate(e,l,c){const d=e.now||0,p=this.value.possiblyEvaluate(e,l,c),f=this.prior;if(f){if(d>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(d<this.begin)return f.possiblyEvaluate(e,l,c);{const m=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,l,c),p,he(m))}}return p}}class Ns{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,l,c){const d=new qs(this._properties);for(const p of Object.keys(this._values))d._values[p]=this._values[p].possiblyEvaluate(e,l,c);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class $s{constructor(e,l){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=l}hasValue(e){return void 0!==this._values[e].value}getValue(e){return be(this._values[e].value)}setValue(e,l){this._values[e]=new Cs(this._values[e].property,null===l?void 0:be(l),this._globalState)}serialize(){const e={};for(const l of Object.keys(this._values)){const c=this.getValue(l);void 0!==c&&(e[l]=c)}return e}possiblyEvaluate(e,l,c){const d=new qs(this._properties);for(const p of Object.keys(this._values))d._values[p]=this._values[p].possiblyEvaluate(e,l,c);return d}}class Us{constructor(e,l,c){this.property=e,this.value=l,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,l,c,d){return this.property.evaluate(this.value,this.parameters,e,l,c,d)}}class qs{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class js{constructor(e){this.specification=e}possiblyEvaluate(e,l){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(l)}interpolate(e,l,c){const d=_n[this.specification.type];return d?d(e,l,c):e}}class Gs{constructor(e,l){this.specification=e,this.overrides=l}possiblyEvaluate(e,l,c,d){return new Us(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(l,null,{},c,d)}:e.expression,l)}interpolate(e,l,c){if("constant"!==e.value.kind||"constant"!==l.value.kind)return e;if(void 0===e.value.value||void 0===l.value.value)return new Us(this,{kind:"constant",value:void 0},e.parameters);const d=_n[this.specification.type];if(d){const p=d(e.value.value,l.value.value,c);return new Us(this,{kind:"constant",value:p},e.parameters)}return e}evaluate(e,l,c,d,p,f){return"constant"===e.kind?e.value:e.evaluate(l,c,d,p,f)}}class Xs extends Gs{possiblyEvaluate(e,l,c,d){if(void 0===e.value)return new Us(this,{kind:"constant",value:void 0},l);if("constant"===e.expression.kind){const p=e.expression.evaluate(l,null,{},c,d),f="resolvedImage"===e.property.specification.type&&"string"!=typeof p?p.name:p,m=this._calculate(f,f,f,l);return new Us(this,{kind:"constant",value:m},l)}if("camera"===e.expression.kind){const c=this._calculate(e.expression.evaluate({zoom:l.zoom-1}),e.expression.evaluate({zoom:l.zoom}),e.expression.evaluate({zoom:l.zoom+1}),l);return new Us(this,{kind:"constant",value:c},l)}return new Us(this,e.expression,l)}evaluate(e,l,c,d,p,f){if("source"===e.kind){const m=e.evaluate(l,c,d,p,f);return this._calculate(m,m,m,l)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(l.zoom)-1},c,d),e.evaluate({zoom:Math.floor(l.zoom)},c,d),e.evaluate({zoom:Math.floor(l.zoom)+1},c,d),l):e.value}_calculate(e,l,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:l}:{from:c,to:l}}interpolate(e){return e}}class Ys{constructor(e){this.specification=e}possiblyEvaluate(e,l,c,d){if(void 0!==e.value){if("constant"===e.expression.kind){const p=e.expression.evaluate(l,null,{},c,d);return this._calculate(p,p,p,l)}return this._calculate(e.expression.evaluate(new Ps(Math.floor(l.zoom-1),l)),e.expression.evaluate(new Ps(Math.floor(l.zoom),l)),e.expression.evaluate(new Ps(Math.floor(l.zoom+1),l)),l)}}_calculate(e,l,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:l}:{from:c,to:l}}interpolate(e){return e}}class Zs{constructor(e){this.specification=e}possiblyEvaluate(e,l,c,d){return!!e.expression.evaluate(l,null,{},c,d)}interpolate(){return!1}}class Hs{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in e){const c=e[l];c.specification.overridable&&this.overridableProperties.push(l);const d=this.defaultPropertyValues[l]=new Cs(c,void 0,void 0),p=this.defaultTransitionablePropertyValues[l]=new Ls(c,void 0);this.defaultTransitioningPropertyValues[l]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=d.possiblyEvaluate({})}}}ec("DataDrivenProperty",Gs),ec("DataConstantProperty",js),ec("CrossFadedDataDrivenProperty",Xs),ec("CrossFadedProperty",Ys),ec("ColorRampProperty",Zs);class Ks extends xt{constructor(e,l,c){if(super(),this.id=e.id,this.type=e.type,this._globalState=c,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=function(e,l){return new rs(e,l)}(this.visibility,c),"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Ko(e.filter,c)),l.layout&&(this._unevaluatedLayout=new $s(l.layout,c)),l.paint)){this._transitionablePaint=new Os(l.paint,c);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new qs(l.paint)}}setFilter(e){this.filter=e,this._featureFilter=Ko(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const l of this._visibilityExpression.getGlobalStateRefs())e.add(l);if(this._unevaluatedLayout)for(const l in this._unevaluatedLayout._values){const c=this._unevaluatedLayout._values[l];for(const l of c.getGlobalStateRefs())e.add(l)}for(const l of this._featureFilter.getGlobalStateRefs())e.add(l);return e}getPaintAffectingGlobalStateRefs(){var e;const l=new globalThis.Map;if(this._transitionablePaint)for(const c in this._transitionablePaint._values){const d=this._transitionablePaint._values[c].value;for(const p of d.getGlobalStateRefs()){const f=null!==(e=l.get(p))&&void 0!==e?e:[];f.push({name:c,value:d.value}),l.set(p,f)}}return l}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,l,c={}){if(null==l||!this._validate(Kl,`layers.${this.id}.layout.${e}`,e,l,c))return"visibility"===e?(this.visibility=l,this._visibilityExpression.setValue(l),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,l)}getPaintProperty(e){return e.endsWith(Mc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,l,c={}){if(null!=l&&this._validate(Yl,`layers.${this.id}.paint.${e}`,e,l,c))return!1;if(e.endsWith(Mc))return this._transitionablePaint.setTransition(e.slice(0,-11),l||void 0),!1;{const c=this._transitionablePaint._values[e],d="cross-faded-data-driven"===c.property.specification["property-type"],p=c.value.isDataDriven(),f=c.value;this._transitionablePaint.setValue(e,l),this._handleSpecialPaintPropertyUpdate(e);const m=this._transitionablePaint._values[e].value;return m.isDataDriven()||p||d||this._handleOverridablePaintPropertyUpdate(e,f,m)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,l,c){return!1}isHidden(e=this.minzoom,l=!1){return!!(this.minzoom&&e<(l?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this._evaluatedVisibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,l){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,l)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ve(e,((e,l)=>!(void 0===e||"layout"===l&&!Object.keys(e).length||"paint"===l&&!Object.keys(e).length)))}_validate(e,l,c,d,p={}){return(!p||!1!==p.validate)&&Ql(this,e.call(Wl,{key:l,layerType:this.type,objectKey:c,value:d,styleSpec:Tt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const l=this.paint.get(e);if(l instanceof Us&&fo(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}}let Ic;var Ec={get paint(){return Ic=Ic||new Hs({"raster-opacity":new js(Tt.paint_raster["raster-opacity"]),"raster-hue-rotate":new js(Tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new js(Tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new js(Tt.paint_raster["raster-brightness-max"]),"raster-saturation":new js(Tt.paint_raster["raster-saturation"]),"raster-contrast":new js(Tt.paint_raster["raster-contrast"]),"raster-resampling":new js(Tt.paint_raster["raster-resampling"]),"raster-fade-duration":new js(Tt.paint_raster["raster-fade-duration"])})}};class Qs extends Ks{constructor(e,l){super(e,Ec,l)}}const Cc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ea{constructor(e,l){this._structArray=e,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ra{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,l){return e._trim(),l&&(e.isTransferred=!0,l.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const l=Object.create(this.prototype);return l.arrayBuffer=e.arrayBuffer,l.length=e.length,l.capacity=e.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ac(e,l=1){let c=0,d=0;return{members:e.map((e=>{const p=Cc[e.type].BYTES_PER_ELEMENT,f=c=Dc(c,Math.max(l,p)),m=e.components||1;return d=Math.max(d,p),c+=p*m,{name:e.name,type:e.type,components:m,offset:f}})),size:Dc(c,Math.max(d,l)),alignment:l}}function Dc(e,l){return Math.ceil(e/l)*l}class sa extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,l)}emplace(e,l,c){const d=2*e;return this.int16[d+0]=l,this.int16[d+1]=c,e}}sa.prototype.bytesPerElement=4,ec("StructArrayLayout2i4",sa);class aa extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,l,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,l,c)}emplace(e,l,c,d){const p=3*e;return this.int16[p+0]=l,this.int16[p+1]=c,this.int16[p+2]=d,e}}aa.prototype.bytesPerElement=6,ec("StructArrayLayout3i6",aa);class oa extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,l,c,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,l,c,d)}emplace(e,l,c,d,p){const f=4*e;return this.int16[f+0]=l,this.int16[f+1]=c,this.int16[f+2]=d,this.int16[f+3]=p,e}}oa.prototype.bytesPerElement=8,ec("StructArrayLayout4i8",oa);class la extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,l,c,d,p,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,l,c,d,p,f)}emplace(e,l,c,d,p,f,m){const _=6*e;return this.int16[_+0]=l,this.int16[_+1]=c,this.int16[_+2]=d,this.int16[_+3]=p,this.int16[_+4]=f,this.int16[_+5]=m,e}}la.prototype.bytesPerElement=12,ec("StructArrayLayout2i4i12",la);class ua extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,l,c,d,p,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,l,c,d,p,f)}emplace(e,l,c,d,p,f,m){const _=4*e,g=8*e;return this.int16[_+0]=l,this.int16[_+1]=c,this.uint8[g+4]=d,this.uint8[g+5]=p,this.uint8[g+6]=f,this.uint8[g+7]=m,e}}ua.prototype.bytesPerElement=8,ec("StructArrayLayout2i4ub8",ua);class ca extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,l)}emplace(e,l,c){const d=2*e;return this.float32[d+0]=l,this.float32[d+1]=c,e}}ca.prototype.bytesPerElement=8,ec("StructArrayLayout2f8",ca);class ha extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,l,c,d,p,f,m,_,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,l,c,d,p,f,m,_,g,y)}emplace(e,l,c,d,p,f,m,_,g,y,b){const T=10*e;return this.uint16[T+0]=l,this.uint16[T+1]=c,this.uint16[T+2]=d,this.uint16[T+3]=p,this.uint16[T+4]=f,this.uint16[T+5]=m,this.uint16[T+6]=_,this.uint16[T+7]=g,this.uint16[T+8]=y,this.uint16[T+9]=b,e}}ha.prototype.bytesPerElement=20,ec("StructArrayLayout10ui20",ha);class pa extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,l,c,d,p,f,m,_){const g=this.length;return this.resize(g+1),this.emplace(g,e,l,c,d,p,f,m,_)}emplace(e,l,c,d,p,f,m,_,g){const y=8*e;return this.uint16[y+0]=l,this.uint16[y+1]=c,this.uint16[y+2]=d,this.uint16[y+3]=p,this.uint16[y+4]=f,this.uint16[y+5]=m,this.uint16[y+6]=_,this.uint16[y+7]=g,e}}pa.prototype.bytesPerElement=16,ec("StructArrayLayout8ui16",pa);class fa extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,l,c,d,p,f,m,_,g,y,b,T){const S=this.length;return this.resize(S+1),this.emplace(S,e,l,c,d,p,f,m,_,g,y,b,T)}emplace(e,l,c,d,p,f,m,_,g,y,b,T,S){const P=12*e;return this.int16[P+0]=l,this.int16[P+1]=c,this.int16[P+2]=d,this.int16[P+3]=p,this.uint16[P+4]=f,this.uint16[P+5]=m,this.uint16[P+6]=_,this.uint16[P+7]=g,this.int16[P+8]=y,this.int16[P+9]=b,this.int16[P+10]=T,this.int16[P+11]=S,e}}fa.prototype.bytesPerElement=24,ec("StructArrayLayout4i4ui4i24",fa);class da extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,l,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,l,c)}emplace(e,l,c,d){const p=3*e;return this.float32[p+0]=l,this.float32[p+1]=c,this.float32[p+2]=d,e}}da.prototype.bytesPerElement=12,ec("StructArrayLayout3f12",da);class ya extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const l=this.length;return this.resize(l+1),this.emplace(l,e)}emplace(e,l){return this.uint32[1*e+0]=l,e}}ya.prototype.bytesPerElement=4,ec("StructArrayLayout1ul4",ya);class ma extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,l,c,d,p,f,m,_,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,l,c,d,p,f,m,_,g)}emplace(e,l,c,d,p,f,m,_,g,y){const b=10*e,T=5*e;return this.int16[b+0]=l,this.int16[b+1]=c,this.int16[b+2]=d,this.int16[b+3]=p,this.int16[b+4]=f,this.int16[b+5]=m,this.uint32[T+3]=_,this.uint16[b+8]=g,this.uint16[b+9]=y,e}}ma.prototype.bytesPerElement=20,ec("StructArrayLayout6i1ul2ui20",ma);class ga extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,l,c,d,p,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,l,c,d,p,f)}emplace(e,l,c,d,p,f,m){const _=6*e;return this.int16[_+0]=l,this.int16[_+1]=c,this.int16[_+2]=d,this.int16[_+3]=p,this.int16[_+4]=f,this.int16[_+5]=m,e}}ga.prototype.bytesPerElement=12,ec("StructArrayLayout2i2i2i12",ga);class xa extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,l,c,d,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,l,c,d,p)}emplace(e,l,c,d,p,f){const m=4*e,_=8*e;return this.float32[m+0]=l,this.float32[m+1]=c,this.float32[m+2]=d,this.int16[_+6]=p,this.int16[_+7]=f,e}}xa.prototype.bytesPerElement=16,ec("StructArrayLayout2f1f2i16",xa);class va extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,l,c,d,p,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,l,c,d,p,f)}emplace(e,l,c,d,p,f,m){const _=16*e,g=4*e,y=8*e;return this.uint8[_+0]=l,this.uint8[_+1]=c,this.float32[g+1]=d,this.float32[g+2]=p,this.int16[y+6]=f,this.int16[y+7]=m,e}}va.prototype.bytesPerElement=16,ec("StructArrayLayout2ub2f2i16",va);class ba extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,l,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,l,c)}emplace(e,l,c,d){const p=3*e;return this.uint16[p+0]=l,this.uint16[p+1]=c,this.uint16[p+2]=d,e}}ba.prototype.bytesPerElement=6,ec("StructArrayLayout3ui6",ba);class wa extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,l,c,d,p,f,m,_,g,y,b,T,S,P,I,C,R){const L=this.length;return this.resize(L+1),this.emplace(L,e,l,c,d,p,f,m,_,g,y,b,T,S,P,I,C,R)}emplace(e,l,c,d,p,f,m,_,g,y,b,T,S,P,I,C,R,L){const F=24*e,B=12*e,O=48*e;return this.int16[F+0]=l,this.int16[F+1]=c,this.uint16[F+2]=d,this.uint16[F+3]=p,this.uint32[B+2]=f,this.uint32[B+3]=m,this.uint32[B+4]=_,this.uint16[F+10]=g,this.uint16[F+11]=y,this.uint16[F+12]=b,this.float32[B+7]=T,this.float32[B+8]=S,this.uint8[O+36]=P,this.uint8[O+37]=I,this.uint8[O+38]=C,this.uint32[B+10]=R,this.int16[F+22]=L,e}}wa.prototype.bytesPerElement=48,ec("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",wa);class _a extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,l,c,d,p,f,m,_,g,y,b,T,S,P,I,C,R,L,F,B,O,V,j,G,U,q,Z,W){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,l,c,d,p,f,m,_,g,y,b,T,S,P,I,C,R,L,F,B,O,V,j,G,U,q,Z,W)}emplace(e,l,c,d,p,f,m,_,g,y,b,T,S,P,I,C,R,L,F,B,O,V,j,G,U,q,Z,W,Q){const J=32*e,re=16*e;return this.int16[J+0]=l,this.int16[J+1]=c,this.int16[J+2]=d,this.int16[J+3]=p,this.int16[J+4]=f,this.int16[J+5]=m,this.int16[J+6]=_,this.int16[J+7]=g,this.uint16[J+8]=y,this.uint16[J+9]=b,this.uint16[J+10]=T,this.uint16[J+11]=S,this.uint16[J+12]=P,this.uint16[J+13]=I,this.uint16[J+14]=C,this.uint16[J+15]=R,this.uint16[J+16]=L,this.uint16[J+17]=F,this.uint16[J+18]=B,this.uint16[J+19]=O,this.uint16[J+20]=V,this.uint16[J+21]=j,this.uint16[J+22]=G,this.uint32[re+12]=U,this.float32[re+13]=q,this.float32[re+14]=Z,this.uint16[J+30]=W,this.uint16[J+31]=Q,e}}_a.prototype.bytesPerElement=64,ec("StructArrayLayout8i15ui1ul2f2ui64",_a);class Sa extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const l=this.length;return this.resize(l+1),this.emplace(l,e)}emplace(e,l){return this.float32[1*e+0]=l,e}}Sa.prototype.bytesPerElement=4,ec("StructArrayLayout1f4",Sa);class Aa extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,l,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,l,c)}emplace(e,l,c,d){const p=3*e;return this.uint16[6*e+0]=l,this.float32[p+1]=c,this.float32[p+2]=d,e}}Aa.prototype.bytesPerElement=12,ec("StructArrayLayout1ui2f12",Aa);class ka extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,l,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,l,c)}emplace(e,l,c,d){const p=4*e;return this.uint32[2*e+0]=l,this.uint16[p+2]=c,this.uint16[p+3]=d,e}}ka.prototype.bytesPerElement=8,ec("StructArrayLayout1ul2ui8",ka);class Ea extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,l)}emplace(e,l,c){const d=2*e;return this.uint16[d+0]=l,this.uint16[d+1]=c,e}}Ea.prototype.bytesPerElement=4,ec("StructArrayLayout2ui4",Ea);class Ta extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const l=this.length;return this.resize(l+1),this.emplace(l,e)}emplace(e,l){return this.uint16[1*e+0]=l,e}}Ta.prototype.bytesPerElement=2,ec("StructArrayLayout1ui2",Ta);class Ia extends ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,l,c,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,l,c,d)}emplace(e,l,c,d,p){const f=4*e;return this.float32[f+0]=l,this.float32[f+1]=c,this.float32[f+2]=d,this.float32[f+3]=p,e}}Ia.prototype.bytesPerElement=16,ec("StructArrayLayout4f16",Ia);class Ma extends ea{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new d(this.anchorPointX,this.anchorPointY)}}Ma.prototype.size=20;class Fa extends ma{get(e){return new Ma(this,e)}}ec("CollisionBoxArray",Fa);class Da extends ea{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Da.prototype.size=48;class za extends wa{get(e){return new Da(this,e)}}ec("PlacedSymbolArray",za);class Pa extends ea{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Pa.prototype.size=64;class Ba extends _a{get(e){return new Pa(this,e)}}ec("SymbolInstanceArray",Ba);class Va extends Sa{getoffsetX(e){return this.float32[1*e+0]}}ec("GlyphOffsetArray",Va);class Ca extends aa{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ec("SymbolLineVertexArray",Ca);class La extends ea{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}La.prototype.size=12;class Oa extends Aa{get(e){return new La(this,e)}}ec("TextAnchorOffsetArray",Oa);class Ra extends ea{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ra.prototype.size=8;class Na extends ka{get(e){return new Ra(this,e)}}ec("FeatureIndexArray",Na);class $a extends sa{}class Ua extends sa{}class qa extends sa{}class ja extends la{}class Ga extends ua{}class Xa extends ca{}class Ya extends ha{}class Za extends pa{}class Ha extends fa{}class Ka extends da{}class Wa extends ya{}class Ja extends ga{}class Qa extends va{}class to extends ba{}class eo extends Ea{}const zc=Ac([{name:"a_pos",components:2,type:"Int16"}],4),{members:kc}=zc;class io{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,l,c,d){const p=this.segments[this.segments.length-1];return e>io.MAX_VERTEX_ARRAY_LENGTH&&Se(`Max vertices per segment is ${io.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${io.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+e>io.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==d?this.createNewSegment(l,c,d):p}createNewSegment(e,l,c){const d={vertexOffset:e.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0,vaos:{}};return void 0!==c&&(d.sortKey=c),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(d),d}getOrCreateLatestSegment(e,l,c){return this.prepareSegment(0,e,l,c)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const l in e.vaos)e.vaos[l].destroy()}static simpleSegment(e,l,c,d){return new io([{vertexOffset:e,primitiveOffset:l,vertexLength:c,primitiveLength:d,vaos:{},sortKey:0}])}}function Rc(e,l){return 256*(e=fe(Math.floor(e),0,255))+fe(Math.floor(l),0,255)}io.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ec("SegmentVector",io);const Lc=Ac([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Fc=Ac([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Bc,Oc,Vc,Nc={exports:{}},Gc={exports:{}},Uc={exports:{}},Zc=function(){if(Vc)return Nc.exports;Vc=1;var e=(Bc||(Bc=1,Gc.exports=function(e,l){var c,d,p,f,m,_,g,y;for(d=e.length-(c=3&e.length),p=l,m=3432918353,_=461845907,y=0;y<d;)g=255&e.charCodeAt(y)|(255&e.charCodeAt(++y))<<8|(255&e.charCodeAt(++y))<<16|(255&e.charCodeAt(++y))<<24,++y,p=27492+(65535&(f=5*(65535&(p=(p^=g=(65535&(g=(g=(65535&g)*m+(((g>>>16)*m&65535)<<16)&4294967295)<<15|g>>>17))*_+(((g>>>16)*_&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(g=0,c){case 3:g^=(255&e.charCodeAt(y+2))<<16;case 2:g^=(255&e.charCodeAt(y+1))<<8;case 1:p^=g=(65535&(g=(g=(65535&(g^=255&e.charCodeAt(y)))*m+(((g>>>16)*m&65535)<<16)&4294967295)<<15|g>>>17))*_+(((g>>>16)*_&65535)<<16)&4294967295}return p^=e.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),Gc.exports),l=(Oc||(Oc=1,Uc.exports=function(e,l){for(var c,d=e.length,p=l^d,f=0;d>=4;)c=1540483477*(65535&(c=255&e.charCodeAt(f)|(255&e.charCodeAt(++f))<<8|(255&e.charCodeAt(++f))<<16|(255&e.charCodeAt(++f))<<24))+((1540483477*(c>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++f;switch(d){case 3:p^=(255&e.charCodeAt(f+2))<<16;case 2:p^=(255&e.charCodeAt(f+1))<<8;case 1:p=1540483477*(65535&(p^=255&e.charCodeAt(f)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),Uc.exports);return Nc.exports=e,Nc.exports.murmur3=e,Nc.exports.murmur2=l,Nc.exports}(),$c=p(Zc);class go{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,l,c,d){this.ids.push(Wc(e)),this.positions.push(l,c,d)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=Wc(e);let c=0,d=this.ids.length-1;for(;c<d;){const e=c+d>>1;this.ids[e]>=l?d=e:c=e+1}const p=[];for(;this.ids[c]===l;)p.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return p}static serialize(e,l){const c=new Float64Array(e.ids),d=new Uint32Array(e.positions);return Hc(c,d,0,c.length-1),l&&l.push(c.buffer,d.buffer),{ids:c,positions:d}}static deserialize(e){const l=new go;return l.ids=e.ids,l.positions=e.positions,l.indexed=!0,l}}function Wc(e){const l=+e;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:$c(String(e))}function Hc(e,l,c,d){for(;c<d;){const p=e[c+d>>1];let f=c-1,m=d+1;for(;;){do{f++}while(e[f]<p);do{m--}while(e[m]>p);if(f>=m)break;Xc(e,f,m),Xc(l,3*f,3*m),Xc(l,3*f+1,3*m+1),Xc(l,3*f+2,3*m+2)}m-c<d-m?(Hc(e,l,c,m),c=m+1):(Hc(e,l,m+1,d),d=m)}}function Xc(e,l,c){const d=e[l];e[l]=e[c],e[c]=d}ec("FeaturePositionMap",go);class wo{constructor(e,l){this.gl=e.gl,this.location=l}}class _o extends wo{constructor(e,l){super(e,l),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class So extends wo{constructor(e,l){super(e,l),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ao extends wo{constructor(e,l){super(e,l),this.current=Te.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Yc=new Float32Array(16);function Kc(e){return[Rc(255*e.r,255*e.g),Rc(255*e.b,255*e.a)]}class To{constructor(e,l,c){this.value=e,this.uniformNames=l.map((e=>`u_${e}`)),this.type=c}setUniform(e,l,c){e.set(c.constantOr(this.value))}getBinding(e,l,c){return"color"===this.type?new Ao(e,l):new _o(e,l)}}class Io{constructor(e,l){this.uniformNames=l.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,l){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,l.y,l.height,l.width]}setUniform(e,l,c,d){let p=null;"u_pattern_to"===d?p=this.patternTo:"u_pattern_from"===d?p=this.patternFrom:"u_dasharray_to"===d?p=this.dashTo:"u_dasharray_from"===d?p=this.dashFrom:"u_pixel_ratio_to"===d?p=this.pixelRatioTo:"u_pixel_ratio_from"===d&&(p=this.pixelRatioFrom),null!==p&&e.set(p)}getBinding(e,l,c){return"u_pattern"===c.substr(0,9)||"u_dasharray_"===c.substr(0,12)?new So(e,l):new _o(e,l)}}class Mo{constructor(e,l,c,d){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=l.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===c?2:1,offset:0}))),this.paintVertexArray=new d}populatePaintArray(e,l,c){const d=this.paintVertexArray.length,p=this.expression.evaluate(new Ps(0,c),l,{},c.canonical,[],c.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(d,e,p)}updatePaintArray(e,l,c,d,p){const f=this.expression.evaluate(new Ps(0,p),c,d);this._setPaintValue(e,l,f)}_setPaintValue(e,l,c){if("color"===this.type){const d=Kc(c);for(let c=e;c<l;c++)this.paintVertexArray.emplace(c,d[0],d[1])}else{for(let d=e;d<l;d++)this.paintVertexArray.emplace(d,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fo{constructor(e,l,c,d,p,f){this.expression=e,this.uniformNames=l.map((e=>`u_${e}_t`)),this.type=c,this.useIntegerZoom=d,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=l.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===c?4:2,offset:0}))),this.paintVertexArray=new f}populatePaintArray(e,l,c){const d=this.expression.evaluate(new Ps(this.zoom,c),l,{},c.canonical,[],c.formattedSection),p=this.expression.evaluate(new Ps(this.zoom+1,c),l,{},c.canonical,[],c.formattedSection),f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(f,e,d,p)}updatePaintArray(e,l,c,d,p){const f=this.expression.evaluate(new Ps(this.zoom,p),c,d),m=this.expression.evaluate(new Ps(this.zoom+1,p),c,d);this._setPaintValue(e,l,f,m)}_setPaintValue(e,l,c,d){if("color"===this.type){const p=Kc(c),f=Kc(d);for(let c=e;c<l;c++)this.paintVertexArray.emplace(c,p[0],p[1],f[0],f[1])}else{for(let p=e;p<l;p++)this.paintVertexArray.emplace(p,c,d);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,l){const c=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,d=fe(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);e.set(d)}getBinding(e,l,c){return new _o(e,l)}}class Do{constructor(e,l,c,d,p,f){this.expression=e,this.type=l,this.useIntegerZoom=c,this.zoom=d,this.layerId=f,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,l,c){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,this.getPositionIds(l),c)}updatePaintArray(e,l,c,d,p){this._setPaintValues(e,l,this.getPositionIds(c),p)}_setPaintValues(e,l,c,d){const p=this.getPositions(d);if(!p||!c)return;const f=p[c.min],m=p[c.mid],_=p[c.max];if(f&&m&&_)for(let c=e;c<l;c++)this.emplace(this.zoomInPaintVertexArray,c,m,f),this.emplace(this.zoomOutPaintVertexArray,c,m,_)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const l=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,l,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,l,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class zo extends Do{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Lc.members}emplace(e,l,c,d){e.emplace(l,c.tlbr[0],c.tlbr[1],c.tlbr[2],c.tlbr[3],d.tlbr[0],d.tlbr[1],d.tlbr[2],d.tlbr[3],c.pixelRatio,d.pixelRatio)}}class Po extends Do{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return Fc.members}emplace(e,l,c,d){e.emplace(l,0,c.y,c.height,c.width,0,d.y,d.height,d.width)}}class Bo{constructor(e,l,c){this.binders={},this._buffers=[];const d=[];for(const p in e.paint._values){if(!c(p))continue;const f=e.paint.get(p);if(!(f instanceof Us&&fo(f.property.specification)))continue;const m=Qc(p,e.type),_=f.value,g=f.property.specification.type,y=f.property.useIntegerZoom,b=f.property.specification["property-type"],T="cross-faded"===b||"cross-faded-data-driven"===b;if("constant"===_.kind)this.binders[p]=T?new Io(_.value,m):new To(_.value,m,g),d.push(`/u_${p}`);else if("source"===_.kind||T){const c=Jc(p,g,"source");this.binders[p]=T?"line-dasharray"===p?new Po(_,g,y,l,c,e.id):new zo(_,g,y,l,c,e.id):new Mo(_,m,g,c),d.push(`/a_${p}`)}else{const e=Jc(p,g,"composite");this.binders[p]=new Fo(_,m,g,y,l,e),d.push(`/z_${p}`)}}this.cacheKey=d.sort().join("")}getMaxValue(e){const l=this.binders[e];return l instanceof Mo||l instanceof Fo?l.maxValue:0}populatePaintArrays(e,l,c){for(const d in this.binders){const p=this.binders[d];(p instanceof Mo||p instanceof Fo||p instanceof Do)&&p.populatePaintArray(e,l,c)}}setConstantPatternPositions(e,l){for(const c in this.binders){const d=this.binders[c];d instanceof Io&&d.setConstantPatternPositions(e,l)}}setConstantDashPositions(e,l){for(const c in this.binders){const d=this.binders[c];d instanceof Io&&d.setConstantDashPositions(e,l)}}updatePaintArrays(e,l,c,d,p){let f=!1;for(const m in e){const _=l.getPositions(m);for(const l of _){const _=c.feature(l.index);for(const c in this.binders){const g=this.binders[c];if((g instanceof Mo||g instanceof Fo||g instanceof Do)&&!0===g.expression.isStateDependent){const y=d.paint.get(c);g.expression=y.value,g.updatePaintArray(l.start,l.end,_,e[m],p),f=!0}}}}return f}defines(){const e=[];for(const l in this.binders){const c=this.binders[l];(c instanceof To||c instanceof Io)&&e.push(...c.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const l in this.binders){const c=this.binders[l];if(c instanceof Mo||c instanceof Fo)for(let l=0;l<c.paintVertexAttributes.length;l++)e.push(c.paintVertexAttributes[l].name);else if(c instanceof Do){const l=c.getVertexAttributes();for(const c of l)e.push(c.name)}}return e}getBinderUniforms(){const e=[];for(const l in this.binders){const c=this.binders[l];if(c instanceof To||c instanceof Io||c instanceof Fo)for(const l of c.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,l){const c=[];for(const d in this.binders){const p=this.binders[d];if(p instanceof To||p instanceof Io||p instanceof Fo)for(const f of p.uniformNames)if(l[f]){const m=p.getBinding(e,l[f],f);c.push({name:f,property:d,binding:m})}}return c}setUniforms(e,l,c,d){for(const{name:e,property:p,binding:f}of l)this.binders[p].setUniform(f,d,c.get(p),e)}updatePaintBuffers(e){this._buffers=[];for(const l in this.binders){const c=this.binders[l];if(e&&c instanceof Do){const l=2===e.fromScale?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(c instanceof Mo||c instanceof Fo)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(e){for(const l in this.binders){const c=this.binders[l];(c instanceof Mo||c instanceof Fo||c instanceof Do)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const l=this.binders[e];(l instanceof Mo||l instanceof Fo||l instanceof Do)&&l.destroy()}}}class Vo{constructor(e,l,c=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new Bo(d,l,c);this.needsUpload=!1,this._featureMap=new go,this._bufferOffset=0}populatePaintArrays(e,l,c,d){for(const c in this.programConfigurations)this.programConfigurations[c].populatePaintArrays(e,l,d);void 0!==l.id&&this._featureMap.add(l.id,c,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,l,c,d){for(const p of c)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,l,p,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Qc(e,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(`${l}-`,"").replace(/-/g,"_")]}function Jc(e,l,c){const d={color:{source:ca,composite:Ia},number:{source:Sa,composite:ca}},p=function(e){return{"line-pattern":{source:Ya,composite:Ya},"fill-pattern":{source:Ya,composite:Ya},"fill-extrusion-pattern":{source:Ya,composite:Ya},"line-dasharray":{source:Za,composite:Za}}[e]}(e);return p&&p[c]||d[l][c]}ec("ConstantBinder",To),ec("CrossFadedConstantBinder",Io),ec("SourceExpressionBinder",Mo),ec("CrossFadedPatternBinder",zo),ec("CrossFadedDasharrayBinder",Po),ec("CompositeExpressionBinder",Fo),ec("ProgramConfiguration",Bo,{omit:["_buffers"]}),ec("ProgramConfigurationSet",Vo);const eh=Math.pow(2,14)-1,th=-eh-1;function ih(e){const l=re/e.extent,c=e.loadGeometry();for(let e=0;e<c.length;e++){const d=c[e];for(let e=0;e<d.length;e++){const c=d[e],p=Math.round(c.x*l),f=Math.round(c.y*l);c.x=fe(p,th,eh),c.y=fe(f,th,eh),(p<c.x||p>c.x+1||f<c.y||f>c.y+1)&&Se("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function rh(e,l){return{type:e.type,id:e.id,properties:e.properties,geometry:l?ih(e):[]}}const nh=-32768;function sh(e,l,c,d,p){e.emplaceBack(nh+8*l+d,nh+8*c+p)}class jo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Ua,this.indexArray=new to,this.segments=new io,this.programConfigurations=new Vo(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,l,c){const d=this.layers[0],p=[];let f=null,m=!1,_="heatmap"===d.type;if("circle"===d.type){const e=d;f=e.layout.get("circle-sort-key"),m=!f.isConstant(),_=_||"map"===e.paint.get("circle-pitch-alignment")}const g=_?l.subdivisionGranularity.circle:1;for(const{feature:l,id:d,index:_,sourceLayerIndex:g}of e){const e=this.layers[0]._featureFilter.needGeometry,y=rh(l,e);if(!this.layers[0]._featureFilter.filter(new Ps(this.zoom),y,c))continue;const b=m?f.evaluate(y,{},c):void 0,T={id:d,properties:l.properties,type:l.type,sourceLayerIndex:g,index:_,geometry:e?y.geometry:ih(l),patterns:{},sortKey:b};p.push(T)}m&&p.sort(((e,l)=>e.sortKey-l.sortKey));for(const d of p){const{geometry:p,index:f,sourceLayerIndex:m}=d,_=e[f].feature;this.addFeature(d,p,f,c,g),l.featureIndex.insert(_,p,f,m,this.index)}}update(e,l,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,l,this.stateDependentLayers,{imagePositions:c})}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,l,c,d,p=1){let f;switch(p){case 1:f=[0,7];break;case 3:f=[0,2,5,7];break;case 5:f=[0,1,3,4,6,7];break;case 7:f=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const m=f.length;for(const c of l)for(const l of c){const c=l.x,d=l.y;if(c<0||c>=re||d<0||d>=re)continue;const p=this.segments.prepareSegment(m*m,this.layoutVertexArray,this.indexArray,e.sortKey),_=p.vertexLength;for(let e=0;e<m;e++)for(let l=0;l<m;l++)sh(this.layoutVertexArray,c,d,f[l],f[e]);for(let e=0;e<m-1;e++)for(let l=0;l<m-1;l++){const c=_+e*m+l,d=_+(e+1)*m+l;this.indexArray.emplaceBack(c,d+1,c+1),this.indexArray.emplaceBack(c,d,d+1)}p.vertexLength+=m*m,p.primitiveLength+=(m-1)*(m-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{imagePositions:{},canonical:d})}}function oh(e,l){for(let c=0;c<e.length;c++)if(bh(l,e[c]))return!0;for(let c=0;c<l.length;c++)if(bh(e,l[c]))return!0;return!!uh(e,l)}function ah(e,l,c){return!!bh(e,l)||!!mh(l,e,c)}function lh(e,l){if(1===e.length)return vh(l,e[0]);for(let c=0;c<l.length;c++){const d=l[c];for(let l=0;l<d.length;l++)if(bh(e,d[l]))return!0}for(let c=0;c<e.length;c++)if(vh(l,e[c]))return!0;for(let c=0;c<l.length;c++)if(uh(e,l[c]))return!0;return!1}function ch(e,l,c){if(e.length>1){if(uh(e,l))return!0;for(let d=0;d<l.length;d++)if(mh(l[d],e,c))return!0}for(let d=0;d<e.length;d++)if(mh(e[d],l,c))return!0;return!1}function uh(e,l){if(0===e.length||0===l.length)return!1;for(let c=0;c<e.length-1;c++){const d=e[c],p=e[c+1];for(let e=0;e<l.length-1;e++)if(dh(d,p,l[e],l[e+1]))return!0}return!1}function dh(e,l,c,d){return Me(e,c,d)!==Me(l,c,d)&&Me(e,l,c)!==Me(e,l,d)}function mh(e,l,c){const d=c*c;if(1===l.length)return e.distSqr(l[0])<d;for(let c=1;c<l.length;c++)if(yh(e,l[c-1],l[c])<d)return!0;return!1}function yh(e,l,c){const d=l.distSqr(c);if(0===d)return e.distSqr(l);const p=((e.x-l.x)*(c.x-l.x)+(e.y-l.y)*(c.y-l.y))/d;return e.distSqr(p<0?l:p>1?c:c.sub(l)._mult(p)._add(l))}function vh(e,l){let c,d,p,f=!1;for(let m=0;m<e.length;m++){c=e[m];for(let e=0,m=c.length-1;e<c.length;m=e++)d=c[e],p=c[m],d.y>l.y!=p.y>l.y&&l.x<(p.x-d.x)*(l.y-d.y)/(p.y-d.y)+d.x&&(f=!f)}return f}function bh(e,l){let c=!1;for(let d=0,p=e.length-1;d<e.length;p=d++){const f=e[d],m=e[p];f.y>l.y!=m.y>l.y&&l.x<(m.x-f.x)*(l.y-f.y)/(m.y-f.y)+f.x&&(c=!c)}return c}function Th(e,l,c){const d=c[0],p=c[2];if(e.x<d.x&&l.x<d.x||e.x>p.x&&l.x>p.x||e.y<d.y&&l.y<d.y||e.y>p.y&&l.y>p.y)return!1;const f=Me(e,l,c[0]);return f!==Me(e,l,c[1])||f!==Me(e,l,c[2])||f!==Me(e,l,c[3])}function Ph(e,l,c){const d=l.paint.get(e).value;return"constant"===d.kind?d.value:c.programConfigurations.get(l.id).getMaxValue(e)}function Mh(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Ih(e,l,c,p,f){if(!l[0]&&!l[1])return e;const m=d.convert(l)._mult(f);"viewport"===c&&m._rotate(-p);const _=[];for(let l=0;l<e.length;l++)_.push(e[l].sub(m));return _}function Ch(e){const l=[];for(let c=0;c<e.length;c++){const d=e[c],p=l.at(-1);(0===c||p&&!d.equals(p))&&l.push(d)}return l}function Ah({queryGeometry:e,size:l},c){return ah(e,c,l)}function Dh({queryGeometry:e,size:l,transform:c,unwrappedTileID:d,getElevation:p},f){return ah(e,f,l*(c.projectTileCoordinates(f.x,f.y,d,p).signedDistanceFromCamera/c.cameraToCenterDistance))}function zh({queryGeometry:e,size:l,transform:c,unwrappedTileID:d,getElevation:p},f){const m=c.projectTileCoordinates(f.x,f.y,d,p).signedDistanceFromCamera,_=l*(c.cameraToCenterDistance/m);return ah(e,Bh(f,c,d,p),_)}function kh({queryGeometry:e,size:l,transform:c,unwrappedTileID:d,getElevation:p},f){return ah(e,Bh(f,c,d,p),l)}function Fh({queryGeometry:e,size:l,transform:c,unwrappedTileID:d,getElevation:p,pitchAlignment:f="map",pitchScale:m="map"},_){const g="map"===f?"map"===m?Ah:Dh:"map"===m?zh:kh,y={queryGeometry:e,size:l,transform:c,unwrappedTileID:d,getElevation:p};for(const e of _)for(const l of e)if(g(y,l))return!0;return!1}function Bh(e,l,c,p){const f=l.projectTileCoordinates(e.x,e.y,c,p).point;return new d((.5*f.x+.5)*l.width,(.5*-f.y+.5)*l.height)}let Nh,Uh;ec("CircleBucket",jo,{omit:["layers"]});var qh={get paint(){return Uh=Uh||new Hs({"circle-radius":new Gs(Tt.paint_circle["circle-radius"]),"circle-color":new Gs(Tt.paint_circle["circle-color"]),"circle-blur":new Gs(Tt.paint_circle["circle-blur"]),"circle-opacity":new Gs(Tt.paint_circle["circle-opacity"]),"circle-translate":new js(Tt.paint_circle["circle-translate"]),"circle-translate-anchor":new js(Tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new js(Tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new js(Tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gs(Tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gs(Tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gs(Tt.paint_circle["circle-stroke-opacity"])})},get layout(){return Nh=Nh||new Hs({"circle-sort-key":new Gs(Tt.layout_circle["circle-sort-key"])})}};class yl extends Ks{constructor(e,l){super(e,qh,l)}createBucket(e){return new jo(e)}queryRadius(e){const l=e;return Ph("circle-radius",this,l)+Ph("circle-stroke-width",this,l)+Mh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:l,featureState:c,geometry:d,transform:p,pixelsToTileUnits:f,unwrappedTileID:m,getElevation:_}){const g=Ih(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,f),y=this.paint.get("circle-radius").evaluate(l,c)+this.paint.get("circle-stroke-width").evaluate(l,c),b=this.paint.get("circle-pitch-scale"),T=this.paint.get("circle-pitch-alignment");let S,P;return"map"===T?(S=g,P=y*f):(S=function(e,l,c,d){return e.map((e=>Bh(e,l,c,d)))}(g,p,m,_),P=y),Fh({queryGeometry:S,size:P,transform:p,unwrappedTileID:m,getElevation:_,pitchAlignment:T,pitchScale:b},d)}}class ml extends jo{}let $h;ec("HeatmapBucket",ml,{omit:["layers"]});var eu={get paint(){return $h=$h||new Hs({"heatmap-radius":new Gs(Tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gs(Tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new js(Tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Zs(Tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new js(Tt.paint_heatmap["heatmap-opacity"])})}};function tu(e,{width:l,height:c},d,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==l*c*d)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${l*c*d}`)}else p=new Uint8Array(l*c*d);return e.width=l,e.height=c,e.data=p,e}function iu(e,{width:l,height:c},d){if(l===e.width&&c===e.height)return;const p=tu({},{width:l,height:c},d);ru(e,p,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,l),height:Math.min(e.height,c)},d),e.width=l,e.height=c,e.data=p.data}function ru(e,l,c,d,p,f){if(0===p.width||0===p.height)return l;if(p.width>e.width||p.height>e.height||c.x>e.width-p.width||c.y>e.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>l.width||p.height>l.height||d.x>l.width-p.width||d.y>l.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const m=e.data,_=l.data;if(m===_)throw new Error("srcData equals dstData, so image is already copied");for(let g=0;g<p.height;g++){const y=((c.y+g)*e.width+c.x)*f,b=((d.y+g)*l.width+d.x)*f;for(let e=0;e<p.width*f;e++)_[b+e]=m[y+e]}return l}class _l{constructor(e,l){tu(this,e,1,l)}resize(e){iu(this,e,1)}clone(){return new _l({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,l,c,d,p){ru(e,l,c,d,p,1)}}class Sl{constructor(e,l){tu(this,e,4,l)}resize(e){iu(this,e,4)}replace(e,l){l?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Sl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,l,c,d,p){ru(e,l,c,d,p,4)}setPixel(e,l,c){const d=4*(e*this.width+l);this.data[d+0]=Math.round(255*c.r/c.a),this.data[d+1]=Math.round(255*c.g/c.a),this.data[d+2]=Math.round(255*c.b/c.a),this.data[d+3]=Math.round(255*c.a)}}function nu(e){const l={},c=e.resolution||256,d=e.clips?e.clips.length:1,p=e.image||new Sl({width:c,height:d});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const f=(d,f,m)=>{l[e.evaluationKey]=m;const _=e.expression.evaluate(l);p.setPixel(d/4/c,f/4,_)};if(e.clips)for(let l=0,p=0;l<d;++l,p+=4*c)for(let d=0,m=0;d<c;d++,m+=4){const _=d/(c-1),{start:g,end:y}=e.clips[l];f(p,m,g*(1-_)+y*_)}else for(let e=0,l=0;e<c;e++,l+=4)f(0,l,e/(c-1));return p}ec("AlphaImage",_l),ec("RGBAImage",Sl);const su="big-fb";class El extends Ks{createBucket(e){return new ml(e)}constructor(e,l){super(e,eu,l),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=nu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(su)&&this.heatmapFbos.delete(su)}queryRadius(e){return Ph("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:l,featureState:c,geometry:d,transform:p,pixelsToTileUnits:f,unwrappedTileID:m,getElevation:_}){return Fh({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(l,c)*f,transform:p,unwrappedTileID:m,getElevation:_},d)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&!this.isHidden()}}let ou;var au={get paint(){return ou=ou||new Hs({"hillshade-illumination-direction":new js(Tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new js(Tt.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new js(Tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new js(Tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new js(Tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new js(Tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new js(Tt.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new js(Tt.paint_hillshade["hillshade-method"])})}};class Ml extends Ks{constructor(e,l){super(e,au,l),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,l=this.paint.get("hillshade-illumination-altitude").values,c=this.paint.get("hillshade-highlight-color").values,d=this.paint.get("hillshade-shadow-color").values;const p=Math.max(e.length,l.length,c.length,d.length);e=e.concat(Array(p-e.length).fill(e.at(-1))),l=l.concat(Array(p-l.length).fill(l.at(-1))),c=c.concat(Array(p-c.length).fill(c.at(-1))),d=d.concat(Array(p-d.length).fill(d.at(-1)));const f=l.map(He);return{directionRadians:e.map(He),altitudeRadians:f,shadowColor:d,highlightColor:c}}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&!this.isHidden()}}let lu;var cu={get paint(){return lu=lu||new Hs({"color-relief-opacity":new js(Tt["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Zs(Tt["paint_color-relief"]["color-relief-color"])})}};class zl{constructor(e,l,c,d){this.context=e,this.format=c,this.texture=e.gl.createTexture(),this.update(l,d)}update(e,l,c){const{width:d,height:p}=e,f=!(this.size&&this.size[0]===d&&this.size[1]===p||c),{context:m}=this,{gl:_}=m;if(this.useMipmap=Boolean(l&&l.useMipmap),_.bindTexture(_.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!l||!1!==l.premultiply)),f)this.size=[d,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Ae(e)?_.texImage2D(_.TEXTURE_2D,0,this.format,this.format,_.UNSIGNED_BYTE,e):_.texImage2D(_.TEXTURE_2D,0,this.format,d,p,0,this.format,_.UNSIGNED_BYTE,e.data);else{const{x:l,y:f}=c||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Ae(e)?_.texSubImage2D(_.TEXTURE_2D,0,l,f,_.RGBA,_.UNSIGNED_BYTE,e):_.texSubImage2D(_.TEXTURE_2D,0,l,f,d,p,_.RGBA,_.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&_.generateMipmap(_.TEXTURE_2D),m.pixelStoreUnpackFlipY.setDefault(),m.pixelStoreUnpack.setDefault(),m.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,l,c){const{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),c!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,c||e),this.filter=e),l!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Pl{constructor(e,l,c,d=1,p=1,f=1,m=0){if(this.uid=e,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void Se(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const _=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=p,this.blueFactor=f,this.baseShift=m;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let e=0;e<_;e++)this.data[this._idx(-1,e)]=this.data[this._idx(0,e)],this.data[this._idx(_,e)]=this.data[this._idx(_-1,e)],this.data[this._idx(e,-1)]=this.data[this._idx(e,0)],this.data[this._idx(e,_)]=this.data[this._idx(e,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let e=0;e<_;e++)for(let l=0;l<_;l++){const c=this.get(e,l);c>this.max&&(this.max=c),c<this.min&&(this.min=c)}}get(e,l){const c=new Uint8Array(this.data.buffer),d=4*this._idx(e,l);return this.unpack(c[d],c[d+1],c[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,l){if(e<-1||e>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${l}, dim: ${this.dim}`);return(l+1)*this.stride+(e+1)}unpack(e,l,c){return e*this.redFactor+l*this.greenFactor+c*this.blueFactor-this.baseShift}pack(e){return uu(e,this.getUnpackVector())}getPixels(){return new Sl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,l,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=l*this.dim,p=l*this.dim+this.dim,f=c*this.dim,m=c*this.dim+this.dim;switch(l){case-1:d=p-1;break;case 1:p=d+1}switch(c){case-1:f=m-1;break;case 1:m=f+1}const _=-l*this.dim,g=-c*this.dim;for(let l=f;l<m;l++)for(let c=d;c<p;c++)this.data[this._idx(c,l)]=e.data[this._idx(c+_,l+g)]}}function uu(e,l){const c=l[0],d=l[1],p=l[2],f=l[3],m=Math.min(c,d,p),_=Math.round((e+f)/m);return{r:Math.floor(_*m/c)%256,g:Math.floor(_*m/d)%256,b:Math.floor(_*m/p)%256}}ec("DEMData",Pl);class Vl extends Ks{constructor(e,l){super(e,cu,l)}_createColorRamp(e){const l={elevationStops:[],colorStops:[]},c=this._transitionablePaint._values["color-relief-color"].value.expression;if(c instanceof ii&&c._styleExpression.expression instanceof fr){this.colorRampExpression=c;const e=c._styleExpression.expression;l.elevationStops=e.labels,l.colorStops=[];for(const c of l.elevationStops)l.colorStops.push(e.evaluate({globals:{elevation:c}}))}if(l.elevationStops.length<1&&(l.elevationStops=[0],l.colorStops=[Te.transparent]),l.elevationStops.length<2&&(l.elevationStops.push(l.elevationStops[0]+1),l.colorStops.push(l.colorStops[0])),l.elevationStops.length<=e)return l;const d={elevationStops:[],colorStops:[]},p=(l.elevationStops.length-1)/(e-1);for(let e=0;e<l.elevationStops.length-.5;e+=p)d.elevationStops.push(l.elevationStops[Math.round(e)]),d.colorStops.push(l.colorStops[Math.round(e)]);return Se(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${l.elevationStops.length}`),d}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,l,c){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const d=this._createColorRamp(l),p=new Sl({width:d.colorStops.length,height:1}),f=new Sl({width:d.colorStops.length,height:1});for(let e=0;e<d.elevationStops.length;e++){const l=uu(d.elevationStops[e],c);f.setPixel(0,e,new Te(l.r/255,l.g/255,l.b/255,1)),p.setPixel(0,e,d.colorStops[e])}return this.colorRampTextures={elevationTexture:new zl(e,f,e.gl.RGBA),colorTexture:new zl(e,p,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const du=Ac([{name:"a_pos",components:2,type:"Int16"}],4),{members:fu}=du;function mu(e,l,c){const d=c.patternDependencies;let p=!1;for(const c of l){const l=c.paint.get(`${e}-pattern`);l.isConstant()||(p=!0);const f=l.constantOr(null);f&&(p=!0,d[f.to]=!0,d[f.from]=!0)}return p}function _u(e,l,c,d,p){const{zoom:f}=d,m=p.patternDependencies;for(const d of l){const l=d.paint.get(`${e}-pattern`).value;if("constant"!==l.kind){let e=l.evaluate({zoom:f-1},c,{},p.availableImages),_=l.evaluate({zoom:f},c,{},p.availableImages),g=l.evaluate({zoom:f+1},c,{},p.availableImages);e=e&&e.name?e.name:e,_=_&&_.name?_.name:_,g=g&&g.name?g.name:g,m[e]=!0,m[_]=!0,m[g]=!0,c.patterns[d.id]={min:e,mid:_,max:g}}}return c}function gu(e,l,c,d,p){let f;if(p===function(e,l,c,d){let p=0;for(let f=l,m=c-d;f<c;f+=d)p+=(e[m]-e[f])*(e[f+1]+e[m+1]),m=f;return p}(e,l,c,d)>0)for(let p=l;p<c;p+=d)f=Wu(p/d|0,e[p],e[p+1],f);else for(let p=c-d;p>=l;p-=d)f=Wu(p/d|0,e[p],e[p+1],f);return f&&ju(f,f.next)&&(Hu(f),f=f.next),f}function xu(e,l){if(!e)return e;l||(l=e);let c,d=e;do{if(c=!1,d.steiner||!ju(d,d.next)&&0!==Ou(d.prev,d,d.next))d=d.next;else{if(Hu(d),d=l=d.prev,d===d.next)break;c=!0}}while(c||d!==l);return l}function vu(e,l,c,d,p,f,m){if(!e)return;!m&&f&&function(e,l,c,d){let p=e;do{0===p.z&&(p.z=Du(p.x,p.y,l,c,d)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next}while(p!==e);p.prevZ.nextZ=null,p.prevZ=null,function(e){let l,c=1;do{let d,p=e;e=null;let f=null;for(l=0;p;){l++;let m=p,_=0;for(let e=0;e<c&&(_++,m=m.nextZ,m);e++);let g=c;for(;_>0||g>0&&m;)0!==_&&(0===g||!m||p.z<=m.z)?(d=p,p=p.nextZ,_--):(d=m,m=m.nextZ,g--),f?f.nextZ=d:e=d,d.prevZ=f,f=d;p=m}f.nextZ=null,c*=2}while(l>1)}(p)}(e,d,p,f);let _=e;for(;e.prev!==e.next;){const g=e.prev,y=e.next;if(f?Tu(e,d,p,f):bu(e))l.push(g.i,e.i,y.i),Hu(e),e=y.next,_=y.next;else if((e=y)===_){m?1===m?vu(e=Su(xu(e),l),l,c,d,p,f,2):2===m&&Iu(e,l,c,d,p,f):vu(xu(e),l,c,d,p,f,1);break}}}function bu(e){const l=e.prev,c=e,d=e.next;if(Ou(l,c,d)>=0)return!1;const p=l.x,f=c.x,m=d.x,_=l.y,g=c.y,y=d.y,b=Math.min(p,f,m),T=Math.min(_,g,y),S=Math.max(p,f,m),P=Math.max(_,g,y);let I=d.next;for(;I!==l;){if(I.x>=b&&I.x<=S&&I.y>=T&&I.y<=P&&Fu(p,_,f,g,m,y,I.x,I.y)&&Ou(I.prev,I,I.next)>=0)return!1;I=I.next}return!0}function Tu(e,l,c,d){const p=e.prev,f=e,m=e.next;if(Ou(p,f,m)>=0)return!1;const _=p.x,g=f.x,y=m.x,b=p.y,T=f.y,S=m.y,P=Math.min(_,g,y),I=Math.min(b,T,S),C=Math.max(_,g,y),R=Math.max(b,T,S),L=Du(P,I,l,c,d),F=Du(C,R,l,c,d);let B=e.prevZ,O=e.nextZ;for(;B&&B.z>=L&&O&&O.z<=F;){if(B.x>=P&&B.x<=C&&B.y>=I&&B.y<=R&&B!==p&&B!==m&&Fu(_,b,g,T,y,S,B.x,B.y)&&Ou(B.prev,B,B.next)>=0)return!1;if(B=B.prevZ,O.x>=P&&O.x<=C&&O.y>=I&&O.y<=R&&O!==p&&O!==m&&Fu(_,b,g,T,y,S,O.x,O.y)&&Ou(O.prev,O,O.next)>=0)return!1;O=O.nextZ}for(;B&&B.z>=L;){if(B.x>=P&&B.x<=C&&B.y>=I&&B.y<=R&&B!==p&&B!==m&&Fu(_,b,g,T,y,S,B.x,B.y)&&Ou(B.prev,B,B.next)>=0)return!1;B=B.prevZ}for(;O&&O.z<=F;){if(O.x>=P&&O.x<=C&&O.y>=I&&O.y<=R&&O!==p&&O!==m&&Fu(_,b,g,T,y,S,O.x,O.y)&&Ou(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function Su(e,l){let c=e;do{const d=c.prev,p=c.next.next;!ju(d,p)&&Nu(d,c,c.next,p)&&Zu(d,p)&&Zu(p,d)&&(l.push(d.i,c.i,p.i),Hu(c),Hu(c.next),c=e=p),c=c.next}while(c!==e);return xu(c)}function Iu(e,l,c,d,p,f){let m=e;do{let e=m.next.next;for(;e!==m.prev;){if(m.i!==e.i&&Bu(m,e)){let _=$u(m,e);return m=xu(m,m.next),_=xu(_,_.next),vu(m,l,c,d,p,f,0),void vu(_,l,c,d,p,f,0)}e=e.next}m=m.next}while(m!==e)}function Eu(e,l){let c=e.x-l.x;return 0===c&&(c=e.y-l.y,0===c)&&(c=(e.next.y-e.y)/(e.next.x-e.x)-(l.next.y-l.y)/(l.next.x-l.x)),c}function Cu(e,l){const c=function(e,l){let c=l;const d=e.x,p=e.y;let f,m=-1/0;if(ju(e,c))return c;do{if(ju(e,c.next))return c.next;if(p<=c.y&&p>=c.next.y&&c.next.y!==c.y){const e=c.x+(p-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(e<=d&&e>m&&(m=e,f=c.x<c.next.x?c:c.next,e===d))return f}c=c.next}while(c!==l);if(!f)return null;const _=f,g=f.x,y=f.y;let b=1/0;c=f;do{if(d>=c.x&&c.x>=g&&d!==c.x&&Lu(p<y?d:m,p,g,y,p<y?m:d,p,c.x,c.y)){const l=Math.abs(p-c.y)/(d-c.x);Zu(c,e)&&(l<b||l===b&&(c.x>f.x||c.x===f.x&&Au(f,c)))&&(f=c,b=l)}c=c.next}while(c!==_);return f}(e,l);if(!c)return l;const d=$u(c,e);return xu(d,d.next),xu(c,c.next)}function Au(e,l){return Ou(e.prev,e,l.prev)<0&&Ou(l.next,e,e.next)<0}function Du(e,l,c,d,p){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-d)*p|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function zu(e){let l=e,c=e;do{(l.x<c.x||l.x===c.x&&l.y<c.y)&&(c=l),l=l.next}while(l!==e);return c}function Lu(e,l,c,d,p,f,m,_){return(p-m)*(l-_)>=(e-m)*(f-_)&&(e-m)*(d-_)>=(c-m)*(l-_)&&(c-m)*(f-_)>=(p-m)*(d-_)}function Fu(e,l,c,d,p,f,m,_){return!(e===m&&l===_)&&Lu(e,l,c,d,p,f,m,_)}function Bu(e,l){return e.next.i!==l.i&&e.prev.i!==l.i&&!function(e,l){let c=e;do{if(c.i!==e.i&&c.next.i!==e.i&&c.i!==l.i&&c.next.i!==l.i&&Nu(c,c.next,e,l))return!0;c=c.next}while(c!==e);return!1}(e,l)&&(Zu(e,l)&&Zu(l,e)&&function(e,l){let c=e,d=!1;const p=(e.x+l.x)/2,f=(e.y+l.y)/2;do{c.y>f!=c.next.y>f&&c.next.y!==c.y&&p<(c.next.x-c.x)*(f-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next}while(c!==e);return d}(e,l)&&(Ou(e.prev,e,l.prev)||Ou(e,l.prev,l))||ju(e,l)&&Ou(e.prev,e,e.next)>0&&Ou(l.prev,l,l.next)>0)}function Ou(e,l,c){return(l.y-e.y)*(c.x-l.x)-(l.x-e.x)*(c.y-l.y)}function ju(e,l){return e.x===l.x&&e.y===l.y}function Nu(e,l,c,d){const p=qu(Ou(e,l,c)),f=qu(Ou(e,l,d)),m=qu(Ou(c,d,e)),_=qu(Ou(c,d,l));return p!==f&&m!==_||!(0!==p||!Uu(e,c,l))||!(0!==f||!Uu(e,d,l))||!(0!==m||!Uu(c,e,d))||!(0!==_||!Uu(c,l,d))}function Uu(e,l,c){return l.x<=Math.max(e.x,c.x)&&l.x>=Math.min(e.x,c.x)&&l.y<=Math.max(e.y,c.y)&&l.y>=Math.min(e.y,c.y)}function qu(e){return e>0?1:e<0?-1:0}function Zu(e,l){return Ou(e.prev,e,e.next)<0?Ou(e,l,e.next)>=0&&Ou(e,e.prev,l)>=0:Ou(e,l,e.prev)<0||Ou(e,e.next,l)<0}function $u(e,l){const c=Xu(e.i,e.x,e.y),d=Xu(l.i,l.x,l.y),p=e.next,f=l.prev;return e.next=l,l.prev=e,c.next=p,p.prev=c,d.next=c,c.prev=d,f.next=d,d.prev=f,d}function Wu(e,l,c,d){const p=Xu(e,l,c);return d?(p.next=d.next,p.prev=d,d.next.prev=p,d.next=p):(p.prev=p,p.next=p),p}function Hu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Xu(e,l,c){return{i:e,x:l,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class hu{constructor(e,l){if(l>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=l}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class pu{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}pu.noSubdivision=new pu({fill:new hu(0,0),line:new hu(0,0),tile:new hu(0,0),stencil:new hu(0,0),circle:1}),ec("SubdivisionGranularityExpression",hu),ec("SubdivisionGranularitySetting",pu);const Yu=-32768,Ku=32767;class yu{constructor(e,l){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=re/e,this._canonical=l}_getKey(e,l){return(e+=32768)<<16|l+32768}_vertexToIndex(e,l){if(e<-32768||l<-32768||e>32767||l>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const c=0|Math.round(e),d=0|Math.round(l),p=this._getKey(c,d);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const f=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,f),this._vertexBuffer.push(c,d),f}_subdivideTrianglesScanline(e){if(this._granularity<2)return function(e,l){const c=[];for(let d=0;d<l.length;d+=3){const p=l[d],f=l[d+1],m=l[d+2],_=e[2*p],g=e[2*p+1];(e[2*f]-_)*(e[2*m+1]-g)-(e[2*f+1]-g)*(e[2*m]-_)>0?(c.push(p),c.push(m),c.push(f)):(c.push(p),c.push(f),c.push(m))}return c}(this._vertexBuffer,e);const l=[],c=e.length;for(let d=0;d<c;d+=3){const c=[e[d+0],e[d+1],e[d+2]],p=[this._vertexBuffer[2*e[d+0]+0],this._vertexBuffer[2*e[d+0]+1],this._vertexBuffer[2*e[d+1]+0],this._vertexBuffer[2*e[d+1]+1],this._vertexBuffer[2*e[d+2]+0],this._vertexBuffer[2*e[d+2]+1]];let f=1/0,m=1/0,_=-1/0,g=-1/0;for(let e=0;e<3;e++){const l=p[2*e],c=p[2*e+1];f=Math.min(f,l),_=Math.max(_,l),m=Math.min(m,c),g=Math.max(g,c)}if(f===_||m===g)continue;const y=Math.floor(f/this._granularityCellSize),b=Math.ceil(_/this._granularityCellSize),T=Math.floor(m/this._granularityCellSize),S=Math.ceil(g/this._granularityCellSize);if(y!==b||T!==S)for(let e=T;e<S;e++){const d=this._scanlineGenerateVertexRingForCellRow(e,p,c);ed(this._vertexBuffer,d,l)}else l.push(...c)}return l}_scanlineGenerateVertexRingForCellRow(e,l,c){const d=e*this._granularityCellSize,p=d+this._granularityCellSize,f=[];for(let e=0;e<3;e++){const m=l[2*e],_=l[2*e+1],g=l[2*(e+1)%6],y=l[(2*(e+1)+1)%6],b=l[2*(e+2)%6],T=l[(2*(e+2)+1)%6],S=g-m,P=y-_,I=0===S,C=0===P,R=(d-_)/P,L=(p-_)/P,F=Math.min(R,L),B=Math.max(R,L);if(!C&&(F>=1||B<=0)||C&&(_<d||_>p)){y>=d&&y<=p&&f.push(c[(e+1)%3]);continue}!C&&F>0&&f.push(this._vertexToIndex(m+S*F,_+P*F));const O=m+S*Math.max(F,0),V=m+S*Math.min(B,1);I||this._generateIntraEdgeVertices(f,m,_,g,y,O,V),!C&&B<1&&f.push(this._vertexToIndex(m+S*B,_+P*B)),(C||y>=d&&y<=p)&&f.push(c[(e+1)%3]),!C&&(y<=d||y>=p)&&this._generateInterEdgeVertices(f,m,_,g,y,b,T,V,d,p)}return f}_generateIntraEdgeVertices(e,l,c,d,p,f,m){const _=d-l,g=p-c,y=0===g,b=y?Math.min(l,d):Math.min(f,m),T=y?Math.max(l,d):Math.max(f,m),S=Math.floor(b/this._granularityCellSize)+1,P=Math.ceil(T/this._granularityCellSize)-1;if(y?l<d:f<m)for(let d=S;d<=P;d++){const p=d*this._granularityCellSize;e.push(this._vertexToIndex(p,c+g*(p-l)/_))}else for(let d=P;d>=S;d--){const p=d*this._granularityCellSize;e.push(this._vertexToIndex(p,c+g*(p-l)/_))}}_generateInterEdgeVertices(e,l,c,d,p,f,m,_,g,y){const b=p-c,T=f-d,S=m-p,P=(g-p)/S,I=(y-p)/S,C=Math.min(P,I),R=Math.max(P,I),L=d+T*C;let F=Math.floor(Math.min(L,_)/this._granularityCellSize)+1,B=Math.ceil(Math.max(L,_)/this._granularityCellSize)-1,O=_<L;const V=0===S;if(V&&(m===g||m===y))return;if(V||C>=1||R<=0){const e=c-m,d=f+(l-f)*Math.min((g-m)/e,(y-m)/e);F=Math.floor(Math.min(d,_)/this._granularityCellSize)+1,B=Math.ceil(Math.max(d,_)/this._granularityCellSize)-1,O=_<d}const j=b>0?y:g;if(O)for(let l=F;l<=B;l++)e.push(this._vertexToIndex(l*this._granularityCellSize,j));else for(let l=B;l>=F;l--)e.push(this._vertexToIndex(l*this._granularityCellSize,j))}_generateOutline(e){const l=[];for(const c of e){const e=Ju(c,this._granularity,!0),d=this._pointArrayToIndices(e),p=[];for(let e=1;e<d.length;e++)p.push(d[e-1]),p.push(d[e]);l.push(p)}return l}_handlePoles(e){let l=!1,c=!1;this._canonical&&(0===this._canonical.y&&(l=!0),this._canonical.y===(1<<this._canonical.z)-1&&(c=!0)),(l||c)&&this._fillPoles(e,l,c)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let l=0;l<e.length;l+=2){const c=e[l+1];c===Yu&&(e[l+1]=-32767),c===Ku&&(e[l+1]=32766)}}_generatePoleQuad(e,l,c,d,p,f){d>p!=(f===Yu)?(e.push(l),e.push(c),e.push(this._vertexToIndex(d,f)),e.push(c),e.push(this._vertexToIndex(p,f)),e.push(this._vertexToIndex(d,f))):(e.push(c),e.push(l),e.push(this._vertexToIndex(d,f)),e.push(this._vertexToIndex(p,f)),e.push(c),e.push(this._vertexToIndex(d,f)))}_fillPoles(e,l,c){const d=this._vertexBuffer,p=re,f=e.length;for(let m=2;m<f;m+=3){const f=e[m-2],_=e[m-1],g=e[m],y=d[2*f],b=d[2*f+1],T=d[2*_],S=d[2*_+1],P=d[2*g],I=d[2*g+1];l&&(0===b&&0===S&&this._generatePoleQuad(e,f,_,y,T,Yu),0===S&&0===I&&this._generatePoleQuad(e,_,g,T,P,Yu),0===I&&0===b&&this._generatePoleQuad(e,g,f,P,y,Yu)),c&&(b===p&&S===p&&this._generatePoleQuad(e,f,_,y,T,Ku),S===p&&I===p&&this._generatePoleQuad(e,_,g,T,P,Ku),I===p&&b===p&&this._generatePoleQuad(e,g,f,P,y,Ku))}}_initializeVertices(e){for(let l=0;l<e.length;l+=2)this._vertexToIndex(e[l],e[l+1])}subdividePolygonInternal(e,l){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:c,holeIndices:d}=function(e){const l=[],c=[];for(const d of e)if(0!==d.length){d!==e[0]&&l.push(c.length/2);for(let e=0;e<d.length;e++)c.push(d[e].x),c.push(d[e].y)}return{flattened:c,holeIndices:l}}(e);let p;this._initializeVertices(c);try{const e=function(e,l,c=2){const d=l&&l.length,p=d?l[0]*c:e.length;let f=gu(e,0,p,c,!0);const m=[];if(!f||f.next===f.prev)return m;let _,g,y;if(d&&(f=function(e,l,c,d){const p=[];for(let c=0,f=l.length;c<f;c++){const m=gu(e,l[c]*d,c<f-1?l[c+1]*d:e.length,d,!1);m===m.next&&(m.steiner=!0),p.push(zu(m))}p.sort(Eu);for(let e=0;e<p.length;e++)c=Cu(p[e],c);return c}(e,l,f,c)),e.length>80*c){_=e[0],g=e[1];let l=_,d=g;for(let f=c;f<p;f+=c){const c=e[f],p=e[f+1];c<_&&(_=c),p<g&&(g=p),c>l&&(l=c),p>d&&(d=p)}y=Math.max(l-_,d-g),y=0!==y?32767/y:0}return vu(f,m,c,_,g,y,0),m}(c,d),l=this._convertIndices(c,e);p=this._subdivideTrianglesScanline(l)}catch(e){console.error(e)}let f=[];return l&&(f=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:f}}_convertIndices(e,l){const c=[];for(let d=0;d<l.length;d++)c.push(this._vertexToIndex(e[2*l[d]],e[2*l[d]+1]));return c}_pointArrayToIndices(e){const l=[];for(let c=0;c<e.length;c++){const d=e[c];l.push(this._vertexToIndex(d.x,d.y))}return l}}function Qu(e,l,c,d=!0){return new yu(c,l).subdividePolygonInternal(e,d)}function Ju(e,l,c=!1){if(!e||e.length<1)return[];if(e.length<2)return[];const p=e[0],f=e[e.length-1],m=c&&(p.x!==f.x||p.y!==f.y);if(l<2)return m?[...e,e[0]]:[...e];const _=Math.floor(re/l),g=[];g.push(new d(e[0].x,e[0].y));const y=e.length,b=m?y:y-1;for(let l=0;l<b;l++){const c=e[l],p=l<y-1?e[l+1]:e[0],f=c.x,m=c.y,b=p.x,T=p.y,S=f!==b,P=m!==T;if(!S&&!P)continue;const I=b-f,C=T-m,R=Math.abs(I),L=Math.abs(C);let F=f,B=m;for(;;){const e=I>0?(Math.floor(F/_)+1)*_:(Math.ceil(F/_)-1)*_,l=C>0?(Math.floor(B/_)+1)*_:(Math.ceil(B/_)-1)*_,c=Math.abs(F-e),p=Math.abs(B-l),f=Math.abs(F-b),m=Math.abs(B-T),y=S?c/R:Number.POSITIVE_INFINITY,O=P?p/L:Number.POSITIVE_INFINITY;if((f<=c||!S)&&(m<=p||!P))break;if(y<O&&S||!P){F=e,B+=C*y;const l=new d(F,Math.round(B));g[g.length-1].x===l.x&&g[g.length-1].y===l.y||g.push(l)}else{F+=I*O,B=l;const e=new d(Math.round(F),B);g[g.length-1].x===e.x&&g[g.length-1].y===e.y||g.push(e)}}const O=new d(b,T);g[g.length-1].x===O.x&&g[g.length-1].y===O.y||g.push(O)}return g}function ed(e,l,c){if(0===l.length)throw new Error("Subdivision vertex ring is empty.");let d=0,p=e[2*l[0]];for(let c=1;c<l.length;c++){const f=e[2*l[c]];f<p&&(p=f,d=c)}const f=l.length;let m=d,_=(m+1)%f;for(;;){const d=m-1>=0?m-1:f-1,p=(_+1)%f,g=e[2*l[d]],y=e[2*l[p]],b=e[2*l[m]],T=e[2*l[m]+1],S=e[2*l[_]+1];let P=!1;if(g<y)P=!0;else if(g>y)P=!1;else{const c=S-T,f=-(e[2*l[_]]-b),m=T<S?1:-1;((g-b)*c+(e[2*l[d]+1]-T)*f)*m>((y-b)*c+(e[2*l[p]+1]-T)*f)*m&&(P=!0)}if(P){const e=l[d],p=l[m],g=l[_];e!==p&&e!==g&&p!==g&&c.push(g,p,e),m--,m<0&&(m=f-1)}else{const e=l[p],d=l[m],g=l[_];e!==d&&e!==g&&d!==g&&c.push(g,d,e),_++,_>=f&&(_=0)}if(d===p)break}}function td(e,l,c,d,p,f,m,_,g){const y=p.length/2,b=m&&_&&g;if(y<io.MAX_VERTEX_ARRAY_LENGTH){const T=l.prepareSegment(y,c,d),S=T.vertexLength;for(let e=0;e<f.length;e+=3)d.emplaceBack(S+f[e],S+f[e+1],S+f[e+2]);let P,I;T.vertexLength+=y,T.primitiveLength+=f.length/3,b&&(I=m.prepareSegment(y,c,_),P=I.vertexLength,I.vertexLength+=y);for(let l=0;l<p.length;l+=2)e(p[l],p[l+1]);if(b)for(let e=0;e<g.length;e++){const l=g[e];for(let e=1;e<l.length;e+=2)_.emplaceBack(P+l[e-1],P+l[e]);I.primitiveLength+=l.length/2}}else!function(e,l,c,d,p,f){const m=[];for(let e=0;e<d.length/2;e++)m.push(-1);const _={count:0};let g=0,y=e.getOrCreateLatestSegment(l,c),b=y.vertexLength;for(let T=2;T<p.length;T+=3){const S=p[T-2],P=p[T-1],I=p[T];let C=m[S]<g,R=m[P]<g,L=m[I]<g;y.vertexLength+((C?1:0)+(R?1:0)+(L?1:0))>io.MAX_VERTEX_ARRAY_LENGTH&&(y=e.createNewSegment(l,c),g=_.count,C=!0,R=!0,L=!0,b=0);const F=id(m,d,f,_,S,C,y),B=id(m,d,f,_,P,R,y),O=id(m,d,f,_,I,L,y);c.emplaceBack(b+F-g,b+B-g,b+O-g),y.primitiveLength++}}(l,c,d,p,f,e),b&&function(e,l,c,d,p,f){const m=[];for(let e=0;e<d.length/2;e++)m.push(-1);const _={count:0};let g=0,y=e.getOrCreateLatestSegment(l,c),b=y.vertexLength;for(let T=0;T<p.length;T++){const S=p[T];for(let P=1;P<p[T].length;P+=2){const p=S[P-1],T=S[P];let I=m[p]<g,C=m[T]<g;y.vertexLength+((I?1:0)+(C?1:0))>io.MAX_VERTEX_ARRAY_LENGTH&&(y=e.createNewSegment(l,c),g=_.count,I=!0,C=!0,b=0);const R=id(m,d,f,_,p,I,y),L=id(m,d,f,_,T,C,y);c.emplaceBack(b+R-g,b+L-g),y.primitiveLength++}}}(m,c,_,p,g,e),l.forceNewSegmentOnNextPrepare(),null==m||m.forceNewSegmentOnNextPrepare()}function id(e,l,c,d,p,f,m){if(f){const f=d.count;return c(l[2*p],l[2*p+1]),e[p]=d.count,d.count++,m.vertexLength++,f}return e[p]}class wu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new qa,this.indexArray=new to,this.indexArray2=new eo,this.programConfigurations=new Vo(e.layers,e.zoom),this.segments=new io,this.segments2=new io,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,l,c){this.hasDependencies=mu("fill",this.layers,l);const d=this.layers[0].layout.get("fill-sort-key"),p=!d.isConstant(),f=[];for(const{feature:m,id:_,index:g,sourceLayerIndex:y}of e){const e=this.layers[0]._featureFilter.needGeometry,b=rh(m,e);if(!this.layers[0]._featureFilter.filter(new Ps(this.zoom),b,c))continue;const T=p?d.evaluate(b,{},c,l.availableImages):void 0,S={id:_,properties:m.properties,type:m.type,sourceLayerIndex:y,index:g,geometry:e?b.geometry:ih(m),patterns:{},sortKey:T};f.push(S)}p&&f.sort(((e,l)=>e.sortKey-l.sortKey));for(const d of f){const{geometry:p,index:f,sourceLayerIndex:m}=d;if(this.hasDependencies){const e=_u("fill",this.layers,d,{zoom:this.zoom},l);this.patternFeatures.push(e)}else this.addFeature(d,p,f,c,{},l.subdivisionGranularity);l.featureIndex.insert(e[f].feature,p,f,m,this.index)}}update(e,l,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,l,this.stateDependentLayers,{imagePositions:c})}addFeatures(e,l,c){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,l,c,e.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fu),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,l,c,d,p,f){for(const e of Kn(l,500)){const l=Qu(e,d,f.fill.getGranularityForZoomLevel(d.z)),c=this.layoutVertexArray;td(((e,l)=>{c.emplaceBack(e,l)}),this.segments,this.layoutVertexArray,this.indexArray,l.verticesFlattened,l.indicesTriangles,this.segments2,this.indexArray2,l.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{imagePositions:p,canonical:d})}}let rd,nd;ec("FillBucket",wu,{omit:["layers","patternFeatures"]});var sd={get paint(){return nd=nd||new Hs({"fill-antialias":new js(Tt.paint_fill["fill-antialias"]),"fill-opacity":new Gs(Tt.paint_fill["fill-opacity"]),"fill-color":new Gs(Tt.paint_fill["fill-color"]),"fill-outline-color":new Gs(Tt.paint_fill["fill-outline-color"]),"fill-translate":new js(Tt.paint_fill["fill-translate"]),"fill-translate-anchor":new js(Tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xs(Tt.paint_fill["fill-pattern"])})},get layout(){return rd=rd||new Hs({"fill-sort-key":new Gs(Tt.layout_fill["fill-sort-key"])})}};class ku extends Ks{constructor(e,l){super(e,sd,l)}recalculate(e,l){super.recalculate(e,l);const c=this.paint._values["fill-outline-color"];"constant"===c.value.kind&&void 0===c.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new wu(e)}queryRadius(){return Mh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:l,transform:c,pixelsToTileUnits:d}){return lh(Ih(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-c.bearingInRadians,d),l)}isTileClipped(){return!0}}const od=Ac([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ad=Ac([{name:"a_centroid",components:2,type:"Int16"}],4),{members:cd}=od;class Mu{constructor(e,l,c,d,p){this.properties={},this.extent=c,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=d,this._values=p,e.readFields(hd,this,l)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const l=e.readVarint()+e.pos,c=[];let p,f=1,m=0,_=0,g=0;for(;e.pos<l;){if(m<=0){const l=e.readVarint();f=7&l,m=l>>3}if(m--,1===f||2===f)_+=e.readSVarint(),g+=e.readSVarint(),1===f&&(p&&c.push(p),p=[]),p&&p.push(new d(_,g));else{if(7!==f)throw new Error(`unknown command ${f}`);p&&p.push(p[0].clone())}}return p&&c.push(p),c}bbox(){const e=this._pbf;e.pos=this._geometry;const l=e.readVarint()+e.pos;let c=1,d=0,p=0,f=0,m=1/0,_=-1/0,g=1/0,y=-1/0;for(;e.pos<l;){if(d<=0){const l=e.readVarint();c=7&l,d=l>>3}if(d--,1===c||2===c)p+=e.readSVarint(),f+=e.readSVarint(),p<m&&(m=p),p>_&&(_=p),f<g&&(g=f),f>y&&(y=f);else if(7!==c)throw new Error(`unknown command ${c}`)}return[m,g,_,y]}toGeoJSON(e,l,c){const d=this.extent*Math.pow(2,c),p=this.extent*e,f=this.extent*l,m=this.loadGeometry();function _(e){return[360*(e.x+p)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+f)/d)*Math.PI))-90]}function g(e){return e.map(_)}let y;if(1===this.type){const e=[];for(const l of m)e.push(l[0]);const l=g(e);y=1===e.length?{type:"Point",coordinates:l[0]}:{type:"MultiPoint",coordinates:l}}else if(2===this.type){const e=m.map(g);y=1===e.length?{type:"LineString",coordinates:e[0]}:{type:"MultiLineString",coordinates:e}}else{if(3!==this.type)throw new Error("unknown feature type");{const e=dd(m),l=[];for(const c of e)l.push(c.map(g));y=1===l.length?{type:"Polygon",coordinates:l[0]}:{type:"MultiPolygon",coordinates:l}}}const b={type:"Feature",geometry:y,properties:this.properties};return null!=this.id&&(b.id=this.id),b}}function hd(e,l,c){1===e?l.id=c.readVarint():2===e?function(e,l){const c=e.readVarint()+e.pos;for(;e.pos<c;){const c=l._keys[e.readVarint()],d=l._values[e.readVarint()];l.properties[c]=d}}(c,l):3===e?l.type=c.readVarint():4===e&&(l._geometry=c.pos)}function dd(e){const l=e.length;if(l<=1)return[e];const c=[];let d,p;for(let f=0;f<l;f++){const l=pd(e[f]);0!==l&&(void 0===p&&(p=l<0),p===l<0?(d&&c.push(d),d=[e[f]]):d&&d.push(e[f]))}return d&&c.push(d),c}function pd(e){let l=0;for(let c,d,p=0,f=e.length,m=f-1;p<f;m=p++)c=e[p],d=e[m],l+=(d.x-c.x)*(c.y+d.y);return l}Mu.types=["Unknown","Point","LineString","Polygon"];class Pu{constructor(e,l){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(fd,this,l),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const l=this._pbf.readVarint()+this._pbf.pos;return new Mu(this._pbf,l,this.extent,this._keys,this._values)}}function fd(e,l,c){15===e?l.version=c.readVarint():1===e?l.name=c.readString():5===e?l.extent=c.readVarint():2===e?l._features.push(c.pos):3===e?l._keys.push(c.readString()):4===e&&l._values.push(function(e){let l=null;const c=e.readVarint()+e.pos;for(;e.pos<c;){const c=e.readVarint()>>3;l=1===c?e.readString():2===c?e.readFloat():3===c?e.readDouble():4===c?e.readVarint64():5===c?e.readVarint():6===c?e.readSVarint():7===c?e.readBoolean():null}if(null==l)throw new Error("unknown feature value");return l}(c))}class Vu{constructor(e,l){this.layers=e.readFields(md,{},l)}}function md(e,l,c){if(3===e){const e=new Pu(c,c.readVarint()+c.pos);e.length&&(l[e.name]=e)}}const _d=Math.pow(2,13);function gd(e,l,c,d,p,f,m,_){e.emplaceBack(l,c,2*Math.floor(d*_d)+m,p*_d*2,f*_d*2,Math.round(_))}class Ru{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ja,this.centroidVertexArray=new $a,this.indexArray=new to,this.programConfigurations=new Vo(e.layers,e.zoom),this.segments=new io,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,l,c){this.features=[],this.hasDependencies=mu("fill-extrusion",this.layers,l);for(const{feature:d,id:p,index:f,sourceLayerIndex:m}of e){const e=this.layers[0]._featureFilter.needGeometry,_=rh(d,e);if(!this.layers[0]._featureFilter.filter(new Ps(this.zoom),_,c))continue;const g={id:p,sourceLayerIndex:m,index:f,geometry:e?_.geometry:ih(d),properties:d.properties,type:d.type,patterns:{}};this.hasDependencies?this.features.push(_u("fill-extrusion",this.layers,g,{zoom:this.zoom},l)):this.addFeature(g,g.geometry,f,c,{},l.subdivisionGranularity),l.featureIndex.insert(d,g.geometry,f,m,this.index,!0)}}addFeatures(e,l,c){for(const d of this.features){const{geometry:p}=d;this.addFeature(d,p,d.index,l,c,e.subdivisionGranularity)}}update(e,l,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,l,this.stateDependentLayers,{imagePositions:c})}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cd),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,ad.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,l,c,d,p,f){for(const c of Kn(l,500)){const l={x:0,y:0,sampleCount:0},p=this.layoutVertexArray.length;this.processPolygon(l,d,e,c,f);const m=this.layoutVertexArray.length-p,_=Math.floor(l.x/l.sampleCount),g=Math.floor(l.y/l.sampleCount);for(let e=0;e<m;e++)this.centroidVertexArray.emplaceBack(_,g)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{imagePositions:p,canonical:d})}processPolygon(e,l,c,d,p){if(d.length<1)return;if(vd(d[0]))return;for(const l of d)0!==l.length&&yd(e,l);const f={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},m=p.fill.getGranularityForZoomLevel(l.z),_="Polygon"===Mu.types[c.type];for(const e of d){if(0===e.length)continue;if(vd(e))continue;const l=Ju(e,m,_);this._generateSideFaces(l,f)}if(!_)return;const g=Qu(d,l,m,!1),y=this.layoutVertexArray;td(((e,l)=>{gd(y,e,l,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,g.verticesFlattened,g.indicesTriangles)}_generateSideFaces(e,l){let c=0;for(let d=1;d<e.length;d++){const p=e[d],f=e[d-1];if(xd(p,f))continue;l.segment.vertexLength+4>io.MAX_VERTEX_ARRAY_LENGTH&&(l.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const m=p.sub(f)._perp()._unit(),_=f.dist(p);c+_>32768&&(c=0),gd(this.layoutVertexArray,p.x,p.y,m.x,m.y,0,0,c),gd(this.layoutVertexArray,p.x,p.y,m.x,m.y,0,1,c),c+=_,gd(this.layoutVertexArray,f.x,f.y,m.x,m.y,0,0,c),gd(this.layoutVertexArray,f.x,f.y,m.x,m.y,0,1,c);const g=l.segment.vertexLength;this.indexArray.emplaceBack(g,g+2,g+1),this.indexArray.emplaceBack(g+1,g+2,g+3),l.segment.vertexLength+=4,l.segment.primitiveLength+=2}}}function yd(e,l){for(let c=0;c<l.length;c++){const d=l[c];c===l.length-1&&l[0].x===d.x&&l[0].y===d.y||(e.x+=d.x,e.y+=d.y,e.sampleCount++)}}function xd(e,l){return e.x===l.x&&(e.x<0||e.x>re)||e.y===l.y&&(e.y<0||e.y>re)}function vd(e){return e.every((e=>e.x<0))||e.every((e=>e.x>re))||e.every((e=>e.y<0))||e.every((e=>e.y>re))}let bd;ec("FillExtrusionBucket",Ru,{omit:["layers","features"]});var wd={get paint(){return bd=bd||new Hs({"fill-extrusion-opacity":new js(Tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gs(Tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new js(Tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new js(Tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xs(Tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gs(Tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gs(Tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new js(Tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Gu extends Ks{constructor(e,l){super(e,wd,l)}createBucket(e){return new Ru(e)}queryRadius(){return Mh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:l,featureState:c,geometry:p,transform:f,pixelsToTileUnits:m,pixelPosMatrix:_}){const g=Ih(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-f.bearingInRadians,m),y=this.paint.get("fill-extrusion-height").evaluate(l,c),b=this.paint.get("fill-extrusion-base").evaluate(l,c),T=function(e,l){const c=[];for(const p of e){const e=[p.x,p.y,0,1];q(e,e,l),c.push(new d(e[0]/e[3],e[1]/e[3]))}return c}(g,_),S=function(e,l,c,p){const f=[],m=[],_=p[8]*l,g=p[9]*l,y=p[10]*l,b=p[11]*l,T=p[8]*c,S=p[9]*c,P=p[10]*c,I=p[11]*c;for(const l of e){const e=[],c=[];for(const f of l){const l=f.x,m=f.y,C=p[0]*l+p[4]*m+p[12],R=p[1]*l+p[5]*m+p[13],L=p[2]*l+p[6]*m+p[14],F=p[3]*l+p[7]*m+p[15],B=L+y,O=F+b,V=C+T,j=R+S,G=L+P,U=F+I,q=new d((C+_)/O,(R+g)/O);q.z=B/O,e.push(q);const Z=new d(V/U,j/U);Z.z=G/U,c.push(Z)}f.push(e),m.push(c)}return[f,m]}(p,b,y,_);return function(e,l,c){let d=1/0;lh(c,l)&&(d=Pd(c,l[0]));for(let p=0;p<l.length;p++){const f=l[p],m=e[p];for(let e=0;e<f.length-1;e++){const l=f[e],p=[l,f[e+1],m[e+1],m[e],l];oh(c,p)&&(d=Math.min(d,Pd(c,p)))}}return d!==1/0&&d}(S[0],S[1],T)}}function Td(e,l){return e.x*l.x+e.y*l.y}function Pd(e,l){if(1===e.length){let c=0;const d=l[c++];let p;for(;!p||d.equals(p);)if(p=l[c++],!p)return 1/0;for(;c<l.length;c++){const f=l[c],m=e[0],_=p.sub(d),g=f.sub(d),y=m.sub(d),b=Td(_,_),T=Td(_,g),S=Td(g,g),P=Td(y,_),I=Td(y,g),C=b*S-T*T,R=(S*P-T*I)/C,L=(b*I-T*P)/C,F=d.z*(1-R-L)+p.z*R+f.z*L;if(isFinite(F))return F}return 1/0}{let e=1/0;for(const c of l)e=Math.min(e,c.z);return e}}const Md=Ac([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Id}=Md,Ed=Ac([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Cd}=Ed,Ad=Math.cos(Math.PI/180*37.5),Dd=Math.pow(2,14)/.5;class tc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Ga,this.layoutVertexArray2=new Xa,this.indexArray=new to,this.programConfigurations=new Vo(e.layers,e.zoom),this.segments=new io,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,l,c){this.hasDependencies=mu("line",this.layers,l)||this.hasLineDasharray(this.layers);const d=this.layers[0].layout.get("line-sort-key"),p=!d.isConstant(),f=[];for(const{feature:l,id:m,index:_,sourceLayerIndex:g}of e){const e=this.layers[0]._featureFilter.needGeometry,y=rh(l,e);if(!this.layers[0]._featureFilter.filter(new Ps(this.zoom),y,c))continue;const b=p?d.evaluate(y,{},c):void 0,T={id:m,properties:l.properties,type:l.type,sourceLayerIndex:g,index:_,geometry:e?y.geometry:ih(l),patterns:{},dashes:{},sortKey:b};f.push(T)}p&&f.sort(((e,l)=>e.sortKey-l.sortKey));for(const d of f){const{geometry:p,index:f,sourceLayerIndex:m}=d;this.hasDependencies?(mu("line",this.layers,l)?_u("line",this.layers,d,{zoom:this.zoom},l):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,d,this.zoom,l),this.patternFeatures.push(d)):this.addFeature(d,p,f,c,{},{},l.subdivisionGranularity),l.featureIndex.insert(e[f].feature,p,f,m,this.index)}}update(e,l,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,l,this.stateDependentLayers,{imagePositions:c,dashPositions:d})}addFeatures(e,l,c,d){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,l,c,d,e.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Cd)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Id),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,l,c,d,p,f,m){const _=this.layers[0].layout,g=_.get("line-join").evaluate(e,{}),y=_.get("line-cap"),b=_.get("line-miter-limit"),T=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const c of l)this.addLine(c,e,g,y,b,T,d,m);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{imagePositions:p,dashPositions:f,canonical:d})}addLine(e,l,c,d,p,f,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Ju(e,m?_.line.getGranularityForZoomLevel(m.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let l=0;l<e.length-1;l++)this.totalDistance+=e[l].dist(e[l+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g="Polygon"===Mu.types[l.type];let y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let b=0;for(;b<y-1&&e[b].equals(e[b+1]);)b++;if(y<(g?3:2))return;"bevel"===c&&(p=1.05);const T=this.overscaling<=16?122880/(512*this.overscaling):0,S=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let P,I,C,R,L;this.e1=this.e2=-1,g&&(P=e[y-2],L=e[b].sub(P)._unit()._perp());for(let l=b;l<y;l++){if(C=l===y-1?g?e[b+1]:void 0:e[l+1],C&&e[l].equals(C))continue;L&&(R=L),P&&(I=P),P=e[l],L=C?C.sub(P)._unit()._perp():R,R=R||L;let m=R.add(L);0===m.x&&0===m.y||m._unit();const _=R.x*L.x+R.y*L.y,F=m.x*L.x+m.y*L.y,B=0!==F?1/F:1/0,O=2*Math.sqrt(2-2*F),V=F<Ad&&I&&C,j=R.x*L.y-R.y*L.x>0;if(V&&l>b){const e=P.dist(I);if(e>2*T){const l=P.sub(P.sub(I)._mult(T/e)._round());this.updateDistance(I,l),this.addCurrentVertex(l,R,0,0,S),I=l}}const G=I&&C;let U=G?c:g?"butt":d;if(G&&"round"===U&&(B<f?U="miter":B<=2&&(U="fakeround")),"miter"===U&&B>p&&(U="bevel"),"bevel"===U&&(B>2&&(U="flipbevel"),B<p&&(U="miter")),I&&this.updateDistance(I,P),"miter"===U)m._mult(B),this.addCurrentVertex(P,m,0,0,S);else if("flipbevel"===U){if(B>100)m=L.mult(-1);else{const e=B*R.add(L).mag()/R.sub(L).mag();m._perp()._mult(e*(j?-1:1))}this.addCurrentVertex(P,m,0,0,S),this.addCurrentVertex(P,m.mult(-1),0,0,S)}else if("bevel"===U||"fakeround"===U){const e=-Math.sqrt(B*B-1),l=j?e:0,c=j?0:e;if(I&&this.addCurrentVertex(P,R,l,c,S),"fakeround"===U){const e=Math.round(180*O/Math.PI/20);for(let l=1;l<e;l++){let c=l/e;if(.5!==c){const e=c-.5;c+=c*e*(c-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*e*e+(.848013+_*(.215638*_-1.06021)))}const d=L.sub(R)._mult(c)._add(R)._unit()._mult(j?-1:1);this.addHalfVertex(P,d.x,d.y,!1,j,0,S)}}C&&this.addCurrentVertex(P,L,-l,-c,S)}else if("butt"===U)this.addCurrentVertex(P,m,0,0,S);else if("square"===U){const e=I?1:-1;this.addCurrentVertex(P,m,e,e,S)}else"round"===U&&(I&&(this.addCurrentVertex(P,R,0,0,S),this.addCurrentVertex(P,R,1,1,S,!0)),C&&(this.addCurrentVertex(P,L,-1,-1,S,!0),this.addCurrentVertex(P,L,0,0,S)));if(V&&l<y-1){const e=P.dist(C);if(e>2*T){const l=P.add(C.sub(P)._mult(T/e)._round());this.updateDistance(P,l),this.addCurrentVertex(l,L,0,0,S),P=l}}}}addCurrentVertex(e,l,c,d,p,f=!1){const m=l.y*d-l.x,_=-l.y-l.x*d;this.addHalfVertex(e,l.x+l.y*c,l.y-l.x*c,f,!1,c,p),this.addHalfVertex(e,m,_,f,!0,-d,p),this.distance>Dd/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,l,c,d,p,f))}addHalfVertex({x:e,y:l},c,d,p,f,m,_){const g=.5*(this.lineClips?this.scaledDistance*(Dd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(l<<1)+(f?1:0),Math.round(63*c)+128,Math.round(63*d)+128,1+(0===m?0:m<0?-1:1)|(63&g)<<2,g>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const y=_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,y,this.e2),_.primitiveLength++),f?this.e2=y:this.e1=y}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,l){this.distance+=e.dist(l),this.updateScaledDistance()}hasLineDasharray(e){for(const l of e){const e=l.paint.get("line-dasharray");if(e&&!e.isConstant())return!0}return!1}addLineDashDependencies(e,l,c,d){for(const p of e){const e=p.paint.get("line-dasharray");if(!e||"constant"===e.value.kind)continue;const f="round"===p.layout.get("line-cap"),m={dasharray:e.value.evaluate({zoom:c-1},l,{}),round:f},_={dasharray:e.value.evaluate({zoom:c},l,{}),round:f},g={dasharray:e.value.evaluate({zoom:c+1},l,{}),round:f},y=`${m.dasharray.join(",")},${m.round}`,b=`${_.dasharray.join(",")},${_.round}`,T=`${g.dasharray.join(",")},${g.round}`;d.dashDependencies[y]=m,d.dashDependencies[b]=_,d.dashDependencies[T]=g,l.dashes[p.id]={min:y,mid:b,max:T}}}}let zd,kd;ec("LineBucket",tc,{omit:["layers","patternFeatures"]});var Rd={get paint(){return kd=kd||new Hs({"line-opacity":new Gs(Tt.paint_line["line-opacity"]),"line-color":new Gs(Tt.paint_line["line-color"]),"line-translate":new js(Tt.paint_line["line-translate"]),"line-translate-anchor":new js(Tt.paint_line["line-translate-anchor"]),"line-width":new Gs(Tt.paint_line["line-width"]),"line-gap-width":new Gs(Tt.paint_line["line-gap-width"]),"line-offset":new Gs(Tt.paint_line["line-offset"]),"line-blur":new Gs(Tt.paint_line["line-blur"]),"line-dasharray":new Xs(Tt.paint_line["line-dasharray"]),"line-pattern":new Xs(Tt.paint_line["line-pattern"]),"line-gradient":new Zs(Tt.paint_line["line-gradient"])})},get layout(){return zd=zd||new Hs({"line-cap":new js(Tt.layout_line["line-cap"]),"line-join":new Gs(Tt.layout_line["line-join"]),"line-miter-limit":new js(Tt.layout_line["line-miter-limit"]),"line-round-limit":new js(Tt.layout_line["line-round-limit"]),"line-sort-key":new Gs(Tt.layout_line["line-sort-key"])})}};class ic extends Gs{possiblyEvaluate(e,l){return l=new Ps(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(e,l)}evaluate(e,l,c,d){return l=ge({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(e,l,c,d)}}let Ld;class ac extends Ks{constructor(e,l){super(e,Rd,l),this.gradientVersion=0,Ld||(Ld=new ic(Rd.paint.properties["line-width"].specification),Ld.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this.gradientExpression();this.stepInterpolant=!!function(e){return void 0!==e._styleExpression}(e)&&e._styleExpression.expression instanceof or,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,l){super.recalculate(e,l),this.paint._values["line-floorwidth"]=Ld.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new tc(e)}queryRadius(e){const l=e,c=Fd(Ph("line-width",this,l),Ph("line-gap-width",this,l)),d=Ph("line-offset",this,l);return c/2+Math.abs(d)+Mh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:l,featureState:c,geometry:p,transform:f,pixelsToTileUnits:m}){const _=Ih(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-f.bearingInRadians,m),g=m/2*Fd(this.paint.get("line-width").evaluate(l,c),this.paint.get("line-gap-width").evaluate(l,c)),y=this.paint.get("line-offset").evaluate(l,c);return y&&(p=function(e,l){const c=[];for(let p=0;p<e.length;p++){const f=Ch(e[p]),m=[];for(let e=0;e<f.length;e++){const c=f[e],p=f[e-1],_=f[e+1],g=0===e?new d(0,0):c.sub(p)._unit()._perp(),y=e===f.length-1?new d(0,0):_.sub(c)._unit()._perp(),b=g._add(y)._unit(),T=b.x*y.x+b.y*y.y;0!==T&&b._mult(1/T),m.push(b._mult(l)._add(c))}c.push(m)}return c}(p,y*m)),function(e,l,c){for(let d=0;d<l.length;d++){const p=l[d];if(e.length>=3)for(let l=0;l<p.length;l++)if(bh(e,p[l]))return!0;if(ch(e,p,c))return!0}return!1}(_,p,g)}isTileClipped(){return!0}}function Fd(e,l){return l>0?l+2*e:e}const Bd=Ac([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Od=Ac([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ac([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Vd=Ac([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Ac([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jd=Ac([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Nd=Ac([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Gd(e,l,c){return e.sections.forEach((e=>{e.text=function(e,l,c){const d=l.layout.get("text-transform").evaluate(c,{});return"uppercase"===d?e=e.toLocaleUpperCase():"lowercase"===d&&(e=e.toLocaleLowerCase()),wc.applyArabicShaping&&(e=wc.applyArabicShaping(e)),e}(e.text,l,c)})),e}Ac([{name:"triangle",components:3,type:"Uint16"}]),Ac([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ac([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ac([{type:"Float32",name:"offsetX"}]),Ac([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ac([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Ud=24;const qd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Zd={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},$d={40:!0};function Wd(e,l,c,d,p,f){if("fontStack"in l){const d=c[l.fontStack],f=d&&d[e];return f?f.metrics.advance*l.scale+p:0}{const e=d[l.imageName];return e?e.displaySize[0]*l.scale*Ud/f+p:0}}function Hd(e,l,c,d){const p=Math.pow(e-l,2);return d?e<l?p/2:2*p:p+Math.abs(c)*c}function Xd(e,l,c){let d=0;return 10===e&&(d-=1e4),c&&(d+=150),40!==e&&65288!==e||(d+=50),41!==l&&65289!==l||(d+=50),d}function Yd(e,l,c,d,p,f){let m=null,_=Hd(l,c,p,f);for(const e of d){const d=Hd(l-e.x,c,p,f)+e.badness;d<=_&&(m=e,_=d)}return{index:e,x:l,priorBreak:m,badness:_}}function Kd(e){return e?Kd(e.priorBreak).concat(e.index):[]}class Sc{constructor(e="",l=[],c=[]){this.text=e,this.sections=l,this.sectionIndex=c,this.imageSectionID=null}static fromFeature(e,l){const c=new Sc;for(let d=0;d<e.sections.length;d++){const p=e.sections[d];p.image?c.addImageSection(p):c.addTextSection(p,l)}return c}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=function(e){let l="",c={premature:!0,value:void 0};const d=e[Symbol.iterator]();let p=d.next();const f=e[Symbol.iterator]();f.next();let m=f.next();for(;!p.done;)l+=!m.done&&gc(m.value.codePointAt(0))&&!qd[m.value]||!c.premature&&gc(c.value.codePointAt(0))&&!qd[c.value]||!qd[p.value]?p.value:qd[p.value],c={value:p.value,premature:!1},p=d.next(),m=f.next();return l}(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),l=e?e[0].length:0,c=this.text.match(/\S\s*$/),d=c?c[0].length-1:0;this.text=this.text.substring(l,this.text.length-d),this.sectionIndex=this.sectionIndex.slice(l,this.sectionIndex.length-d)}substring(e,l){const c=[...this.text].slice(e,l).join(""),d=this.sectionIndex.slice(e,l);return new Sc(c,this.sections,d)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,l)=>Math.max(e,this.sections[l].scale)),0)}getMaxImageSize(e){let l=0,c=0;for(let d=0;d<this.length();d++){const p=this.getSection(d);if("imageName"in p){const d=e[p.imageName];if(!d)continue;const f=d.displaySize;l=Math.max(l,f[0]),c=Math.max(c,f[1])}}return{maxImageWidth:l,maxImageHeight:c}}addTextSection(e,l){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||l});const c=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>c)))}addImageSection(e){const l=e.image?e.image.name:"";if(0===l.length)return void Se("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:l}),this.sectionIndex.push(this.sections.length-1)):Se("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,l,c,d,p){const f=[],m=this.determineAverageLineWidth(e,l,c,d,p),_=this.hasZeroWidthSpaces();let g=0,y=0;const b=this.text[Symbol.iterator]();let T=b.next();const S=this.text[Symbol.iterator]();S.next();let P=S.next();const I=this.text[Symbol.iterator]();I.next(),I.next();let C=I.next();for(;!T.done;){const l=this.getSection(y),R=T.value.codePointAt(0);if(uc(R)||(g+=Wd(R,l,c,d,e,p)),!P.done){const e=cc(R),c=P.value.codePointAt(0);(Zd[R]||e||"imageName"in l||!C.done&&$d[c])&&f.push(Yd(y+1,g,m,f,Xd(R,c,e&&_),!1))}y++,T=b.next(),P=S.next(),C=I.next()}return Kd(Yd(this.length(),g,m,f,0,!0))}determineAverageLineWidth(e,l,c,d,p){let f=0,m=0;for(const l of this.text){const _=this.getSection(m);f+=Wd(l.codePointAt(0),_,c,d,e,p),m++}return f/Math.max(1,Math.ceil(f/l))}}const Qd=4294967296,Jd=1/Qd,ip="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");class Tc{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,l,c=this.length){for(;this.pos<c;){const c=this.readVarint(),d=c>>3,p=this.pos;this.type=7&c,e(d,l,this),this.pos===p&&this.skip(c)}return l}readMessage(e,l){return this.readFields(e,l,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Qd;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Qd;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const l=this.buf;let c,d;return d=l[this.pos++],c=127&d,d<128?c:(d=l[this.pos++],c|=(127&d)<<7,d<128?c:(d=l[this.pos++],c|=(127&d)<<14,d<128?c:(d=l[this.pos++],c|=(127&d)<<21,d<128?c:(d=l[this.pos],c|=(15&d)<<28,function(e,l,c){const d=c.buf;let p,f;if(f=d[c.pos++],p=(112&f)>>4,f<128)return rp(e,p,l);if(f=d[c.pos++],p|=(127&f)<<3,f<128)return rp(e,p,l);if(f=d[c.pos++],p|=(127&f)<<10,f<128)return rp(e,p,l);if(f=d[c.pos++],p|=(127&f)<<17,f<128)return rp(e,p,l);if(f=d[c.pos++],p|=(127&f)<<24,f<128)return rp(e,p,l);if(f=d[c.pos++],p|=(1&f)<<31,f<128)return rp(e,p,l);throw new Error("Expected varint not more than 10 bytes")}(c,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return Boolean(this.readVarint())}readString(){const e=this.readVarint()+this.pos,l=this.pos;return this.pos=e,e-l>=12&&ip?ip.decode(this.buf.subarray(l,e)):function(e,l,c){let d="",p=l;for(;p<c;){const l=e[p];let f,m,_,g=null,y=l>239?4:l>223?3:l>191?2:1;if(p+y>c)break;1===y?l<128&&(g=l):2===y?(f=e[p+1],128==(192&f)&&(g=(31&l)<<6|63&f,g<=127&&(g=null))):3===y?(f=e[p+1],m=e[p+2],128==(192&f)&&128==(192&m)&&(g=(15&l)<<12|(63&f)<<6|63&m,(g<=2047||g>=55296&&g<=57343)&&(g=null))):4===y&&(f=e[p+1],m=e[p+2],_=e[p+3],128==(192&f)&&128==(192&m)&&128==(192&_)&&(g=(15&l)<<18|(63&f)<<12|(63&m)<<6|63&_,(g<=65535||g>=1114112)&&(g=null))),null===g?(g=65533,y=1):g>65535&&(g-=65536,d+=String.fromCharCode(g>>>10&1023|55296),g=56320|1023&g),d+=String.fromCharCode(g),p+=y}return d}(this.buf,l,e)}readBytes(){const e=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,e);return this.pos=e,l}readPackedVarint(e=[],l){const c=this.readPackedEnd();for(;this.pos<c;)e.push(this.readVarint(l));return e}readPackedSVarint(e=[]){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readSFixed64());return e}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(e){const l=7&e;if(0===l)for(;this.buf[this.pos++]>127;);else if(2===l)this.pos=this.readVarint()+this.pos;else if(5===l)this.pos+=4;else{if(1!==l)throw new Error(`Unimplemented type: ${l}`);this.pos+=8}}writeTag(e,l){this.writeVarint(e<<3|l)}realloc(e){let l=this.length||16;for(;l<this.pos+e;)l*=2;if(l!==this.length){const e=new Uint8Array(l);e.set(this.buf),this.buf=e,this.dataView=new DataView(e.buffer),this.length=l}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Jd),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Jd),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?function(e,l){let c,d;if(e>=0?(c=e%4294967296|0,d=e/4294967296|0):(c=~(-e%4294967296),d=~(-e/4294967296),4294967295^c?c=c+1|0:(c=0,d=d+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(e,l,c){c.buf[c.pos++]=127&e|128,e>>>=7,c.buf[c.pos++]=127&e|128,e>>>=7,c.buf[c.pos++]=127&e|128,e>>>=7,c.buf[c.pos++]=127&e|128,c.buf[c.pos]=127&(e>>>=7)}(c,0,l),function(e,l){const c=(7&e)<<4;l.buf[l.pos++]|=c|((e>>>=3)?128:0),e&&(l.buf[l.pos++]=127&e|((e>>>=7)?128:0),e&&(l.buf[l.pos++]=127&e|((e>>>=7)?128:0),e&&(l.buf[l.pos++]=127&e|((e>>>=7)?128:0),e&&(l.buf[l.pos++]=127&e|((e>>>=7)?128:0),e&&(l.buf[l.pos++]=127&e)))))}(d,l)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const l=this.pos;this.pos=function(e,l,c){for(let d,p,f=0;f<l.length;f++){if(d=l.charCodeAt(f),d>55295&&d<57344){if(!p){d>56319||f+1===l.length?(e[c++]=239,e[c++]=191,e[c++]=189):p=d;continue}if(d<56320){e[c++]=239,e[c++]=191,e[c++]=189,p=d;continue}d=p-55296<<10|d-56320|65536,p=null}else p&&(e[c++]=239,e[c++]=191,e[c++]=189,p=null);d<128?e[c++]=d:(d<2048?e[c++]=d>>6|192:(d<65536?e[c++]=d>>12|224:(e[c++]=d>>18|240,e[c++]=d>>12&63|128),e[c++]=d>>6&63|128),e[c++]=63&d|128)}return c}(this.buf,e,this.pos);const c=this.pos-l;c>=128&&np(l,c,this),this.pos=l-1,this.writeVarint(c),this.pos+=c}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const l=e.length;this.writeVarint(l),this.realloc(l);for(let c=0;c<l;c++)this.buf[this.pos++]=e[c]}writeRawMessage(e,l){this.pos++;const c=this.pos;e(l,this);const d=this.pos-c;d>=128&&np(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d}writeMessage(e,l,c){this.writeTag(e,2),this.writeRawMessage(l,c)}writePackedVarint(e,l){l.length&&this.writeMessage(e,sp,l)}writePackedSVarint(e,l){l.length&&this.writeMessage(e,op,l)}writePackedBoolean(e,l){l.length&&this.writeMessage(e,cp,l)}writePackedFloat(e,l){l.length&&this.writeMessage(e,ap,l)}writePackedDouble(e,l){l.length&&this.writeMessage(e,lp,l)}writePackedFixed32(e,l){l.length&&this.writeMessage(e,hp,l)}writePackedSFixed32(e,l){l.length&&this.writeMessage(e,up,l)}writePackedFixed64(e,l){l.length&&this.writeMessage(e,dp,l)}writePackedSFixed64(e,l){l.length&&this.writeMessage(e,pp,l)}writeBytesField(e,l){this.writeTag(e,2),this.writeBytes(l)}writeFixed32Field(e,l){this.writeTag(e,5),this.writeFixed32(l)}writeSFixed32Field(e,l){this.writeTag(e,5),this.writeSFixed32(l)}writeFixed64Field(e,l){this.writeTag(e,1),this.writeFixed64(l)}writeSFixed64Field(e,l){this.writeTag(e,1),this.writeSFixed64(l)}writeVarintField(e,l){this.writeTag(e,0),this.writeVarint(l)}writeSVarintField(e,l){this.writeTag(e,0),this.writeSVarint(l)}writeStringField(e,l){this.writeTag(e,2),this.writeString(l)}writeFloatField(e,l){this.writeTag(e,5),this.writeFloat(l)}writeDoubleField(e,l){this.writeTag(e,1),this.writeDouble(l)}writeBooleanField(e,l){this.writeVarintField(e,+l)}}function rp(e,l,c){return c?4294967296*l+(e>>>0):4294967296*(l>>>0)+(e>>>0)}function np(e,l,c){const d=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));c.realloc(d);for(let l=c.pos-1;l>=e;l--)c.buf[l+d]=c.buf[l]}function sp(e,l){for(let c=0;c<e.length;c++)l.writeVarint(e[c])}function op(e,l){for(let c=0;c<e.length;c++)l.writeSVarint(e[c])}function ap(e,l){for(let c=0;c<e.length;c++)l.writeFloat(e[c])}function lp(e,l){for(let c=0;c<e.length;c++)l.writeDouble(e[c])}function cp(e,l){for(let c=0;c<e.length;c++)l.writeBoolean(e[c])}function hp(e,l){for(let c=0;c<e.length;c++)l.writeFixed32(e[c])}function up(e,l){for(let c=0;c<e.length;c++)l.writeSFixed32(e[c])}function dp(e,l){for(let c=0;c<e.length;c++)l.writeFixed64(e[c])}function pp(e,l){for(let c=0;c<e.length;c++)l.writeSFixed64(e[c])}function fp(e,l,c){1===e&&c.readMessage(mp,l)}function mp(e,l,c){if(3===e){const{id:e,bitmap:d,width:p,height:f,left:m,top:_,advance:g}=c.readMessage(_p,{});l.push({id:e,bitmap:new _l({width:p+6,height:f+6},d),metrics:{width:p,height:f,left:m,top:_,advance:g}})}}function _p(e,l,c){1===e?l.id=c.readVarint():2===e?l.bitmap=c.readBytes():3===e?l.width=c.readVarint():4===e?l.height=c.readVarint():5===e?l.left=c.readSVarint():6===e?l.top=c.readSVarint():7===e&&(l.advance=c.readVarint())}function gp(e){let l=0,c=0;for(const d of e)l+=d.w*d.h,c=Math.max(c,d.w);e.sort(((e,l)=>l.h-e.h));const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),c),h:1/0}];let p=0,f=0;for(const l of e)for(let e=d.length-1;e>=0;e--){const c=d[e];if(!(l.w>c.w||l.h>c.h)){if(l.x=c.x,l.y=c.y,f=Math.max(f,l.y+l.h),p=Math.max(p,l.x+l.w),l.w===c.w&&l.h===c.h){const l=d.pop();l&&e<d.length&&(d[e]=l)}else l.h===c.h?(c.x+=l.w,c.w-=l.w):l.w===c.w?(c.y+=l.h,c.h-=l.h):(d.push({x:c.x+l.w,y:c.y,w:c.w-l.w,h:l.h}),c.y+=l.h,c.h-=l.h);break}}return{w:p,h:f,fill:l/(p*f)||0}}class qc{constructor(e,{pixelRatio:l,version:c,stretchX:d,stretchY:p,content:f,textFitWidth:m,textFitHeight:_}){this.paddedRect=e,this.pixelRatio=l,this.stretchX=d,this.stretchY=p,this.content=f,this.version=c,this.textFitWidth=m,this.textFitHeight=_}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class jc{constructor(e,l){const c={},d={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,c,p),this.addImages(l,d,p);const{w:f,h:m}=gp(p),_=new Sl({width:f||1,height:m||1});for(const l in e){const d=e[l],p=c[l].paddedRect;Sl.copy(d.data,_,{x:0,y:0},{x:p.x+1,y:p.y+1},d.data)}for(const e in l){const c=l[e],p=d[e].paddedRect,f=p.x+1,m=p.y+1,g=c.data.width,y=c.data.height;Sl.copy(c.data,_,{x:0,y:0},{x:f,y:m},c.data),Sl.copy(c.data,_,{x:0,y:y-1},{x:f,y:m-1},{width:g,height:1}),Sl.copy(c.data,_,{x:0,y:0},{x:f,y:m+y},{width:g,height:1}),Sl.copy(c.data,_,{x:g-1,y:0},{x:f-1,y:m},{width:1,height:y}),Sl.copy(c.data,_,{x:0,y:0},{x:f+g,y:m},{width:1,height:y})}this.image=_,this.iconPositions=c,this.patternPositions=d}addImages(e,l,c){for(const d in e){const p=e[d],f={x:0,y:0,w:p.data.width+2,h:p.data.height+2};c.push(f),l[d]=new qc(f,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,l){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in e.updatedImages)this.patchUpdatedImage(this.iconPositions[c],e.getImage(c),l),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c),l)}patchUpdatedImage(e,l,c){if(!e||!l)return;if(e.version===l.version)return;e.version=l.version;const[d,p]=e.tl;c.update(l.data,void 0,{x:d,y:p})}}var yp;function xp(e,c,d,p,f,m,_,g,y,b,T,S,P,I,C){const R=Sc.fromFeature(e,f);let L;S===l.az.vertical&&R.verticalizePunctuation();let F=R.determineLineBreaks(b,m,c,p,I);const{processBidirectionalText:B,processStyledBidirectionalText:O}=wc;if(B&&1===R.sections.length){L=[],F=F.map((e=>R.toCodeUnitIndex(e)));const e=B(R.toString(),F);for(const l of e){const e=[...l].map((()=>0));L.push(new Sc(l,R.sections,e))}}else if(O){L=[],F=F.map((e=>R.toCodeUnitIndex(e)));let e=0;const l=[];for(const c of R.text)l.push(...Array(c.length).fill(R.sectionIndex[e])),e++;const c=O(R.text,l,F);for(const e of c){const l=[];let c="";for(const d of e[0])l.push(e[1][c.length]),c+=d;L.push(new Sc(e[0],R.sections,l))}}else L=function(e,l){const c=[];let d=0;for(const p of l)c.push(e.substring(d,p)),d=p;return d<e.length()&&c.push(e.substring(d,e.length())),c}(R,F);const V=[],j={positionedLines:V,text:R.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:S,iconsInText:!1,verticalizable:!1};return function(e,l,c,d,p,f,m,_,g,y,b,T){let S=0,P=0,I=0,C=0;const R="right"===_?1:"left"===_?0:.5,L=Ud/T;let F=0;for(const m of p){m.trim();const p=m.getMaxScale(),_={positionedGlyphs:[],lineOffset:0};e.positionedLines[F]=_;const T=_.positionedGlyphs;let B=0;if(!m.length()){P+=f,++F;continue}const O=bp(d,m,L);let V=0;for(const f of m.text){const _=m.getSection(V),I=f.codePointAt(0),C=Tp(g,b,I),R={glyph:I,imageName:null,x:S,y:P+-17,vertical:C,scale:1,fontStack:"",sectionIndex:m.getSectionIndex(V),metrics:null,rect:null};let F;if("fontStack"in _){if(F=Sp(_,I,C,O,l,c),!F)continue;R.fontStack=_.fontStack}else{if(e.iconsInText=!0,_.scale*=L,F=Pp(_,C,p,O,d),!F)continue;B=Math.max(B,F.imageOffset),R.imageName=_.imageName}const{rect:j,metrics:G,baselineOffset:U}=F;R.y+=U,R.scale=_.scale,R.metrics=G,R.rect=j,T.push(R),C?(e.verticalizable=!0,S+=("imageName"in _?G.advance:Ud)*_.scale+y):S+=G.advance*_.scale+y,V++}0!==T.length&&(I=Math.max(S-y,I),Mp(T,0,T.length-1,R)),S=0,_.lineOffset=Math.max(B,(p-1)*Ud);const j=f*p+B;P+=j,C=Math.max(j,C),++F}const{horizontalAlign:B,verticalAlign:O}=vp(m);(function(e,l,c,d,p,f,m,_,g){const y=(l-c)*p;let b=0;b=f!==m?-_*d- -17:-d*g*m+.5*m;for(const l of e)for(const e of l.positionedGlyphs)e.x+=y,e.y+=b})(e.positionedLines,R,B,O,I,C,f,P,p.length),e.top+=-O*P,e.bottom=e.top+P,e.left+=-B*I,e.right=e.left+I}(j,c,d,p,L,_,g,y,S,b,P,C),!function(e){for(const l of e)if(0!==l.positionedGlyphs.length)return!1;return!0}(V)&&j}function vp(e){let l=.5,c=.5;switch(e){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:l,verticalAlign:c}}function bp(e,l,c){const d=l.getMaxScale()*Ud,{maxImageWidth:p,maxImageHeight:f}=l.getMaxImageSize(e),m=Math.max(d,f*c);return{verticalLineContentWidth:Math.max(d,p*c),horizontalLineContentHeight:m}}function wp(e){switch(e){case"top":return 0;case"center":return.5;default:return 1}}function Tp(e,c,d){return!(e===l.az.horizontal||!c&&!hc(d)||c&&(uc(d)||(p=d,/\p{sc=Arab}/u.test(String.fromCodePoint(p)))));var p}function Sp(e,l,c,d,p,f){const m=f[e.fontStack],_=function(e,l,c,d){if(e&&e.rect)return e;const p=l[c.fontStack],f=p&&p[d];return f?{rect:null,metrics:f.metrics}:null}(m&&m[l],p,e,l);if(null===_)return null;let g;if(c)g=d.verticalLineContentWidth-e.scale*Ud;else{const l=wp(e.verticalAlign);g=(d.horizontalLineContentHeight-e.scale*Ud)*l}return{rect:_.rect,metrics:_.metrics,baselineOffset:g}}function Pp(e,l,c,d,p){const f=p[e.imageName];if(!f)return null;const m=f.paddedRect,_=f.displaySize,g={width:_[0],height:_[1],left:1,top:-3,advance:l?_[1]:_[0]};let y;if(l)y=d.verticalLineContentWidth-_[1]*e.scale;else{const l=wp(e.verticalAlign);y=(d.horizontalLineContentHeight-_[1]*e.scale)*l}return{rect:m,metrics:g,baselineOffset:y,imageOffset:(l?_[0]:_[1])*e.scale-Ud*c}}function Mp(e,l,c,d){if(0===d)return;const p=e[c],f=(e[c].x+p.metrics.advance*p.scale)*d;for(let d=l;d<=c;d++)e[d].x-=f}function Ip(e,l,c){const{horizontalAlign:d,verticalAlign:p}=vp(c),f=l[0]-e.displaySize[0]*d,m=l[1]-e.displaySize[1]*p;return{image:e,top:m,bottom:m+e.displaySize[1],left:f,right:f+e.displaySize[0]}}function Cp(e){var l,c;let d=e.left,p=e.top,f=e.right-d,m=e.bottom-p;const _=null!==(l=e.image.textFitWidth)&&void 0!==l?l:"stretchOrShrink",g=null!==(c=e.image.textFitHeight)&&void 0!==c?c:"stretchOrShrink",y=(e.image.content[2]-e.image.content[0])/(e.image.content[3]-e.image.content[1]);if("proportional"===g){if("stretchOnly"===_&&f/m<y||"proportional"===_){const e=Math.ceil(m*y);d*=e/f,f=e}}else if("proportional"===_&&"stretchOnly"===g&&0!==y&&f/m>y){const e=Math.ceil(f/y);p*=e/m,m=e}return{x1:d,y1:p,x2:d+f,y2:p+m}}function Dp(e,l,c,d,p,f){const m=e.image;let _;if(m.content){const e=m.content,l=m.pixelRatio||1;_=[e[0]/l,e[1]/l,m.displaySize[0]-e[2]/l,m.displaySize[1]-e[3]/l]}const g=l.left*f,y=l.right*f;let b,T,S,P;"width"===c||"both"===c?(P=p[0]+g-d[3],T=p[0]+y+d[1]):(P=p[0]+(g+y-m.displaySize[0])/2,T=P+m.displaySize[0]);const I=l.top*f,C=l.bottom*f;return"height"===c||"both"===c?(b=p[1]+I-d[0],S=p[1]+C+d[2]):(b=p[1]+(I+C-m.displaySize[1])/2,S=b+m.displaySize[1]),{image:m,top:b,right:T,bottom:S,left:P,collisionPadding:_}}ec("ImagePosition",qc),ec("ImageAtlas",jc),l.az=void 0,(yp=l.az||(l.az={}))[yp.none=0]="none",yp[yp.horizontal=1]="horizontal",yp[yp.vertical=2]="vertical",yp[yp.horizontalOnly=3]="horizontalOnly";const zp=128,kp=32640;function Fp(e,l){const{expression:c}=l;if("constant"===c.kind)return{kind:"constant",layoutSize:c.evaluate(new Ps(e+1))};if("source"===c.kind)return{kind:"source"};{const{zoomStops:l,interpolationType:d}=c;let p=0;for(;p<l.length&&l[p]<=e;)p++;p=Math.max(0,p-1);let f=p;for(;f<l.length&&l[f]<e+1;)f++;f=Math.min(l.length-1,f);const m=l[p],_=l[f];return"composite"===c.kind?{kind:"composite",minZoom:m,maxZoom:_,interpolationType:d}:{kind:"camera",minZoom:m,maxZoom:_,minSize:c.evaluate(new Ps(m)),maxSize:c.evaluate(new Ps(_)),interpolationType:d}}}function Bp(e,l,c){let d="never";const p=e.get(l);return p?d=p:e.get(c)&&(d="always"),d}const Vp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function jp(e,l,c,d,p,f,m,_,g,y,b,T,S){const P=_?Math.min(kp,Math.round(_[0])):0,I=_?Math.min(kp,Math.round(_[1])):0;e.emplaceBack(l,c,Math.round(32*d),Math.round(32*p),f,m,(P<<1)+(g?1:0),I,16*y,16*b,256*T,256*S)}function Np(e,l,c){e.emplaceBack(l.x,l.y,c),e.emplaceBack(l.x,l.y,c),e.emplaceBack(l.x,l.y,c),e.emplaceBack(l.x,l.y,c)}function Gp(e){for(const l of e.sections)if(bc(l.text))return!0;return!1}class hh{constructor(e){this.layoutVertexArray=new Ha,this.indexArray=new to,this.programConfigurations=e,this.segments=new io,this.dynamicLayoutVertexArray=new Ka,this.opacityVertexArray=new Wa,this.hasVisibleVertices=!1,this.placedSymbolArray=new za}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,l,c,d){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bd.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Od.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Vp,!0),this.opacityVertexBuffer.itemSize=1),(c||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ec("SymbolBuffers",hh);class ph{constructor(e,l,c){this.layoutVertexArray=new e,this.layoutAttributes=l,this.indexArray=new c,this.segments=new io,this.collisionVertexArray=new Qa}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Vd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ec("CollisionBuffers",ph);class fh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Fp(this.zoom,c["text-size"]),this.iconSizeData=Fp(this.zoom,c["icon-size"]);const d=this.layers[0].layout,p=d.get("symbol-sort-key"),f=d.get("symbol-z-order");this.canOverlap="never"!==Bp(d,"text-overlap","text-allow-overlap")||"never"!==Bp(d,"icon-overlap","icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&!p.isConstant(),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===d.get("symbol-placement")&&(this.writingModes=d.get("text-writing-mode").map((e=>l.az[e]))),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID}createArrays(){this.text=new hh(new Vo(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new hh(new Vo(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Va,this.lineVertexArray=new Ca,this.symbolInstances=new Ba,this.textAnchorOffsets=new Oa}calculateGlyphDependencies(e,l,c,d,p){for(const f of e)if(l[f.codePointAt(0)]=!0,(c||d)&&p){const e=qd[f];e&&(l[e.codePointAt(0)]=!0)}}populate(e,c,d){const p=this.layers[0],f=p.layout,m=f.get("text-font"),_=f.get("text-field"),g=f.get("icon-image"),y=("constant"!==_.value.kind||_.value.value instanceof De&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&("constant"!==m.value.kind||m.value.value.length>0),b="constant"!==g.value.kind||!!g.value.value||Object.keys(g.parameters).length>0,T=f.get("symbol-sort-key");if(this.features=[],!y&&!b)return;const S=c.iconDependencies,P=c.glyphDependencies,I=c.availableImages,C=new Ps(this.zoom);for(const{feature:c,id:_,index:g,sourceLayerIndex:R}of e){const e=p._featureFilter.needGeometry,L=rh(c,e);if(!p._featureFilter.filter(C,L,d))continue;let F,B;if(e||(L.geometry=ih(c)),y){const e=p.getValueAndResolveTokens("text-field",L,d,I),l=De.factory(e),c=this.hasRTLText=this.hasRTLText||Gp(l);(!c||"unavailable"===wc.getRTLTextPluginStatus()||c&&wc.isParsed())&&(F=Gd(l,p,L))}if(b){const e=p.getValueAndResolveTokens("icon-image",L,d,I);B=e instanceof Oe?e:Oe.fromString(e)}if(!F&&!B)continue;const O=this.sortFeaturesByKey?T.evaluate(L,{},d):void 0;if(this.features.push({id:_,text:F,icon:B,index:g,sourceLayerIndex:R,geometry:L.geometry,properties:c.properties,type:Mu.types[c.type],sortKey:O}),B&&(S[B.name]=!0),F){const e=m.evaluate(L,{},d).join(","),c="viewport"!==f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.az.vertical)>=0;for(const l of F.sections)if(l.image)S[l.image.name]=!0;else{const d=dc(F.toString()),p=l.fontStack||e,f=P[p]=P[p]||{};this.calculateGlyphDependencies(l.text,f,c,this.allowVerticalPlacement,d)}}}"line"===f.get("symbol-placement")&&(this.features=function(e){const l={},c={},d=[];let p=0;function f(l){d.push(e[l]),p++}function m(e,l,p){const f=c[e];return delete c[e],c[l]=f,d[f].geometry[0].pop(),d[f].geometry[0]=d[f].geometry[0].concat(p[0]),f}function _(e,c,p){const f=l[c];return delete l[c],l[e]=f,d[f].geometry[0].shift(),d[f].geometry[0]=p[0].concat(d[f].geometry[0]),f}function g(e,l,c){const d=c?l[0][l[0].length-1]:l[0][0];return`${e}:${d.x}:${d.y}`}for(let y=0;y<e.length;y++){const b=e[y],T=b.geometry,S=b.text?b.text.toString():null;if(!S){f(y);continue}const P=g(S,T),I=g(S,T,!0);if(P in c&&I in l&&c[P]!==l[I]){const e=_(P,I,T),p=m(P,I,d[e].geometry);delete l[P],delete c[I],c[g(S,d[p].geometry,!0)]=p,d[e].geometry=null}else P in c?m(P,I,T):I in l?_(P,I,T):(f(y),l[P]=p-1,c[I]=p-1)}return d.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,l)=>e.sortKey-l.sortKey))}update(e,l,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,l,this.layers,{imagePositions:c}),this.icon.programConfigurations.updatePaintArrays(e,l,this.layers,{imagePositions:c}))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,l){const c=this.lineVertexArray.length;if(void 0!==e.segment){let c=e.dist(l[e.segment+1]),d=e.dist(l[e.segment]);const p={};for(let d=e.segment+1;d<l.length;d++)p[d]={x:l[d].x,y:l[d].y,tileUnitDistanceFromAnchor:c},d<l.length-1&&(c+=l[d+1].dist(l[d]));for(let c=e.segment||0;c>=0;c--)p[c]={x:l[c].x,y:l[c].y,tileUnitDistanceFromAnchor:d},c>0&&(d+=l[c-1].dist(l[c]));for(let e=0;e<l.length;e++){const l=p[e];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,c,d,p,f,m,_,g,y,b,T,S){const P=e.indexArray,I=e.layoutVertexArray,C=e.segments.prepareSegment(4*c.length,I,P,this.canOverlap?m.sortKey:void 0),R=this.glyphOffsetArray.length,L=C.vertexLength,F=this.allowVerticalPlacement&&_===l.az.vertical?Math.PI/2:0,B=m.text&&m.text.sections;for(let l=0;l<c.length;l++){const{tl:p,tr:f,bl:_,br:y,tex:b,pixelOffsetTL:T,pixelOffsetBR:R,minFontScaleX:L,minFontScaleY:O,glyphOffset:V,isSDF:j,sectionIndex:G}=c[l],U=C.vertexLength,q=V[1];jp(I,g.x,g.y,p.x,q+p.y,b.x,b.y,d,j,T.x,T.y,L,O),jp(I,g.x,g.y,f.x,q+f.y,b.x+b.w,b.y,d,j,R.x,T.y,L,O),jp(I,g.x,g.y,_.x,q+_.y,b.x,b.y+b.h,d,j,T.x,R.y,L,O),jp(I,g.x,g.y,y.x,q+y.y,b.x+b.w,b.y+b.h,d,j,R.x,R.y,L,O),Np(e.dynamicLayoutVertexArray,g,F),P.emplaceBack(U,U+2,U+1),P.emplaceBack(U+1,U+2,U+3),C.vertexLength+=4,C.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(V[0]),l!==c.length-1&&G===c[l+1].sectionIndex||e.programConfigurations.populatePaintArrays(I.length,m,m.index,{imagePositions:{},canonical:S,formattedSection:B&&B[G]})}e.placedSymbolArray.emplaceBack(g.x,g.y,R,this.glyphOffsetArray.length-R,L,y,b,g.segment,d?d[0]:0,d?d[1]:0,p[0],p[1],_,0,!1,0,T)}_addCollisionDebugVertex(e,l,c,d,p,f){return l.emplaceBack(0,0),e.emplaceBack(c.x,c.y,d,p,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(e,l,c,p,f,m,_){const g=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),y=g.vertexLength,b=f.layoutVertexArray,T=f.collisionVertexArray,S=_.anchorX,P=_.anchorY;this._addCollisionDebugVertex(b,T,m,S,P,new d(e,l)),this._addCollisionDebugVertex(b,T,m,S,P,new d(c,l)),this._addCollisionDebugVertex(b,T,m,S,P,new d(c,p)),this._addCollisionDebugVertex(b,T,m,S,P,new d(e,p)),g.vertexLength+=4;const I=f.indexArray;I.emplaceBack(y,y+1),I.emplaceBack(y+1,y+2),I.emplaceBack(y+2,y+3),I.emplaceBack(y+3,y),g.primitiveLength+=4}addDebugCollisionBoxes(e,l,c,d){for(let p=e;p<l;p++){const e=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(e.x1,e.y1,e.x2,e.y2,d?this.textCollisionBox:this.iconCollisionBox,e.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ph(Ja,jd.members,eo),this.iconCollisionBox=new ph(Ja,jd.members,eo);for(let e=0;e<this.symbolInstances.length;e++){const l=this.symbolInstances.get(e);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(e,l,c,d,p,f,m,_,g){const y={};for(let d=l;d<c;d++){const l=e.get(d);y.textBox={x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,anchorPointX:l.anchorPointX,anchorPointY:l.anchorPointY},y.textFeatureIndex=l.featureIndex;break}for(let l=d;l<p;l++){const c=e.get(l);y.verticalTextBox={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2,anchorPointX:c.anchorPointX,anchorPointY:c.anchorPointY},y.verticalTextFeatureIndex=c.featureIndex;break}for(let l=f;l<m;l++){const c=e.get(l);y.iconBox={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2,anchorPointX:c.anchorPointX,anchorPointY:c.anchorPointY},y.iconFeatureIndex=c.featureIndex;break}for(let l=_;l<g;l++){const c=e.get(l);y.verticalIconBox={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2,anchorPointX:c.anchorPointX,anchorPointY:c.anchorPointY},y.verticalIconFeatureIndex=c.featureIndex;break}return y}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const c=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,l){const c=e.placedSymbolArray.get(l),d=c.vertexStartIndex+4*c.numGlyphs;for(let l=c.vertexStartIndex;l<d;l+=4)e.indexArray.emplaceBack(l,l+2,l+1),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(e),c=Math.cos(e),d=[],p=[],f=[];for(let e=0;e<this.symbolInstances.length;++e){f.push(e);const m=this.symbolInstances.get(e);d.push(0|Math.round(l*m.anchorX+c*m.anchorY)),p.push(m.featureIndex)}return f.sort(((e,l)=>d[e]-d[l]||p[l]-p[e])),f}addToSortKeyRanges(e,l){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===l?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const l=this.symbolInstances.get(e);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach(((e,l,c)=>{e>=0&&c.indexOf(e)===l&&this.addIndicesForPlacedSymbol(this.text,e)})),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let qp,Zp;ec("SymbolBucket",fh,{omit:["layers","collisionBoxArray","features","compareText"]}),fh.MAX_GLYPHS=65535,fh.addDynamicAttributes=Np;var $p={get paint(){return Zp=Zp||new Hs({"icon-opacity":new Gs(Tt.paint_symbol["icon-opacity"]),"icon-color":new Gs(Tt.paint_symbol["icon-color"]),"icon-halo-color":new Gs(Tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gs(Tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gs(Tt.paint_symbol["icon-halo-blur"]),"icon-translate":new js(Tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new js(Tt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Gs(Tt.paint_symbol["text-opacity"]),"text-color":new Gs(Tt.paint_symbol["text-color"],{runtimeType:pi,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Gs(Tt.paint_symbol["text-halo-color"]),"text-halo-width":new Gs(Tt.paint_symbol["text-halo-width"]),"text-halo-blur":new Gs(Tt.paint_symbol["text-halo-blur"]),"text-translate":new js(Tt.paint_symbol["text-translate"]),"text-translate-anchor":new js(Tt.paint_symbol["text-translate-anchor"])})},get layout(){return qp=qp||new Hs({"symbol-placement":new js(Tt.layout_symbol["symbol-placement"]),"symbol-spacing":new js(Tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new js(Tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gs(Tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new js(Tt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new js(Tt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new js(Tt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new js(Tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new js(Tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new js(Tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gs(Tt.layout_symbol["icon-size"]),"icon-text-fit":new js(Tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new js(Tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gs(Tt.layout_symbol["icon-image"]),"icon-rotate":new Gs(Tt.layout_symbol["icon-rotate"]),"icon-padding":new Gs(Tt.layout_symbol["icon-padding"]),"icon-keep-upright":new js(Tt.layout_symbol["icon-keep-upright"]),"icon-offset":new Gs(Tt.layout_symbol["icon-offset"]),"icon-anchor":new Gs(Tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new js(Tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new js(Tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new js(Tt.layout_symbol["text-rotation-alignment"]),"text-field":new Gs(Tt.layout_symbol["text-field"]),"text-font":new Gs(Tt.layout_symbol["text-font"]),"text-size":new Gs(Tt.layout_symbol["text-size"]),"text-max-width":new Gs(Tt.layout_symbol["text-max-width"]),"text-line-height":new js(Tt.layout_symbol["text-line-height"]),"text-letter-spacing":new Gs(Tt.layout_symbol["text-letter-spacing"]),"text-justify":new Gs(Tt.layout_symbol["text-justify"]),"text-radial-offset":new Gs(Tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new js(Tt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Gs(Tt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Gs(Tt.layout_symbol["text-anchor"]),"text-max-angle":new js(Tt.layout_symbol["text-max-angle"]),"text-writing-mode":new js(Tt.layout_symbol["text-writing-mode"]),"text-rotate":new Gs(Tt.layout_symbol["text-rotate"]),"text-padding":new js(Tt.layout_symbol["text-padding"]),"text-keep-upright":new js(Tt.layout_symbol["text-keep-upright"]),"text-transform":new Gs(Tt.layout_symbol["text-transform"]),"text-offset":new Gs(Tt.layout_symbol["text-offset"]),"text-allow-overlap":new js(Tt.layout_symbol["text-allow-overlap"]),"text-overlap":new js(Tt.layout_symbol["text-overlap"]),"text-ignore-placement":new js(Tt.layout_symbol["text-ignore-placement"]),"text-optional":new js(Tt.layout_symbol["text-optional"])})}};class gh{constructor(e){if(void 0===e.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:ni,this.defaultValue=e}evaluate(e){if(e.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(e.formattedSection))return l.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ec("FormatSectionOverride",gh,{omit:["defaultValue"]});class xh extends Ks{constructor(e,l){super(e,$p,l)}recalculate(e,l){if(super.recalculate(e,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const e=this.layout.get("text-writing-mode");if(e){const l=[];for(const c of e)l.indexOf(c)<0&&l.push(c);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,l,c,d){const p=this.layout.get(e).evaluate(l,{},c,d),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||No(f.value)||!p?p:function(e,l){return l.replace(/{([^{}]+)}/g,((l,c)=>e&&c in e?String(e[c]):""))}(l.properties,p)}createBucket(e){return new fh(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of $p.paint.overridableProperties){if(!xh.hasPaintOverride(this.layout,e))continue;const l=this.paint.get(e),c=new gh(l),d=new ei(c,l.property.specification);let p=null;p="constant"===l.value.kind||"source"===l.value.kind?new ii("source",d):new si("composite",d,l.value.zoomStops),this.paint._values[e]=new Us(l.property,p,l.parameters)}}_handleOverridablePaintPropertyUpdate(e,l,c){return!(!this.layout||l.isDataDriven()||c.isDataDriven())&&xh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,l){const c=e.get("text-field"),d=$p.paint.properties[l];let p=!1;const f=e=>{for(const l of e)if(d.overrides&&d.overrides.hasOverride(l))return void(p=!0)};if("constant"===c.value.kind&&c.value.value instanceof De)f(c.value.value.sections);else if("source"===c.value.kind||"composite"===c.value.kind){const e=l=>{p||(l instanceof je&&rn(l.value)===yi?f(l.value.sections):l instanceof Ir?f(l.sections):l.eachChild(e))},l=c.value;l._styleExpression&&e(l._styleExpression.expression)}return p}}let Hp;var Xp={get paint(){return Hp=Hp||new Hs({"background-color":new js(Tt.paint_background["background-color"]),"background-pattern":new Ys(Tt.paint_background["background-pattern"]),"background-opacity":new js(Tt.paint_background["background-opacity"])})}};class wh extends Ks{constructor(e,l){super(e,Xp,l)}}class _h extends Ks{constructor(e,l){super(e,{},l),this.onAdd=e=>{this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)},this.onRemove=e=>{this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)},this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Sh{constructor(e){this._methodToThrottle=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Yp={once:!0},tf=6371008.8;class Eh{constructor(e,l){if(isNaN(e)||isNaN(l))throw new Error(`Invalid LngLat object: (${e}, ${l})`);if(this.lng=+e,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Eh(me(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const l=Math.PI/180,c=this.lat*l,d=e.lat*l,p=Math.sin(c)*Math.sin(d)+Math.cos(c)*Math.cos(d)*Math.cos((e.lng-this.lng)*l);return tf*Math.acos(Math.min(p,1))}static convert(e){if(e instanceof Eh)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Eh(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Eh(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const rf=2*Math.PI*tf;function sf(e){return rf*Math.cos(e*Math.PI/180)}function of(e){return(180+e)/360}function af(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function hf(e,l){return e/sf(l)}function df(e){return 360*e-180}function pf(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function ff(e,l){return e*sf(pf(l))}class Vh{constructor(e,l,c=0){this.x=+e,this.y=+l,this.z=+c}static fromLngLat(e,l=0){const c=Eh.convert(e);return new Vh(of(c.lng),af(c.lat),hf(l,c.lat))}toLngLat(){return new Eh(df(this.x),pf(this.y))}toAltitude(){return ff(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/rf*(e=pf(this.y),1/Math.cos(e*Math.PI/180));var e}}function _f(e,l,c){var d=2*Math.PI*6378137/256/Math.pow(2,c);return[e*d-2*Math.PI*6378137/2,l*d-2*Math.PI*6378137/2]}class Lh{constructor(e,l,c){if(!function(e,l,c){return!(e<0||e>25||c<0||c>=Math.pow(2,e)||l<0||l>=Math.pow(2,e))}(e,l,c))throw new Error(`x=${l}, y=${c}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=l,this.y=c,this.key=vf(0,e,e,l,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,l,c){const d=(f=this.y,m=this.z,_=_f(256*(p=this.x),256*(f=Math.pow(2,m)-f-1),m),g=_f(256*(p+1),256*(f+1),m),_[0]+","+_[1]+","+g[0]+","+g[1]);var p,f,m,_,g;const y=function(e,l,c){let d,p="";for(let f=e;f>0;f--)d=1<<f-1,p+=(l&d?1:0)+(c&d?2:0);return p}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===c?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,y).replace(/{bbox-epsg-3857}/g,d)}isChildOf(e){const l=this.z-e.z;return l>0&&e.x===this.x>>l&&e.y===this.y>>l}getTilePoint(e){const l=Math.pow(2,this.z);return new d((e.x*l-this.x)*re,(e.y*l-this.y)*re)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Oh{constructor(e,l){this.wrap=e,this.canonical=l,this.key=vf(e,l.z,l.z,l.x,l.y)}}class Rh{constructor(e,l,c,d,p){if(this.terrainRttPosMatrix32f=null,e<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${c}`);this.overscaledZ=e,this.wrap=l,this.canonical=new Lh(c,+d,+p),this.key=vf(l,e,c,d,p)}clone(){return new Rh(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-e;return e>this.canonical.z?new Rh(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rh(e,this.wrap,e,this.canonical.x>>l,this.canonical.y>>l)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,l){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-e;return e>this.canonical.z?vf(this.wrap*+l,e,this.canonical.z,this.canonical.x,this.canonical.y):vf(this.wrap*+l,e,e,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(e){if(e.wrap!==this.wrap)return!1;if(this.overscaledZ-e.overscaledZ<=0)return!1;if(0===e.overscaledZ)return this.overscaledZ>0;const l=this.canonical.z-e.canonical.z;return!(l<0)&&e.canonical.x===this.canonical.x>>l&&e.canonical.y===this.canonical.y>>l}children(e){if(this.overscaledZ>=e)return[new Rh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,c=2*this.canonical.x,d=2*this.canonical.y;return[new Rh(l,this.wrap,l,c,d),new Rh(l,this.wrap,l,c+1,d),new Rh(l,this.wrap,l,c,d+1),new Rh(l,this.wrap,l,c+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Rh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Rh(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Oh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Vh(e.x-this.wrap,e.y))}}function vf(e,l,c,d,p){(e*=2)<0&&(e=-1*e-1);const f=1<<c;return(f*f*e+f*p+d).toString(36)+c.toString(36)+l.toString(36)}function bf(e,l){return l?e.properties[l]:e.id}function wf(e,l){const c={id:e.id};if(l.removeAllProperties&&(delete e.removeProperties,delete e.addOrUpdateProperties,delete l.removeProperties),l.removeProperties)for(const c of l.removeProperties){const l=e.addOrUpdateProperties.findIndex((e=>e.key===c));l>-1&&e.addOrUpdateProperties.splice(l,1)}return(e.removeAllProperties||l.removeAllProperties)&&(c.removeAllProperties=!0),(e.removeProperties||l.removeProperties)&&(c.removeProperties=[...e.removeProperties||[],...l.removeProperties||[]]),(e.addOrUpdateProperties||l.addOrUpdateProperties)&&(c.addOrUpdateProperties=[...e.addOrUpdateProperties||[],...l.addOrUpdateProperties||[]]),(e.newGeometry||l.newGeometry)&&(c.newGeometry=l.newGeometry||e.newGeometry),c}function Tf(e){var l,c;if(!e)return{};const d={};return d.removeAll=e.removeAll,d.remove=new Set(e.remove||[]),d.add=new Map(null===(l=e.add)||void 0===l?void 0:l.map((e=>[e.id,e]))),d.update=new Map(null===(c=e.update)||void 0===c?void 0:c.map((e=>[e.id,e]))),d}ec("CanonicalTileID",Lh),ec("OverscaledTileID",Rh,{omit:["terrainRttPosMatrix32f"]});class jh{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const l=new jh;return l.extend(e(new d(this.minX,this.minY))),l.extend(e(new d(this.maxX,this.minY))),l.extend(e(new d(this.minX,this.maxY))),l.extend(e(new d(this.maxX,this.maxY))),l}static fromPoints(e){const l=new jh;for(const c of e)l.extend(c);return l}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Gh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let l=0;l<e.length;l++){const c=e[l];this._stringToNumber[c]=l,this._numberToString[l]=c}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Xh{constructor(e,l,c,d,p){this.type="Feature",this._vectorTileFeature=e,this._x=c,this._y=d,this._z=l,this.properties=e.properties,this.id=p}projectPoint(e,l,c,d){return[360*(e.x+l)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+c)/d)*Math.PI))-90]}projectLine(e,l,c,d){return e.map((e=>this.projectPoint(e,l,c,d)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,l=e.extent*Math.pow(2,this._z),c=e.extent*this._x,d=e.extent*this._y,p=e.loadGeometry();switch(e.type){case 1:{const e=[];for(const l of p)e.push(l[0]);const f=this.projectLine(e,c,d,l);this._geometry=1===e.length?{type:"Point",coordinates:f[0]}:{type:"MultiPoint",coordinates:f};break}case 2:{const e=p.map((e=>this.projectLine(e,c,d,l)));this._geometry=1===e.length?{type:"LineString",coordinates:e[0]}:{type:"MultiLineString",coordinates:e};break}case 3:{const e=dd(p),f=[];for(const p of e)f.push(p.map((e=>this.projectLine(e,c,d,l))));this._geometry=1===f.length?{type:"Polygon",coordinates:f[0]}:{type:"MultiPolygon",coordinates:f};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const l in this)"_geometry"!==l&&"_vectorTileFeature"!==l&&"_x"!==l&&"_y"!==l&&"_z"!==l&&(e[l]=this[l]);return e}}class Yh{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,l,c){this._name=e,this.dataBuffer=l,"number"==typeof c?this._size=c:(this.nullabilityBuffer=c,this._size=c.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Zh extends Yh{}class Hh extends Zh{getValueFromBuffer(e){return this.dataBuffer[e]}}class Kh extends Zh{getValueFromBuffer(e){return this.dataBuffer[e]}}class Wh extends Yh{delta;constructor(e,l,c,d){super(e,l,d),this.delta=c}}class Jh extends Wh{constructor(e,l,c,d){super(e,Int32Array.of(l),c,d)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Qh extends Yh{constructor(e,l,c){super(e,Int32Array.of(l),c)}getValueFromBuffer(e){return this.dataBuffer[0]}}class tp{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,l,c,d,p=4096){this._name=e,this._geometryVector=l,this._idVector=c,this._propertyVectors=d,this._extent=p}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((e=>[e.name,e])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let l=0;for(;l<this.numFeatures;){let c;this.idVector&&(c=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(l)):this.idVector.getValue(l));const d=e?.next().value,p={};for(const e of this.propertyVectors){if(!e)continue;const c=e.name,d=e.getValue(l);null!==d&&(p[c]=d)}l++,yield{id:c,geometry:d,properties:p}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],l=this.geometryVector.getGeometries();for(let c=0;c<this.numFeatures;c++){let d;this.idVector&&(d=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(c)):this.idVector.getValue(c));const p={coordinates:l[c],type:this.geometryVector.geometryType(c)},f={};for(const e of this.propertyVectors){if(!e)continue;const l=e.name,d=e.getValue(c);null!==d&&(f[l]=d)}e.push({id:d,geometry:p,properties:f})}return e}containsMaxSaveIntegerValues(e){return e instanceof Hh||e instanceof Qh&&e instanceof Jh||e instanceof Kh}}class ep{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Sf,Pf,Ef,Cf,Af,zf,kf,Rf,Lf,Bf;function Of(e,l,c){const d=new Int32Array(c);let p=0,f=l.get();for(let l=0;l<d.length;l++){let l=e[f++],c=127&l;l<128||(l=e[f++],c|=(127&l)<<7,l<128||(l=e[f++],c|=(127&l)<<14,l<128||(l=e[f++],c|=(127&l)<<21,l<128||(l=e[f++],c|=(15&l)<<28)))),d[p++]=c}return l.set(f),d}function Vf(e,l,c){const d=new BigInt64Array(c);for(let c=0;c<d.length;c++)d[c]=Zf(e,l);return d}function jf(e,l){let c,d;return d=e[l.get()],l.increment(),c=127&d,d<128?c:(d=e[l.get()],l.increment(),c|=(127&d)<<7,d<128?c:(d=e[l.get()],l.increment(),c|=(127&d)<<14,d<128?c:(d=e[l.get()],l.increment(),c|=(127&d)<<21,d<128?c:(d=e[l.get()],c|=(15&d)<<28,function(e,l,c){let d,p;if(p=l[c.get()],c.increment(),d=(112&p)>>4,p<128)return 4294967296*d+(e>>>0);if(p=l[c.get()],c.increment(),d|=(127&p)<<3,p<128)return 4294967296*d+(e>>>0);if(p=l[c.get()],c.increment(),d|=(127&p)<<10,p<128)return 4294967296*d+(e>>>0);if(p=l[c.get()],c.increment(),d|=(127&p)<<17,p<128)return 4294967296*d+(e>>>0);if(p=l[c.get()],c.increment(),d|=(127&p)<<24,p<128)return 4294967296*d+(e>>>0);if(p=l[c.get()],c.increment(),d|=(1&p)<<31,p<128)return 4294967296*d+(e>>>0);throw new Error("Expected varint not more than 10 bytes")}(c,e,l)))))}function Gf(e,l,c,d){throw new Error("FastPFor is not implemented yet.")}function Uf(e){return e>>>1^-(1&e)}function qf(e){return e>>1n^-(1n&e)}function Zf(e,l){let c=0n,d=0,p=l.get();for(;p<e.length;){const l=e[p++];if(c|=BigInt(127&l)<<BigInt(d),!(128&l))break;if(d+=7,d>=64)throw new Error("Varint too long")}return l.set(p),c}function $f(e,l,c){const d=new Int32Array(c);let p=0;for(let c=0;c<l;c++){const f=e[c];d.fill(e[c+l],p,p+f),p+=f}return d}function Wf(e,l,c){const d=new BigInt64Array(c);let p=0;for(let c=0;c<l;c++){const f=Number(e[c]);d.fill(e[c+l],p,p+f),p+=f}return d}function Xf(e,l,c){const d=new Float64Array(c);let p=0;for(let c=0;c<l;c++){const f=e[c];d.fill(e[c+l],p,p+f),p+=f}return d}function Yf(e){const l=e.length/4*4;let c=1;if(l>=4)for(let d=e[0];c<l-4;c+=4)d=e[c]+=d,d=e[c+1]+=d,d=e[c+2]+=d,d=e[c+3]+=d;for(;c!=e.length;)e[c]+=e[c-1],++c}function Kf(e){e[0]=e[0]>>>1^-(1&e[0]),e[1]=e[1]>>>1^-(1&e[1]);const l=e.length/4*4;let c=2;if(l>=4)for(;c<l-4;c+=4){const l=e[c],d=e[c+1],p=e[c+2],f=e[c+3];e[c]=(l>>>1^-(1&l))+e[c-2],e[c+1]=(d>>>1^-(1&d))+e[c-1],e[c+2]=(p>>>1^-(1&p))+e[c],e[c+3]=(f>>>1^-(1&f))+e[c+1]}for(;c!=e.length;c+=2)e[c]=(e[c]>>>1^-(1&e[c]))+e[c-2],e[c+1]=(e[c+1]>>>1^-(1&e[c+1]))+e[c-1]}!function(e){e.NONE="NONE",e.DELTA="DELTA",e.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",e.RLE="RLE",e.MORTON="MORTON",e.PDE="PDE"}(Sf||(Sf={})),function(e){e.NONE="NONE",e.FAST_PFOR="FAST_PFOR",e.VARINT="VARINT",e.ALP="ALP"}(Pf||(Pf={})),function(e){e.PRESENT="PRESENT",e.DATA="DATA",e.OFFSET="OFFSET",e.LENGTH="LENGTH"}(Ef||(Ef={}));class Ap{_dictionaryType;_offsetType;_lengthType;constructor(e,l,c){this._dictionaryType=e,this._offsetType=l,this._lengthType=c}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Qf(e,l){const c=function(e,l){const c=e[l.get()],d=Object.values(Ef)[c>>4];let p=null;switch(d){case Ef.DATA:p=new Ap(Object.values(Cf)[15&c]);break;case Ef.OFFSET:p=new Ap(null,Object.values(Af)[15&c]);break;case Ef.LENGTH:p=new Ap(null,null,Object.values(zf)[15&c])}l.increment();const f=e[l.get()],m=Object.values(Sf)[f>>5],_=Object.values(Sf)[f>>2&7],g=Object.values(Pf)[3&f];l.increment();const y=Of(e,l,2),b=y[0];return{physicalStreamType:d,logicalStreamType:p,logicalLevelTechnique1:m,logicalLevelTechnique2:_,physicalLevelTechnique:g,numValues:b,byteLength:y[1],decompressedCount:b}}(e,l);return c.logicalLevelTechnique1===Sf.MORTON?function(e,l,c){const d=Of(l,c,2);return{physicalStreamType:e.physicalStreamType,logicalStreamType:e.logicalStreamType,logicalLevelTechnique1:e.logicalLevelTechnique1,logicalLevelTechnique2:e.logicalLevelTechnique2,physicalLevelTechnique:e.physicalLevelTechnique,numValues:e.numValues,byteLength:e.byteLength,decompressedCount:e.decompressedCount,numBits:d[0],coordinateShift:d[1]}}(c,e,l):Sf.RLE!==c.logicalLevelTechnique1&&Sf.RLE!==c.logicalLevelTechnique2||Pf.NONE===c.physicalLevelTechnique?c:function(e,l,c){const d=Of(l,c,2);return{physicalStreamType:e.physicalStreamType,logicalStreamType:e.logicalStreamType,logicalLevelTechnique1:e.logicalLevelTechnique1,logicalLevelTechnique2:e.logicalLevelTechnique2,physicalLevelTechnique:e.physicalLevelTechnique,numValues:e.numValues,byteLength:e.byteLength,decompressedCount:d[1],runs:d[0],numRleValues:d[1]}}(c,e,l)}!function(e){e.NONE="NONE",e.SINGLE="SINGLE",e.SHARED="SHARED",e.VERTEX="VERTEX",e.MORTON="MORTON",e.FSST="FSST"}(Cf||(Cf={})),function(e){e.VERTEX="VERTEX",e.INDEX="INDEX",e.STRING="STRING",e.KEY="KEY"}(Af||(Af={})),function(e){e.VAR_BINARY="VAR_BINARY",e.GEOMETRIES="GEOMETRIES",e.PARTS="PARTS",e.RINGS="RINGS",e.TRIANGLES="TRIANGLES",e.SYMBOL="SYMBOL",e.DICTIONARY="DICTIONARY"}(zf||(zf={})),function(e){e[e.FLAT=0]="FLAT",e[e.CONST=1]="CONST",e[e.SEQUENCE=2]="SEQUENCE",e[e.DICTIONARY=3]="DICTIONARY",e[e.FSST_DICTIONARY=4]="FSST_DICTIONARY"}(kf||(kf={}));class Ep{values;_size;constructor(e,l){this.values=e,this._size=l}get(e){const l=Math.floor(e/8);return 1==(this.values[l]>>e%8&1)}set(e,l){const c=Math.floor(e/8);this.values[c]=this.values[c]|(l?1:0)<<e%8}getInt(e){const l=Math.floor(e/8);return this.values[l]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Jf(e,l,c,d,p){return function(e,l,c){switch(l.logicalLevelTechnique1){case Sf.DELTA:return l.logicalLevelTechnique2===Sf.RLE?function(e,l,c){const d=new Int32Array(c);let p=0,f=0;for(let c=0;c<l;c++){const m=e[c],_=Uf(e[c+l]);for(let e=0;e<m;e++)f+=_,d[p++]=f}return d}(e,l.runs,l.numRleValues):(function(e){e[0]=e[0]>>>1^-(1&e[0]);const l=e.length/4*4;let c=1;if(l>=4)for(;c<l-4;c+=4){const l=e[c],d=e[c+1],p=e[c+2],f=e[c+3];e[c]=(l>>>1^-(1&l))+e[c-1],e[c+1]=(d>>>1^-(1&d))+e[c],e[c+2]=(p>>>1^-(1&p))+e[c+1],e[c+3]=(f>>>1^-(1&f))+e[c+2]}for(;c!=e.length;++c)e[c]=(e[c]>>>1^-(1&e[c]))+e[c-1]}(e),e);case Sf.RLE:return function(e,l,c){return c?function(e,l,c){const d=new Int32Array(c);let p=0;for(let c=0;c<l;c++){const f=e[c];let m=e[c+l];m=m>>>1^-(1&m),d.fill(m,p,p+f),p+=f}return d}(e,l.runs,l.numRleValues):$f(e,l.runs,l.numRleValues)}(e,l,c);case Sf.MORTON:return Yf(e),e;case Sf.COMPONENTWISE_DELTA:return Kf(e),e;case Sf.NONE:return c&&function(e){for(let l=0;l<e.length;l++){const c=e[l];e[l]=c>>>1^-(1&c)}}(e),e;default:throw new Error(`The specified Logical level technique is not supported: ${l.logicalLevelTechnique1}`)}}(tm(e,l,c),c,d)}function em(e,l,c){return function(e,l){if(l.logicalLevelTechnique1===Sf.DELTA&&l.logicalLevelTechnique2===Sf.NONE){const l=function(e){const l=new Int32Array(e.length+1);l[0]=0,l[1]=Uf(e[0]);let c=l[1],d=2;for(;d!=l.length;++d){const p=e[d-1];c+=p>>>1^-(1&p),l[d]=l[d-1]+c}return l}(e);return l}if(l.logicalLevelTechnique1===Sf.RLE&&l.logicalLevelTechnique2===Sf.NONE){const c=function(e,l,c){const d=new Int32Array(c+1);d[0]=0;let p=1,f=d[0];for(let c=0;c<l;c++){const m=e[c],_=e[c+l];for(let e=p;e<p+m;e++)d[e]=_+f,f=d[e];p+=m}return d}(e,l.runs,l.numRleValues);return c}if(l.logicalLevelTechnique1===Sf.NONE&&l.logicalLevelTechnique2===Sf.NONE){!function(e){let l=0;for(let c=0;c<e.length;c++)e[c]+=l,l=e[c]}(e);const c=new Int32Array(l.numValues+1);return c[0]=0,c.set(e,1),c}if(l.logicalLevelTechnique1===Sf.DELTA&&l.logicalLevelTechnique2===Sf.RLE){const c=function(e,l,c){const d=new Int32Array(c+1);d[0]=0;let p=1,f=d[0];for(let c=0;c<l;c++){const m=e[c];let _=e[c+l];_=_>>>1^-(1&_);for(let e=p;e<p+m;e++)d[e]=_+f,f=d[e];p+=m}return d}(e,l.runs,l.numRleValues);return Yf(c),c}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}(tm(e,l,c),c)}function tm(e,l,c){const d=c.physicalLevelTechnique;if(d===Pf.FAST_PFOR)return Gf();if(d===Pf.VARINT)return Of(e,l,c.numValues);if(d===Pf.NONE){const d=l.get();l.add(c.byteLength);const p=e.subarray(d,l.get());return new Int32Array(p)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function im(e,l,c,d){const p=tm(e,l,c);if(1===p.length){const e=p[0];return d?Uf(e):e}return d?function(e){return Uf(e[1])}(p):function(e){return e[1]}(p)}function rm(e,l,c){return function(e){if(2==e.length){const l=Uf(e[1]);return[l,l]}return[Uf(e[2]),Uf(e[3])]}(tm(e,l,c))}function nm(e,l,c){return function(e){if(2==e.length){const l=qf(e[1]);return[l,l]}return[qf(e[2]),qf(e[3])]}(Vf(e,l,c.numValues))}function sm(e,l,c,d){return function(e,l,c){switch(l.logicalLevelTechnique1){case Sf.DELTA:return l.logicalLevelTechnique2===Sf.RLE?function(e,l,c){const d=new BigInt64Array(c);let p=0,f=0n;for(let c=0;c<l;c++){const m=Number(e[c]),_=qf(e[c+l]);for(let e=0;e<m;e++)f+=_,d[p++]=f}return d}(e,l.runs,l.numRleValues):(function(e){e[0]=e[0]>>1n^-(1n&e[0]);const l=e.length/4*4;let c=1;if(l>=4)for(;c<l-4;c+=4){const l=e[c],d=e[c+1],p=e[c+2],f=e[c+3];e[c]=(l>>1n^-(1n&l))+e[c-1],e[c+1]=(d>>1n^-(1n&d))+e[c],e[c+2]=(p>>1n^-(1n&p))+e[c+1],e[c+3]=(f>>1n^-(1n&f))+e[c+2]}for(;c!=e.length;++c)e[c]=(e[c]>>1n^-(1n&e[c]))+e[c-1]}(e),e);case Sf.RLE:return function(e,l,c){return c?function(e,l,c){const d=new BigInt64Array(c);let p=0;for(let c=0;c<l;c++){const f=Number(e[c]);let m=e[c+l];m=m>>1n^-(1n&m),d.fill(m,p,p+f),p+=f}return d}(e,l.runs,l.numRleValues):Wf(e,l.runs,l.numRleValues)}(e,l,c);case Sf.NONE:return c&&function(e){for(let l=0;l<e.length;l++){const c=e[l];e[l]=c>>1n^-(1n&c)}}(e),e;default:throw new Error(`The specified Logical level technique is not supported: ${l.logicalLevelTechnique1}`)}}(Vf(e,l,c.numValues),c,d)}function om(e,l,c,d){const p=Vf(e,l,c.numValues);if(1===p.length){const e=p[0];return d?qf(e):e}return d?function(e){return qf(e[1])}(p):function(e){return e[1]}(p)}function am(e,l,c,d,p){return function(e,l,c,d){switch(l.logicalLevelTechnique1){case Sf.DELTA:return l.logicalLevelTechnique2===Sf.RLE&&(e=$f(e,l.runs,l.numRleValues)),function(e,l){const c=new Int32Array(e.size());let d=0;e.get(0)?(c[0]=e.get(0)?l[0]>>>1^-(1&l[0]):0,d=1):c[0]=0;let p=1;for(;p!=c.length;++p)c[p]=e.get(p)?c[p-1]+(l[d]>>>1^-(1&l[d++])):c[p-1];return c}(d,e);case Sf.RLE:return function(e,l,c,d){const p=l;return c?function(e,l,c){const d=new Int32Array(e.size());let p=0;for(let f=0;f<c;f++){const m=l[f];let _=l[f+c];_=_>>>1^-(1&_);for(let l=p;l<p+m;l++)e.get(l)?d[l]=_:(d[l]=0,p++);p+=m}return d}(d,e,p.runs):function(e,l,c){const d=new Int32Array(e.size());let p=0;for(let f=0;f<c;f++){const m=l[f],_=l[f+c];for(let l=p;l<p+m;l++)e.get(l)?d[l]=_:(d[l]=0,p++);p+=m}return d}(d,e,p.runs)}(e,l,c,d);case Sf.MORTON:return Yf(e),e;case Sf.COMPONENTWISE_DELTA:return Kf(e),e;case Sf.NONE:return e=c?function(e,l){const c=new Int32Array(e.size());let d=0,p=0;for(;p!=c.length;++p)if(e.get(p)){const e=l[d++];c[p]=e>>>1^-(1&e)}else c[p]=0;return c}(d,e):function(e,l){const c=new Int32Array(e.size());let d=0,p=0;for(;p!=c.length;++p)c[p]=e.get(p)?l[d++]:0;return c}(d,e),e;default:throw new Error("The specified Logical level technique is not supported")}}(c.physicalLevelTechnique===Pf.FAST_PFOR?Gf():Of(e,l,c.numValues),c,d,p)}function lm(e,l,c,d){const p=e.logicalLevelTechnique1;if(p===Sf.RLE)return 1===e.runs?kf.CONST:kf.FLAT;const f=l instanceof Ep?l.size():l;if(p===Sf.DELTA&&e.logicalLevelTechnique2===Sf.RLE){const l=e.runs,p=2;if(e.numRleValues!==f)return kf.FLAT;if(1===l)return kf.SEQUENCE;if(2===l){const l=d.get();let f;if(e.physicalLevelTechnique===Pf.VARINT)f=Of(c,d,4);else{const e=d.get();f=new Int32Array(c.buffer,c.byteOffset+e,4)}if(d.set(l),f[2]===p&&f[3]===p)return kf.SEQUENCE}}return 1===e.numValues?kf.CONST:kf.FLAT}class Lp extends Zh{getValueFromBuffer(e){return this.dataBuffer[e]}}class Op extends Wh{constructor(e,l,c,d){super(e,BigInt64Array.of(l),c,d)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class Rp{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,l,c){this._geometryOffsets=e,this._partOffsets=l,this._ringOffsets=c}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function cm(e,l,c){return{x:hm(e,l)-c,y:hm(e>>1,l)-c}}function hm(e,l){let c=0;for(let d=0;d<l;d++)c|=(e&1<<2*d)>>d;return c}!function(e){e[e.POINT=0]="POINT",e[e.LINESTRING=1]="LINESTRING",e[e.POLYGON=2]="POLYGON",e[e.MULTIPOINT=3]="MULTIPOINT",e[e.MULTILINESTRING=4]="MULTILINESTRING",e[e.MULTIPOLYGON=5]="MULTIPOLYGON"}(Rf||(Rf={})),function(e){e[e.POINT=0]="POINT",e[e.LINESTRING=1]="LINESTRING",e[e.POLYGON=2]="POLYGON"}(Lf||(Lf={})),function(e){e[e.MORTON=0]="MORTON",e[e.VEC_2=1]="VEC_2",e[e.VEC_3=2]="VEC_3"}(Bf||(Bf={}));class Up{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((e=>[e]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,l){return[e].concat(l)}createMultiPolygon(e){return e.flat()}}function um(e){const l=new Array(e.numGeometries);let c=1,p=1,f=1,m=0;const _=new Up;let g=0,y=0;const b=e.mortonSettings,T=e.topologyVector,S=T.geometryOffsets,P=T.partOffsets,I=T.ringOffsets,C=e.vertexOffsets,R=e.containsPolygonGeometry(),L=e.vertexBuffer;for(let T=0;T<e.numGeometries;T++){const F=e.geometryType(T);if(F===Rf.POINT){if(C&&0!==C.length)if(e.vertexBufferType===Bf.VEC_2){const e=2*C[y++],c=new d(L[e],L[e+1]);l[m++]=_.createPoint(c)}else{const e=cm(L[C[y++]],b.numBits,b.coordinateShift),c=new d(e.x,e.y);l[m++]=_.createPoint(c)}else{const e=new d(L[g++],L[g++]);l[m++]=_.createPoint(e)}S&&f++,P&&c++,I&&p++}else if(F===Rf.MULTIPOINT){const e=S[f]-S[f-1];f++;const c=new Array(e);if(C&&0!==C.length){for(let l=0;l<e;l++){const e=2*C[y++];c[l]=new d(L[e],L[e+1])}l[m++]=_.createMultiPoint(c)}else{for(let l=0;l<e;l++){const e=L[g++],p=L[g++];c[l]=new d(e,p)}l[m++]=_.createMultiPoint(c)}}else if(F===Rf.LINESTRING){let d,T=0;R?(T=I[p]-I[p-1],p++):T=P[c]-P[c-1],c++,C&&0!==C.length?(d=e.vertexBufferType===Bf.VEC_2?_m(L,C,y,T,!1):gm(L,C,y,T,!1,b),y+=T):(d=mm(L,g,T,!1),g+=2*T),l[m++]=_.createLineString(d),S&&f++}else if(F===Rf.POLYGON){const d=P[c]-P[c-1];c++;const T=new Array(d-1);let R=I[p]-I[p-1];if(p++,C&&0!==C.length){const c=e.vertexBufferType===Bf.VEC_2?pm(L,C,y,R):fm(L,C,y,R,0,b);y+=R;for(let l=0;l<T.length;l++)R=I[p]-I[p-1],p++,T[l]=e.vertexBufferType===Bf.VEC_2?pm(L,C,y,R):fm(L,C,y,R,0,b),y+=R;l[m++]=_.createPolygon(c,T)}else{const e=dm(L,g,R);g+=2*R;for(let e=0;e<T.length;e++)R=I[p]-I[p-1],p++,T[e]=dm(L,g,R),g+=2*R;l[m++]=_.createPolygon(e,T)}S&&f++}else if(F===Rf.MULTILINESTRING){const d=S[f]-S[f-1];f++;const T=new Array(d);if(C&&0!==C.length){for(let l=0;l<d;l++){let d=0;R?(d=I[p]-I[p-1],p++):d=P[c]-P[c-1],c++;const f=e.vertexBufferType===Bf.VEC_2?_m(L,C,y,d,!1):gm(L,C,y,d,!1,b);T[l]=f,y+=d}l[m++]=_.createMultiLineString(T)}else{for(let e=0;e<d;e++){let l=0;R?(l=I[p]-I[p-1],p++):l=P[c]-P[c-1],c++,T[e]=mm(L,g,l,!1),g+=2*l}l[m++]=_.createMultiLineString(T)}}else{if(F!==Rf.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const d=S[f]-S[f-1];f++;const T=new Array(d);let R=0;if(C&&0!==C.length){for(let l=0;l<d;l++){const d=P[c]-P[c-1];c++;const f=new Array(d-1);R=I[p]-I[p-1],p++;const m=e.vertexBufferType===Bf.VEC_2?pm(L,C,y,R):fm(L,C,y,R,0,b);y+=R;for(let l=0;l<f.length;l++)R=I[p]-I[p-1],p++,f[l]=e.vertexBufferType===Bf.VEC_2?pm(L,C,y,R):fm(L,C,y,R,0,b),y+=R;T[l]=_.createPolygon(m,f)}l[m++]=_.createMultiPolygon(T)}else{for(let e=0;e<d;e++){const l=P[c]-P[c-1];c++;const d=new Array(l-1);R=I[p]-I[p-1],p++;const f=dm(L,g,R);g+=2*R;for(let e=0;e<d.length;e++){const l=I[p]-I[p-1];p++,d[e]=dm(L,g,l),g+=2*l}T[e]=_.createPolygon(f,d)}l[m++]=_.createMultiPolygon(T)}}}}return l}function dm(e,l,c){return mm(e,l,c,!0)}function pm(e,l,c,d){return _m(e,l,c,d,!0)}function fm(e,l,c,d,p,f){return gm(e,l,c,d,!0,f)}function mm(e,l,c,p){const f=new Array(p?c+1:c);for(let p=0;p<2*c;p+=2)f[p/2]=new d(e[l+p],e[l+p+1]);return p&&(f[f.length-1]=f[0]),f}function _m(e,l,c,p,f){const m=new Array(f?p+1:p);for(let f=0;f<2*p;f+=2){const p=2*l[c+f/2];m[f/2]=new d(e[p],e[p+1])}return f&&(m[m.length-1]=m[0]),m}function gm(e,l,c,p,f,m){const _=new Array(f?p+1:p);for(let f=0;f<p;f++){const p=cm(e[l[c+f]],m.numBits,m.coordinateShift);_[f]=new d(p.x,p.y)}return f&&(_[_.length-1]=_[0]),_}class Kp{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,l,c,d,p){this._vertexBufferType=e,this._topologyVector=l,this._vertexOffsets=c,this._vertexBuffer=d,this._mortonSettings=p}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=um(this);let l=0;for(;l<this.numGeometries;)yield{coordinates:e[l],type:this.geometryType(l)},l++}getSimpleEncodedVertex(e){const l=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[l],this.vertexBuffer[l+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const l=cm(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[l.x,l.y]}const l=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[l],this.vertexBuffer[l+1]]}getGeometries(){return um(this)}get mortonSettings(){return this._mortonSettings}}class Wp extends Kp{_numGeometries;_geometryType;constructor(e,l,c,d,p,f,m){super(c,d,p,f,m),this._numGeometries=e,this._geometryType=l}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Rf.POLYGON||this._geometryType===Rf.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Jp extends Kp{_geometryTypes;constructor(e,l,c,d,p,f){super(e,c,d,p,f),this._geometryTypes=l}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===Rf.POLYGON||this.geometryType(e)===Rf.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Qp{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,l,c,d){this._triangleOffsets=e,this._indexBuffer=l,this._vertexBuffer=c,this._topologyVector=d}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),l=this._topologyVector,c=l.partOffsets,p=l.ringOffsets,f=l.geometryOffsets;let m=0,_=1,g=1,y=1;for(let l=0;l<this.numGeometries;l++)switch(this.geometryType(l)){case Rf.POLYGON:{const b=c[_]-c[_-1];_++;const T=[];for(let e=0;e<b;e++){const e=p[g]-p[g-1];g++;const l=[];for(let c=0;c<e;c++){const e=this._vertexBuffer[m++],c=this._vertexBuffer[m++];l.push(new d(e,c))}l.length>0&&l.push(l[0]),T.push(l)}e[l]=T,f&&y++}break;case Rf.MULTIPOLYGON:{const b=f[y]-f[y-1];y++;const T=[];for(let e=0;e<b;e++){const e=c[_]-c[_-1];_++;for(let l=0;l<e;l++){const e=p[g]-p[g-1];g++;const l=[];for(let c=0;c<e;c++){const e=this._vertexBuffer[m++],c=this._vertexBuffer[m++];l.push(new d(e,c))}l.length>0&&l.push(l[0]),T.push(l)}}e[l]=T}}return e}[Symbol.iterator](){return null}}function ym(e,l,c,d,p,f){return new ef(e,l,c,d,p,f)}class ef extends Qp{_numGeometries;_geometryType;constructor(e,l,c,d,p,f){super(c,d,p,f),this._numGeometries=e,this._geometryType=l}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function xm(e,l,c,d,p){return new nf(e,l,c,d,p)}class nf extends Qp{_geometryTypes;constructor(e,l,c,d,p){super(l,c,d,p),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function vm(e,l,c,d,p){const f=Qf(e,c);let m=null,_=null,g=null,y=null,b=null,T=null,S=null,P=null;if(lm(f,d,e,c)===kf.CONST){const p=im(e,c,f,!1);for(let d=0;d<l-1;d++){const l=Qf(e,c);switch(l.physicalStreamType){case Ef.LENGTH:switch(l.logicalStreamType.lengthType){case zf.GEOMETRIES:m=em(e,c,l);break;case zf.PARTS:_=em(e,c,l);break;case zf.RINGS:g=em(e,c,l);break;case zf.TRIANGLES:S=em(e,c,l)}break;case Ef.OFFSET:switch(l.logicalStreamType.offsetType){case Af.VERTEX:y=Jf(e,c,l,!1);break;case Af.INDEX:P=Jf(e,c,l,!1)}break;case Ef.DATA:Cf.VERTEX===l.logicalStreamType.dictionaryType?b=Jf(e,c,l,!0):(T={numBits:l.numBits,coordinateShift:l.coordinateShift},b=Jf(e,c,l,!1))}}return null!==P?null!=m||null!=_?ym(d,p,S,P,b,new Rp(m,_,g)):ym(d,p,S,P,b):null===T?function(e,l,c,d,p){return new Wp(e,l,Bf.VEC_2,c,d,p)}(d,p,new Rp(m,_,g),y,b):function(e,l,c,d,p,f){return new Wp(e,l,Bf.MORTON,c,d,p,f)}(d,p,new Rp(m,_,g),y,b,T)}const I=Jf(e,c,f,!1);for(let d=0;d<l-1;d++){const l=Qf(e,c);switch(l.physicalStreamType){case Ef.LENGTH:switch(l.logicalStreamType.lengthType){case zf.GEOMETRIES:m=Jf(e,c,l,!1);break;case zf.PARTS:_=Jf(e,c,l,!1);break;case zf.RINGS:g=Jf(e,c,l,!1);break;case zf.TRIANGLES:S=em(e,c,l)}break;case Ef.OFFSET:switch(l.logicalStreamType.offsetType){case Af.VERTEX:y=Jf(e,c,l,!1);break;case Af.INDEX:P=Jf(e,c,l,!1)}break;case Ef.DATA:Cf.VERTEX===l.logicalStreamType.dictionaryType?b=Jf(e,c,l,!0):(T={numBits:l.numBits,coordinateShift:l.coordinateShift},b=Jf(e,c,l,!1))}}return null!==P&&null===_?xm(I,S,P,b):(null!==m?(m=bm(I,m,2),null!==_&&null!==g?(_=wm(I,m,_,!1),g=function(e,l,c,d){const p=new Int32Array(c[c.length-1]+1);let f=0;p[0]=f;let m=1,_=1,g=0;for(let y=0;y<e.length;y++){const b=e[y],T=l[y+1]-l[y];if(0!==b&&3!==b)for(let e=0;e<T;e++){const e=c[m]-c[m-1];m++;for(let l=0;l<e;l++)f=p[_++]=f+d[g++]}else for(let e=0;e<T;e++)p[_++]=++f,m++}return p}(I,m,_,g)):null!==_&&(_=function(e,l,c){const d=new Int32Array(l[l.length-1]+1);let p=0;d[0]=p;let f=1,m=0;for(let _=0;_<e.length;_++){const g=e[_],y=l[_+1]-l[_];if(4===g||1===g)for(let e=0;e<y;e++)p=d[f++]=p+c[m++];else for(let e=0;e<y;e++)d[f++]=++p}return d}(I,m,_))):null!==_&&null!==g?(_=bm(I,_,1),g=wm(I,_,g,!0)):null!==_&&(_=bm(I,_,0)),null!==P?xm(I,S,P,b,new Rp(m,_,g)):null===T?function(e,l,c,d){return new Jp(Bf.VEC_2,e,l,c,d)}(I,new Rp(m,_,g),y,b):function(e,l,c,d,p){return new Jp(Bf.MORTON,e,l,c,d,p)}(I,new Rp(m,_,g),y,b,T))}function bm(e,l,c){const d=new Int32Array(e.length+1);let p=0;d[0]=p;let f=0;for(let m=0;m<e.length;m++)p=d[m+1]=p+(e[m]>c?l[f++]:1);return d}function wm(e,l,c,d){const p=new Int32Array(l[l.length-1]+1);let f=0;p[0]=f;let m=1,_=0;for(let g=0;g<e.length;g++){const y=e[g],b=l[g+1]-l[g];if(5===y||2===y||d&&(4===y||1===y))for(let e=0;e<b;e++)f=p[m++]=f+c[_++];else for(let e=0;e<b;e++)p[m++]=++f}return p}class lf extends Yh{dataVector;constructor(e,l,c){super(e,l.getBuffer(),c),this.dataVector=l}getValueFromBuffer(e){return this.dataVector.get(e)}}class uf extends Zh{getValueFromBuffer(e){return this.dataBuffer[e]}}class cf extends Yh{constructor(e,l,c){super(e,BigInt64Array.of(l),c)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Tm(e,l,c){return Sm(e,Math.ceil(l/8),c)}function Sm(e,l,c){const d=new Uint8Array(l);let p=0;for(;p<l;){const l=e[c.increment()];if(l<=127){const f=l+3,m=e[c.increment()],_=p+f;d.fill(m,p,_),p=_}else{const f=256-l;for(let l=0;l<f;l++)d[p++]=e[c.increment()]}}return d}const Pm=new TextDecoder;function Mm(e,l,c){return c-l>=12?Pm.decode(e.subarray(l,c)):function(e,l,c){let d="",p=l;for(;p<c;){const l=e[p];let f,m,_,g=null,y=l>239?4:l>223?3:l>191?2:1;if(p+y>c)break;1===y?l<128&&(g=l):2===y?(f=e[p+1],128==(192&f)&&(g=(31&l)<<6|63&f,g<=127&&(g=null))):3===y?(f=e[p+1],m=e[p+2],128==(192&f)&&128==(192&m)&&(g=(15&l)<<12|(63&f)<<6|63&m,(g<=2047||g>=55296&&g<=57343)&&(g=null))):4===y&&(f=e[p+1],m=e[p+2],_=e[p+3],128==(192&f)&&128==(192&m)&&128==(192&_)&&(g=(15&l)<<18|(63&f)<<12|(63&m)<<6|63&_,(g<=65535||g>=1114112)&&(g=null))),null===g?(g=65533,y=1):g>65535&&(g-=65536,d+=String.fromCharCode(g>>>10&1023|55296),g=56320|1023&g),d+=String.fromCharCode(g),p+=y}return d}(e,l,c)}class yf extends Yh{offsetBuffer;constructor(e,l,c,d){super(e,c,d),this.offsetBuffer=l}}class mf extends yf{textEncoder;constructor(e,l,c,d){super(e,l,c,d??l.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Mm(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class gf extends yf{indexBuffer;textEncoder;constructor(e,l,c,d,p){super(e,c,d,p??l.length),this.indexBuffer=l,this.indexBuffer=l,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const l=this.indexBuffer[e];return Mm(this.dataBuffer,this.offsetBuffer[l],this.offsetBuffer[l+1])}}class xf extends yf{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,l,c,d,p,f,m){super(e,c,d,m),this.indexBuffer=l,this.symbolOffsetBuffer=p,this.symbolTableBuffer=f,this.textEncoder=new TextEncoder}getValueFromBuffer(e){null==this.decodedDictionary&&(null==this.symbolLengthBuffer&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=function(e,l,c){const d=[],p=new Array(l.length).fill(0);for(let e=1;e<l.length;e++)p[e]=p[e-1]+l[e-1];for(let f=0;f<c.length;f++)if(255===c[f])d.push(c[++f]);else{const m=l[c[f]],_=p[c[f]];for(let l=0;l<m;l++)d.push(e[_+l])}return new Uint8Array(d)}(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const l=this.indexBuffer[e];return Mm(this.decodedDictionary,this.offsetBuffer[l],this.offsetBuffer[l+1])}offsetToLengthBuffer(e){const l=new Uint32Array(e.length-1);let c=e[0];for(let d=1;d<e.length;d++){const p=e[d];l[d-1]=p-c,c=p}return l}}function Im(e,l,c,d,p,f){return"scalarType"===c.type?function(e,l,c,d,p,f){let m=null,_=0;if(0===e)return null;if(f.nullable){const e=Qf(l,c);_=e.numValues;const d=c.get(),p=Tm(l,_,c);c.set(d+e.byteLength),m=new Ep(p,e.numValues)}const g=m??d;switch(p.physicalType){case 4:case 3:return function(e,l,c,d,p){const f=Qf(e,l),m=lm(f,p,e,l),_=3===d.physicalType;if(m===kf.FLAT){const d=Em(p)?am(e,l,f,_,p):Jf(e,l,f,_);return new Hh(c.name,d,p)}if(m===kf.SEQUENCE){const d=rm(e,l,f);return new Jh(c.name,d[0],d[1],f.numRleValues)}{const d=im(e,l,f,_);return new Qh(c.name,d,p)}}(l,c,f,p,g);case 9:return function(e,l,c,d,p){let f=null,m=null,_=null,g=null,y=null,b=null,T=null,S=null;for(let e=0;e<d;e++){const e=Qf(l,c);if(0!==e.byteLength)switch(e.physicalStreamType){case Ef.PRESENT:{const d=Tm(l,e.numValues,c);b=new Ep(d,e.numValues);break}case Ef.OFFSET:m=null!=p||null!=b?am(l,c,e,!1,p??b):Jf(l,c,e,!1);break;case Ef.LENGTH:{const d=em(l,c,e);zf.DICTIONARY===e.logicalStreamType.lengthType?f=d:zf.SYMBOL===e.logicalStreamType.lengthType?g=d:T=d;break}case Ef.DATA:{const d=l.subarray(c.get(),c.get()+e.byteLength);c.add(e.byteLength);const p=e.logicalStreamType.dictionaryType;Cf.FSST===p?y=d:Cf.SINGLE===p||Cf.SHARED===p?_=d:Cf.NONE===p&&(S=d);break}}}return function(e,l,c,d,p,f,m){return l?new xf(e,c,d,p,f,l,m):null}(e,y,m,f,_,g,p??b)??function(e,l,c,d,p){return l?p?new gf(e,c,d,l,p):new gf(e,c,d,l):null}(e,_,m,f,p??b)??function(e,l,c,d,p){if(!l||!c)return null;if(d)return p?new gf(e,d,l,c,p):new gf(e,d,l,c);if(p&&p.size()!==l.length-1){const d=new Int32Array(p.size());let f=0;for(let e=0;e<p.size();e++)d[e]=p.get(e)?f++:0;return new gf(e,d,l,c,p)}return p?new mf(e,l,c,p):new mf(e,l,c)}(e,T,S,m,p??b)}(f.name,l,c,f.nullable?e-1:e,m);case 0:return function(e,l,c,d,p){const f=Qf(e,l),m=f.numValues,_=l.get(),g=Em(p)?function(e,l,c,d){const p=Sm(e,Math.ceil(l/8),c),f=new Ep(p,l),m=d.size(),_=new Ep(new Uint8Array(m),m);let g=0;for(let e=0;e<d.size();e++){const l=!!d.get(e)&&f.get(g++);_.set(e,l)}return _.getBuffer()}(e,m,l,p):Tm(e,m,l);l.set(_+f.byteLength);const y=new Ep(g,m);return new lf(c.name,y,p)}(l,c,f,0,g);case 6:case 5:return function(e,l,c,d,p){const f=Qf(e,l),m=lm(f,d,e,l),_=5===p.physicalType;if(m===kf.FLAT){const p=Em(d)?function(e,l,c,d,p){return function(e,l,c,d){switch(l.logicalLevelTechnique1){case Sf.DELTA:return l.logicalLevelTechnique2===Sf.RLE&&(e=Wf(e,l.runs,l.numRleValues)),function(e,l){const c=new BigInt64Array(e.size());let d=0;e.get(0)?(c[0]=e.get(0)?l[0]>>1n^-(1n&l[0]):0n,d=1):c[0]=0n;let p=1;for(;p!=c.length;++p)c[p]=e.get(p)?c[p-1]+(l[d]>>1n^-(1n&l[d++])):c[p-1];return c}(d,e);case Sf.RLE:return function(e,l,c,d){const p=l;return c?function(e,l,c){const d=new BigInt64Array(e.size());let p=0;for(let f=0;f<c;f++){const m=Number(l[f]);let _=l[f+c];_=_>>1n^-(1n&_);for(let l=p;l<p+m;l++)e.get(l)?d[l]=_:(d[l]=0n,p++);p+=m}return d}(d,e,p.runs):function(e,l,c){const d=new BigInt64Array(e.size());let p=0;for(let f=0;f<c;f++){const m=Number(l[f]),_=l[f+c];for(let l=p;l<p+m;l++)e.get(l)?d[l]=_:(d[l]=0n,p++);p+=m}return d}(d,e,p.runs)}(e,l,c,d);case Sf.NONE:return e=c?function(e,l){const c=new BigInt64Array(e.size());let d=0,p=0;for(;p!=c.length;++p)if(e.get(p)){const e=l[d++];c[p]=e>>1n^-(1n&e)}else c[p]=0n;return c}(d,e):function(e,l){const c=new BigInt64Array(e.size());let d=0,p=0;for(;p!=c.length;++p)c[p]=e.get(p)?l[d++]:0n;return c}(d,e),e;default:throw new Error("The specified Logical level technique is not supported")}}(Vf(e,l,c.numValues),c,d,p)}(e,l,f,_,d):sm(e,l,f,_);return new Lp(c.name,p,d)}if(m===kf.SEQUENCE){const d=nm(e,l,f);return new Op(c.name,d[0],d[1],f.numRleValues)}{const p=om(e,l,f,_);return new cf(c.name,p,d)}}(l,c,f,g,p);case 7:return function(e,l,c,d){const p=Qf(e,l),f=Em(d)?function(e,l,c,d){const p=l.get(),f=p+d*Float32Array.BYTES_PER_ELEMENT,m=new Uint8Array(e.subarray(p,f)).buffer,_=new Float32Array(m);l.set(f);const g=c.size(),y=new Float32Array(g);let b=0;for(let e=0;e<g;e++)y[e]=c.get(e)?_[b++]:0;return y}(e,l,d,p.numValues):function(e,l,c){const d=l.get(),p=d+c*Float32Array.BYTES_PER_ELEMENT,f=new Uint8Array(e.subarray(d,p)).buffer,m=new Float32Array(f);return l.set(p),m}(e,l,p.numValues);return new uf(c.name,f,d)}(l,c,f,g);case 8:return function(e,l,c,d){const p=Qf(e,l),f=Em(d)?function(e,l,c,d){const p=l.get(),f=p+d*Float64Array.BYTES_PER_ELEMENT,m=new Uint8Array(e.subarray(p,f)).buffer,_=new Float64Array(m);l.set(f);const g=c.size(),y=new Float64Array(g);let b=0;for(let e=0;e<g;e++)y[e]=c.get(e)?_[b++]:0;return y}(e,l,d,p.numValues):function(e,l,c){const d=l.get(),p=d+c*Float64Array.BYTES_PER_ELEMENT,f=new Uint8Array(e.subarray(d,p)).buffer,m=new Float64Array(f);return l.set(p),m}(e,l,p.numValues);return new Kh(c.name,f,d)}(l,c,f,g);default:throw new Error(`The specified data type for the field is currently not supported: ${p}`)}}(d,e,l,p,c.scalarType,c):1!=d?null:function(e,l,c,d){let p=null,f=null,m=null,_=null,g=!1;for(;!g;){const c=Qf(e,l);switch(c.physicalStreamType){case Ef.LENGTH:zf.DICTIONARY===c.logicalStreamType.lengthType?p=em(e,l,c):m=em(e,l,c);break;case Ef.DATA:Cf.SINGLE===c.logicalStreamType.dictionaryType||Cf.SHARED===c.logicalStreamType.dictionaryType?(f=e.subarray(l.get(),l.get()+c.byteLength),g=!0):_=e.subarray(l.get(),l.get()+c.byteLength),l.add(c.byteLength)}}const y=c.complexType.children,b=[];let T=0;for(const g of y){const y=Of(e,l,1)[0];if(0==y)continue;const S=`${c.name}${"default"===g.name?"":":"+g.name}`;if(2!==y||"scalarField"!==g.type||9!==g.scalarField.physicalType)throw new Error("Currently only optional string fields are implemented for a struct.");const P=Qf(e,l),I=Tm(e,P.numValues,l),C=Qf(e,l),R=C.decompressedCount!==d?am(e,l,C,!1,new Ep(I,P.numValues)):Jf(e,l,C,!1);b[T++]=_?new xf(S,R,p,f,m,_,new Ep(I,P.numValues)):new gf(S,R,p,f,new Ep(I,P.numValues))}return b}(e,l,c,p)}function Em(e){return e instanceof Ep}function Cm(e){if("id"===e.name)return!1;if("scalarType"===e.type){const l=e.scalarType;if("physicalType"===l.type)switch(l.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if("logicalType"===l.type)return!1}else if("complexType"===e.type){const l=e.complexType;if("physicalType"===l.type)switch(l.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",e),!1}const Am=new TextDecoder;function Dm(e,l){const c=Of(e,l,1)[0];if(0===c)return"";const d=l.get(),p=e.subarray(d,d+c);return l.add(c),Am.decode(p)}function zm(e,l){const c=Of(e,l,1)[0]>>>0,d=!!(4&c),p=!!(2&c),f=Of(e,l,1)[0]>>>0,m={};if(1&c&&(m.nullable=!0),p){const p={};if(d?(p.type="logicalType",p.logicalType=f):(p.type="physicalType",p.physicalType=f),8&c){const c=Of(e,l,1)[0]>>>0;p.children=new Array(c);for(let d=0;d<c;d++)p.children[d]=zm(e,l)}m.type="complexField",m.complexField=p}else{const e={};d?(e.type="logicalType",e.logicalType=f):(e.type="physicalType",e.physicalType=f),m.type="scalarField",m.scalarField=e}return m}function km(e,l){const c=Of(e,l,1)[0]>>>0,d=function(e){switch(e){case 0:case 1:case 2:case 3:{const l={};l.nullable=!!(1&e),l.columnScope=0;const c={};return c.physicalType=e>1?6:4,c.type="physicalType",l.scalarType=c,l.type="scalarType",l}case 4:{const e={nullable:!1,columnScope:0},l={type:"physicalType",physicalType:0};return e.type="complexType",e.complexType=l,e}case 30:{const e={nullable:!1,columnScope:0},l={type:"physicalType",physicalType:1};return e.type="complexType",e.complexType=l,e}default:return function(e){let l=null;switch(e){case 10:case 11:l=0;break;case 12:case 13:l=1;break;case 14:case 15:l=2;break;case 16:case 17:l=3;break;case 18:case 19:l=4;break;case 20:case 21:l=5;break;case 22:case 23:l=6;break;case 24:case 25:l=7;break;case 26:case 27:l=8;break;case 28:case 29:l=9;break;default:return null}const c={};c.nullable=!!(1&e),c.columnScope=0;const d={type:"physicalType"};return d.physicalType=l,c.type="scalarType",c.scalarType=d,c}(e)}}(c);if(!d)throw new Error(`Unsupported column type code: ${c}`);if(function(e){return e>=10}(c)?d.name=Dm(e,l):c>=0&&c<=3?d.name="id":4===c&&(d.name="geometry"),function(e){return 30===e}(c)){const c=Of(e,l,1)[0]>>>0,p=d.complexType;p.children=new Array(c);for(let d=0;d<c;d++)p.children[d]=zm(e,l)}return d}function Rm(e,l){const c={featureTables:[]},d={};d.name=Dm(e,l);const p=Of(e,l,1)[0]>>>0,f=Of(e,l,1)[0]>>>0;d.columns=new Array(f);for(let c=0;c<f;c++)d.columns[c]=km(e,l);return c.featureTables.push(d),[c,p]}function Lm(e,l,c,d,p,f,m=!1){const _=l.scalarType.physicalType,g=lm(p,f,e,c);if(4===_)switch(g){case kf.FLAT:{const l=Jf(e,c,p,!1);return new Hh(d,l,f)}case kf.SEQUENCE:{const l=rm(e,c,p);return new Jh(d,l[0],l[1],p.numRleValues)}case kf.CONST:{const l=im(e,c,p,!1);return new Qh(d,l,f)}}else switch(g){case kf.FLAT:{if(m){const l=function(e,l,c,d){const p=function(e,l,c){const d=new Float64Array(l);for(let p=0;p<l;p++)d[p]=jf(e,c);return d}(e,c.numValues,l);return function(e,l,c){switch(l.logicalLevelTechnique1){case Sf.DELTA:return l.logicalLevelTechnique2===Sf.RLE&&(e=Xf(e,l.runs,l.numRleValues)),function(e){e[0]=e[0]%2==1?(e[0]+1)/-2:e[0]/2;const l=e.length/4*4;let c=1;if(l>=4)for(;c<l-4;c+=4){const l=e[c],d=e[c+1],p=e[c+2],f=e[c+3];e[c]=(l%2==1?(l+1)/-2:l/2)+e[c-1],e[c+1]=(d%2==1?(d+1)/-2:d/2)+e[c],e[c+2]=(p%2==1?(p+1)/-2:p/2)+e[c+1],e[c+3]=(f%2==1?(f+1)/-2:f/2)+e[c+2]}for(;c!=e.length;++c)e[c]=(e[c]%2==1?(e[c]+1)/-2:e[c]/2)+e[c-1]}(e),e;case Sf.RLE:return function(e,l,c){return c?function(e,l,c){const d=new Float64Array(c);let p=0;for(let c=0;c<l;c++){const f=e[c];let m=e[c+l];m=m%2==1?(m+1)/-2:m/2,d.fill(m,p,p+f),p+=f}return d}(e,l.runs,l.numRleValues):Xf(e,l.runs,l.numRleValues)}(e,l,c);case Sf.NONE:return e;default:throw new Error(`The specified Logical level technique is not supported: ${l.logicalLevelTechnique1}`)}}(p,c,d)}(e,c,p,!1);return new Kh(d,l,f)}const l=sm(e,c,p,!1);return new Lp(d,l,f)}case kf.SEQUENCE:{const l=nm(e,c,p);return new Op(d,l[0],l[1],p.numRleValues)}case kf.CONST:{const l=om(e,c,p,!1);return new cf(d,l,f)}}throw new Error("Vector type not supported for id column.")}class If{constructor(e,l){var c;switch(this._featureData=e,this.properties=this._featureData.properties||{},null===(c=this._featureData.geometry)||void 0===c?void 0:c.type){case Rf.POINT:case Rf.MULTIPOINT:this.type=1;break;case Rf.LINESTRING:case Rf.MULTILINESTRING:this.type=2;break;case Rf.POLYGON:case Rf.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=l,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const l of this._featureData.geometry.coordinates){const c=[];for(const e of l)c.push(new d(e.x,e.y));e.push(c)}return e}}class Mf{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new If(this.features[e],this.extent)}}class Ff{constructor(e){this.layers={};const l=function(e,l,c=!0){const d=new ep(0),p=[];for(;d.get()<e.length;){const l=Of(e,d,1)[0]>>>0,f=d.get()+l;if(f>e.length)throw new Error(`Block overruns tile: ${f} > ${e.length}`);if(1!=Of(e,d,1)[0]>>>0){d.set(f);continue}const m=Rm(e,d),_=m[1],g=m[0].featureTables[0];let y=null,b=null;const T=[];let S=0;for(const l of g.columns){const p=l.name;if("id"===p){let f=null;if(l.nullable){const l=Qf(e,d),c=d.get(),p=Tm(e,l.numValues,d);d.set(c+l.byteLength),f=new Ep(p,l.numValues)}const m=Qf(e,d);S=m.decompressedCount,y=Lm(e,l,d,p,m,f??S,c)}else if("geometry"===p){const l=Of(e,d,1)[0];if(0===S){const l=d.get();S=Qf(e,d).decompressedCount,d.set(l)}b=vm(e,l,d,S)}else{const c=Cm(l)?Of(e,d,1)[0]:1;if(0===c&&"scalarType"===l.type)continue;const p=Im(e,d,l,c,S);if(p)if(Array.isArray(p))for(const e of p)T.push(e);else T.push(p)}}const P=new tp(g.name,b,y,T,_);p.push(P),d.set(f)}return p}(new Uint8Array(e));this.layers=l.reduce(((e,l)=>Object.assign(Object.assign({},e),{[l.name]:new Mf(l)})),{})}}class Df{constructor(e,l){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=l,"id"in e&&("string"==typeof e.id?this.id=parseInt(e.id,10):"number"!=typeof e.id||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],l=1===this.feature.type?[this.feature.geometry]:this.feature.geometry;for(const c of l){const l=[];for(const e of c)l.push(new d(e[0],e[1]));e.push(l)}return e}}const Fm="_geojsonTileLayer";function Bm(e,l){l.writeVarintField(15,e.version||1),l.writeStringField(1,e.name||""),l.writeVarintField(5,e.extent||4096);const c={keys:[],values:[],keycache:{},valuecache:{}};for(let d=0;d<e.length;d++)c.feature=e.feature(d),l.writeMessage(2,Om,c);const d=c.keys;for(const e of d)l.writeStringField(3,e);const p=c.values;for(const e of p)l.writeMessage(4,Um,e)}function Om(e,l){if(!e.feature)return;const c=e.feature;void 0!==c.id&&l.writeVarintField(1,c.id),l.writeMessage(2,Vm,e),l.writeVarintField(3,c.type),l.writeMessage(4,Gm,c)}function Vm(e,l){for(const c in e.feature?.properties){let d=e.feature.properties[c],p=e.keycache[c];if(null==d)continue;void 0===p&&(e.keys.push(c),p=e.keys.length-1,e.keycache[c]=p),l.writeVarint(p),"string"!=typeof d&&"boolean"!=typeof d&&"number"!=typeof d&&(d=JSON.stringify(d));const f=typeof d+":"+d;let m=e.valuecache[f];void 0===m&&(e.values.push(d),m=e.values.length-1,e.valuecache[f]=m),l.writeVarint(m)}}function jm(e,l){return(l<<3)+(7&e)}function Nm(e){return e<<1^e>>31}function Gm(e,l){const c=e.loadGeometry(),d=e.type;let p=0,f=0;for(const m of c){let c=1;1===d&&(c=m.length),l.writeVarint(jm(1,c));const _=3===d?m.length-1:m.length;for(let e=0;e<_;e++){1===e&&1!==d&&l.writeVarint(jm(2,_-1));const c=m[e].x-p,g=m[e].y-f;l.writeVarint(Nm(c)),l.writeVarint(Nm(g)),p+=c,f+=g}3===e.type&&l.writeVarint(jm(7,1))}}function Um(e,l){const c=typeof e;"string"===c?l.writeStringField(1,e):"boolean"===c?l.writeBooleanField(7,e):"number"===c&&(e%1!=0?l.writeDoubleField(3,e):e<0?l.writeSVarintField(6,e):l.writeVarintField(5,e))}class Nf{constructor(e,l){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new cs(re,16,0),this.grid3D=new cs(re,16,0),this.featureIndexArray=new Na,this.promoteId=l}insert(e,l,c,d,p,f){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,d,p);const _=f?this.grid3D:this.grid;for(let e=0;e<l.length;e++){const c=l[e],d=[1/0,1/0,-1/0,-1/0];for(let e=0;e<c.length;e++){const l=c[e];d[0]=Math.min(d[0],l.x),d[1]=Math.min(d[1],l.y),d[2]=Math.max(d[2],l.x),d[3]=Math.max(d[3],l.y)}d[0]<re&&d[1]<re&&d[2]>=0&&d[3]>=0&&_.insert(m,d[0],d[1],d[2],d[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers="mlt"!==this.encoding?new Vu(new Tc(this.rawTileData)).layers:new Ff(this.rawTileData).layers,this.sourceLayerCoder=new Gh(this.vtLayers?Object.keys(this.vtLayers).sort():[Fm])),this.vtLayers}query(e,l,c,p){this.loadVTLayers();const f=e.params,m=re/e.tileSize/e.scale,_=Ko(f.filter,f.globalState),g=e.queryGeometry,y=e.queryPadding*m,b=jh.fromPoints(g),T=this.grid.query(b.minX-y,b.minY-y,b.maxX+y,b.maxY+y),S=jh.fromPoints(e.cameraQueryGeometry).expandBy(y),P=this.grid3D.query(S.minX,S.minY,S.maxX,S.maxY,((l,c,p,f)=>function(e,l,c,p,f){for(const d of e)if(l<=d.x&&c<=d.y&&p>=d.x&&f>=d.y)return!0;const m=[new d(l,c),new d(l,f),new d(p,f),new d(p,c)];if(e.length>2)for(const l of m)if(bh(e,l))return!0;for(let l=0;l<e.length-1;l++)if(Th(e[l],e[l+1],m))return!0;return!1}(e.cameraQueryGeometry,l-y,c-y,p+y,f+y)));for(const e of P)T.push(e);T.sort(Zm);const I={};let C;for(let d=0;d<T.length;d++){const y=T[d];if(y===C)continue;C=y;const b=this.featureIndexArray.get(y);let S=null;this.loadMatchingFeature(I,b.bucketIndex,b.sourceLayerIndex,b.featureIndex,_,f.layers,f.availableImages,l,c,p,((l,c,d)=>(S||(S=ih(l)),c.queryIntersectsFeature({queryGeometry:g,feature:l,featureState:d,geometry:S,zoom:this.z,transform:e.transform,pixelsToTileUnits:m,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return I}loadMatchingFeature(e,l,c,d,p,f,m,_,g,y,b){const T=this.bucketLayerIDs[l];if(f&&!T.some((e=>f.has(e))))return;const S=this.sourceLayerCoder.decode(c),P=this.vtLayers[S].feature(d);if(p.needGeometry){const e=rh(P,!0);if(!p.filter(new Ps(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!p.filter(new Ps(this.tileID.overscaledZ),P))return;const I=this.getId(P,S);for(let l=0;l<T.length;l++){const c=T[l];if(f&&!f.has(c))continue;const p=_[c];if(!p)continue;let S={};I&&y&&(S=y.getState(p.sourceLayer||Fm,I));const C=ge({},g[c]);C.paint=qm(C.paint,p.paint,P,S,m),C.layout=qm(C.layout,p.layout,P,S,m);const R=!b||b(P,p,S);if(!R)continue;const L=new Xh(P,this.z,this.x,this.y,I);L.layer=C;let F=e[c];void 0===F&&(F=e[c]=[]),F.push({featureIndex:d,feature:L,intersectionZ:R})}}lookupSymbolFeatures(e,l,c,d,p,f,m,_){const g={};this.loadVTLayers();const y=Ko(p.filterSpec,p.globalState);for(const p of e)this.loadMatchingFeature(g,c,d,p,y,f,m,_,l);return g}hasLayer(e){for(const l of this.bucketLayerIDs)for(const c of l)if(e===c)return!0;return!1}getId(e,l){var c;let d=e.id;return this.promoteId&&(d=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[l]],"boolean"==typeof d&&(d=Number(d)),void 0===d&&(null===(c=e.properties)||void 0===c?void 0:c.cluster)&&this.promoteId&&(d=Number(e.properties.cluster_id))),d}}function qm(e,l,c,d,p){return xe(e,((e,f)=>{const m=l instanceof qs?l.get(f):null;return m&&m.evaluate?m.evaluate(c,d,p):m}))}function Zm(e,l){return l-e}function $m(e,l,c,p,f){const m=[];for(let _=0;_<e.length;_++){const g=e[_];let y;for(let e=0;e<g.length-1;e++){let _=g[e],b=g[e+1];_.x<l&&b.x<l||(_.x<l?_=new d(l,_.y+(l-_.x)/(b.x-_.x)*(b.y-_.y))._round():b.x<l&&(b=new d(l,_.y+(l-_.x)/(b.x-_.x)*(b.y-_.y))._round()),_.y<c&&b.y<c||(_.y<c?_=new d(_.x+(c-_.y)/(b.y-_.y)*(b.x-_.x),c)._round():b.y<c&&(b=new d(_.x+(c-_.y)/(b.y-_.y)*(b.x-_.x),c)._round()),_.x>=p&&b.x>=p||(_.x>=p?_=new d(p,_.y+(p-_.x)/(b.x-_.x)*(b.y-_.y))._round():b.x>=p&&(b=new d(p,_.y+(p-_.x)/(b.x-_.x)*(b.y-_.y))._round()),_.y>=f&&b.y>=f||(_.y>=f?_=new d(_.x+(f-_.y)/(b.y-_.y)*(b.x-_.x),f)._round():b.y>=f&&(b=new d(_.x+(f-_.y)/(b.y-_.y)*(b.x-_.x),f)._round()),y&&_.equals(y[y.length-1])||(y=[_],m.push(y)),y.push(b)))))}}return m}function Wm(e,l,c,d,p){switch(l){case 1:return function(e,l,c,d){const p=[];for(const f of e)for(const e of f){const f=0===d?e.x:e.y;f>=l&&f<=c&&p.push([e])}return p}(e,c,d,p);case 2:return Xm(e,c,d,p,!1);case 3:return Xm(e,c,d,p,!0)}return[]}function Hm(e,l,c,p,f){const m=0===p?Ym:Km;let _=[];const g=[];for(let d=0;d<e.length-1;d++){const y=e[d],b=e[d+1],T=0===p?y.x:y.y,S=0===p?b.x:b.y;let P=!1;T<l?S>l&&_.push(m(y,b,l)):T>c?S<c&&_.push(m(y,b,c)):_.push(y),S<l&&T>=l&&(_.push(m(y,b,l)),P=!0),S>c&&T<=c&&(_.push(m(y,b,c)),P=!0),!f&&P&&(g.push(_),_=[])}const y=e.length-1,b=0===p?e[y].x:e[y].y;return b>=l&&b<=c&&_.push(e[y]),f&&_.length>0&&!_[0].equals(_[_.length-1])&&_.push(new d(_[0].x,_[0].y)),_.length>0&&g.push(_),g}function Xm(e,l,c,d,p){const f=[];for(const m of e){const e=Hm(m,l,c,d,p);e.length>0&&f.push(...e)}return f}function Ym(e,l,c){return new d(c,e.y+(c-e.x)/(l.x-e.x)*(l.y-e.y))}function Km(e,l,c){return new d(e.x+(c-e.y)/(l.y-e.y)*(l.x-e.x),c)}ec("FeatureIndex",Nf,{omit:["rawTileData","sourceLayerCoder"]});class Hf extends d{constructor(e,l,c,d){super(e,l),this.angle=c,void 0!==d&&(this.segment=d)}clone(){return new Hf(this.x,this.y,this.angle,this.segment)}}function Qm(e,l,c,d,p){if(void 0===l.segment||0===c)return!0;let f=l,m=l.segment+1,_=0;for(;_>-c/2;){if(m--,m<0)return!1;_-=e[m].dist(f),f=e[m]}_+=e[m].dist(e[m+1]),m++;const g=[];let y=0;for(;_<c/2;){const l=e[m],c=e[m+1];if(!c)return!1;let f=e[m-1].angleTo(l)-l.angleTo(c);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:_,angleDelta:f}),y+=f;_-g[0].distance>d;)y-=g.shift().angleDelta;if(y>p)return!1;m++,_+=l.dist(c)}return!0}function Jm(e){let l=0;for(let c=0;c<e.length-1;c++)l+=e[c].dist(e[c+1]);return l}function e_(e,l,c){return e?.6*l*c:0}function t_(e,l){return Math.max(e?e.right-e.left:0,l?l.right-l.left:0)}function i_(e,l,c,d,p,f){const m=e_(c,p,f),_=t_(c,d)*f;let g=0;const y=Jm(e)/2;for(let c=0;c<e.length-1;c++){const d=e[c],p=e[c+1],f=d.dist(p);if(g+f>y){const b=(y-g)/f,T=_n.number(d.x,p.x,b),S=_n.number(d.y,p.y,b),P=new Hf(T,S,p.angleTo(d),c);return P._round(),!m||Qm(e,P,_,m,l)?P:void 0}g+=f}}function r_(e,l,c,d,p,f,m,_,g){const y=e_(d,f,m),b=t_(d,p),T=b*m,S=0===e[0].x||e[0].x===g||0===e[0].y||e[0].y===g;return l-T<l/4&&(l=T+l/4),n_(e,S?l/2*_%l:(b/2+2*f)*m*_%l,l,y,c,T,S,!1,g)}function n_(e,l,c,d,p,f,m,_,g){const y=f/2,b=Jm(e);let T=0,S=l-c,P=[];for(let l=0;l<e.length-1;l++){const m=e[l],_=e[l+1],I=m.dist(_),C=_.angleTo(m);for(;S+c<T+I;){S+=c;const R=(S-T)/I,L=_n.number(m.x,_.x,R),F=_n.number(m.y,_.y,R);if(L>=0&&L<g&&F>=0&&F<g&&S-y>=0&&S+y<=b){const c=new Hf(L,F,C,l);c._round(),d&&!Qm(e,c,f,d,p)||P.push(c)}}T+=I}return _||P.length||m||(P=n_(e,T/2,c,d,p,f,m,!0,g)),P}function s_(e,l,c,p){const f=[],m=e.image,_=m.pixelRatio,g=m.paddedRect.w-2,y=m.paddedRect.h-2;let b={x1:e.left,y1:e.top,x2:e.right,y2:e.bottom};const T=m.stretchX||[[0,g]],S=m.stretchY||[[0,y]],P=(e,l)=>e+l[1]-l[0],I=T.reduce(P,0),C=S.reduce(P,0),R=g-I,L=y-C;let F=0,B=I,O=0,V=C,j=0,G=R,U=0,q=L;if(m.content&&p){const l=m.content,c=l[2]-l[0],d=l[3]-l[1];(m.textFitWidth||m.textFitHeight)&&(b=Cp(e)),F=o_(T,0,l[0]),O=o_(S,0,l[1]),B=o_(T,l[0],l[2]),V=o_(S,l[1],l[3]),j=l[0]-F,U=l[1]-O,G=c-B,q=d-V}const Z=b.x1,W=b.y1,Q=b.x2-Z,J=b.y2-W,re=(e,p,f,g)=>{const y=l_(e.stretch-F,B,Q,Z),b=c_(e.fixed-j,G,e.stretch,I),T=l_(p.stretch-O,V,J,W),S=c_(p.fixed-U,q,p.stretch,C),P=l_(f.stretch-F,B,Q,Z),R=c_(f.fixed-j,G,f.stretch,I),L=l_(g.stretch-O,V,J,W),re=c_(g.fixed-U,q,g.stretch,C),oe=new d(y,T),le=new d(P,T),ce=new d(P,L),he=new d(y,L),ue=new d(b/_,S/_),pe=new d(R/_,re/_),fe=l*Math.PI/180;if(fe){const e=Math.sin(fe),l=Math.cos(fe),c=[l,-e,e,l];oe._matMult(c),le._matMult(c),he._matMult(c),ce._matMult(c)}const me=e.stretch+e.fixed,ge=p.stretch+p.fixed;return{tl:oe,tr:le,bl:he,br:ce,tex:{x:m.paddedRect.x+1+me,y:m.paddedRect.y+1+ge,w:f.stretch+f.fixed-me,h:g.stretch+g.fixed-ge},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ue,pixelOffsetBR:pe,minFontScaleX:G/_/Q,minFontScaleY:q/_/J,isSDF:c}};if(p&&(m.stretchX||m.stretchY)){const e=a_(T,R,I),l=a_(S,L,C);for(let c=0;c<e.length-1;c++){const d=e[c],p=e[c+1];for(let e=0;e<l.length-1;e++)f.push(re(d,l[e],p,l[e+1]))}}else f.push(re({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:y+1}));return f}function o_(e,l,c){let d=0;for(const p of e)d+=Math.max(l,Math.min(c,p[1]))-Math.max(l,Math.min(c,p[0]));return d}function a_(e,l,c){const d=[{fixed:-1,stretch:0}];for(const[l,c]of e){const e=d[d.length-1];d.push({fixed:l-e.stretch,stretch:e.stretch}),d.push({fixed:l-e.stretch,stretch:e.stretch+(c-l)})}return d.push({fixed:l+1,stretch:c}),d}function l_(e,l,c,d){return e/l*c+d}function c_(e,l,c,d){return e-l*c/d}ec("Anchor",Hf);class ld{constructor(e,l,c,p,f,m,_,g,y,b){var T;if(this.boxStartIndex=e.length,y){let e=m.top,l=m.bottom;const c=m.collisionPadding;c&&(e-=c[1],l+=c[3]);let d=l-e;d>0&&(d=Math.max(10,d),this.circleDiameter=d)}else{const y=(null===(T=m.image)||void 0===T?void 0:T.content)&&(m.image.textFitWidth||m.image.textFitHeight)?Cp(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};y.y1=y.y1*_-g[0],y.y2=y.y2*_+g[2],y.x1=y.x1*_-g[3],y.x2=y.x2*_+g[1];const S=m.collisionPadding;if(S&&(y.x1-=S[0]*_,y.y1-=S[1]*_,y.x2+=S[2]*_,y.y2+=S[3]*_),b){const e=new d(y.x1,y.y1),l=new d(y.x2,y.y1),c=new d(y.x1,y.y2),p=new d(y.x2,y.y2),f=b*Math.PI/180;e._rotate(f),l._rotate(f),c._rotate(f),p._rotate(f),y.x1=Math.min(e.x,l.x,c.x,p.x),y.x2=Math.max(e.x,l.x,c.x,p.x),y.y1=Math.min(e.y,l.y,c.y,p.y),y.y2=Math.max(e.y,l.y,c.y,p.y)}e.emplaceBack(l.x,l.y,y.x1,y.y1,y.x2,y.y2,c,p,f)}this.boxEndIndex=e.length}}class ud{constructor(e=[],l=(e,l)=>e<l?-1:e>l?1:0){if(this.data=e,this.length=this.data.length,this.compare=l,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:l,compare:c}=this,d=l[e];for(;e>0;){const p=e-1>>1,f=l[p];if(c(d,f)>=0)break;l[e]=f,e=p}l[e]=d}_down(e){const{data:l,compare:c}=this,d=this.length>>1,p=l[e];for(;e<d;){let d=1+(e<<1);const f=d+1;if(f<this.length&&c(l[f],l[d])<0&&(d=f),c(l[d],p)>=0)break;l[e]=l[d],e=d}l[e]=p}}function h_(e,l=1,c=!1){const p=jh.fromPoints(e[0]),f=Math.min(p.width(),p.height());let m=f/2;const _=new ud([],u_),{minX:g,minY:y,maxX:b,maxY:T}=p;if(0===f)return new d(g,y);for(let l=g;l<b;l+=f)for(let c=y;c<T;c+=f)_.push(new d_(l+m,c+m,m,e));let S=function(e){let l=0,c=0,d=0;const p=e[0];for(let e=0,f=p.length,m=f-1;e<f;m=e++){const f=p[e],_=p[m],g=f.x*_.y-_.x*f.y;c+=(f.x+_.x)*g,d+=(f.y+_.y)*g,l+=3*g}return new d_(c/l,d/l,0,e)}(e),P=_.length;for(;_.length;){const d=_.pop();(d.d>S.d||!S.d)&&(S=d,c&&console.log("found best %d after %d probes",Math.round(1e4*d.d)/1e4,P)),d.max-S.d<=l||(m=d.h/2,_.push(new d_(d.p.x-m,d.p.y-m,m,e)),_.push(new d_(d.p.x+m,d.p.y-m,m,e)),_.push(new d_(d.p.x-m,d.p.y+m,m,e)),_.push(new d_(d.p.x+m,d.p.y+m,m,e)),P+=4)}return c&&(console.log(`num probes: ${P}`),console.log(`best distance: ${S.d}`)),S.p}function u_(e,l){return l.max-e.max}function d_(l,c,p,f){(this||e).p=new d(l,c),(this||e).h=p,(this||e).d=function(e,l){let c=!1,d=1/0;for(let p=0;p<l.length;p++){const f=l[p];for(let l=0,p=f.length,m=p-1;l<p;m=l++){const p=f[l],_=f[m];p.y>e.y!=_.y>e.y&&e.x<(_.x-p.x)*(e.y-p.y)/(_.y-p.y)+p.x&&(c=!c),d=Math.min(d,yh(e,p,_))}}return(c?1:-1)*Math.sqrt(d)}((this||e).p,f),(this||e).max=(this||e).d+(this||e).h*Math.SQRT2}var p_;l.aP=void 0,(p_=l.aP||(l.aP={}))[p_.center=1]="center",p_[p_.left=2]="left",p_[p_.right=3]="right",p_[p_.top=4]="top",p_[p_.bottom=5]="bottom",p_[p_["top-left"]=6]="top-left",p_[p_["top-right"]=7]="top-right",p_[p_["bottom-left"]=8]="bottom-left",p_[p_["bottom-right"]=9]="bottom-right";const f_=Number.POSITIVE_INFINITY;function m_(e,l){return l[1]!==f_?function(e,l,c){let d=0,p=0;switch(l=Math.abs(l),c=Math.abs(c),e){case"top-right":case"top-left":case"top":p=c-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-c}switch(e){case"top-right":case"bottom-right":case"right":d=-l;break;case"top-left":case"bottom-left":case"left":d=l}return[d,p]}(e,l[0],l[1]):function(e,l){let c=0,d=0;l<0&&(l=0);const p=l/Math.SQRT2;switch(e){case"top-right":case"top-left":d=p-7;break;case"bottom-right":case"bottom-left":d=7-p;break;case"bottom":d=7-l;break;case"top":d=l-7}switch(e){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=l;break;case"right":c=-l}return[c,d]}(e,l[0])}function __(e,l,c){var d;const p=e.layout,f=null===(d=p.get("text-variable-anchor-offset"))||void 0===d?void 0:d.evaluate(l,{},c);if(f){const e=f.values,l=[];for(let c=0;c<e.length;c+=2){const d=l[c]=e[c],p=e[c+1].map((e=>e*Ud));d.startsWith("top")?p[1]-=7:d.startsWith("bottom")&&(p[1]+=7),l[c+1]=p}return new Le(l)}const m=p.get("text-variable-anchor");if(m){let d;d=void 0!==e._unevaluatedLayout.getValue("text-radial-offset")?[p.get("text-radial-offset").evaluate(l,{},c)*Ud,f_]:p.get("text-offset").evaluate(l,{},c).map((e=>e*Ud));const f=[];for(const e of m)f.push(e,m_(e,d));return new Le(f)}return null}function g_(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function y_(e,c,d,p,f,m,_,g,y,b,T,S){let P=m.textMaxSize.evaluate(c,{});void 0===P&&(P=_);const I=e.layers[0].layout,C=I.get("icon-offset").evaluate(c,{},T),R=v_(d.horizontal),L=_/24,F=e.tilePixelRatio*L,B=e.tilePixelRatio*P/24,O=e.tilePixelRatio*g,V=e.tilePixelRatio*I.get("symbol-spacing"),j=I.get("text-padding")*e.tilePixelRatio,G=function(e,l,c,d=1){const p=e.get("icon-padding").evaluate(l,{},c),f=p&&p.values;return[f[0]*d,f[1]*d,f[2]*d,f[3]*d]}(I,c,T,e.tilePixelRatio),U=I.get("text-max-angle")/180*Math.PI,q="viewport"!==I.get("text-rotation-alignment")&&"point"!==I.get("symbol-placement"),Z="map"===I.get("icon-rotation-alignment")&&"point"!==I.get("symbol-placement"),W=I.get("symbol-placement"),Q=V/2,J=I.get("icon-text-fit");let oe;p&&"none"!==J&&(e.allowVerticalPlacement&&d.vertical&&(oe=Dp(p,d.vertical,J,I.get("icon-text-fit-padding"),C,L)),R&&(p=Dp(p,R,J,I.get("icon-text-fit-padding"),C,L)));const le=T?S.line.getGranularityForZoomLevel(T.z):1,ce=(g,S)=>{S.x<0||S.x>=re||S.y<0||S.y>=re||function(e,c,d,p,f,m,_,g,y,b,T,S,P,I,C,R,L,F,B,O,V,j,G,U,q){const Z=e.addToLineVertexArray(c,d);let W,Q,J,re,oe=0,le=0,ce=0,he=0,ue=-1,pe=-1;const fe={};let me=$c("");if(e.allowVerticalPlacement&&p.vertical){const e=g.layout.get("text-rotate").evaluate(V,{},U)+90;J=new ld(y,c,b,T,S,p.vertical,P,I,C,e),_&&(re=new ld(y,c,b,T,S,_,L,F,C,e))}if(f){const d=g.layout.get("icon-rotate").evaluate(V,{}),p="none"!==g.layout.get("icon-text-fit"),m=s_(f,d,G,p),P=_?s_(_,d,G,p):void 0;Q=new ld(y,c,b,T,S,f,L,F,!1,d),oe=4*m.length;const I=e.iconSizeData;let C=null;"source"===I.kind?(C=[zp*g.layout.get("icon-size").evaluate(V,{})],C[0]>kp&&Se(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===I.kind&&(C=[zp*j.compositeIconSizes[0].evaluate(V,{},U),zp*j.compositeIconSizes[1].evaluate(V,{},U)],(C[0]>kp||C[1]>kp)&&Se(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),e.addSymbols(e.icon,m,C,O,B,V,l.az.none,c,Z.lineStartIndex,Z.lineLength,-1,U),ue=e.icon.placedSymbolArray.length-1,P&&(le=4*P.length,e.addSymbols(e.icon,P,C,O,B,V,l.az.vertical,c,Z.lineStartIndex,Z.lineLength,-1,U),pe=e.icon.placedSymbolArray.length-1)}const ge=Object.keys(p.horizontal);for(const d of ge){const f=p.horizontal[d];if(!W){me=$c(f.text);const e=g.layout.get("text-rotate").evaluate(V,{},U);W=new ld(y,c,b,T,S,f,P,I,C,e)}const _=1===f.positionedLines.length;if(ce+=x_(e,c,f,m,g,C,V,R,Z,p.vertical?l.az.horizontal:l.az.horizontalOnly,_?ge:[d],fe,ue,j,U),_)break}p.vertical&&(he+=x_(e,c,p.vertical,m,g,C,V,R,Z,l.az.vertical,["vertical"],fe,pe,j,U));const ye=W?W.boxStartIndex:e.collisionBoxArray.length,xe=W?W.boxEndIndex:e.collisionBoxArray.length,ve=J?J.boxStartIndex:e.collisionBoxArray.length,be=J?J.boxEndIndex:e.collisionBoxArray.length,we=Q?Q.boxStartIndex:e.collisionBoxArray.length,Me=Q?Q.boxEndIndex:e.collisionBoxArray.length,Ee=re?re.boxStartIndex:e.collisionBoxArray.length,Ce=re?re.boxEndIndex:e.collisionBoxArray.length;let Ae=-1;const Ne=(e,l)=>e&&e.circleDiameter?Math.max(e.circleDiameter,l):l;Ae=Ne(W,Ae),Ae=Ne(J,Ae),Ae=Ne(Q,Ae),Ae=Ne(re,Ae);const Ge=Ae>-1?1:0;Ge&&(Ae*=q/Ud),e.glyphOffsetArray.length>=fh.MAX_GLYPHS&&Se("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==V.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,V.sortKey);const Ue=__(g,V,U),[qe,$e]=function(e,c){const d=e.length,p=null==c?void 0:c.values;if((null==p?void 0:p.length)>0)for(let c=0;c<p.length;c+=2){const d=p[c+1];e.emplaceBack(l.aP[p[c]],d[0],d[1])}return[d,e.length]}(e.textAnchorOffsets,Ue);e.symbolInstances.emplaceBack(c.x,c.y,fe.right>=0?fe.right:-1,fe.center>=0?fe.center:-1,fe.left>=0?fe.left:-1,fe.vertical||-1,ue,pe,me,ye,xe,ve,be,we,Me,Ee,Ce,b,ce,he,oe,le,Ge,0,P,Ae,qe,$e)}(e,S,g,d,p,f,oe,e.layers[0],e.collisionBoxArray,c.index,c.sourceLayerIndex,e.index,F,[j,j,j,j],q,y,O,G,Z,C,c,m,b,T,_)};if("line"===W)for(const l of $m(c.geometry,0,0,re,re)){const c=Ju(l,le),f=r_(c,V,U,d.vertical||R,p,24,B,e.overscaling,re);for(const l of f)R&&b_(e,R.text,Q,l)||ce(c,l)}else if("line-center"===W){for(const e of c.geometry)if(e.length>1){const l=Ju(e,le),c=i_(l,U,d.vertical||R,p,24,B);c&&ce(l,c)}}else if("Polygon"===c.type)for(const e of Kn(c.geometry,0)){const l=h_(e,16);ce(Ju(e[0],le,!0),new Hf(l.x,l.y,0))}else if("LineString"===c.type)for(const e of c.geometry){const l=Ju(e,le);ce(l,new Hf(l[0].x,l[0].y,0))}else if("Point"===c.type)for(const e of c.geometry)for(const l of e)ce([l],new Hf(l.x,l.y,0))}function x_(e,l,c,p,f,m,_,g,y,b,T,S,P,I,C){const R=function(e,l,c,p,f,m,_,g){const y=p.layout.get("text-rotate").evaluate(m,{})*Math.PI/180,b=[];for(const e of l.positionedLines)for(const p of e.positionedGlyphs){if(!p.rect)continue;const m=p.rect||{};let T=4,S=!0,P=1,I=0;const C=(f||g)&&p.vertical,R=p.metrics.advance*p.scale/2;if(g&&l.verticalizable&&(I=e.lineOffset/2-(p.imageName?-(Ud-p.metrics.width*p.scale)/2:(p.scale-1)*Ud)),p.imageName){const e=_[p.imageName];S=e.sdf,P=e.pixelRatio,T=1/P}const L=f?[p.x+R,p.y]:[0,0];let F=f?[0,0]:[p.x+R+c[0],p.y+c[1]-I],B=[0,0];C&&(B=F,F=[0,0]);const O=p.metrics.isDoubleResolution?2:1,V=(p.metrics.left-T)*p.scale-R+F[0],j=(-p.metrics.top-T)*p.scale+F[1],G=V+m.w/O*p.scale/P,U=j+m.h/O*p.scale/P,q=new d(V,j),Z=new d(G,j),W=new d(V,U),Q=new d(G,U);if(C){const e=new d(-R,R- -17),l=-Math.PI/2,c=12-R,f=new d(22-c,-(p.imageName?c:0)),m=new d(...B);q._rotateAround(l,e)._add(f)._add(m),Z._rotateAround(l,e)._add(f)._add(m),W._rotateAround(l,e)._add(f)._add(m),Q._rotateAround(l,e)._add(f)._add(m)}if(y){const e=Math.sin(y),l=Math.cos(y),c=[l,-e,e,l];q._matMult(c),Z._matMult(c),W._matMult(c),Q._matMult(c)}const J=new d(0,0),re=new d(0,0);b.push({tl:q,tr:Z,bl:W,br:Q,tex:m,writingMode:l.writingMode,glyphOffset:L,sectionIndex:p.sectionIndex,isSDF:S,pixelOffsetTL:J,pixelOffsetBR:re,minFontScaleX:0,minFontScaleY:0})}return b}(0,c,g,f,m,_,p,e.allowVerticalPlacement),L=e.textSizeData;let F=null;"source"===L.kind?(F=[zp*f.layout.get("text-size").evaluate(_,{})],F[0]>kp&&Se(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===L.kind&&(F=[zp*I.compositeTextSizes[0].evaluate(_,{},C),zp*I.compositeTextSizes[1].evaluate(_,{},C)],(F[0]>kp||F[1]>kp)&&Se(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,R,F,g,m,_,b,l,y.lineStartIndex,y.lineLength,P,C);for(const l of T)S[l]=e.text.placedSymbolArray.length-1;return 4*R.length}function v_(e){for(const l in e)return e[l];return null}function b_(e,l,c,d){const p=e.compareText;if(l in p){const e=p[l];for(let l=e.length-1;l>=0;l--)if(d.dist(e[l])<c)return!0}else p[l]=[];return p[l].push(d),!1}const w_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Sd{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,c]=new Uint8Array(e,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const d=c>>4;if(1!==d)throw new Error(`Got v${d} data when expected v1.`);const p=w_[15&c];if(!p)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[m]=new Uint32Array(e,4,1);return new Sd(m,f,p,e)}constructor(e,l=64,c=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=w_.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,m=e*this.IndexArrayType.BYTES_PER_ELEMENT,_=(8-m%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${c}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+_,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+m+_),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+_,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=e)}add(e,l){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=l,c}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return T_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,l,c,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:f,nodeSize:m}=this,_=[0,p.length-1,0],g=[];for(;_.length;){const y=_.pop()||0,b=_.pop()||0,T=_.pop()||0;if(b-T<=m){for(let m=T;m<=b;m++){const _=f[2*m],y=f[2*m+1];_>=e&&_<=c&&y>=l&&y<=d&&g.push(p[m])}continue}const S=T+b>>1,P=f[2*S],I=f[2*S+1];P>=e&&P<=c&&I>=l&&I<=d&&g.push(p[S]),(0===y?e<=P:l<=I)&&(_.push(T),_.push(S-1),_.push(1-y)),(0===y?c>=P:d>=I)&&(_.push(S+1),_.push(b),_.push(1-y))}return g}within(e,l,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:p,nodeSize:f}=this,m=[0,d.length-1,0],_=[],g=c*c;for(;m.length;){const y=m.pop()||0,b=m.pop()||0,T=m.pop()||0;if(b-T<=f){for(let c=T;c<=b;c++)I_(p[2*c],p[2*c+1],e,l)<=g&&_.push(d[c]);continue}const S=T+b>>1,P=p[2*S],I=p[2*S+1];I_(P,I,e,l)<=g&&_.push(d[S]),(0===y?e-c<=P:l-c<=I)&&(m.push(T),m.push(S-1),m.push(1-y)),(0===y?e+c>=P:l+c>=I)&&(m.push(S+1),m.push(b),m.push(1-y))}return _}}function T_(e,l,c,d,p,f){if(p-d<=c)return;const m=d+p>>1;S_(e,l,m,d,p,f),T_(e,l,c,d,m-1,1-f),T_(e,l,c,m+1,p,1-f)}function S_(e,l,c,d,p,f){for(;p>d;){if(p-d>600){const m=p-d+1,_=c-d+1,g=Math.log(m),y=.5*Math.exp(2*g/3),b=.5*Math.sqrt(g*y*(m-y)/m)*(_-m/2<0?-1:1);S_(e,l,c,Math.max(d,Math.floor(c-_*y/m+b)),Math.min(p,Math.floor(c+(m-_)*y/m+b)),f)}const m=l[2*c+f];let _=d,g=p;for(P_(e,l,d,c),l[2*p+f]>m&&P_(e,l,d,p);_<g;){for(P_(e,l,_,g),_++,g--;l[2*_+f]<m;)_++;for(;l[2*g+f]>m;)g--}l[2*d+f]===m?P_(e,l,d,g):(g++,P_(e,l,g,p)),g<=c&&(d=g+1),c<=g&&(p=g-1)}}function P_(e,l,c,d){M_(e,c,d),M_(l,2*c,2*d),M_(l,2*c+1,2*d+1)}function M_(e,l,c){const d=e[l];e[l]=e[c],e[c]=d}function I_(e,l,c,d){const p=e-c,f=l-d;return p*p+f*f}var E_;l.cI=void 0,(E_=l.cI||(l.cI={})).create="create",E_.load="load",E_.fullLoad="fullLoad";let C_=null,A_=[];const D_=1e3/60,z_="loadTime",k_="fullLoadTime",R_={mark(e){performance.mark(e)},frame(e){const l=e;null!=C_&&A_.push(l-C_),C_=l},clearMetrics(){C_=null,A_=[],performance.clearMeasures(z_),performance.clearMeasures(k_);for(const e in l.cI)performance.clearMarks(l.cI[e])},getPerformanceMetrics(){performance.measure(z_,l.cI.create,l.cI.load),performance.measure(k_,l.cI.create,l.cI.fullLoad);const e=performance.getEntriesByName(z_)[0].duration,c=performance.getEntriesByName(k_)[0].duration,d=A_.length,p=1/(A_.reduce(((e,l)=>e+l),0)/d/1e3),f=A_.filter((e=>e>D_)).reduce(((e,l)=>e+(l-D_)/D_),0);return{loadTime:e,fullLoadTime:c,fps:p,percentDroppedFrames:f/(d+f)*100,totalFrames:d}}};l.$=T,l.A=I,l.B=Ql,l.C=Wl,l.D=js,l.E=xt,l.F=function([e,l,c]){return l+=90,l*=Math.PI/180,c*=Math.PI/180,{x:e*Math.cos(l)*Math.sin(c),y:e*Math.sin(l)*Math.sin(c),z:e*Math.cos(c)}},l.G=_n,l.H=Ps,l.I=qc,l.J=Xl,l.K=function(e){if(null==Ce){const l=e.navigator?e.navigator.userAgent:null;Ce=!!e.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Ce},l.L=class{constructor(e,l){this.target=e,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Sh((()=>this.process())),this.subscription=$e(this.target,"message",(e=>this.receive(e)),!1),this.globalScope=Ee(self)?e:window}registerMessageHandler(e,l){this.messageHandlers[e]=l}unregisterMessageHandler(e){delete this.messageHandlers[e]}sendAsync(e,l){return new Promise(((c,d)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10),f=l?$e(l.signal,"abort",(()=>{null==f||f.unsubscribe(),delete this.resolveRejects[p];const l={id:p,type:"<cancel>",origin:location.origin,targetMapId:e.targetMapId,sourceMapId:this.mapId};this.target.postMessage(l)}),Yp):null;this.resolveRejects[p]={resolve:e=>{null==f||f.unsubscribe(),c(e)},reject:e=>{null==f||f.unsubscribe(),d(e)}};const m=[],_=Object.assign(Object.assign({},e),{id:p,sourceMapId:this.mapId,origin:location.origin,data:oc(e.data,m)});this.target.postMessage(_,{transfer:m})}))}receive(e){const l=e.data,c=l.id;if(!("file://"!==l.origin&&"file://"!==location.origin&&"resource://android"!==l.origin&&"resource://android"!==location.origin&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if("<cancel>"===l.type){delete this.tasks[c];const e=this.abortControllers[c];return delete this.abortControllers[c],void(e&&e.abort())}if(Ee(self)||l.mustQueue)return this.tasks[c]=l,this.taskQueue.push(c),void this.invoker.trigger();this.processTask(c,l)}}process(){if(0===this.taskQueue.length)return;const e=this.taskQueue.shift(),l=this.tasks[e];delete this.tasks[e],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(e,l)}processTask(e,l){return c(this,void 0,void 0,(function*(){if("<response>"===l.type){const c=this.resolveRejects[e];if(delete this.resolveRejects[e],!c)return;return void(l.error?c.reject(lc(l.error)):c.resolve(lc(l.data)))}if(!this.messageHandlers[l.type])return void this.completeTask(e,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const c=lc(l.data),d=new AbortController;this.abortControllers[e]=d;try{const p=yield this.messageHandlers[l.type](l.sourceMapId,c,d);this.completeTask(e,null,p)}catch(c){this.completeTask(e,c)}}))}completeTask(e,l,c){const d=[];delete this.abortControllers[e];const p={id:e,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?oc(l):null,data:oc(c,d)};this.target.postMessage(p,{transfer:d})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},l.M=ft,l.N=function(){var e=new I(16);return I!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},l.O=function(e,l,c){var d,p,f,m,_,g,y,b,T,S,P,I,C=c[0],R=c[1],L=c[2];return l===e?(e[12]=l[0]*C+l[4]*R+l[8]*L+l[12],e[13]=l[1]*C+l[5]*R+l[9]*L+l[13],e[14]=l[2]*C+l[6]*R+l[10]*L+l[14],e[15]=l[3]*C+l[7]*R+l[11]*L+l[15]):(p=l[1],f=l[2],m=l[3],_=l[4],g=l[5],y=l[6],b=l[7],T=l[8],S=l[9],P=l[10],I=l[11],e[0]=d=l[0],e[1]=p,e[2]=f,e[3]=m,e[4]=_,e[5]=g,e[6]=y,e[7]=b,e[8]=T,e[9]=S,e[10]=P,e[11]=I,e[12]=d*C+_*R+T*L+l[12],e[13]=p*C+g*R+S*L+l[13],e[14]=f*C+y*R+P*L+l[14],e[15]=m*C+b*R+I*L+l[15]),e},l.P=d,l.Q=function(e,l,c){var d=c[0],p=c[1],f=c[2];return e[0]=l[0]*d,e[1]=l[1]*d,e[2]=l[2]*d,e[3]=l[3]*d,e[4]=l[4]*p,e[5]=l[5]*p,e[6]=l[6]*p,e[7]=l[7]*p,e[8]=l[8]*f,e[9]=l[9]*f,e[10]=l[10]*f,e[11]=l[11]*f,e[12]=l[12],e[13]=l[13],e[14]=l[14],e[15]=l[15],e},l.R=Sl,l.S=function(e,l,c){var d=l[0],p=l[1],f=l[2],m=l[3],_=l[4],g=l[5],y=l[6],b=l[7],T=l[8],S=l[9],P=l[10],I=l[11],C=l[12],R=l[13],L=l[14],F=l[15],B=c[0],O=c[1],V=c[2],j=c[3];return e[0]=B*d+O*_+V*T+j*C,e[1]=B*p+O*g+V*S+j*R,e[2]=B*f+O*y+V*P+j*L,e[3]=B*m+O*b+V*I+j*F,e[4]=(B=c[4])*d+(O=c[5])*_+(V=c[6])*T+(j=c[7])*C,e[5]=B*p+O*g+V*S+j*R,e[6]=B*f+O*y+V*P+j*L,e[7]=B*m+O*b+V*I+j*F,e[8]=(B=c[8])*d+(O=c[9])*_+(V=c[10])*T+(j=c[11])*C,e[9]=B*p+O*g+V*S+j*R,e[10]=B*f+O*y+V*P+j*L,e[11]=B*m+O*b+V*I+j*F,e[12]=(B=c[12])*d+(O=c[13])*_+(V=c[14])*T+(j=c[15])*C,e[13]=B*p+O*g+V*S+j*R,e[14]=B*f+O*y+V*P+j*L,e[15]=B*m+O*b+V*I+j*F,e},l.T=zl,l.U=function(e,l){const c={};for(let d=0;d<l.length;d++){const p=l[d];p in e&&(c[p]=e[p])}return c},l.V=Eh,l.W=me,l.X=af,l.Y=of,l.Z=rt,l._=c,l.a=st,l.a$=V,l.a0=S,l.a1=Ge,l.a2=Rh,l.a3=df,l.a4=pf,l.a5=re,l.a6=function(e,l,c){if(!e)return l||{};if(!l)return e||{};const d=Tf(e),p=Tf(l);!function(e,l){l.removeAll&&(e.add.clear(),e.update.clear(),e.remove.clear(),l.remove.clear());for(const c of l.remove)e.add.delete(c),e.update.delete(c);for(const[c,d]of l.update){const p=e.update.get(c);p&&(l.update.set(c,wf(p,d)),e.update.delete(c))}}(d,p);const f={};if((d.removeAll||p.removeAll)&&(f.removeAll=!0),f.remove=new Set([...d.remove,...p.remove]),f.add=new Map([...d.add,...p.add]),f.update=new Map([...d.update,...p.update]),f.remove.size&&f.add.size)for(const e of f.add.keys())f.remove.delete(e);return function(e){const l={};return e.removeAll&&(l.removeAll=e.removeAll),e.remove&&(l.remove=Array.from(e.remove)),e.add&&(l.add=Array.from(e.add.values())),e.update&&(l.update=Array.from(e.update.values())),l}(f)},l.a7=function(e,l){const c=new Map;if(null==e)return c;if(null==e.type)return c;if("Feature"===e.type){const d=bf(e,l);if(null==d)return;return c.set(d,e),c}if("FeatureCollection"===e.type){const d=new Set;for(const p of e.features){const e=bf(p,l);if(null==e)return;if(d.has(e))return;d.add(e),c.set(e,p)}return c}},l.a8=function(e,l,c){var d,p;const f=[];if(l.removeAll)e.clear();else if(l.remove)for(const c of l.remove){const l=e.get(c);l&&(f.push(l.geometry),e.delete(c))}if(l.add)for(const d of l.add){const l=bf(d,c);if(null==l)continue;const p=e.get(l);p&&f.push(p.geometry),f.push(d.geometry),e.set(l,d)}if(l.update)for(const c of l.update){const l=e.get(c.id);if(!l)continue;const m=!!c.newGeometry,_=c.removeAllProperties||(null===(d=c.removeProperties)||void 0===d?void 0:d.length)>0||(null===(p=c.addOrUpdateProperties)||void 0===p?void 0:p.length)>0;if(!m&&!_)continue;f.push(l.geometry);const g=Object.assign({},l);if(e.set(c.id,g),m&&(f.push(c.newGeometry),g.geometry=c.newGeometry),_){if(g.properties=c.removeAllProperties?{}:Object.assign({},g.properties||{}),c.removeProperties)for(const e of c.removeProperties)delete g.properties[e];if(c.addOrUpdateProperties)for(const{key:e,value:l}of c.addOrUpdateProperties)g.properties[e]=l}}return f},l.a9=Vh,l.aA=function(e,{uSize:l,uSizeT:c},{lowerSize:d,upperSize:p}){return"source"===e.kind?d/zp:"composite"===e.kind?_n.number(d/zp,p/zp,c):l},l.aB=function(e,l){var c=l[0],d=l[1],p=l[2],f=l[3],m=l[4],_=l[5],g=l[6],y=l[7],b=l[8],T=l[9],S=l[10],P=l[11],I=l[12],C=l[13],R=l[14],L=l[15],F=c*_-d*m,B=c*g-p*m,O=c*y-f*m,V=d*g-p*_,j=d*y-f*_,G=p*y-f*g,U=b*C-T*I,q=b*R-S*I,Z=b*L-P*I,W=T*R-S*C,Q=T*L-P*C,J=S*L-P*R,re=F*J-B*Q+O*W+V*Z-j*q+G*U;return re?(e[0]=(_*J-g*Q+y*W)*(re=1/re),e[1]=(p*Q-d*J-f*W)*re,e[2]=(C*G-R*j+L*V)*re,e[3]=(S*j-T*G-P*V)*re,e[4]=(g*Z-m*J-y*q)*re,e[5]=(c*J-p*Z+f*q)*re,e[6]=(R*O-I*G-L*B)*re,e[7]=(b*G-S*O+P*B)*re,e[8]=(m*Q-_*Z+y*U)*re,e[9]=(d*Z-c*Q-f*U)*re,e[10]=(I*j-C*O+L*F)*re,e[11]=(T*O-b*j-P*F)*re,e[12]=(_*q-m*W-g*U)*re,e[13]=(c*W-d*q+p*U)*re,e[14]=(C*B-I*V-R*F)*re,e[15]=(b*V-T*B+S*F)*re,e):null},l.aC=Q,l.aD=function(e){var l=e[0],c=e[1];return Math.sqrt(l*l+c*c)},l.aE=function(e){return e[0]=0,e[1]=0,e},l.aF=function(e,l,c){return e[0]=l[0]*c,e[1]=l[1]*c,e},l.aG=Np,l.aH=q,l.aI=function(e,l,c,p){const f=l.y-e.y,m=l.x-e.x,_=p.y-c.y,g=p.x-c.x,y=_*m-g*f;if(0===y)return null;const b=(g*(e.y-c.y)-_*(e.x-c.x))/y;return new d(e.x+b*m,e.y+b*f)},l.aJ=$m,l.aK=oh,l.aL=function(e){let l=1/0,c=1/0,d=-1/0,p=-1/0;for(const f of e)l=Math.min(l,f.x),c=Math.min(c,f.y),d=Math.max(d,f.x),p=Math.max(p,f.y);return[l,c,d,p]},l.aM=Ud,l.aN=oe,l.aO=function(e,l,c,d,p=!1){if(!c[0]&&!c[1])return[0,0];const f=p?"map"===d?-e.bearingInRadians:0:"viewport"===d?e.bearingInRadians:0;if(f){const e=Math.sin(f),l=Math.cos(f);c=[c[0]*l-c[1]*e,c[0]*e+c[1]*l]}return[p?c[0]:oe(l,c[0],e.zoom),p?c[1]:oe(l,c[1],e.zoom)]},l.aQ=Bp,l.aR=g_,l.aS=vp,l.aT=Sd,l.aU=Ac,l.aV=pu,l.aW=$a,l.aX=io,l.aY=to,l.aZ=Ye,l.a_=ff,l.aa=jh,l.ab=25,l.ac=Lh,l.ad=e=>{const l=window.document.createElement("video");return l.muted=!0,new Promise((c=>{l.onloadstart=()=>{c(l)};for(const c of e){const e=window.document.createElement("source");vt(c)||(l.crossOrigin="Anonymous"),e.src=c,l.appendChild(e)}}))},l.ae=Dt,l.af=function(){return ye++},l.ag=Fa,l.ah=fh,l.ai=Fm,l.aj=Ko,l.ak=rh,l.al=Xh,l.am=function(e){const l={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,c,d,p)=>{const f=d||p;return l[c]=!f||f.toLowerCase(),""})),l["max-age"]){const e=parseInt(l["max-age"],10);isNaN(e)?delete l["max-age"]:l["max-age"]=e}return l},l.an=fe,l.ao=85.051129,l.ap=He,l.aq=function(e){return Math.pow(2,e)},l.ar=R,l.as=hf,l.at=function(e){return Math.log(e)/Math.LN2},l.au=function(e){var l=e[0],c=e[1];return l*l+c*c},l.av=function(e){if(!e.length)return new Set;const l=Math.max(...e.map((e=>e.canonical.z)));let c=1/0,d=-1/0,p=1/0,f=-1/0;const m=[];for(const _ of e){const{x:e,y:g,z:y}=_.canonical,b=Math.pow(2,l-y),T=e*b,S=g*b;m.push({id:_,x:T,y:S}),T<c&&(c=T),T>d&&(d=T),S<p&&(p=S),S>f&&(f=S)}const _=new Set;for(const e of m)e.x!==c&&e.x!==d&&e.y!==p&&e.y!==f||_.add(e.id);return _},l.aw=function(e,l){const c=Math.abs(2*e.wrap)-+(e.wrap<0),d=Math.abs(2*l.wrap)-+(l.wrap<0);return e.overscaledZ-l.overscaledZ||d-c||l.canonical.y-e.canonical.y||l.canonical.x-e.canonical.x},l.ax=class{constructor(e,l){this.max=e,this.onRemove=l,this.reset()}reset(){for(const e in this.data)for(const l of this.data[e])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(e,l,c){const d=e.wrapped().key;void 0===this.data[d]&&(this.data[d]=[]);const p={value:l,timeout:void 0};if(void 0!==c&&(p.timeout=setTimeout((()=>{this.remove(e,p)}),c)),this.data[d].push(p),this.order.push(d),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const l=this.data[e].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),l.value}getByKey(e){const l=this.data[e];return l?l[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,l){if(!this.has(e))return this;const c=e.wrapped().key,d=void 0===l?0:this.data[c].indexOf(l),p=this.data[c][d];return this.data[c].splice(d,1),p.timeout&&clearTimeout(p.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(p.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const l=[];for(const c in this.data)for(const d of this.data[c])e(d.value)||l.push(d);for(const e of l)this.remove(e.value.tileID,e)}},l.ay=function(e,l){let c=0,d=0;if("constant"===e.kind)d=e.layoutSize;else if("source"!==e.kind){const{interpolationType:p,minZoom:f,maxZoom:m}=e,_=p?fe(fr.interpolationFactor(p,l,f,m),0,1):0;"camera"===e.kind?d=_n.number(e.minSize,e.maxSize,_):c=_}return{uSizeT:c,uSize:d}},l.b=Ae,l.b$=Ao,l.b0=O,l.b1=function(e){var l=new I(3);return l[0]=e[0],l[1]=e[1],l[2]=e[2],l},l.b2=function(e,l,c){return e[0]=l[0]-c[0],e[1]=l[1]-c[1],e[2]=l[2]-c[2],e},l.b3=function(e,l){var c=l[0],d=l[1],p=l[2],f=c*c+d*d+p*p;return f>0&&(f=1/Math.sqrt(f)),e[0]=l[0]*f,e[1]=l[1]*f,e[2]=l[2]*f,e},l.b4=j,l.b5=function(e,l){return e[0]*l[0]+e[1]*l[1]+e[2]*l[2]},l.b6=function(e,l,c){return e[0]=l[0]*c[0],e[1]=l[1]*c[1],e[2]=l[2]*c[2],e[3]=l[3]*c[3],e},l.b7=F,l.b8=function(e,l,c){const d=l[0]*c[0]+l[1]*c[1]+l[2]*c[2];return 0===d?null:(-(e[0]*c[0]+e[1]*c[1]+e[2]*c[2])-c[3])/d},l.b9=U,l.bA=function(){return new Float64Array(3)},l.bB=W,l.bC=function(e,l,c){var d=c[0],p=c[1],f=c[2],m=c[3],_=l[0],g=l[1],y=l[2],b=p*y-f*g,T=f*_-d*y,S=d*g-p*_;return e[0]=_+m*(b+=b)+p*(S+=S)-f*(T+=T),e[1]=g+m*T+f*b-d*S,e[2]=y+m*S+d*T-p*b,e},l.bD=function(e,l,c){const d=(p=[e[0],e[1],e[2],l[0],l[1],l[2],c[0],c[1],c[2]])[0]*((b=p[8])*(m=p[4])-(_=p[5])*(y=p[7]))+p[1]*(-b*(f=p[3])+_*(g=p[6]))+p[2]*(y*f-m*g);var p,f,m,_,g,y,b;if(0===d)return null;const T=j([],[l[0],l[1],l[2]],[c[0],c[1],c[2]]),S=j([],[c[0],c[1],c[2]],[e[0],e[1],e[2]]),P=j([],[e[0],e[1],e[2]],[l[0],l[1],l[2]]),I=V([],T,-e[3]);return O(I,I,V([],S,-l[3])),O(I,I,V([],P,-c[3])),V(I,I,1/d),I},l.bE=tf,l.bF=function(){return new Float64Array(4)},l.bG=function(e,l,c,d){var p=[],f=[];return p[0]=l[0]-c[0],p[1]=l[1]-c[1],p[2]=l[2]-c[2],f[0]=p[0]*Math.cos(d)-p[1]*Math.sin(d),f[1]=p[0]*Math.sin(d)+p[1]*Math.cos(d),f[2]=p[2],e[0]=f[0]+c[0],e[1]=f[1]+c[1],e[2]=f[2]+c[2],e},l.bH=function(e,l,c,d){var p=[],f=[];return p[0]=l[0]-c[0],p[1]=l[1]-c[1],p[2]=l[2]-c[2],f[0]=p[0],f[1]=p[1]*Math.cos(d)-p[2]*Math.sin(d),f[2]=p[1]*Math.sin(d)+p[2]*Math.cos(d),e[0]=f[0]+c[0],e[1]=f[1]+c[1],e[2]=f[2]+c[2],e},l.bI=function(e,l,c,d){var p=[],f=[];return p[0]=l[0]-c[0],p[1]=l[1]-c[1],p[2]=l[2]-c[2],f[0]=p[2]*Math.sin(d)+p[0]*Math.cos(d),f[1]=p[1],f[2]=p[2]*Math.cos(d)-p[0]*Math.sin(d),e[0]=f[0]+c[0],e[1]=f[1]+c[1],e[2]=f[2]+c[2],e},l.bJ=function(e,l,c){var d=Math.sin(c),p=Math.cos(c),f=l[0],m=l[1],_=l[2],g=l[3],y=l[8],b=l[9],T=l[10],S=l[11];return l!==e&&(e[4]=l[4],e[5]=l[5],e[6]=l[6],e[7]=l[7],e[12]=l[12],e[13]=l[13],e[14]=l[14],e[15]=l[15]),e[0]=f*p-y*d,e[1]=m*p-b*d,e[2]=_*p-T*d,e[3]=g*p-S*d,e[8]=f*d+y*p,e[9]=m*d+b*p,e[10]=_*d+T*p,e[11]=g*d+S*p,e},l.bK=function(e,l){const c=le(e,360),d=le(l,360),p=d-c,f=d>c?p-360:p+360;return Math.abs(p)<Math.abs(f)?p:f},l.bL=function(e){return e[0]=0,e[1]=0,e[2]=0,e},l.bM=function(e,l,c,d){const p=Math.sqrt(e*e+l*l),f=Math.sqrt(c*c+d*d);e/=p,l/=p,c/=f,d/=f;const m=Math.acos(e*c+l*d);return-l*c+e*d>0?m:-m},l.bN=function(e,l){const c=le(e,2*Math.PI),d=le(l,2*Math.PI);return Math.min(Math.abs(c-d),Math.abs(c-d+2*Math.PI),Math.abs(c-d-2*Math.PI))},l.bO=function(){const e={},l=Tt.$version;for(const c in Tt.$root){const d=Tt.$root[c];if(d.required){let p=null;p="version"===c?l:"array"===d.type?[]:{},null!=p&&(e[c]=p)}}return e},l.bP=_t,l.bQ=xs,l.bR=function e(l,c){if(Array.isArray(l)){if(!Array.isArray(c)||l.length!==c.length)return!1;for(let d=0;d<l.length;d++)if(!e(l[d],c[d]))return!1;return!0}if("object"==typeof l&&null!==l&&null!==c){if("object"!=typeof c)return!1;if(Object.keys(l).length!==Object.keys(c).length)return!1;for(const d in l)if(!e(l[d],c[d]))return!1;return!0}return l===c},l.bS=function(e){e=e.slice();const l=Object.create(null);for(let c=0;c<e.length;c++)l[e[c].id]=e[c];for(let c=0;c<e.length;c++)"ref"in e[c]&&(e[c]=At(e[c],l[e[c].ref]));return e},l.bT=function(e,l){if("custom"===e.type)return new _h(e,l);switch(e.type){case"background":return new wh(e,l);case"circle":return new yl(e,l);case"color-relief":return new Vl(e,l);case"fill":return new ku(e,l);case"fill-extrusion":return new Gu(e,l);case"heatmap":return new El(e,l);case"hillshade":return new Ml(e,l);case"line":return new ac(e,l);case"raster":return new Qs(e,l);case"symbol":return new xh(e,l)}},l.bU=e=>"raster"===e.type,l.bV=be,l.bW=function(e,l){if(!e)return[{command:"setStyle",args:[l]}];let c=[];try{if(!Lt(e.version,l.version))return[{command:"setStyle",args:[l]}];Lt(e.center,l.center)||c.push({command:"setCenter",args:[l.center]}),Lt(e.state,l.state)||c.push({command:"setGlobalState",args:[l.state]}),Lt(e.centerAltitude,l.centerAltitude)||c.push({command:"setCenterAltitude",args:[l.centerAltitude]}),Lt(e.zoom,l.zoom)||c.push({command:"setZoom",args:[l.zoom]}),Lt(e.bearing,l.bearing)||c.push({command:"setBearing",args:[l.bearing]}),Lt(e.pitch,l.pitch)||c.push({command:"setPitch",args:[l.pitch]}),Lt(e.roll,l.roll)||c.push({command:"setRoll",args:[l.roll]}),Lt(e.sprite,l.sprite)||c.push({command:"setSprite",args:[l.sprite]}),Lt(e.glyphs,l.glyphs)||c.push({command:"setGlyphs",args:[l.glyphs]}),Lt(e.transition,l.transition)||c.push({command:"setTransition",args:[l.transition]}),Lt(e.light,l.light)||c.push({command:"setLight",args:[l.light]}),Lt(e.terrain,l.terrain)||c.push({command:"setTerrain",args:[l.terrain]}),Lt(e.sky,l.sky)||c.push({command:"setSky",args:[l.sky]}),Lt(e.projection,l.projection)||c.push({command:"setProjection",args:[l.projection]});const d={},p=[];!function(e,l,c,d){let p;for(p in l=l||{},e=e||{})Object.prototype.hasOwnProperty.call(e,p)&&(Object.prototype.hasOwnProperty.call(l,p)||Ut(p,c,d));for(p in l)Object.prototype.hasOwnProperty.call(l,p)&&(Object.prototype.hasOwnProperty.call(e,p)?Lt(e[p],l[p])||("geojson"===e[p].type&&"geojson"===l[p].type&&Ht(e,l,p)?Ft(c,{command:"setGeoJSONSourceData",args:[p,l[p].data]}):Zt(p,l,c,d)):Ot(p,l,c))}(e.sources,l.sources,p,d);const f=[];e.layers&&e.layers.forEach((e=>{"source"in e&&d[e.source]?c.push({command:"removeLayer",args:[e.id]}):f.push(e)})),c=c.concat(p),function(e,l,c){l=l||[];const d=(e=e||[]).map(Kt),p=l.map(Kt),f=e.reduce(Jt,{}),m=l.reduce(Jt,{}),_=d.slice(),g=Object.create(null);let y,b,T,S,P;for(let e=0,l=0;e<d.length;e++)y=d[e],Object.prototype.hasOwnProperty.call(m,y)?l++:(Ft(c,{command:"removeLayer",args:[y]}),_.splice(_.indexOf(y,l),1));for(let e=0,l=0;e<p.length;e++)y=p[p.length-1-e],_[_.length-1-e]!==y&&(Object.prototype.hasOwnProperty.call(f,y)?(Ft(c,{command:"removeLayer",args:[y]}),_.splice(_.lastIndexOf(y,_.length-l),1)):l++,S=_[_.length-e],Ft(c,{command:"addLayer",args:[m[y],S]}),_.splice(_.length-e,0,y),g[y]=!0);for(let e=0;e<p.length;e++)if(y=p[e],b=f[y],T=m[y],!g[y]&&!Lt(b,T))if(Lt(b.source,T.source)&&Lt(b["source-layer"],T["source-layer"])&&Lt(b.type,T.type)){for(P in Xt(b.layout,T.layout,c,y,null,"setLayoutProperty"),Xt(b.paint,T.paint,c,y,null,"setPaintProperty"),Lt(b.filter,T.filter)||Ft(c,{command:"setFilter",args:[y,T.filter]}),Lt(b.minzoom,T.minzoom)&&Lt(b.maxzoom,T.maxzoom)||Ft(c,{command:"setLayerZoomRange",args:[y,T.minzoom,T.maxzoom]}),b)Object.prototype.hasOwnProperty.call(b,P)&&"layout"!==P&&"paint"!==P&&"filter"!==P&&"metadata"!==P&&"minzoom"!==P&&"maxzoom"!==P&&(0===P.indexOf("paint.")?Xt(b[P],T[P],c,y,P.slice(6),"setPaintProperty"):Lt(b[P],T[P])||Ft(c,{command:"setLayerProperty",args:[y,P,T[P]]}));for(P in T)Object.prototype.hasOwnProperty.call(T,P)&&!Object.prototype.hasOwnProperty.call(b,P)&&"layout"!==P&&"paint"!==P&&"filter"!==P&&"metadata"!==P&&"minzoom"!==P&&"maxzoom"!==P&&(0===P.indexOf("paint.")?Xt(b[P],T[P],c,y,P.slice(6),"setPaintProperty"):Lt(b[P],T[P])||Ft(c,{command:"setLayerProperty",args:[y,P,T[P]]}))}else Ft(c,{command:"removeLayer",args:[y]}),S=_[_.lastIndexOf(y)+1],Ft(c,{command:"addLayer",args:[T,S]})}(f,l.layers,c)}catch(e){console.warn("Unable to compute style diff:",e),c=[{command:"setStyle",args:[l]}]}return c},l.bX=function(e){const l=[],c=e.id;return void 0===c&&l.push({message:`layers.${c}: missing required property "id"`}),void 0===e.render&&l.push({message:`layers.${c}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&l.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),l},l.bY=xe,l.bZ=ve,l.b_=class extends wo{constructor(e,l){super(e,l),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},l.ba=function(e,l,c){return e[0]=l[0]*c,e[1]=l[1]*c,e[2]=l[2]*c,e[3]=l[3]*c,e},l.bb=function(e,l){return e[0]*l[0]+e[1]*l[1]+e[2]*l[2]+e[3]},l.bc=Oh,l.bd=vf,l.be=function(e,l,c,d,p){var f=1/Math.tan(l/2);if(e[0]=f/c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=p&&p!==1/0){var m=1/(d-p);e[10]=(p+d)*m,e[14]=2*p*d*m}else e[10]=-1,e[14]=-2*d;return e},l.bf=function(e){var l=new I(16);return l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8],l[9]=e[9],l[10]=e[10],l[11]=e[11],l[12]=e[12],l[13]=e[13],l[14]=e[14],l[15]=e[15],l},l.bg=function(e,l,c){var d=Math.sin(c),p=Math.cos(c),f=l[0],m=l[1],_=l[2],g=l[3],y=l[4],b=l[5],T=l[6],S=l[7];return l!==e&&(e[8]=l[8],e[9]=l[9],e[10]=l[10],e[11]=l[11],e[12]=l[12],e[13]=l[13],e[14]=l[14],e[15]=l[15]),e[0]=f*p+y*d,e[1]=m*p+b*d,e[2]=_*p+T*d,e[3]=g*p+S*d,e[4]=y*p-f*d,e[5]=b*p-m*d,e[6]=T*p-_*d,e[7]=S*p-g*d,e},l.bh=function(e,l,c){var d=Math.sin(c),p=Math.cos(c),f=l[4],m=l[5],_=l[6],g=l[7],y=l[8],b=l[9],T=l[10],S=l[11];return l!==e&&(e[0]=l[0],e[1]=l[1],e[2]=l[2],e[3]=l[3],e[12]=l[12],e[13]=l[13],e[14]=l[14],e[15]=l[15]),e[4]=f*p+y*d,e[5]=m*p+b*d,e[6]=_*p+T*d,e[7]=g*p+S*d,e[8]=y*p-f*d,e[9]=b*p-m*d,e[10]=T*p-_*d,e[11]=S*p-g*d,e},l.bi=function(){const e=new Float32Array(16);return R(e),e},l.bj=function(){const e=new Float64Array(16);return R(e),e},l.bk=function(){return new Float64Array(16)},l.bl=function(e,l,c){const d=new Float64Array(4);return W(d,e,l-90,c),d},l.bm=function(e,l,c,d){var p,f,m,_,g,y=l[0],b=l[1],T=l[2],S=l[3],I=c[0],C=c[1],R=c[2],L=c[3];return(f=y*I+b*C+T*R+S*L)<0&&(f=-f,I=-I,C=-C,R=-R,L=-L),1-f>P?(p=Math.acos(f),m=Math.sin(p),_=Math.sin((1-d)*p)/m,g=Math.sin(d*p)/m):(_=1-d,g=d),e[0]=_*y+g*I,e[1]=_*b+g*C,e[2]=_*T+g*R,e[3]=_*S+g*L,e},l.bn=function(e){const l=new Float64Array(9);var c,d,p,f,m,_,g,y,b,T,S,P,I,C,R,L,F,B;T=(p=(d=e)[0])*(g=p+p),S=(f=d[1])*g,I=(m=d[2])*g,C=m*(y=f+f),L=(_=d[3])*g,F=_*y,B=_*(b=m+m),(c=l)[0]=1-(P=f*y)-(R=m*b),c[3]=S-B,c[6]=I+F,c[1]=S+B,c[4]=1-T-R,c[7]=C-L,c[2]=I-F,c[5]=C+L,c[8]=1-T-P;const O=Ye(-Math.asin(fe(l[2],-1,1)));let V,j;return Math.hypot(l[5],l[8])<.001?(V=0,j=-Ye(Math.atan2(l[3],l[4]))):(V=Ye(0===l[5]&&0===l[8]?0:Math.atan2(l[5],l[8])),j=Ye(0===l[1]&&0===l[0]?0:Math.atan2(l[1],l[0]))),{roll:V,pitch:O+90,bearing:j}},l.bo=function(e,l){return e.roll==l.roll&&e.pitch==l.pitch&&e.bearing==l.bearing},l.bp=Te,l.bq=_o,l.br=Yu,l.bs=Ku,l.bt=hu,l.bu=ce,l.bv=he,l.bw=Re,l.bx=function(e,l,c,d,p){return ce(d,p,fe((e-l)/(c-l),0,1))},l.by=function(e,l,c,d){return e[0]=l[0]+c[0]*d,e[1]=l[1]+c[1]*d,e[2]=l[2]+c[2]*d,e},l.bz=le,l.c=ot,l.c$=class{constructor(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let e=performance.getEntriesByName(this._marks.measure);return 0===e.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),e=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),e}},l.c0=class extends wo{constructor(e,l){super(e,l),this.current=Yc}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let l=1;l<16;l++)if(e[l]!==this.current[l]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},l.c1=So,l.c2=class extends wo{constructor(e,l){super(e,l),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},l.c3=class extends wo{constructor(e,l){super(e,l),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},l.c4=C,l.c5=function(e,l){var c=Math.sin(l),d=Math.cos(l);return e[0]=d,e[1]=c,e[2]=0,e[3]=-c,e[4]=d,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},l.c6=function(e,l,c){var d=l[0],p=l[1],f=l[2];return e[0]=d*c[0]+p*c[3]+f*c[6],e[1]=d*c[1]+p*c[4]+f*c[7],e[2]=d*c[2]+p*c[5]+f*c[8],e},l.c7=function(e,l,c,d,p,f,m){var _=1/(l-c),g=1/(d-p),y=1/(f-m);return e[0]=-2*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*y,e[11]=0,e[12]=(l+c)*_,e[13]=(p+d)*g,e[14]=(m+f)*y,e[15]=1,e},l.c8=class extends wo{constructor(e,l){super(e,l),this.current=new Array}set(e){if(e!=this.current){this.current=e;const l=new Float32Array(4*e.length);for(let c=0;c<e.length;c++)l[4*c]=e[c].r,l[4*c+1]=e[c].g,l[4*c+2]=e[c].b,l[4*c+3]=e[c].a;this.gl.uniform4fv(this.location,l)}}},l.c9=class extends wo{constructor(e,l){super(e,l),this.current=new Array}set(e){if(e!=this.current){this.current=e;const l=new Float32Array(e);this.gl.uniform1fv(this.location,l)}}},l.cA=function(e,l){var c;if(!tt[l])return!1;const d=null==e?void 0:e.target,p=(null===(c=null==d?void 0:d.ownerDocument)||void 0===c?void 0:c.defaultView)||window;return e instanceof p.MouseEvent||e instanceof p.WheelEvent},l.cB=function(e,l){return et[l]&&"touches"in e},l.cC=function(e){return et[e]||tt[e]},l.cD=function(e,l,c){var d=l[0],p=l[1];return e[0]=c[0]*d+c[4]*p+c[12],e[1]=c[1]*d+c[5]*p+c[13],e},l.cE=function(e,l){const{x:c,y:d}=Vh.fromLngLat(l);return!(e<0||e>25||d<0||d>=1||c<0||c>=1)},l.cF=function(e,l){return e[0]=l[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},l.cG=class extends aa{},l.cH=R_,l.cJ=ct,l.cK=function(e,l){ot.REGISTERED_PROTOCOLS[e]=l},l.cL=function(e){delete ot.REGISTERED_PROTOCOLS[e]},l.cM=function(e,l){const c={};for(let d=0;d<e.length;d++){const p=l&&l[e[d].id]||rl(e[d]);l&&(l[e[d].id]=p);let f=c[p];f||(f=c[p]=[]),f.push(e[d])}const d=[];for(const e in c)d.push(c[e]);return d},l.cN=ec,l.cO=Gh,l.cP=Nf,l.cQ=jc,l.cR=function(e){var c;e.bucket.createArrays(),e.bucket.tilePixelRatio=re/(512*e.bucket.overscaling),e.bucket.compareText={},e.bucket.iconsNeedLinear=!1;const d=e.bucket.layers[0],p=d.layout,f=d._unevaluatedLayout._values,m={layoutIconSize:f["icon-size"].possiblyEvaluate(new Ps(e.bucket.zoom+1),e.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new Ps(e.bucket.zoom+1),e.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new Ps(18))};if("composite"===e.bucket.textSizeData.kind){const{minZoom:l,maxZoom:c}=e.bucket.textSizeData;m.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Ps(l),e.canonical),f["text-size"].possiblyEvaluate(new Ps(c),e.canonical)]}if("composite"===e.bucket.iconSizeData.kind){const{minZoom:l,maxZoom:c}=e.bucket.iconSizeData;m.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Ps(l),e.canonical),f["icon-size"].possiblyEvaluate(new Ps(c),e.canonical)]}const _=p.get("text-line-height")*Ud,g="viewport"!==p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),y=p.get("text-keep-upright"),b=p.get("text-size");for(const f of e.bucket.features){const T=p.get("text-font").evaluate(f,{},e.canonical).join(","),S=b.evaluate(f,{},e.canonical),P=m.layoutTextSize.evaluate(f,{},e.canonical),I=m.layoutIconSize.evaluate(f,{},e.canonical),C={horizontal:{},vertical:void 0},R=f.text;let L,F=[0,0];if(R){const c=R.toString(),m=p.get("text-letter-spacing").evaluate(f,{},e.canonical)*Ud,b=pc(c)?m:0,I=p.get("text-anchor").evaluate(f,{},e.canonical),L=__(d,f,e.canonical);if(!L){const l=p.get("text-radial-offset").evaluate(f,{},e.canonical);F=l?m_(I,[l*Ud,f_]):p.get("text-offset").evaluate(f,{},e.canonical).map((e=>e*Ud))}let B=g?"center":p.get("text-justify").evaluate(f,{},e.canonical);const O="point"===p.get("symbol-placement")?p.get("text-max-width").evaluate(f,{},e.canonical)*Ud:1/0,V=()=>{e.bucket.allowVerticalPlacement&&dc(c)&&(C.vertical=xp(R,e.glyphMap,e.glyphPositions,e.imagePositions,T,O,_,I,"left",b,F,l.az.vertical,!0,P,S))};if(!g&&L){const c=new Set;if("auto"===B)for(let e=0;e<L.values.length;e+=2)c.add(g_(L.values[e]));else c.add(B);let d=!1;for(const p of c)if(!C.horizontal[p])if(d)C.horizontal[p]=C.horizontal[0];else{const c=xp(R,e.glyphMap,e.glyphPositions,e.imagePositions,T,O,_,"center",p,b,F,l.az.horizontal,!1,P,S);c&&(C.horizontal[p]=c,d=1===c.positionedLines.length)}V()}else{"auto"===B&&(B=g_(I));const d=xp(R,e.glyphMap,e.glyphPositions,e.imagePositions,T,O,_,I,B,b,F,l.az.horizontal,!1,P,S);d&&(C.horizontal[B]=d),V(),dc(c)&&g&&y&&(C.vertical=xp(R,e.glyphMap,e.glyphPositions,e.imagePositions,T,O,_,I,B,b,F,l.az.vertical,!1,P,S))}}let B=!1;if(f.icon&&f.icon.name){const l=e.imageMap[f.icon.name];l&&(L=Ip(e.imagePositions[f.icon.name],p.get("icon-offset").evaluate(f,{},e.canonical),p.get("icon-anchor").evaluate(f,{},e.canonical)),B=!!l.sdf,void 0===e.bucket.sdfIcons?e.bucket.sdfIcons=B:e.bucket.sdfIcons!==B&&Se("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(l.pixelRatio!==e.bucket.pixelRatio||0!==p.get("icon-rotate").constantOr(1))&&(e.bucket.iconsNeedLinear=!0))}const O=v_(C.horizontal)||C.vertical;(c=e.bucket).iconsInText||(c.iconsInText=!!O&&O.iconsInText),(O||L)&&y_(e.bucket,f,C,L,e.imageMap,m,P,I,F,B,e.canonical,e.subdivisionGranularity)}e.showCollisionBoxes&&e.bucket.generateCollisionDebugBuffers()},l.cS=wu,l.cT=Ru,l.cU=tc,l.cV=function(e){const l=new Tc;return function(e,l){for(const c in e.layers)l.writeMessage(3,Bm,e.layers[c])}(e,l),l.finish()},l.cW=function(e,l,c,d,p,f){let m=Wm(e,l,c,p,0);return m=Wm(m,l,d,f,1),m},l.cX=class{constructor(e){this.maxEntries=e,this.map=new Map}get(e){const l=this.map.get(e);return void 0!==l&&(this.map.delete(e),this.map.set(e,l)),l}set(e,l){if(this.map.has(e))this.map.delete(e);else if(this.map.size>=this.maxEntries){const e=this.map.keys().next().value;this.map.delete(e)}this.map.set(e,l)}clear(){this.map.clear()}},l.cY=Vu,l.cZ=Tc,l.c_=Ff,l.ca=class extends xa{},l.cb=Nd,l.cc=class extends ba{},l.cd=su,l.ce=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},l.cf=nu,l.cg=function(e,l,c){var d=l[0],p=l[1],f=l[2],m=c[3]*d+c[7]*p+c[11]*f+c[15];return e[0]=(c[0]*d+c[4]*p+c[8]*f+c[12])/(m=m||1),e[1]=(c[1]*d+c[5]*p+c[9]*f+c[13])/m,e[2]=(c[2]*d+c[6]*p+c[10]*f+c[14])/m,e},l.ch=class extends oa{},l.ci=class extends Ta{},l.cj=function(e,l){return e[0]===l[0]&&e[1]===l[1]&&e[2]===l[2]&&e[3]===l[3]&&e[4]===l[4]&&e[5]===l[5]&&e[6]===l[6]&&e[7]===l[7]&&e[8]===l[8]&&e[9]===l[9]&&e[10]===l[10]&&e[11]===l[11]&&e[12]===l[12]&&e[13]===l[13]&&e[14]===l[14]&&e[15]===l[15]},l.ck=function(e,l){var c=e[0],d=e[1],p=e[2],f=e[3],m=e[4],_=e[5],g=e[6],y=e[7],b=e[8],T=e[9],S=e[10],I=e[11],C=e[12],R=e[13],L=e[14],F=e[15],B=l[0],O=l[1],V=l[2],j=l[3],G=l[4],U=l[5],q=l[6],Z=l[7],W=l[8],Q=l[9],J=l[10],re=l[11],oe=l[12],le=l[13],ce=l[14],he=l[15];return Math.abs(c-B)<=P*Math.max(1,Math.abs(c),Math.abs(B))&&Math.abs(d-O)<=P*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(p-V)<=P*Math.max(1,Math.abs(p),Math.abs(V))&&Math.abs(f-j)<=P*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(m-G)<=P*Math.max(1,Math.abs(m),Math.abs(G))&&Math.abs(_-U)<=P*Math.max(1,Math.abs(_),Math.abs(U))&&Math.abs(g-q)<=P*Math.max(1,Math.abs(g),Math.abs(q))&&Math.abs(y-Z)<=P*Math.max(1,Math.abs(y),Math.abs(Z))&&Math.abs(b-W)<=P*Math.max(1,Math.abs(b),Math.abs(W))&&Math.abs(T-Q)<=P*Math.max(1,Math.abs(T),Math.abs(Q))&&Math.abs(S-J)<=P*Math.max(1,Math.abs(S),Math.abs(J))&&Math.abs(I-re)<=P*Math.max(1,Math.abs(I),Math.abs(re))&&Math.abs(C-oe)<=P*Math.max(1,Math.abs(C),Math.abs(oe))&&Math.abs(R-le)<=P*Math.max(1,Math.abs(R),Math.abs(le))&&Math.abs(L-ce)<=P*Math.max(1,Math.abs(L),Math.abs(ce))&&Math.abs(F-he)<=P*Math.max(1,Math.abs(F),Math.abs(he))},l.cl=function(e,l){return e[0]=l[0],e[1]=l[1],e[2]=l[2],e[3]=l[3],e[4]=l[4],e[5]=l[5],e[6]=l[6],e[7]=l[7],e[8]=l[8],e[9]=l[9],e[10]=l[10],e[11]=l[11],e[12]=l[12],e[13]=l[13],e[14]=l[14],e[15]=l[15],e},l.cm=e=>"symbol"===e.type,l.cn=e=>"circle"===e.type,l.co=e=>"heatmap"===e.type,l.cp=e=>"line"===e.type,l.cq=e=>"fill"===e.type,l.cr=e=>"fill-extrusion"===e.type,l.cs=e=>"hillshade"===e.type,l.ct=e=>"color-relief"===e.type,l.cu=e=>"background"===e.type,l.cv=e=>"custom"===e.type,l.cw=ue,l.cx=function(e,l,c){if(l<=0)return e;const d=1/l;return void 0===c||Math.abs(c)<1e-10?Math.round(e*d)/d:(c>0?Math.ceil(e*d-1e-9):Math.floor(e*d+1e-10))/d},l.cy=function(e,l,c){const d=J(l.x-c.x,l.y-c.y),p=J(e.x-c.x,e.y-c.y);var f,m;return Ye(Math.atan2(d[0]*p[1]-d[1]*p[0],(f=d)[0]*(m=p)[0]+f[1]*m[1]))},l.cz=pe,l.d=vt,l.d0=function(l,d,p,f,m){return c(this||e,void 0,void 0,(function*(){if(S())try{return yield Ge(l,d,p,f,m)}catch(e){}return function(e,l,c,d,p){const f=e.width,m=e.height;Ue&&qe||(Ue=new OffscreenCanvas(f,m),qe=Ue.getContext("2d",{willReadFrequently:!0})),Ue.width=f,Ue.height=m,qe.drawImage(e,0,0,f,m);const _=qe.getImageData(l,c,d,p);return qe.clearRect(0,0,f,m),_.data}(l,d,p,f,m)}))},l.d1=Pl,l.d2=p,l.d3=class{constructor(e,l){this.layers={[Fm]:this},this.name=Fm,this.version=l?l.version:1,this.extent=l?l.extent:4096,this.length=e.length,this.features=e}feature(e){return new Df(this.features[e],this.extent)}},l.d4=Go,l.d5=wc,l.e=ge,l.f=e=>c(void 0,void 0,void 0,(function*(){if(0===e.byteLength)return createImageBitmap(new ImageData(1,1));const l=new Blob([new Uint8Array(e)],{type:"image/png"});try{return createImageBitmap(l)}catch(e){throw new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),l.g=at,l.h=e=>new Promise(((l,c)=>{const d=new Image;d.onload=()=>{l(d),URL.revokeObjectURL(d.src),d.onload=null,window.requestAnimationFrame((()=>{d.src=Ne}))},d.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(e)],{type:"image/png"});d.src=e.byteLength?URL.createObjectURL(p):Ne})),l.i=Ee,l.j=(e,l)=>yt(ge(e,{type:"json"}),l),l.k=gt,l.l=mt,l.m=yt,l.n=(e,l)=>yt(ge(e,{type:"arrayBuffer"}),l),l.o=function(e){return new Tc(e).readFields(fp,[])},l.p=gp,l.q=function(e){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(e))},l.r=_l,l.s=$e,l.t=Hs,l.u=Tt,l.v=$l,l.w=Se,l.x=Os,l.y=Hl,l.z=Mc}));d("worker",["./shared"],(function(e){class t{constructor(e,l){this.keyCache={},e&&this.replace(e,l)}replace(e,l){this._layerConfigs={},this._layers={},this.update(e,[],l)}update(l,c,d){for(const c of l){this._layerConfigs[c.id]=c;const l=this._layers[c.id]=e.bT(c,d);l._featureFilter=e.aj(l.filter,d),this.keyCache[c.id]&&delete this.keyCache[c.id]}for(const e of c)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const p=e.cM(Object.values(this._layerConfigs),this.keyCache);for(const l of p){const c=l.map((e=>this._layers[e.id])),d=c[0];if(d.isHidden())continue;const p=d.source||"";let f=this.familiesBySource[p];f||(f=this.familiesBySource[p]={});const m=d.sourceLayer||e.ai;let _=f[m];_||(_=f[m]=[]),_.push(c)}}}class o{constructor(l){const c={},d=[];for(const e in l){const p=l[e],f=c[e]={};for(const e in p){const l=p[+e];if(!l||0===l.bitmap.width||0===l.bitmap.height)continue;const c={x:0,y:0,w:l.bitmap.width+2,h:l.bitmap.height+2};d.push(c),f[e]={rect:c,metrics:l.metrics}}}const{w:p,h:f}=e.p(d),m=new e.r({width:p||1,height:f||1});for(const d in l){const p=l[d];for(const l in p){const f=p[+l];if(!f||0===f.bitmap.width||0===f.bitmap.height)continue;const _=c[d][l].rect;e.r.copy(f.bitmap,m,{x:0,y:0},{x:_.x+1,y:_.y+1},f.bitmap)}}this.image=m,this.positions=c}}e.cN("GlyphAtlas",o);class s{constructor(l){this.tileID=new e.a2(l.tileID.overscaledZ,l.tileID.wrap,l.tileID.canonical.z,l.tileID.canonical.x,l.tileID.canonical.y),this.uid=l.uid,this.zoom=l.zoom,this.pixelRatio=l.pixelRatio,this.tileSize=l.tileSize,this.source=l.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=l.showCollisionBoxes,this.collectResourceTiming=!!l.collectResourceTiming,this.returnDependencies=!!l.returnDependencies,this.promoteId=l.promoteId,this.inFlightDependencies=[]}parse(c,d,p,f,m){return e._(this,void 0,void 0,(function*(){this.status="parsing",this.data=c,this.collisionBoxArray=new e.ag;const _=new e.cO(Object.keys(c.layers).sort()),g=new e.cP(this.tileID,this.promoteId);g.bucketLayerIDs=[];const y={},b={featureIndex:g,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:p,subdivisionGranularity:m},T=d.familiesBySource[this.source];for(const d in T){const f=c.layers[d];if(!f)continue;1===f.version&&e.w(`Vector tile source "${this.source}" layer "${d}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const m=_.encode(d),S=[];for(let e=0;e<f.length;e++){const l=f.feature(e),c=g.getId(l,d);S.push({feature:l,id:c,index:e,sourceLayerIndex:m})}for(const c of T[d]){const d=c[0];d.source!==this.source&&e.w(`layer.source = ${d.source} does not equal this.source = ${this.source}`),d.isHidden(this.zoom,!0)||(l(c,this.zoom,p),(y[d.id]=d.createBucket({index:g.bucketLayerIDs.length,layers:c,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:m,sourceID:this.source})).populate(S,b,this.tileID.canonical),g.bucketLayerIDs.push(c.map((e=>e.id))))}}const S=e.bY(b.glyphDependencies,(e=>Object.keys(e).map(Number)));this.inFlightDependencies.forEach((e=>null==e?void 0:e.abort())),this.inFlightDependencies=[];let P=Promise.resolve({});if(Object.keys(S).length){const e=new AbortController;this.inFlightDependencies.push(e),P=f.sendAsync({type:"GG",data:{stacks:S,source:this.source,tileID:this.tileID,type:"glyphs"}},e)}const I=Object.keys(b.iconDependencies);let C=Promise.resolve({});if(I.length){const e=new AbortController;this.inFlightDependencies.push(e),C=f.sendAsync({type:"GI",data:{icons:I,source:this.source,tileID:this.tileID,type:"icons"}},e)}const R=Object.keys(b.patternDependencies);let L=Promise.resolve({});if(R.length){const e=new AbortController;this.inFlightDependencies.push(e),L=f.sendAsync({type:"GI",data:{icons:R,source:this.source,tileID:this.tileID,type:"patterns"}},e)}const F=b.dashDependencies;let B=Promise.resolve({});if(Object.keys(F).length){const e=new AbortController;this.inFlightDependencies.push(e),B=f.sendAsync({type:"GDA",data:{dashes:F}},e)}const[O,V,j,G]=yield Promise.all([P,C,L,B]),U=new o(O),q=new e.cQ(V,j);for(const c in y){const d=y[c];d instanceof e.ah?(l(d.layers,this.zoom,p),e.cR({bucket:d,glyphMap:O,glyphPositions:U.positions,imageMap:V,imagePositions:q.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:b.subdivisionGranularity})):d.hasDependencies&&(d instanceof e.cS||d instanceof e.cT||d instanceof e.cU)&&(l(d.layers,this.zoom,p),d.addFeatures(b,this.tileID.canonical,q.patternPositions,G))}return this.status="done",{buckets:Object.values(y).filter((e=>!e.isEmpty())),featureIndex:g,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:U.image,imageAtlas:q,dashPositions:G,glyphMap:this.returnDependencies?O:null,iconMap:this.returnDependencies?V:null,glyphPositions:this.returnDependencies?U.positions:null}}))}}function l(l,c,d){const p=new e.H(c);for(const e of l)e.recalculate(p,d)}class n{constructor(e,l,c,d,p){this.type=e,this.properties=c||{},this.extent=p,this.pointsArray=l,this.id=d}loadGeometry(){return this.pointsArray.map((l=>l.map((l=>new e.P(l.x,l.y)))))}}class r{constructor(e,l,c){this.version=2,this._myFeatures=e,this.name=l,this.length=e.length,this.extent=c}feature(e){return this._myFeatures[e]}}class a{constructor(){this.layers={}}addLayer(e){this.layers[e.name]=e}}function c(l){let c=e.cV(l);return 0===c.byteOffset&&c.byteLength===c.buffer.byteLength||(c=new Uint8Array(c)),{vectorTile:l,rawData:c.buffer}}function d(l,c,d){const{extent:p}=l,f=Math.pow(2,d.z-c.z),m=(d.x-c.x*f)*p,_=(d.y-c.y*f)*p,g=[];for(let c=0;c<l.length;c++){const d=l.feature(c);let y=d.loadGeometry();for(const e of y)for(const l of e)l.x=l.x*f-m,l.y=l.y*f-_;const b=128;y=e.cW(y,d.type,-b,-b,p+b,p+b),0!==y.length&&g.push(new n(d.type,y,d.properties,d.id,p))}return new r(g,l.name,p)}class h{constructor(l,c,d){this.actor=l,this.layerIndex=c,this.availableImages=d,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new e.cX(1e3)}loadVectorTile(l,c){return e._(this,void 0,void 0,(function*(){const d=yield e.n(l.request,c);try{return{vectorTile:"mlt"!==l.encoding?new e.cY(new e.cZ(d.data)):new e.c_(d.data),rawData:d.data,cacheControl:d.cacheControl,expires:d.expires}}catch(e){const c=new Uint8Array(d.data);let p=`Unable to parse the tile at ${l.request.url}, `;throw p+=31===c[0]&&139===c[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${e.message}`,new Error(p)}}))}loadTile(l){return e._(this,void 0,void 0,(function*(){const{uid:c,overzoomParameters:d}=l;d&&(l.request=d.overzoomRequest);const p=!!(l&&l.request&&l.request.collectResourceTiming)&&new e.c$(l.request),f=new s(l);this.loading[c]=f;const m=new AbortController;f.abort=m;try{const _=yield this.loadVectorTile(l,m);if(delete this.loading[c],!_)return null;if(d){const e=this._getOverzoomTile(l,_.vectorTile);_.rawData=e.rawData,_.vectorTile=e.vectorTile}const g=_.rawData,y={};_.expires&&(y.expires=_.expires),_.cacheControl&&(y.cacheControl=_.cacheControl);const b={};if(p){const e=p.finish();e&&(b.resourceTiming=JSON.parse(JSON.stringify(e)))}f.vectorTile=_.vectorTile;const T=f.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,l.subdivisionGranularity);this.loaded[c]=f,this.fetching[c]={rawTileData:g,cacheControl:y,resourceTiming:b};try{const c=yield T;return e.e({rawTileData:g.slice(0),encoding:l.encoding},c,y,b)}finally{delete this.fetching[c]}}catch(e){throw delete this.loading[c],f.status="done",this.loaded[c]=f,e}}))}_getOverzoomTile(e,l){const{tileID:p,source:f,overzoomParameters:m}=e,{maxZoomTileID:_}=m,g=`${_.key}_${p.key}`,y=this.overzoomedTileResultCache.get(g);if(y)return y;const b=new a,T=this.layerIndex.familiesBySource[f];for(const e in T){const c=l.layers[e];if(!c)continue;const f=d(c,_,p.canonical);f.length>0&&b.addLayer(f)}const S=c(b);return this.overzoomedTileResultCache.set(g,S),S}reloadTile(l){return e._(this,void 0,void 0,(function*(){const c=l.uid;if(!this.loaded||!this.loaded[c])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const d=this.loaded[c];if(d.showCollisionBoxes=l.showCollisionBoxes,"parsing"===d.status){const p=yield d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,l.subdivisionGranularity);let f;if(this.fetching[c]){const{rawTileData:d,cacheControl:m,resourceTiming:_}=this.fetching[c];delete this.fetching[c],f=e.e({rawTileData:d.slice(0),encoding:l.encoding},p,m,_)}else f=p;return f}if("done"===d.status&&d.vectorTile)return d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,l.subdivisionGranularity)}))}abortTile(l){return e._(this,void 0,void 0,(function*(){const e=this.loading,c=l.uid;e&&e[c]&&e[c].abort&&(e[c].abort.abort(),delete e[c])}))}removeTile(l){return e._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[l.uid]&&delete this.loaded[l.uid]}))}}class u{constructor(){this.loaded={}}loadTile(l){return e._(this,void 0,void 0,(function*(){const{uid:c,encoding:d,rawImageData:p,redFactor:f,greenFactor:m,blueFactor:_,baseShift:g}=l,y=p.width+2,b=p.height+2,T=e.b(p)?new e.R({width:y,height:b},yield e.d0(p,-1,-1,y,b)):p,S=new e.d1(c,T,d,f,m,_,g);return this.loaded=this.loaded||{},this.loaded[c]=S,S}))}removeTile(e){const l=this.loaded,c=e.uid;l&&l[c]&&delete l[c]}}var p,f,m=function(){if(f)return p;function e(e,c){if(0!==e.length){l(e[0],c);for(var d=1;d<e.length;d++)l(e[d],!c)}}function l(e,l){for(var c=0,d=0,p=0,f=e.length,m=f-1;p<f;m=p++){var _=(e[p][0]-e[m][0])*(e[m][1]+e[p][1]),g=c+_;d+=Math.abs(c)>=Math.abs(_)?c-g+_:_-g+c,c=g}c+d>=0!=!!l&&e.reverse()}return f=1,p=function l(c,d){var p,f=c&&c.type;if("FeatureCollection"===f)for(p=0;p<c.features.length;p++)l(c.features[p],d);else if("GeometryCollection"===f)for(p=0;p<c.geometries.length;p++)l(c.geometries[p],d);else if("Feature"===f)l(c.geometry,d);else if("Polygon"===f)e(c.coordinates,d);else if("MultiPolygon"===f)for(p=0;p<c.coordinates.length;p++)e(c.coordinates[p],d);return c}}(),_=e.d2(m);const g={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},y=Math.fround||(b=new Float32Array(1),e=>(b[0]=+e,b[0]));var b;class x{constructor(e){this.options=Object.assign(Object.create(g),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:l,minZoom:c,maxZoom:d}=this.options;l&&console.time("total time");const p=`prepare ${e.length} points`;l&&console.time(p),this.points=e;const f=[];for(let l=0;l<e.length;l++){const c=e[l];if(!c.geometry)continue;const[d,p]=c.geometry.coordinates,m=y(P(d)),_=y(I(p));f.push(m,_,1/0,l,-1,1),this.options.reduce&&f.push(0)}let m=this.trees[d+1]=this._createTree(f);l&&console.timeEnd(p);for(let e=d;e>=c;e--){const c=+Date.now();m=this.trees[e]=this._createTree(this._cluster(m,e)),l&&console.log("z%d: %d clusters in %dms",e,m.numItems,+Date.now()-c)}return l&&console.timeEnd("total time"),this}getClusters(e,l){let c=((e[0]+180)%360+360)%360-180;const d=Math.max(-90,Math.min(90,e[1]));let p=180===e[2]?180:((e[2]+180)%360+360)%360-180;const f=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)c=-180,p=180;else if(c>p){const e=this.getClusters([c,d,180,f],l),m=this.getClusters([-180,d,p,f],l);return e.concat(m)}const m=this.trees[this._limitZoom(l)],_=m.range(P(c),I(f),P(p),I(d)),g=m.data,y=[];for(const e of _){const l=this.stride*e;y.push(g[l+5]>1?T(g,l,this.clusterProps):this.points[g[l+3]])}return y}getChildren(e){const l=this._getOriginId(e),c=this._getOriginZoom(e),d="No cluster with the specified id.",p=this.trees[c];if(!p)throw new Error(d);const f=p.data;if(l*this.stride>=f.length)throw new Error(d);const m=this.options.radius/(this.options.extent*Math.pow(2,c-1)),_=p.within(f[l*this.stride],f[l*this.stride+1],m),g=[];for(const l of _){const c=l*this.stride;f[c+4]===e&&g.push(f[c+5]>1?T(f,c,this.clusterProps):this.points[f[c+3]])}if(0===g.length)throw new Error(d);return g}getLeaves(e,l,c){const d=[];return this._appendLeaves(d,e,l=l||10,c=c||0,0),d}getTile(e,l,c){const d=this.trees[this._limitZoom(e)],p=Math.pow(2,e),{extent:f,radius:m}=this.options,_=m/f,g=(c-_)/p,y=(c+1+_)/p,b={features:[]};return this._addTileFeatures(d.range((l-_)/p,g,(l+1+_)/p,y),d.data,l,c,p,b),0===l&&this._addTileFeatures(d.range(1-_/p,g,1,y),d.data,p,c,p,b),l===p-1&&this._addTileFeatures(d.range(0,g,_/p,y),d.data,-1,c,p,b),b.features.length?b:null}getClusterExpansionZoom(e){let l=this._getOriginZoom(e)-1;for(;l<=this.options.maxZoom;){const c=this.getChildren(e);if(l++,1!==c.length)break;e=c[0].properties.cluster_id}return l}_appendLeaves(e,l,c,d,p){const f=this.getChildren(l);for(const l of f){const f=l.properties;if(f&&f.cluster?p+f.point_count<=d?p+=f.point_count:p=this._appendLeaves(e,f.cluster_id,c,d,p):p<d?p++:e.push(l),e.length===c)break}return p}_createTree(l){const c=new e.aT(l.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<l.length;e+=this.stride)c.add(l[e],l[e+1]);return c.finish(),c.data=l,c}_addTileFeatures(e,l,c,d,p,f){for(const m of e){const e=m*this.stride,_=l[e+5]>1;let g,y,b;if(_)g=S(l,e,this.clusterProps),y=l[e],b=l[e+1];else{const c=this.points[l[e+3]];g=c.properties;const[d,p]=c.geometry.coordinates;y=P(d),b=I(p)}const T={type:1,geometry:[[Math.round(this.options.extent*(y*p-c)),Math.round(this.options.extent*(b*p-d))]],tags:g};let C;C=_||this.options.generateId?l[e+3]:this.points[l[e+3]].id,void 0!==C&&(T.id=C),f.features.push(T)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,l){const{radius:c,extent:d,reduce:p,minPoints:f}=this.options,m=c/(d*Math.pow(2,l)),_=e.data,g=[],y=this.stride;for(let c=0;c<_.length;c+=y){if(_[c+2]<=l)continue;_[c+2]=l;const d=_[c],b=_[c+1],T=e.within(_[c],_[c+1],m),S=_[c+5];let P=S;for(const e of T){const c=e*y;_[c+2]>l&&(P+=_[c+5])}if(P>S&&P>=f){let e,f=d*S,m=b*S,I=-1;const C=(c/y<<5)+(l+1)+this.points.length;for(const d of T){const g=d*y;if(_[g+2]<=l)continue;_[g+2]=l;const b=_[g+5];f+=_[g]*b,m+=_[g+1]*b,_[g+4]=C,p&&(e||(e=this._map(_,c,!0),I=this.clusterProps.length,this.clusterProps.push(e)),p(e,this._map(_,g)))}_[c+4]=C,g.push(f/P,m/P,1/0,C,-1,P),p&&g.push(I)}else{for(let e=0;e<y;e++)g.push(_[c+e]);if(P>1)for(const e of T){const c=e*y;if(!(_[c+2]<=l)){_[c+2]=l;for(let e=0;e<y;e++)g.push(_[c+e])}}}}return g}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,l,c){if(e[l+5]>1){const d=this.clusterProps[e[l+6]];return c?Object.assign({},d):d}const d=this.points[e[l+3]].properties,p=this.options.map(d);return c&&p===d?Object.assign({},p):p}}function T(e,l,c){return{type:"Feature",id:e[l+3],properties:S(e,l,c),geometry:{type:"Point",coordinates:[(d=e[l],360*(d-.5)),C(e[l+1])]}};var d}function S(e,l,c){const d=e[l+5],p=d>=1e4?`${Math.round(d/1e3)}k`:d>=1e3?Math.round(d/100)/10+"k":d,f=e[l+6],m=-1===f?{}:Object.assign({},c[f]);return Object.assign(m,{cluster:!0,cluster_id:e[l+3],point_count:d,point_count_abbreviated:p})}function P(e){return e/360+.5}function I(e){const l=Math.sin(e*Math.PI/180),c=.5-.25*Math.log((1+l)/(1-l))/Math.PI;return c<0?0:c>1?1:c}function C(e){const l=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(l))/Math.PI-90}function R(e,l,c,d){let p=d;const f=l+(c-l>>1);let m,_=c-l;const g=e[l],y=e[l+1],b=e[c],T=e[c+1];for(let d=l+3;d<c;d+=3){const l=L(e[d],e[d+1],g,y,b,T);if(l>p)m=d,p=l;else if(l===p){const e=Math.abs(d-f);e<_&&(m=d,_=e)}}p>d&&(m-l>3&&R(e,l,m,d),e[m+2]=p,c-m>3&&R(e,m,c,d))}function L(e,l,c,d,p,f){let m=p-c,_=f-d;if(0!==m||0!==_){const g=((e-c)*m+(l-d)*_)/(m*m+_*_);g>1?(c=p,d=f):g>0&&(c+=m*g,d+=_*g)}return m=e-c,_=l-d,m*m+_*_}function F(e,l,c,d){const p={type:l,geom:c},f={id:null==e?null:e,type:p.type,geometry:p.geom,tags:d,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};switch(p.type){case"Point":case"MultiPoint":case"LineString":B(f,p.geom);break;case"Polygon":B(f,p.geom[0]);break;case"MultiLineString":for(const e of p.geom)B(f,e);break;case"MultiPolygon":for(const e of p.geom)B(f,e[0])}return f}function B(e,l){for(let c=0;c<l.length;c+=3)e.minX=Math.min(e.minX,l[c]),e.minY=Math.min(e.minY,l[c+1]),e.maxX=Math.max(e.maxX,l[c]),e.maxY=Math.max(e.maxY,l[c+1])}function O(e,l){const c=[];switch(e.type){case"FeatureCollection":for(let d=0;d<e.features.length;d++)V(c,e.features[d],l,d);break;case"Feature":V(c,e,l);break;default:V(c,{geometry:e,properties:void 0},l)}return c}function V(e,l,c,d){if(!l.geometry)return;if("GeometryCollection"===l.geometry.type){for(const p of l.geometry.geometries)V(e,{id:l.id,geometry:p,properties:l.properties},c,d);return}const p=l.geometry.coordinates;if(!p?.length)return;const f=Math.pow(c.tolerance/((1<<c.maxZoom)*c.extent),2);let m=l.id;switch(c.promoteId?m=l.properties?.[c.promoteId]:c.generateId&&(m=d||0),l.geometry.type){case"Point":{const c=[];return j(l.geometry.coordinates,c),void e.push(F(m,l.geometry.type,c,l.properties))}case"MultiPoint":{const c=[];for(const e of l.geometry.coordinates)j(e,c);return void e.push(F(m,l.geometry.type,c,l.properties))}case"LineString":{const c=[];return G(l.geometry.coordinates,c,f,!1),void e.push(F(m,l.geometry.type,c,l.properties))}case"MultiLineString":{if(c.lineMetrics){for(const c of l.geometry.coordinates){const d=[];G(c,d,f,!1),e.push(F(m,"LineString",d,l.properties))}return}const d=[];return U(l.geometry.coordinates,d,f,!1),void e.push(F(m,l.geometry.type,d,l.properties))}case"Polygon":{const c=[];return U(l.geometry.coordinates,c,f,!0),void e.push(F(m,l.geometry.type,c,l.properties))}case"MultiPolygon":{const c=[];for(const e of l.geometry.coordinates){const l=[];U(e,l,f,!0),c.push(l)}return void e.push(F(m,l.geometry.type,c,l.properties))}default:throw new Error("Input data is not a valid GeoJSON object.")}}function j(e,l){l.push(q(e[0]),Z(e[1]),0)}function G(e,l,c,d){let p,f,m=0;for(let c=0;c<e.length;c++){const _=q(e[c][0]),g=Z(e[c][1]);l.push(_,g,0),c>0&&(m+=d?(p*g-_*f)/2:Math.sqrt(Math.pow(_-p,2)+Math.pow(g-f,2))),p=_,f=g}const _=l.length-3;l[2]=1,c>0&&R(l,0,_,c),l[_+2]=1,l.size=Math.abs(m),l.start=0,l.end=l.size}function U(e,l,c,d){for(let p=0;p<e.length;p++){const f=[];G(e[p],f,c,d),l.push(f)}}function q(e){return e/360+.5}function Z(e){const l=Math.sin(e*Math.PI/180),c=.5-.25*Math.log((1+l)/(1-l))/Math.PI;return c<0?0:c>1?1:c}function W(e,l,c,d,p,f,m,_){if(d/=l,f>=(c/=l)&&m<d)return e;if(m<c||f>=d)return null;const g=[];for(const l of e){const e=0===p?l.minX:l.minY,f=0===p?l.maxX:l.maxY;if(e>=c&&f<d)g.push(l);else if(!(f<c||e>=d))switch(l.type){case"Point":case"MultiPoint":{const e=[];if(Q(l.geometry,e,c,d,p),!e.length)continue;g.push(F(l.id,3===e.length?"Point":"MultiPoint",e,l.tags));continue}case"LineString":{const e=[];if(J(l.geometry,e,c,d,p,!1,_.lineMetrics),!e.length)continue;if(_.lineMetrics){for(const c of e)g.push(F(l.id,l.type,c,l.tags));continue}if(e.length>1){g.push(F(l.id,"MultiLineString",e,l.tags));continue}g.push(F(l.id,l.type,e[0],l.tags));continue}case"MultiLineString":{const e=[];if(oe(l.geometry,e,c,d,p,!1),!e.length)continue;if(1===e.length){g.push(F(l.id,"LineString",e[0],l.tags));continue}g.push(F(l.id,l.type,e,l.tags));continue}case"Polygon":{const e=[];if(oe(l.geometry,e,c,d,p,!0),!e.length)continue;g.push(F(l.id,l.type,e,l.tags));continue}case"MultiPolygon":{const e=[];for(const f of l.geometry){const l=[];oe(f,l,c,d,p,!0),l.length&&e.push(l)}if(!e.length)continue;g.push(F(l.id,l.type,e,l.tags));continue}}}return g.length?g:null}function Q(e,l,c,d,p){for(let f=0;f<e.length;f+=3){const m=e[f+p];m>=c&&m<=d&&le(l,e[f],e[f+1],e[f+2])}}function J(e,l,c,d,p,f,m){let _=re(e);const g=0===p?ce:he;let y,b,T=e.start;for(let S=0;S<e.length-3;S+=3){const P=e[S],I=e[S+1],C=e[S+2],R=e[S+3],L=e[S+4],F=0===p?P:I,B=0===p?R:L;let O=!1;m&&(y=Math.sqrt(Math.pow(P-R,2)+Math.pow(I-L,2))),F<c?B>c&&(b=g(_,P,I,R,L,c),m&&(_.start=T+y*b)):F>d?B<d&&(b=g(_,P,I,R,L,d),m&&(_.start=T+y*b)):le(_,P,I,C),B<c&&F>=c&&(b=g(_,P,I,R,L,c),O=!0),B>d&&F<=d&&(b=g(_,P,I,R,L,d),O=!0),!f&&O&&(m&&(_.end=T+y*b),l.push(_),_=re(e)),m&&(T+=y)}let S=e.length-3;const P=e[S],I=e[S+1],C=0===p?P:I;C>=c&&C<=d&&le(_,P,I,e[S+2]),S=_.length-3,f&&S>=3&&(_[S]!==_[0]||_[S+1]!==_[1])&&le(_,_[0],_[1],_[2]),_.length&&l.push(_)}function re(e){const l=[];return l.size=e.size,l.start=e.start,l.end=e.end,l}function oe(e,l,c,d,p,f){for(const m of e)J(m,l,c,d,p,f,!1)}function le(e,l,c,d){e.push(l,c,d)}function ce(e,l,c,d,p,f){const m=(f-l)/(d-l);return le(e,f,c+(p-c)*m,1),m}function he(e,l,c,d,p,f){const m=(f-c)/(p-c);return le(e,l+(d-l)*m,f,1),m}function ue(e,l){const c=l.buffer/l.extent;let d=e;const p=W(e,1,-1-c,c,0,-1,2,l),f=W(e,1,1-c,2+c,0,-1,2,l);return p||f?(d=W(e,1,-c,1+c,0,-1,2,l)||[],p&&(d=pe(p,1).concat(d)),f&&(d=d.concat(pe(f,-1))),d):d}function pe(e,l){const c=[];for(const d of e)switch(d.type){case"Point":case"MultiPoint":case"LineString":{const e=fe(d.geometry,l);c.push(F(d.id,d.type,e,d.tags));continue}case"MultiLineString":case"Polygon":{const e=[];for(const c of d.geometry)e.push(fe(c,l));c.push(F(d.id,d.type,e,d.tags));continue}case"MultiPolygon":{const e=[];for(const c of d.geometry){const d=[];for(const e of c)d.push(fe(e,l));e.push(d)}c.push(F(d.id,d.type,e,d.tags));continue}}return c}function fe(e,l){const c=[];c.size=e.size,void 0!==e.start&&(c.start=e.start,c.end=e.end);for(let d=0;d<e.length;d+=3)c.push(e[d]+l,e[d+1],e[d+2]);return c}function me(e,l){if(e.transformed)return e;const c=1<<e.z,d=e.x,p=e.y;for(const f of e.features){if(1===f.type){const e=[];for(let m=0;m<f.geometry.length;m+=2)e.push(ge(f.geometry[m],f.geometry[m+1],l,c,d,p));f.geometry=e;continue}const e=[];for(const m of f.geometry){const f=[];for(let e=0;e<m.length;e+=2)f.push(ge(m[e],m[e+1],l,c,d,p));e.push(f)}f.geometry=e}return e.transformed=!0,e}function ge(e,l,c,d,p,f){return[Math.round(c*(e*d-p)),Math.round(c*(l*d-f))]}function ye(e,l,c,d,p){const f=l===p.maxZoom?0:p.tolerance/((1<<l)*p.extent),m={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:c,y:d,z:l,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const l of e)xe(m,l,f,p);return m}function xe(e,l,c,d){e.minX=Math.min(e.minX,l.minX),e.minY=Math.min(e.minY,l.minY),e.maxX=Math.max(e.maxX,l.maxX),e.maxY=Math.max(e.maxY,l.maxY);let p,f=l.tags||null;switch(l.type){case"Point":case"MultiPoint":{const c=[];for(let d=0;d<l.geometry.length;d+=3)c.push(l.geometry[d],l.geometry[d+1]),e.numPoints++,e.numSimplified++;if(!c.length)return;p={type:1,tags:f,geometry:c};break}case"LineString":{const m=[];if(ve(m,l.geometry,e,c,!1,!1),!m.length)return;if(d.lineMetrics){f={};for(const e in l.tags)f[e]=l.tags[e];f.mapbox_clip_start=l.geometry.start/l.geometry.size,f.mapbox_clip_end=l.geometry.end/l.geometry.size}p={type:2,tags:f,geometry:m};break}case"MultiLineString":case"Polygon":{const d=[];for(let p=0;p<l.geometry.length;p++)ve(d,l.geometry[p],e,c,"Polygon"===l.type,0===p);if(!d.length)return;p={type:"Polygon"===l.type?3:2,tags:f,geometry:d};break}case"MultiPolygon":{const d=[];for(let p=0;p<l.geometry.length;p++){const f=l.geometry[p];for(let l=0;l<f.length;l++)ve(d,f[l],e,c,!0,0===l)}if(!d.length)return;p={type:3,tags:f,geometry:d};break}}null!==l.id&&(p.id=l.id),e.features.push(p)}function ve(e,l,c,d,p,f){const m=d*d;if(d>0&&l.size<(p?m:d))return void(c.numPoints+=l.length/3);const _=[];for(let e=0;e<l.length;e+=3)(0===d||l[e+2]>m)&&(c.numSimplified++,_.push(l[e],l[e+1])),c.numPoints++;p&&function(e,l){let c=0;for(let l=0,d=e.length,p=d-2;l<d;p=l,l+=2)c+=(e[l]-e[p])*(e[l+1]+e[p+1]);if(c>0===l)for(let l=0,c=e.length;l<c/2;l+=2){const d=e[l],p=e[l+1];e[l]=e[c-2-l],e[l+1]=e[c-1-l],e[c-2-l]=d,e[c-1-l]=p}}(_,f),e.push(_)}function be(e,l,c){const d=!!l.newGeometry,p=l.removeAllProperties||l.removeProperties?.length>0||l.addOrUpdateProperties?.length>0;if(d){let d=O({type:"FeatureCollection",features:[{type:"Feature",id:e.id,geometry:l.newGeometry,properties:p?we(e.tags,l):e.tags}]},c);return d=ue(d,c),d[0]}if(p){const c={...e};return c.tags=we(c.tags,l),c}return null}function we(e,l){if(l.removeAllProperties)return{};const c={...e||{}};if(l.removeProperties)for(const e of l.removeProperties)delete c[e];if(l.addOrUpdateProperties)for(const{key:e,value:d}of l.addOrUpdateProperties)c[e]=d;return c}const Se={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,updateable:!1,debug:0};class te{options;tiles;tileCoords;stats={};total=0;source;constructor(e,l){const c=(l=this.options=Object.assign({},Se,l)).debug;if(c&&console.time("preprocess data"),l.maxZoom<0||l.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(l.promoteId&&l.generateId)throw new Error("promoteId and generateId cannot be used together.");let d=O(e,l);this.tiles={},this.tileCoords=[],c&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",l.indexMaxZoom,l.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),d=ue(d,l),d.length&&this.splitTile(d,0,0,0),l.updateable&&(this.source=d),c&&(d.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,l,c,d,p,f,m){const _=[e,l,c,d],g=this.options,y=g.debug;for(;_.length;){d=_.pop(),c=_.pop(),l=_.pop(),e=_.pop();const b=1<<l,T=Me(l,c,d);let S=this.tiles[T];if(!S&&(y>1&&console.time("creation"),S=this.tiles[T]=ye(e,l,c,d,g),this.tileCoords.push({z:l,x:c,y:d,id:T}),y)){y>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",l,c,d,S.numFeatures,S.numPoints,S.numSimplified),console.timeEnd("creation"));const e=`z${l}`;this.stats[e]=(this.stats[e]||0)+1,this.total++}if(S.source=e,null==p){if(l===g.indexMaxZoom||S.numPoints<=g.indexMaxPoints)continue}else{if(l===g.maxZoom||l===p)continue;if(null!=p){const e=p-l;if(c!==f>>e||d!==m>>e)continue}}if(S.source=null,!e.length)continue;y>1&&console.time("clipping");const P=.5*g.buffer/g.extent,I=.5-P,C=.5+P,R=1+P;let L=null,F=null,B=null,O=null;const V=W(e,b,c-P,c+C,0,S.minX,S.maxX,g),j=W(e,b,c+I,c+R,0,S.minX,S.maxX,g);V&&(L=W(V,b,d-P,d+C,1,S.minY,S.maxY,g),F=W(V,b,d+I,d+R,1,S.minY,S.maxY,g)),j&&(B=W(j,b,d-P,d+C,1,S.minY,S.maxY,g),O=W(j,b,d+I,d+R,1,S.minY,S.maxY,g)),y>1&&console.timeEnd("clipping"),_.push(L||[],l+1,2*c,2*d),_.push(F||[],l+1,2*c,2*d+1),_.push(B||[],l+1,2*c+1,2*d),_.push(O||[],l+1,2*c+1,2*d+1)}}getTile(e,l,c){e=+e,l=+l,c=+c;const d=this.options,{extent:p,debug:f}=d;if(e<0||e>24)return null;const m=1<<e,_=Me(e,l=l+m&m-1,c);if(this.tiles[_])return me(this.tiles[_],p);f>1&&console.log("drilling down to z%d-%d-%d",e,l,c);let g,y=e,b=l,T=c;for(;!g&&y>0;)y--,b>>=1,T>>=1,g=this.tiles[Me(y,b,T)];return g?.source?(f>1&&(console.log("found parent tile z%d-%d-%d",y,b,T),console.time("drilling down")),this.splitTile(g.source,y,b,T,e,l,c),f>1&&console.timeEnd("drilling down"),this.tiles[_]?me(this.tiles[_],p):null):null}invalidateTiles(e){const l=this.options,{debug:c}=l;let d=1/0,p=-1/0,f=1/0,m=-1/0;for(const l of e)d=Math.min(d,l.minX),p=Math.max(p,l.maxX),f=Math.min(f,l.minY),m=Math.max(m,l.maxY);const _=l.buffer/l.extent,g=new Set;for(const l in this.tiles){const y=this.tiles[l],b=1<<y.z,T=(y.x-_)/b,S=(y.x+1+_)/b,P=(y.y-_)/b,I=(y.y+1+_)/b;if(p<T||d>=S||m<P||f>=I)continue;let C=!1;for(const l of e)if(l.maxX>=T&&l.minX<S&&l.maxY>=P&&l.minY<I){C=!0;break}if(C){if(c){c>1&&console.log("invalidate tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",y.z,y.x,y.y,y.numFeatures,y.numPoints,y.numSimplified);const e=`z${y.z}`;this.stats[e]=(this.stats[e]||0)-1,this.total--}delete this.tiles[l],g.add(l)}}g.size&&(this.tileCoords=this.tileCoords.filter((e=>!g.has(e.id))))}updateData(e){const l=this.options,c=l.debug;if(!l.updateable)throw new Error("to update tile geojson `updateable` option must be set to true");const{affected:d,source:p}=function(e,l,c){const d=function(e){return e?{removeAll:e.removeAll,remove:new Set(e.remove||[]),add:new Map(e.add?.map((e=>[e.id,e]))),update:new Map(e.update?.map((e=>[e.id,e])))}:{remove:new Set,add:new Map,update:new Map}}(l);let p=[];if(d.removeAll&&(p=e,e=[]),d.remove.size||d.add.size){const l=[];for(const c of e){const{id:e}=c;(d.remove.has(e)||d.add.has(e))&&l.push(c)}if(l.length){p.push(...l);const c=new Set(l.map((e=>e.id)));e=e.filter((e=>!c.has(e.id)))}if(d.add.size){let l=O({type:"FeatureCollection",features:Array.from(d.add.values())},c);l=ue(l,c),p.push(...l),e.push(...l)}}if(d.update.size)for(const[l,f]of d.update){const d=e.findIndex((e=>e.id===l));if(-1===d)continue;const m=e[d],_=be(m,f,c);_&&(p.push(m,_),e[d]=_)}return{affected:p,source:e}}(this.source,e,l);if(!d.length)return;this.source=p,c>1&&(console.log("invalidating tiles"),console.time("invalidating")),this.invalidateTiles(d),c>1&&console.timeEnd("invalidating");const[f,m,_]=[0,0,0],g=ye(this.source,f,m,_,this.options);g.source=this.source;const y=Me(f,m,_);if(this.tiles[y]=g,this.tileCoords.push({z:f,x:m,y:_,id:y}),c){const e=`z${f}`;this.stats[e]=(this.stats[e]||0)+1,this.total++}}}function Me(e,l,c){return 32*((1<<e)*c+l)+e}class se extends h{constructor(e,l,c,d=Ee){super(e,l,c),this._dataUpdateable=new Map,this._createGeoJSONIndex=d}loadVectorTile(l,d){return e._(this,void 0,void 0,(function*(){const d=l.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const p=this._geoJSONIndex.getTile(d.z,d.x,d.y);return p?c(new e.d3(p.features,{version:2,extent:e.a5})):null}))}loadData(l){return e._(this,void 0,void 0,(function*(){var c;null===(c=this._pendingRequest)||void 0===c||c.abort();const d=this._startPerformance(l);this._pendingRequest=new AbortController;try{(!this._pendingData||l.request||l.data||l.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(l,this._pendingRequest));const e=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(e,l),this.loaded={};const c={};return l.request&&(c.data=e),this._finishPerformance(d,l,c),c}catch(l){if(delete this._pendingRequest,e.Z(l))return{abandoned:!0};throw l}}))}_startPerformance(l){var c;if(null===(c=null==l?void 0:l.request)||void 0===c?void 0:c.collectResourceTiming)return new e.c$(l.request)}_finishPerformance(e,l,c){if(!e)return;const d=e.finish();d&&(c.resourceTiming={},c.resourceTiming[l.source]=JSON.parse(JSON.stringify(d)))}getData(){return e._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(e){const l=this.loaded;return l&&l[e.uid]?super.reloadTile(e):this.loadTile(e)}loadAndProcessGeoJSON(l,c){return e._(this,void 0,void 0,(function*(){let e;if(l.request?e=yield this.loadGeoJSONFromUrl(l.request,l.promoteId,c):l.data?e=this._loadGeoJSONFromObject(l.data,l.promoteId):l.dataDiff&&(e=this._loadGeoJSONFromDiff(l.dataDiff,l.promoteId,l.source)),delete this._pendingRequest,"object"!=typeof e)throw new Error(`Input data given to '${l.source}' is not a valid GeoJSON object.`);return _(e,!0),l.filter&&(e=this._filterGeoJSON(e,l.filter)),e}))}loadGeoJSONFromUrl(l,c,d){return e._(this,void 0,void 0,(function*(){const p=yield e.j(l,d);return this._dataUpdateable=e.a7(p.data,c),p.data}))}_loadGeoJSONFromObject(l,c){return this._dataUpdateable=e.a7(l,c),l}_loadGeoJSONFromDiff(l,c,d){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${d}`);e.a8(this._dataUpdateable,l,c);const p=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(p)}_filterGeoJSON(l,c){const d=e.d4(c,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===d.result)throw new Error(d.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const p=l.features.filter((e=>d.value.evaluate({zoom:0},e)));return this._toFeatureCollection(p)}_toFeatureCollection(e){return{type:"FeatureCollection",features:e}}removeSource(l){return e._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(e){return this._geoJSONIndex.getClusterExpansionZoom(e.clusterId)}getClusterChildren(e){return this._geoJSONIndex.getChildren(e.clusterId)}getClusterLeaves(e){return this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset)}}function Ee(l,c){return c.cluster?new x(function({superclusterOptions:l,clusterProperties:c}){if(!c||!l)return l;const d={},p={},f={accumulated:null,zoom:0},m={properties:null},_=Object.keys(c);for(const l of _){const[f,m]=c[l],_=e.d4(m),g=e.d4("string"==typeof f?[f,["accumulated"],["get",l]]:f);d[l]=_.value,p[l]=g.value}return l.map=e=>{m.properties=e;const l={};for(const e of _)l[e]=d[e].evaluate(f,m);return l},l.reduce=(e,l)=>{m.properties=l;for(const l of _)f.accumulated=e[l],e[l]=p[l].evaluate(f,m)},l}(c)).load(l.features):function(e,l){return new te(e,l)}(l,c.geojsonVtOptions)}class ne{constructor(l){this.self=l,this.actor=new e.L(l),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(e,l)=>{if(this.externalWorkerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.externalWorkerSourceTypes[e]=l},this.self.addProtocol=e.cK,this.self.removeProtocol=e.cL,this.self.registerRTLTextPlugin=l=>{e.d5.setMethods(l)},this.actor.registerMessageHandler("LDT",((e,l)=>this._getDEMWorkerSource(e,l.source).loadTile(l))),this.actor.registerMessageHandler("RDT",((l,c)=>e._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(l,c.source).removeTile(c)})))),this.actor.registerMessageHandler("GCEZ",((l,c)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(l,c.type,c.source).getClusterExpansionZoom(c)})))),this.actor.registerMessageHandler("GCC",((l,c)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(l,c.type,c.source).getClusterChildren(c)})))),this.actor.registerMessageHandler("GCL",((l,c)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(l,c.type,c.source).getClusterLeaves(c)})))),this.actor.registerMessageHandler("LD",((e,l)=>this._getWorkerSource(e,l.type,l.source).loadData(l))),this.actor.registerMessageHandler("GD",((e,l)=>this._getWorkerSource(e,l.type,l.source).getData())),this.actor.registerMessageHandler("LT",((e,l)=>this._getWorkerSource(e,l.type,l.source).loadTile(l))),this.actor.registerMessageHandler("RT",((e,l)=>this._getWorkerSource(e,l.type,l.source).reloadTile(l))),this.actor.registerMessageHandler("AT",((e,l)=>this._getWorkerSource(e,l.type,l.source).abortTile(l))),this.actor.registerMessageHandler("RMT",((e,l)=>this._getWorkerSource(e,l.type,l.source).removeTile(l))),this.actor.registerMessageHandler("RS",((l,c)=>e._(this,void 0,void 0,(function*(){if(!this.workerSources[l]||!this.workerSources[l][c.type]||!this.workerSources[l][c.type][c.source])return;const e=this.workerSources[l][c.type][c.source];delete this.workerSources[l][c.type][c.source],void 0!==e.removeSource&&e.removeSource(c)})))),this.actor.registerMessageHandler("RM",(l=>e._(this,void 0,void 0,(function*(){delete this.layerIndexes[l],delete this.availableImages[l],delete this.workerSources[l],delete this.demWorkerSources[l],this.globalStates.delete(l)})))),this.actor.registerMessageHandler("SR",((l,c)=>e._(this,void 0,void 0,(function*(){this.referrer=c})))),this.actor.registerMessageHandler("SRPS",((e,l)=>this._syncRTLPluginState(e,l))),this.actor.registerMessageHandler("IS",((l,c)=>e._(this,void 0,void 0,(function*(){this.self.importScripts(c)})))),this.actor.registerMessageHandler("SI",((e,l)=>this._setImages(e,l))),this.actor.registerMessageHandler("UL",((l,c)=>e._(this,void 0,void 0,(function*(){this._getLayerIndex(l).update(c.layers,c.removedIds,this._getGlobalState(l))})))),this.actor.registerMessageHandler("UGS",((l,c)=>e._(this,void 0,void 0,(function*(){const e=this._getGlobalState(l);for(const l in c)e[l]=c[l]})))),this.actor.registerMessageHandler("SL",((l,c)=>e._(this,void 0,void 0,(function*(){this._getLayerIndex(l).replace(c,this._getGlobalState(l))}))))}_getGlobalState(e){let l=this.globalStates.get(e);return l||(l={},this.globalStates.set(e,l)),l}_setImages(l,c){return e._(this,void 0,void 0,(function*(){this.availableImages[l]=c;for(const e in this.workerSources[l]){const d=this.workerSources[l][e];for(const e in d)d[e].availableImages=c}}))}_syncRTLPluginState(l,c){return e._(this,void 0,void 0,(function*(){return yield e.d5.syncState(c,this.self.importScripts)}))}_getAvailableImages(e){let l=this.availableImages[e];return l||(l=[]),l}_getLayerIndex(e){let l=this.layerIndexes[e];return l||(l=this.layerIndexes[e]=new t),l}_getWorkerSource(e,l,c){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][l]||(this.workerSources[e][l]={}),!this.workerSources[e][l][c]){const d={sendAsync:(l,c)=>(l.targetMapId=e,this.actor.sendAsync(l,c))};switch(l){case"vector":this.workerSources[e][l][c]=new h(d,this._getLayerIndex(e),this._getAvailableImages(e));break;case"geojson":this.workerSources[e][l][c]=new se(d,this._getLayerIndex(e),this._getAvailableImages(e));break;default:this.workerSources[e][l][c]=new this.externalWorkerSourceTypes[l](d,this._getLayerIndex(e),this._getAvailableImages(e))}}return this.workerSources[e][l][c]}_getDEMWorkerSource(e,l){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][l]||(this.demWorkerSources[e][l]=new u),this.demWorkerSources[e][l]}}return e.i(self)&&(self.worker=new ne(self)),ne}));d("index",["exports","./shared"],(function(l,c){var d="5.17.0";function p(){var e=new c.A(4);return c.A!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}let f,m,_;const g={frame(e,l,d,p){const f=p||window,m=f.requestAnimationFrame((e=>{_(),l(e)})),{unsubscribe:_}=c.s(e.signal,"abort",(()=>{_(),f.cancelAnimationFrame(m),d(new c.a(e.signal.reason))}),!1)},frameAsync(e,l){return new Promise(((c,d)=>{this.frame(e,c,d,l)}))},getImageData(e,l=0){return this.getImageCanvasContext(e).getImageData(-l,-l,e.width+2*l,e.height+2*l)},getImageCanvasContext(e){const l=window.document.createElement("canvas"),c=l.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return l.width=e.width,l.height=e.height,c.drawImage(e,0,0,e.width,e.height),c},resolveURL:e=>(f||(f=document.createElement("a")),f.href=e,f.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return void 0!==_?_:!!matchMedia&&(null==m&&(m=matchMedia("(prefers-reduced-motion: reduce)")),m.matches)},set prefersReducedMotion(e){_=e}},y=new class{constructor(){this._realTime="undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return null!==this._frozenAt?this._frozenAt:this._realTime()}setNow(e){this._frozenAt=e}restoreNow(){this._frozenAt=null}isFrozen(){return null!==this._frozenAt}};function b(){return y.getCurrentTime()}class h{static testProp(e){if(!h.docStyle)return e[0];for(let l=0;l<e.length;l++)if(e[l]in h.docStyle)return e[l];return e[0]}static create(e,l,c){const d=window.document.createElement(e);return void 0!==l&&(d.className=l),c&&c.appendChild(d),d}static createNS(e,l){return window.document.createElementNS(e,l)}static disableDrag(){h.docStyle&&h.selectProp&&(h.userSelect=h.docStyle[h.selectProp],h.docStyle[h.selectProp]="none")}static enableDrag(){h.docStyle&&h.selectProp&&(h.docStyle[h.selectProp]=h.userSelect)}static setTransform(e,l){e.style[h.transformProp]=l}static addEventListener(e,l,c,d={}){e.addEventListener(l,c,"passive"in d?d:d.capture)}static removeEventListener(e,l,c,d={}){e.removeEventListener(l,c,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",h.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",h.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",h.suppressClickInternal,!0)}),0)}static getScale(e){const l=e.getBoundingClientRect();return{x:l.width/e.offsetWidth||1,y:l.height/e.offsetHeight||1,boundingClientRect:l}}static getPoint(e,l,d){const p=l.boundingClientRect;return new c.P((d.clientX-p.left)/l.x-e.clientLeft,(d.clientY-p.top)/l.y-e.clientTop)}static mousePos(e,l){const c=h.getScale(e);return h.getPoint(e,c,l)}static touchPos(e,l){const c=[],d=h.getScale(e);for(let p=0;p<l.length;p++)c.push(h.getPoint(e,d,l[p]));return c}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const l=(new DOMParser).parseFromString(e,"text/html").body||document.createElement("body"),c=l.querySelectorAll("script");for(const e of c)e.remove();return h.clean(l),l.innerHTML}static isPossiblyDangerous(e,l){const c=l.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!c.includes("javascript:")&&!c.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const l=e.children;for(const e of l)h.removeAttributes(e),h.clean(e)}static removeAttributes(e){for(const{name:l,value:c}of e.attributes)h.isPossiblyDangerous(l,c)&&e.removeAttribute(l)}}h.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,h.selectProp=h.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),h.transformProp=h.testProp(["transform","WebkitTransform"]);const T={supported:!1,testSupport:function(e){!I&&P&&(C?R(e):S=e)}};let S,P,I=!1,C=!1;function R(e){const l=e.createTexture();e.bindTexture(e.TEXTURE_2D,l);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,P),e.isContextLost())return;T.supported=!0}catch(e){}e.deleteTexture(l),I=!0}var L;"undefined"!=typeof document&&(P=document.createElement("img"),P.onload=()=>{S&&R(S),S=null,C=!0},P.onerror=()=>{I=!0,S=null},P.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(l){let d,p,f,m;l.resetRequestQueue=()=>{d=[],p=0,f=0,m={}},l.addThrottleControl=e=>{const l=f++;return m[l]=e,l},l.removeThrottleControl=e=>{delete m[e],g()},l.getImage=(e,l,p=!0)=>new Promise(((f,m)=>{T.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),c.e(e,{type:"image"}),d.push({abortController:l,requestParameters:e,supportImageRefresh:p,state:"queued",onError:e=>{m(e)},onSuccess:e=>{f(e)}}),g()}));const _=l=>c._(this||e,void 0,void 0,(function*(){l.state="running";const{requestParameters:e,supportImageRefresh:d,onError:f,onSuccess:m,abortController:_}=l,b=!1===d&&!c.i(self)&&!c.g(e.url)&&(!e.headers||Object.keys(e.headers).reduce(((e,l)=>e&&"accept"===l),!0));p++;const T=b?y(e,_):c.m(e,_);try{const e=yield T;delete l.abortController,l.state="completed",e.data instanceof HTMLImageElement||c.b(e.data)?m(e):e.data&&m({data:yield(S=e.data,"function"==typeof createImageBitmap?c.f(S):c.h(S)),cacheControl:e.cacheControl,expires:e.expires})}catch(e){delete l.abortController,f(e)}finally{p--,g()}var S})),g=()=>{const e=(()=>{for(const e of Object.keys(m))if(m[e]())return!0;return!1})()?c.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let l=p;l<e&&d.length>0;l++){const e=d.shift();e.abortController.signal.aborted?l--:_(e)}},y=(e,l)=>new Promise(((d,p)=>{const f=new Image,m=e.url,_=e.credentials;_&&"include"===_?f.crossOrigin="use-credentials":(_&&"same-origin"===_||!c.d(m))&&(f.crossOrigin="anonymous"),l.signal.addEventListener("abort",(()=>{f.src="",p(new c.a(l.signal.reason))})),f.fetchPriority="high",f.onload=()=>{f.onerror=f.onload=null,d({data:f})},f.onerror=()=>{f.onerror=f.onload=null,l.signal.aborted||p(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},f.src=m}))}(L||(L={})),L.resetRequestQueue();class v{constructor(e){this._transformRequestFn=null!=e?e:null}transformRequest(e,l){return this._transformRequestFn&&this._transformRequestFn(e,l)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function F(e){const l=[];if("string"==typeof e)l.push({id:"default",url:e});else if(e&&e.length>0){const c=[];for(const{id:d,url:p}of e){const e=`${d}${p}`;-1===c.indexOf(e)&&(c.push(e),l.push({id:d,url:p}))}}return l}function B(e,l,c){try{const d=new URL(e);return d.pathname+=`${l}${c}`,d.toString()}catch(l){throw new Error(`Invalid sprite URL "${e}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function O(e){const{userImage:l}=e;return!!(l&&l.render&&l.render())&&(e.data.replace(new Uint8Array(l.data.buffer)),!0)}class w extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const e of Object.keys(this.images))this.removeImage(e);this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,promiseResolve:l}of this.requestors)l(this._getImagesForIds(e));this.requestors=[]}}getImage(e){const l=this.images[e];if(l&&!l.data&&l.spriteData){const e=l.spriteData;l.data=new c.R({width:e.width,height:e.height},e.context.getImageData(e.x,e.y,e.width,e.height).data),l.spriteData=null}return l}addImage(e,l){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,l)&&(this.images[e]=l)}_validate(e,l){let d=!0;const p=l.data||l.spriteData;return this._validateStretch(l.stretchX,p&&p.width)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "stretchX" value`))),d=!1),this._validateStretch(l.stretchY,p&&p.height)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "stretchY" value`))),d=!1),this._validateContent(l.content,l)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "content" value`))),d=!1),d}_validateStretch(e,l){if(!e)return!0;let c=0;for(const d of e){if(d[0]<c||d[1]<d[0]||l<d[1])return!1;c=d[1]}return!0}_validateContent(e,l){if(!e)return!0;if(4!==e.length)return!1;const c=l.spriteData,d=c&&c.width||l.data.width,p=c&&c.height||l.data.height;return!(e[0]<0||d<e[0]||e[1]<0||p<e[1]||e[2]<0||d<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,l,c=!0){const d=this.getImage(e);if(c&&(d.data.width!==l.data.width||d.data.height!==l.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${l.data.width}x${l.data.height}).`);l.version=d.version+1,this.images[e]=l,this.updatedImages[e]=!0}removeImage(e){const l=this.images[e];delete this.images[e],delete this.patterns[e],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((l,c)=>{let d=!0;if(!this.isLoaded())for(const l of e)this.images[l]||(d=!1);this.isLoaded()||d?l(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:l})}))}_getImagesForIds(e){const l={};for(const d of e){let e=this.getImage(d);e||(this.fire(new c.l("styleimagemissing",{id:d})),e=this.getImage(d)),e?l[d]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,textFitWidth:e.textFitWidth,textFitHeight:e.textFitHeight,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:c.w(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return l}getPixelSize(){const{width:e,height:l}=this.atlasImage;return{width:e,height:l}}getPattern(e){const l=this.patterns[e],d=this.getImage(e);if(!d)return null;if(l&&l.position.version===d.version)return l.position;if(l)l.position.version=d.version;else{const l={w:d.data.width+2,h:d.data.height+2,x:0,y:0},p=new c.I(l,d);this.patterns[e]={bin:l,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const l=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(e,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const l in this.patterns)e.push(this.patterns[l].bin);const{w:l,h:d}=c.p(e),p=this.atlasImage;p.resize({width:l||1,height:d||1});for(const e in this.patterns){const{bin:l}=this.patterns[e],d=l.x+1,f=l.y+1,m=this.getImage(e).data,_=m.width,g=m.height;c.R.copy(m,p,{x:0,y:0},{x:d,y:f},{width:_,height:g}),c.R.copy(m,p,{x:0,y:g-1},{x:d,y:f-1},{width:_,height:1}),c.R.copy(m,p,{x:0,y:0},{x:d,y:f+g},{width:_,height:1}),c.R.copy(m,p,{x:_-1,y:0},{x:d-1,y:f},{width:1,height:g}),c.R.copy(m,p,{x:0,y:0},{x:d+_,y:f},{width:1,height:g})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const l of e){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const e=this.getImage(l);e||c.w(`Image with ID: "${l}" was not found`),O(e)&&this.updateImage(l,e)}}cloneImages(){const e={};for(const l in this.images){const c=this.images[l];e[l]=Object.assign(Object.assign({},c),{data:c.data?c.data.clone():null})}return e}}const V=1e20;function j(e,l,c,d,p,f,m,_,g){for(let y=l;y<l+d;y++)G(e,c*f+y,f,p,m,_,g);for(let y=c;y<c+p;y++)G(e,y*f+l,1,d,m,_,g)}function G(e,l,c,d,p,f,m){f[0]=0,m[0]=-V,m[1]=V,p[0]=e[l];for(let _=1,g=0,y=0;_<d;_++){p[_]=e[l+_*c];const d=_*_;do{const e=f[g];y=(p[_]-p[e]+d-e*e)/(_-e)/2}while(y<=m[g]&&--g>-1);g++,f[g]=_,m[g]=y,m[g+1]=V}for(let _=0,g=0;_<d;_++){for(;m[g+1]<_;)g++;const d=f[g],y=_-d;e[l+_*c]=p[d]+y*y}}const U=c.v.layout_symbol["text-font"].default.join(",");class M{constructor(e,l,c){this.requestManager=e,this.localIdeographFontFamily=l,this.entries={},this.lang=c}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,(function*(){const l=[];for(const c in e)for(const d of e[c])l.push(this._getAndCacheGlyphsPromise(c,d));const c=yield Promise.all(l),d={};for(const{stack:e,id:l,glyph:p}of c)d[e]||(d[e]={}),d[e][l]=p&&{id:p.id,bitmap:p.bitmap.clone(),metrics:p.metrics};return d}))}_getAndCacheGlyphsPromise(e,l){return c._(this,void 0,void 0,(function*(){let c=this.entries[e];c||(c=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=c.glyphs[l];return void 0!==d?{stack:e,id:l,glyph:d}:!this.url||this._charUsesLocalIdeographFontFamily(l)?(d=c.glyphs[l]=this._drawGlyph(c,e,l),{stack:e,id:l,glyph:d}):yield this._downloadAndCacheRangePromise(e,l)}))}_downloadAndCacheRangePromise(e,l){return c._(this,void 0,void 0,(function*(){const c=this.entries[e],d=Math.floor(l/256);if(c.ranges[d])return{stack:e,id:l,glyph:null};if(!c.requests[d]){const l=M.loadGlyphRange(e,d,this.url,this.requestManager);c.requests[d]=l}try{const p=yield c.requests[d];for(const e in p)c.glyphs[+e]=p[+e];return c.ranges[d]=!0,{stack:e,id:l,glyph:p[l]||null}}catch(p){const f=c.glyphs[l]=this._drawGlyph(c,e,l);return this._warnOnMissingGlyphRange(f,d,l,p),{stack:e,id:l,glyph:f}}}))}_warnOnMissingGlyphRange(e,l,d,p){const f=256*l,m=f+255,_=d.toString(16).padStart(4,"0").toUpperCase();c.w(`Unable to load glyph range ${l}, ${f}-${m}. Rendering codepoint U+${_} locally instead. ${p}`)}_charUsesLocalIdeographFontFamily(e){return!!this.localIdeographFontFamily&&c.q(e)}_drawGlyph(e,l,d){const p=l===U&&""!==this.localIdeographFontFamily&&this._charUsesLocalIdeographFontFamily(d),f=p?"ideographTinySDF":"tinySDF";e[f]||(e[f]=this._createTinySDF(p?this.localIdeographFontFamily:l));const m=e[f].draw(String.fromCodePoint(d)),_=/^\p{gc=Cf}+$/u.test(String.fromCodePoint(d));return{id:d,bitmap:new c.r({width:m.width||60,height:m.height||60},m.data),metrics:{width:_?0:m.glyphWidth/2||24,height:m.glyphHeight/2||24,left:m.glyphLeft/2+.5||0,top:m.glyphTop/2-27.5||-8,advance:_?0:m.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(e){const l=e?e.split(","):[];l.push("sans-serif");const c=l.map((e=>/[-\w]+/.test(e)?e:`'${CSS.escape(e)}'`)).join(",");return new M.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:this._fontWeight(l[0]),fontStyle:this._fontStyle(l[0]),lang:this.lang})}_fontStyle(e){return/italic/i.test(e)?"italic":/oblique/i.test(e)?"oblique":"normal"}_fontWeight(e){const l={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let c;for(const[d,p]of Object.entries(l))new RegExp(`\\b${d}\\b`,"i").test(e)&&(c=`${p}`);return c}destroy(){for(const e in this.entries){const l=this.entries[e];l.tinySDF&&(l.tinySDF=null),l.ideographTinySDF&&(l.ideographTinySDF=null),l.glyphs={},l.requests={},l.ranges={}}this.entries={}}}M.loadGlyphRange=function(l,d,p,f){return c._(this||e,void 0,void 0,(function*(){const e=256*d,m=e+255,_=f.transformRequest(p.replace("{fontstack}",l).replace("{range}",`${e}-${m}`),"Glyphs"),g=yield c.n(_,new AbortController);if(!g||!g.data)throw new Error(`Could not load glyph range. range: ${d}, ${e}-${m}`);const y={};for(const e of c.o(g.data))y[e.id]=e;return y}))},M.TinySDF=class{constructor({fontSize:e=24,buffer:l=3,radius:c=8,cutoff:d=.25,fontFamily:p="sans-serif",fontWeight:f="normal",fontStyle:m="normal",lang:_=null}={}){this.buffer=l,this.cutoff=d,this.radius=c,this.lang=_;const g=this.size=e+4*l,y=this._createCanvas(g),b=this.ctx=y.getContext("2d",{willReadFrequently:!0});b.font=`${m} ${f} ${e}px ${p}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(e){const l=document.createElement("canvas");return l.width=l.height=e,l}draw(e){const{width:l,actualBoundingBoxAscent:c,actualBoundingBoxDescent:d,actualBoundingBoxLeft:p,actualBoundingBoxRight:f}=this.ctx.measureText(e),m=Math.ceil(c),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-p))),g=Math.min(this.size-this.buffer,m+Math.ceil(d)),y=_+2*this.buffer,b=g+2*this.buffer,T=Math.max(y*b,0),S=new Uint8ClampedArray(T),P={data:S,width:y,height:b,glyphWidth:_,glyphHeight:g,glyphTop:m,glyphLeft:0,glyphAdvance:l};if(0===_||0===g)return P;const{ctx:I,buffer:C,gridInner:R,gridOuter:L}=this;this.lang&&(I.lang=this.lang),I.clearRect(C,C,_,g),I.fillText(e,C,C+m);const F=I.getImageData(C,C,_,g);L.fill(V,0,T),R.fill(0,0,T);for(let e=0;e<g;e++)for(let l=0;l<_;l++){const c=F.data[4*(e*_+l)+3]/255;if(0===c)continue;const d=(e+C)*y+l+C;if(1===c)L[d]=0,R[d]=V;else{const e=.5-c;L[d]=e>0?e*e:0,R[d]=e<0?e*e:0}}j(L,0,0,y,b,y,this.f,this.v,this.z),j(R,C,C,_,g,y,this.f,this.v,this.z);for(let e=0;e<T;e++){const l=Math.sqrt(L[e])-Math.sqrt(R[e]);S[e]=Math.round(255-255*(l/this.radius+this.cutoff))}return P}};class E{constructor(){this.specification=c.u.light.position}possiblyEvaluate(e,l){return c.F(e.expression.evaluate(l))}interpolate(e,l,d){return{x:c.G.number(e.x,l.x,d),y:c.G.number(e.y,l.y,d),z:c.G.number(e.z,l.z,d)}}}let q;class z extends c.E{constructor(e){super(),q=q||new c.t({anchor:new c.D(c.u.light.anchor),position:new E,color:new c.D(c.u.light.color),intensity:new c.D(c.u.light.intensity)}),this._transitionable=new c.x(q,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,l={}){if(!this._validate(c.y,e,l))for(const l in e){const d=e[l];l.endsWith(c.z)?this._transitionable.setTransition(l.slice(0,-c.z.length),d):this._transitionable.setValue(l,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,l,d){return(!d||!1!==d.validate)&&c.B(this,e.call(c.C,{value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.u}))}}const Z=new c.t({"sky-color":new c.D(c.u.sky["sky-color"]),"horizon-color":new c.D(c.u.sky["horizon-color"]),"fog-color":new c.D(c.u.sky["fog-color"]),"fog-ground-blend":new c.D(c.u.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.u.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.u.sky["atmosphere-blend"])});class D extends c.E{constructor(e){super(),this._transitionable=new c.x(Z,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0))}setSky(e,l={}){if(!this._validate(c.J,e,l)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const d=e[l];l.endsWith(c.z)?this._transitionable.setTransition(l.slice(0,-c.z.length),d):this._transitionable.setValue(l,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,l,d={}){return!1!==(null==d?void 0:d.validate)&&c.B(this,e.call(c.C,c.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.u})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class A{constructor(e,l){this.width=e,this.height=l,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,l){const c=e.join(",")+String(l);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(e,l)),this.dashEntry[c]}getDashRanges(e,l,c){const d=[];let p=e.length%2==1?-e[e.length-1]*c:0,f=e[0]*c,m=!0;d.push({left:p,right:f,isDash:m,zeroLength:0===e[0]});let _=e[0];for(let l=1;l<e.length;l++){m=!m;const g=e[l];p=_*c,_+=g,f=_*c,d.push({left:p,right:f,isDash:m,zeroLength:0===g})}return d}addRoundDash(e,l,c){const d=l/2;for(let l=-c;l<=c;l++){const p=this.width*(this.nextRow+c+l);let f=0,m=e[f];for(let _=0;_<this.width;_++){_/m.right>1&&(m=e[++f]);const g=Math.abs(_-m.left),y=Math.abs(_-m.right),b=Math.min(g,y);let T;const S=l/c*(d+1);if(m.isDash){const e=d-Math.abs(S);T=Math.sqrt(b*b+e*e)}else T=d-Math.sqrt(b*b+S*S);this.data[p+_]=Math.max(0,Math.min(255,T+128))}}}addRegularDash(e){for(let l=e.length-1;l>=0;--l){const c=e[l],d=e[l+1];c.zeroLength?e.splice(l,1):d&&d.isDash===c.isDash&&(d.left=c.left,e.splice(l,1))}const l=e[0],c=e[e.length-1];l.isDash===c.isDash&&(l.left=c.left-this.width,c.right=l.right+this.width);const d=this.width*this.nextRow;let p=0,f=e[p];for(let l=0;l<this.width;l++){l/f.right>1&&(f=e[++p]);const c=Math.abs(l-f.left),m=Math.abs(l-f.right),_=Math.min(c,m);this.data[d+l]=Math.max(0,Math.min(255,(f.isDash?_:-_)+128))}}addDash(e,l){const d=l?7:0,p=2*d+1;if(this.nextRow+p>this.height)return c.w("LineAtlas out of space"),null;let f=0;for(let l=0;l<e.length;l++)f+=e[l];if(0!==f){const c=this.width/f,p=this.getDashRanges(e,this.width,c);l?this.addRoundDash(p,c,d):this.addRegularDash(p)}const m={y:this.nextRow+d,height:2*d,width:f};return this.nextRow+=p,this.dirty=!0,m}bind(e){const l=e.gl;this.texture?(l.bindTexture(l.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,l.texSubImage2D(l.TEXTURE_2D,0,0,0,this.width,this.height,l.ALPHA,l.UNSIGNED_BYTE,this.data))):(this.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texImage2D(l.TEXTURE_2D,0,l.ALPHA,this.width,this.height,0,l.ALPHA,l.UNSIGNED_BYTE,this.data))}}const W="maplibre_preloaded_worker_pool";class k{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<k.workerCount;)this.workers.push(new Worker(c.c.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[W]}numActive(){return Object.keys(this.active).length}}const Q=Math.floor(g.hardwareConcurrency/2);let J,re;function oe(){return J||(J=new k),J}k.workerCount=c.K(globalThis)?Math.max(Math.min(Q,3),1):1;class N{constructor(e,l){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=l;const d=this.workerPool.acquire(l);for(let e=0;e<d.length;e++){const p=new c.L(d[e],l);p.name=`Worker ${e}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,l){const c=[];for(const d of this.actors)c.push(d.sendAsync({type:e,data:l}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((e=>{e.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,l){for(const c of this.actors)c.registerMessageHandler(e,l)}unregisterMessageHandler(e){for(const l of this.actors)l.unregisterMessageHandler(e)}}function le(){return re||(re=new N(oe(),c.M),re.registerMessageHandler("GR",((e,l,d)=>c.m(l,d)))),re}function ce(e,l){const d=c.N();return c.O(d,d,[1,1,0]),c.Q(d,d,[.5*e.width,.5*e.height,1]),e.calculatePosMatrix?c.S(d,d,e.calculatePosMatrix(l.toUnwrapped())):d}function he(e,l,c,d,p,f,m){var _;const g=function(e,l,c){if(e)for(const d of e){const e=l[d];if(e&&e.source===c&&"fill-extrusion"===e.type)return!0}else for(const e in l){const d=l[e];if(d.source===c&&"fill-extrusion"===d.type)return!0}return!1}(null!==(_=null==p?void 0:p.layers)&&void 0!==_?_:null,l,e.id),y=f.maxPitchScaleFactor(),b=e.tilesIn(d,y,g);b.sort(ue);const T=[];for(const d of b)T.push({wrappedTileID:d.tileID.wrapped().key,queryResults:d.tile.queryRenderedFeatures(l,c,e.getState(),d.queryGeometry,d.cameraQueryGeometry,d.scale,p,f,y,ce(f,d.tileID),m?(e,l)=>m(d.tileID,e,l):void 0)});return function(e,l){for(const c in e)for(const d of e[c])pe(d,l);return e}(function(e){const l={},c={};for(const d of e){const e=d.queryResults,p=d.wrappedTileID,f=c[p]=c[p]||{};for(const c in e){const d=e[c],p=f[c]=f[c]||{},m=l[c]=l[c]||[];for(const e of d)p[e.featureIndex]||(p[e.featureIndex]=!0,m.push(e))}}return l}(T),e)}function ue(e,l){const c=e.tileID,d=l.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}function pe(e,l){const c=e.feature,d=l.getFeatureState(c.layer["source-layer"],c.id);c.source=c.layer.source,c.layer["source-layer"]&&(c.sourceLayer=c.layer["source-layer"]),c.state=d}function fe(l,d,p,f){return c._(this||e,void 0,void 0,(function*(){let e=l;if(l.url?e=(yield c.j(d.transformRequest(l.url,"Source"),p)).data:yield g.frameAsync(p,f),!e)return null;const m=c.U(c.e(e,l),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in e&&e.vector_layers&&(m.vectorLayerIds=e.vector_layers.map((e=>e.id))),m}))}class ${constructor(e,l){e&&(l?this.setSouthWest(e).setNorthEast(l):Array.isArray(e)&&(4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.V?new c.V(e.lng,e.lat):c.V.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.V?new c.V(e.lng,e.lat):c.V.convert(e),this}extend(e){const l=this._sw,d=this._ne;let p,f;if(e instanceof c.V)p=e,f=e;else{if(!(e instanceof $))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend($.convert(e)):this.extend(c.V.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.V.convert(e)):this;if(p=e._sw,f=e._ne,!p||!f)return this}return l||d?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),d.lng=Math.max(f.lng,d.lng),d.lat=Math.max(f.lat,d.lat)):(this._sw=new c.V(p.lng,p.lat),this._ne=new c.V(f.lng,f.lat)),this}getCenter(){return new c.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.V(this.getWest(),this.getNorth())}getSouthEast(){return new c.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:l,lat:d}=c.V.convert(e);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&p}intersects(e){if(!((e=$.convert(e)).getNorth()>=this.getSouth()&&e.getSouth()<=this.getNorth()))return!1;const l=Math.abs(this.getEast()-this.getWest()),d=Math.abs(e.getEast()-e.getWest());if(l>=360||d>=360)return!0;const p=c.W(this.getWest(),-180,180),f=c.W(this.getEast(),-180,180),m=c.W(e.getWest(),-180,180),_=c.W(e.getEast(),-180,180),g=p>=f,y=m>=_;return!(!g||!y)||(g?_>=p||m<=f:y?f>=m||p<=_:m<=f&&_>=p)}static convert(e){return e instanceof $?e:e?new $(e):e}static fromLngLat(e,l=0){const d=360*l/40075017,p=d/Math.cos(Math.PI/180*e.lat);return new $(new c.V(e.lng-p,e.lat-d),new c.V(e.lng+p,e.lat+d))}adjustAntiMeridian(){const e=new c.V(this._sw.lng,this._sw.lat),l=new c.V(this._ne.lng,this._ne.lat);return new $(e,e.lng>l.lng?new c.V(l.lng+360,l.lat):l)}}class H{constructor(e,l,c){this.bounds=$.convert(this.validateBounds(e)),this.minzoom=l||0,this.maxzoom=c||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const l=Math.pow(2,e.z),d=Math.floor(c.Y(this.bounds.getWest())*l),p=Math.floor(c.X(this.bounds.getNorth())*l),f=Math.ceil(c.Y(this.bounds.getEast())*l),m=Math.ceil(c.X(this.bounds.getSouth())*l);return e.x>=d&&e.x<f&&e.y>=p&&e.y<m}}class X extends c.E{constructor(e,l,d,p){if(super(),this.id=e,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.U(l,["url","scheme","tileSize","promoteId","encoding"])),this._options=c.e({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield fe(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new H(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,c.Z(e)||this.fire(new c.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,(function*(){const l=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(l,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(e)};c.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&"expired"!==e.state){if("loading"===e.state)return new Promise(((l,c)=>{e.reloadPromise={resolve:l,reject:c}}))}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{const l=yield e.actor.sendAsync({type:d,data:c},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,l)}catch(l){if(delete e.abortController,e.aborted)return;if(l&&404!==l.status)throw l;this._afterTileLoadWorkerResponse(e,null)}}))}_getOverzoomParameters(e){if(e.tileID.canonical.z<=this.maxzoom)return;if(void 0===this.map._zoomLevelsToOverscale)return;const l=e.tileID.scaledTo(this.maxzoom).canonical,c=l.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:l,overzoomRequest:this.map._requestManager.transformRequest(c,"Tile")}}_afterTileLoadWorkerResponse(e,l){if(l&&l.resourceTiming&&(e.resourceTiming=l.resourceTiming),l&&this.map._refreshExpiredTiles&&e.setExpiryData(l),e.loadVectorData(l,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return c._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return c._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class K extends c.E{constructor(e,l,d,p){super(),this.id=e,this.dispatcher=d,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},l),c.e(this,c.U(l,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield fe(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,l&&(c.e(this,l),l.bounds&&(this.tileBounds=new H(l.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,c.Z(e)||this.fire(new c.k(e))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,(function*(){const l=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const d=yield L.getImage(this.map._requestManager.transformRequest(l,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const l=this.map.painter.context,p=l.gl,f=d.data;e.texture=this.map.painter.getTileTexture(f.width),e.texture?e.texture.update(f,{useMipmap:!0}):(e.texture=new c.T(l,f,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}}))}abortTile(e){return c._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return c._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class Y extends K{constructor(e,l,d,p){super(e,l,d,p),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox",this.redFactor=l.redFactor,this.greenFactor=l.greenFactor,this.blueFactor=l.blueFactor,this.baseShift=l.baseShift}loadTile(e){return c._(this,void 0,void 0,(function*(){const l=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d=this.map._requestManager.transformRequest(l,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const l=yield L.getImage(d,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){const d=l.data;this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const p=c.b(d)&&c.$()?d:yield this.readImageNow(d),f={type:this.type,uid:e.uid,source:this.id,rawImageData:p,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||"expired"===e.state){e.actor=this.dispatcher.getActor();const l=yield e.actor.sendAsync({type:"LDT",data:f});e.dem=l,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}}))}readImageNow(e){return c._(this,void 0,void 0,(function*(){if("undefined"!=typeof VideoFrame&&c.a0()){const l=e.width+2,d=e.height+2;try{return new c.R({width:l,height:d},yield c.a1(e,-1,-1,l,d))}catch(e){}}return g.getImageData(e,1)}))}_getNeighboringTiles(e){const l=e.canonical,d=Math.pow(2,l.z),p=(l.x-1+d)%d,f=0===l.x?e.wrap-1:e.wrap,m=(l.x+1+d)%d,_=l.x+1===d?e.wrap+1:e.wrap,g={};return g[new c.a2(e.overscaledZ,f,l.z,p,l.y).key]={backfilled:!1},g[new c.a2(e.overscaledZ,_,l.z,m,l.y).key]={backfilled:!1},l.y>0&&(g[new c.a2(e.overscaledZ,f,l.z,p,l.y-1).key]={backfilled:!1},g[new c.a2(e.overscaledZ,e.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},g[new c.a2(e.overscaledZ,_,l.z,m,l.y-1).key]={backfilled:!1}),l.y+1<d&&(g[new c.a2(e.overscaledZ,f,l.z,p,l.y+1).key]={backfilled:!1},g[new c.a2(e.overscaledZ,e.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},g[new c.a2(e.overscaledZ,_,l.z,m,l.y+1).key]={backfilled:!1}),g}unloadTile(e){return c._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}function me(e){return"GeometryCollection"===e.type?e.geometries.map((e=>e.coordinates)).flat(1/0):e.coordinates.flat(1/0)}function ge(e){const l=new $;let c;switch(e.type){case"FeatureCollection":c=e.features.map((e=>me(e.geometry))).flat(1/0);break;case"Feature":c=me(e.geometry);break;default:c=me(e)}if(0==c.length)return l;for(let e=0;e<c.length-1;e+=2)l.extend([c[e],c[e+1]]);return l}class ee extends c.E{constructor(e,l,d,p){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:l.data},this.actor=d.getActor(),this.setEventedParent(p),this._data="string"==typeof l.data?{url:l.data}:{geojson:l.data},this._options=c.e({},l),this._collectResourceTiming=l.collectResourceTiming,void 0!==l.maxzoom&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId,void 0!==l.clusterMaxZoom&&this.maxzoom<=l.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${l.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(void 0!==l.buffer?l.buffer:128),tolerance:this._pixelsToTileUnits(void 0!==l.tolerance?l.tolerance:.375),extent:c.a5,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(l.clusterMaxZoom),minPoints:Math.max(2,l.clusterMinPoints||2),extent:c.a5,radius:this._pixelsToTileUnits(l.clusterRadius||50),log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return void 0!==this._pendingWorkerUpdate.data||void 0!==this._pendingWorkerUpdate.diff||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(e){return e*(c.a5/this.tileSize)}_getClusterMaxZoom(e){const l=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||void 0===e||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${l}"`),l}load(){return c._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e,l){this._data="string"==typeof e?{url:e}:{geojson:e},this._pendingWorkerUpdate={data:e};const c=this._updateWorkerData();return l?c:this}updateData(e,l){this._pendingWorkerUpdate.diff=c.a6(this._pendingWorkerUpdate.diff,e);const d=this._updateWorkerData();return l?d:this}getData(){return c._(this,void 0,void 0,(function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getBounds(){return c._(this,void 0,void 0,(function*(){return ge(yield this.getData())}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,void 0!==e.clusterRadius&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),void 0!==e.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,l,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:l,offset:c}})}_updateWorkerData(){return c._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void c.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:e,diff:l}=this._pendingWorkerUpdate,d=this._getLoadGeoJSONParameters(e,l);void 0!==e?this._pendingWorkerUpdate.data=void 0:l&&(this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,yield this._dispatchWorkerUpdate(d)}))}_getLoadGeoJSONParameters(e,l){const d=c.e({type:this.type},this.workerOptions);return"string"==typeof e?(d.request=this.map._requestManager.transformRequest(g.resolveURL(e),"Source"),d.request.collectResourceTiming=this._collectResourceTiming,d):void 0!==e?(d.data=e,d):l?(d.dataDiff=l,d):d}_dispatchWorkerUpdate(e){return c._(this,void 0,void 0,(function*(){this._isUpdatingWorker=!0,this.fire(new c.l("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:e});if(this._isUpdatingWorker=!1,this._removed||l.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));l.data&&(this._data={geojson:l.data});const d=this._applyDiffToSource(e.dataDiff),p=this._getShouldReloadTileOptions(d),f={dataType:"source"};this._applyResourceTiming(f,l),this.fire(new c.l("data",Object.assign(Object.assign({},f),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},f),{sourceDataType:"content",shouldReloadTileOptions:p})))}catch(e){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(e))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyResourceTiming(e,l){var d;if(!this._collectResourceTiming)return;const p=null===(d=l.resourceTiming)||void 0===d?void 0:d[this.id];if(!p)return;const f=p.slice(0);(null==f?void 0:f.length)&&c.e(e,{resourceTiming:f})}_applyDiffToSource(e){if(!e)return;const l="string"==typeof this.promoteId?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const e=c.a7(this._data.geojson,l);if(!e)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:e}}if(!this._data.updateable)return;const d=c.a8(this._data.updateable,e,l);return e.removeAll||this._options.cluster?void 0:d}_getShouldReloadTileOptions(e){if(e)return{affectedBounds:e.filter(Boolean).map((e=>ge(e)))}}shouldReloadTile(e,{affectedBounds:l}){if("loading"===e.state)return!0;if("unloaded"===e.state)return!1;const{buffer:d,extent:p}=this.workerOptions.geojsonVtOptions,f=function({x:e,y:l,z:d},p=0){const f=c.a3((e-p)/Math.pow(2,d)),m=c.a4((l+1+p)/Math.pow(2,d)),_=c.a3((e+1+p)/Math.pow(2,d)),g=c.a4((l-p)/Math.pow(2,d));return new $([f,m],[_,g])}(e.tileID.canonical,d/p);for(const e of l)if(f.intersects(e))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(e){return c._(this,void 0,void 0,(function*(){const l=e.actor?"RT":"LT";e.actor=this.actor;const c={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const d=yield this.actor.sendAsync({type:l,data:c},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,"RT"===l)}))}abortTile(e){return c._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return c._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class te extends c.E{constructor(e,l,c,d){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=c,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=l}load(e){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const l=yield L.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,l&&l.data&&(this.image=l.data,e&&(this.coordinates=e),this._finishLoading())}catch(e){this._request=null,this._loaded=!0,c.Z(e)||this.fire(new c.k(e))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const l=e.map(c.a9.fromLngLat);var d;return this.tileID=function(e){const l=c.aa.fromPoints(e),d=l.width(),p=l.height(),f=Math.max(d,p),m=Math.max(0,Math.floor(-Math.log(f)/Math.LN2)),_=Math.pow(2,m);return new c.ac(m,Math.floor((l.minX+l.maxX)/2*_),Math.floor((l.minY+l.maxY)/2*_))}(l),this.terrainTileRanges=this._getOverlappingTileRanges(l),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=l.map((e=>this.tileID.getTilePoint(e)._round())),this.flippedWindingOrder=((d=this.tileCoords)[1].x-d[0].x)*(d[2].y-d[0].y)-(d[1].y-d[0].y)*(d[2].x-d[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,l=e.gl;this.texture||(this.texture=new c.T(e,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let d=!1;for(const e in this.tiles){const l=this.tiles[e];"loaded"!==l.state&&(l.state="loaded",l.texture=this.texture,d=!0)}d&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:l,minY:d,maxX:p,maxY:f}=c.aa.fromPoints(e),m={};for(let e=0;e<=c.ab;e++){const c=Math.pow(2,e),_=Math.floor(l*c),g=Math.floor(d*c),y=Math.floor(p*c),b=Math.floor(f*c),T=(_%c+c)%c,S=y%c,P=Math.floor(_/c),I=Math.floor(y/c);m[e]={minWrap:P,maxWrap:I,minTileXWrapped:T,maxTileXWrapped:S,minTileY:g,maxTileY:b}}return m}}class ie extends te{constructor(e,l,c,d){super(e,l,c,d),this.roundZoom=!0,this.type="video",this.options=l}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const l of e.urls)this.urls.push(this.map._requestManager.transformRequest(l,"Source").url);try{const e=yield c.ad(this.urls);if(this._loaded=!0,!e)return;this.video=e,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(e){this.fire(new c.k(e))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const l=this.video.seekable;e<l.start(0)||e>l.end(0)?this.fire(new c.k(new c.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,l=e.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(e,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let d=!1;for(const e in this.tiles){const l=this.tiles[e];"loaded"!==l.state&&(l.state="loaded",l.texture=this.texture,d=!0)}d&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ae extends te{constructor(e,l,d,p){super(e,l,d,p),l.coordinates?Array.isArray(l.coordinates)&&4===l.coordinates.length&&!l.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new c.k(new c.ae(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.ae(`sources.${e}`,null,'missing required property "coordinates"'))),l.animate&&"boolean"!=typeof l.animate&&this.fire(new c.k(new c.ae(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),l.canvas?"string"==typeof l.canvas||l.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.ae(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.ae(`sources.${e}`,null,'missing required property "canvas"'))),this.options=l,this.animate=void 0===l.animate||l.animate}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const l=this.map.painter.context,d=l.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new c.T(l,this.canvas,d.RGBA,{premultiply:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let p=!1;for(const e in this.tiles){const l=this.tiles[e];"loaded"!==l.state&&(l.state="loaded",l.texture=this.texture,p=!0)}p&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const ye={},xe=e=>{switch(e){case"geojson":return ee;case"image":return te;case"raster":return K;case"raster-dem":return Y;case"vector":return X;case"video":return ie;case"canvas":return ae}return ye[e]},ve="RTLPluginLoaded";class ne extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=le()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((e=>{throw this.status="error",e}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,(function*(e,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=g.resolveURL(e),!this.url)throw new Error(`requested url ${e} is invalid`);if("unavailable"===this.status){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if("requested"===this.status)return this._requestImport()}))}_requestImport(){return c._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(ve))}))}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let be=null;function we(){return be||(be=new ne),be}var Se,Me;!function(e){e[e.Base=0]="Base",e[e.Parent=1]="Parent"}(Se||(Se={})),function(e){e[e.Departing=0]="Departing",e[e.Incoming=1]="Incoming"}(Me||(Me={}));class de{constructor(e,l){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=e,this.uid=c.af(),this.uses=0,this.tileSize=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(e){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(e||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:e,fadingDirection:l,fadingParentID:c,fadeEndTime:d}){this.resetFadeLogic(),this.fadingRole=e,this.fadingDirection=l,this.fadingParentID=c,this.fadeEndTime=d}setSelfFadeLogic(e){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=e}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=b(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,l,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData,this.latestFeatureIndex.encoding=e.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,l){const c={};if(!l)return c;for(const d of e){const e=d.layerIds.map((e=>l.getLayer(e))).filter(Boolean);if(0!==e.length){d.layers=e,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map((l=>e.filter((e=>e.id===l))[0])));for(const l of e)c[l.id]=d}}return c}(e.buckets,null==l?void 0:l.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const l=this.buckets[e];if(l instanceof c.ah){if(this.hasSymbolBuckets=!0,!d)break;l.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const l=this.buckets[e];if(l instanceof c.ah&&l.hasRTLText){this.hasRTLText=!0,we().lazyLoad();break}}this.queryPadding=0;for(const e in this.buckets){const c=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(e).queryRadius(c))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new c.ag}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const c=this.buckets[l];c.uploadPending()&&c.upload(e)}const l=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(e,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(e,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,l,c,d,p,f,m,_,g,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:p,scale:f,tileSize:this.tileSize,pixelPosMatrix:y,transform:_,params:m,queryPadding:this.queryPadding*g,getElevation:b},e,l,c):{}}querySourceFeatures(e,l){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const p=d.loadVTLayers(),f=l&&l.sourceLayer?l.sourceLayer:"",m=p[c.ai]||p[f];if(!m)return;const _=c.aj(null==l?void 0:l.filter,null==l?void 0:l.globalState),{z:g,x:y,y:b}=this.tileID.canonical,T={z:g,x:y,y:b};for(let l=0;l<m.length;l++){const p=m.feature(l);if(_.needGeometry){const e=c.ak(p,!0);if(!_.filter(new c.H(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!_.filter(new c.H(this.tileID.overscaledZ),p))continue;const S=d.getId(p,f),P=new c.al(p,g,y,b,S);P.tile=T,e.push(P)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const l=this.expirationTime;if(e.cacheControl){const l=c.am(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let c=!1;if(this.expirationTime>e)c=!1;else if(l)if(this.expirationTime<l)c=!0;else{const d=this.expirationTime-l;d?this.expirationTime=e+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const d=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!l.style.hasLayer(p))continue;const f=this.buckets[p],m=f.layers[0].sourceLayer||c.ai,_=d[m],g=e[m];if(!_||!g||0===Object.keys(g).length)continue;f.update(g,_,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const y=l&&l.style&&l.style.getLayer(p);y&&(this.queryPadding=Math.max(this.queryPadding,y.queryRadius(f)))}}holdingForSymbolFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<b()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(e){this.symbolFadeHoldUntil=b()+e}setDependencies(e,l){const c={};for(const e of l)c[e]=!0;this.dependencies[e]=c}hasDependency(e,l){for(const c of e){const e=this.dependencies[c];if(e)for(const c of l)if(e[c])return!0}return!1}}class _e{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,l,d){const p=String(l);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][p]=this.stateChanges[e][p]||{},c.e(this.stateChanges[e][p],d),null===this.deletedStates[e]){this.deletedStates[e]={};for(const l in this.state[e])l!==p&&(this.deletedStates[e][l]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][p]){this.deletedStates[e][p]={};for(const l in this.state[e][p])d[l]||(this.deletedStates[e][p][l]=null)}else for(const l in d)this.deletedStates[e]&&this.deletedStates[e][p]&&null===this.deletedStates[e][p][l]&&delete this.deletedStates[e][p][l]}removeFeatureState(e,l,c){if(null===this.deletedStates[e])return;const d=String(l);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&void 0!==l)null!==this.deletedStates[e][d]&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][c]=null);else if(void 0!==l)if(this.stateChanges[e]&&this.stateChanges[e][d])for(c in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][c]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,l){const d=String(l),p=c.e({},(this.state[e]||{})[d],(this.stateChanges[e]||{})[d]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const c=this.deletedStates[e][l];if(null===c)return{};for(const e in c)delete p[e]}return p}initializeTileState(e,l){e.setFeatureState(this.state,l)}coalesceChanges(e,l){const d={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const l={};for(const d in this.stateChanges[e])this.state[e][d]||(this.state[e][d]={}),c.e(this.state[e][d],this.stateChanges[e][d]),l[d]=this.state[e][d];d[e]=l}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const l={};if(null===this.deletedStates[e])for(const c in this.state[e])l[c]={},this.state[e][c]={};else for(const c in this.deletedStates[e]){if(null===this.deletedStates[e][c])this.state[e][c]={};else for(const l of Object.keys(this.deletedStates[e][c]))delete this.state[e][c][l];l[c]=this.state[e][c]}d[e]=d[e]||{},c.e(d[e],l)}this.stateChanges={},this.deletedStates={},0!==Object.keys(d).length&&e.setFeatureState(d,l)}}const Ee=89.25;function Ce(e,l){const d=c.an(l.lat,-c.ao,c.ao);return new c.P(c.Y(l.lng)*e,c.X(d)*e)}function Ae(e,l){return new c.a9(l.x/e,l.y/e).toLngLat()}function Ne(e){return e.cameraToCenterDistance*Math.min(.85*Math.tan(c.ap(90-e.pitch)),Math.tan(c.ap(Ee-e.pitch)))}function Ge(e,l){const d=e.canonical,p=l/c.aq(d.z),f=d.x+Math.pow(2,d.z)*e.wrap,m=c.ar(new Float64Array(16));return c.O(m,m,[f*p,d.y*p,0]),c.Q(m,m,[p/c.a5,p/c.a5,1]),m}function Ue(e,l,d,p,f){const m=c.a9.fromLngLat(e,l),_=f*c.as(1,e.lat),{x:g,y:y,z:b}=qe(d,p);return new c.a9(m.x+_*-g,m.y+_*-y,m.z+_*-b)}function qe(e,l){const d=c.ap(e),p=c.ap(l),f=Math.cos(-d),m=Math.sin(d);return{x:m*Math.sin(p),y:-m*Math.cos(p),z:f}}function $e(e,l,c){const d=l.intersectsFrustum(e);if(!c||0===d)return d;const p=l.intersectsPlane(c);return 0===p?0:2===d&&2===p?2:1}function He(e,l,c){let d=0;const p=(c-l)/10;for(let f=0;f<10;f++)d+=p*Math.pow(Math.cos(l+(f+.5)/10*(c-l)),e);return d}function Ye(e,l){return function(d,p,f,m,_){const g=2*((e-1)/c.at(Math.cos(c.ap(Ee-_))/Math.cos(c.ap(Ee)))-1),y=Math.acos(f/m),b=2*He(g-1,0,c.ap(_/2)),T=Math.min(c.ap(Ee),y+c.ap(_/2)),S=He(g-1,Math.min(T,y-c.ap(_/2)),T),P=Math.atan(p/f),I=Math.hypot(p,f);let C=d;return C+=c.at(m/I/Math.max(.5,Math.cos(c.ap(_/2)))),C+=g*c.at(Math.cos(P))/2,C-=c.at(Math.max(1,S/b/l))/2,C}}const et=Ye(9.314,3);function tt(e,l){const d=(l.roundZoom?Math.round:Math.floor)(e.zoom+c.at(e.tileSize/l.tileSize));return Math.max(0,d)}function it(e,l){const d=e.getCameraFrustum(),p=e.getClippingPlane(),f=e.screenPointToMercatorCoordinate(e.getCameraPoint()),m=c.a9.fromLngLat(e.center,e.elevation);f.z=m.z+Math.cos(e.pitchInRadians)*e.cameraToCenterDistance/e.worldSize;const _=e.getCoveringTilesDetailsProvider(),g=_.allowVariableZoom(e,l),y=tt(e,l),b=l.minzoom||0,T=void 0!==l.maxzoom?l.maxzoom:e.maxZoom,S=Math.min(Math.max(0,y),T),P=Math.pow(2,S),I=[P*f.x,P*f.y,0],C=[P*m.x,P*m.y,0],R=Math.hypot(m.x-f.x,m.y-f.y),L=Math.abs(m.z-f.z),F=Math.hypot(R,L),B=e=>({zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}),O=[],V=[];if(e.renderWorldCopies&&_.allowWorldCopies())for(let e=1;e<=3;e++)O.push(B(-e)),O.push(B(e));for(O.push(B(0));O.length>0;){const P=O.pop(),R=P.x,B=P.y;let j=P.fullyVisible;const G={x:R,y:B,z:P.zoom},U=_.getTileBoundingVolume(G,P.wrap,e.elevation,l);if(!j){const e=$e(d,U,p);if(0===e)continue;j=2===e}const q=_.distanceToTile2d(f.x,f.y,G,U);let Z=y;g&&(Z=(l.calculateTileZoom||et)(e.zoom+c.at(e.tileSize/l.tileSize),q,L,F,e.fov)),Z=(l.roundZoom?Math.round:Math.floor)(Z),Z=Math.max(0,Z);const W=Math.min(Z,T);if(P.wrap=_.getWrap(m,G,P.wrap),P.zoom>=W){if(P.zoom<b)continue;const e=S-P.zoom,d=I[0]-.5-(R<<e),p=I[1]-.5-(B<<e),f=l.reparseOverscaled?Math.max(P.zoom,Z):P.zoom;V.push({tileID:new c.a2(P.zoom===T?f:P.zoom,P.wrap,P.zoom,R,B),distanceSq:c.au([C[0]-.5-R,C[1]-.5-B]),tileDistanceToCamera:Math.sqrt(d*d+p*p)})}else for(let e=0;e<4;e++)O.push({zoom:P.zoom+1,x:(R<<1)+e%2,y:(B<<1)+(e>>1),wrap:P.wrap,fullyVisible:j})}return V.sort(((e,l)=>e.distanceSq-l.distanceSq)).map((e=>e.tileID))}const rt=c.aa.fromPoints([new c.P(0,0),new c.P(c.a5,c.a5)]);function ot(e){return"raster"===e||"image"===e||"video"===e}function at(e,l,c,d,p,f,m){if(!l.hasData())return!1;const{tileID:_,fadingRole:g,fadingDirection:y,fadingParentID:b}=l;if(g===Se.Base&&y===Me.Incoming&&b)return c[b.key]=b,!0;const T=Math.max(_.overscaledZ-p,f);for(let p=_.overscaledZ-1;p>=T;p--){const f=_.scaledTo(p),g=e.getLoadedTile(f);if(g)return l.setCrossFadeLogic({fadingRole:Se.Base,fadingDirection:Me.Incoming,fadingParentID:g.tileID,fadeEndTime:d+m}),g.setCrossFadeLogic({fadingRole:Se.Parent,fadingDirection:Me.Departing,fadeEndTime:d+m}),c[f.key]=f,!0}return!1}function ft(e,l,c,d,p,f){if(!l.hasData())return!1;const m=l.tileID.children(p);let _=_t(e,l,m,c,d,p,f);if(_)return!0;for(const g of m)_t(e,l,g.children(p),c,d,p,f)&&(_=!0);return _}function _t(e,l,c,d,p,f,m){if(c[0].overscaledZ>=f)return!1;let _=!1;for(const f of c){const c=e.getLoadedTile(f);if(!c)continue;const{fadingRole:g,fadingDirection:y,fadingParentID:b}=c;g===Se.Base&&y===Me.Departing&&b||(c.setCrossFadeLogic({fadingRole:Se.Base,fadingDirection:Me.Departing,fadingParentID:l.tileID,fadeEndTime:p+m}),l.setCrossFadeLogic({fadingRole:Se.Parent,fadingDirection:Me.Incoming,fadeEndTime:p+m})),d[f.key]=f,_=!0}return _}function yt(e,l,c,d){const p=e.tileID;return!!e.selfFading||!e.hasData()&&!!l.has(p)&&(e.setSelfFadeLogic(c+d),!0)}function vt(e,l){var c;e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0;let d=l.tileID.canonical.x-e.tileID.canonical.x;const p=l.tileID.canonical.y-e.tileID.canonical.y,f=Math.pow(2,e.tileID.canonical.z),m=l.tileID.key;0===d&&0===p||Math.abs(p)>1||(Math.abs(d)>1&&(1===Math.abs(d+f)?d+=f:1===Math.abs(d-f)&&(d-=f)),l.dem&&e.dem&&(e.dem.backfillBorder(l.dem,d,p),(null===(c=e.neighboringTiles)||void 0===c?void 0:c[m])&&(e.neighboringTiles[m].backfilled=!0)))}class Le{constructor(){this._tiles={}}handleWrapJump(e){const l={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+e),l[d.tileID.key]=d}this._tiles=l}setFeatureState(e,l){for(const c in this._tiles)this._tiles[c].setFeatureState(e,l)}getAllTiles(){return Object.values(this._tiles)}getAllIds(e=!1){return e?Object.values(this._tiles).map((e=>e.tileID)).sort(c.aw).map((e=>e.key)):Object.keys(this._tiles)}getTileById(e){return this._tiles[e]}setTile(e,l){this._tiles[e]=l}deleteTileById(e){delete this._tiles[e]}getLoadedTile(e){const l=this.getTileById(e.key);return(null==l?void 0:l.hasData())?l:null}isIdRenderable(e,l=!1){var c;return null===(c=this.getTileById(e))||void 0===c?void 0:c.isRenderable(l)}getRenderableIds(e=0,l){const d=[];for(const e of this.getAllIds())this.isIdRenderable(e,l)&&d.push(this.getTileById(e));return l?d.sort(((l,d)=>{const p=l.tileID,f=d.tileID,m=new c.P(p.canonical.x,p.canonical.y)._rotate(-e),_=new c.P(f.canonical.x,f.canonical.y)._rotate(-e);return p.overscaledZ-f.overscaledZ||_.y-m.y||_.x-m.x})).map((e=>e.tileID.key)):d.map((e=>e.tileID)).sort(c.aw).map((e=>e.key))}}class ke extends c.E{constructor(e,l,d){super(),this.id=e,this.dispatcher=d,this.on("data",(e=>this._dataHandler(e))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((e,l,c,d)=>{const p=new(xe(l.type))(e,l,c,d);if(p.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${p.id}`);return p})(e,l,d,this),this._inViewTiles=new Le,this._outOfViewCache=new c.ax(0,(e=>this._unloadTile(e))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new _e,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){for(const e of this._inViewTiles.getAllTiles())e.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e),this._inViewTiles=new Le}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e of this._inViewTiles.getAllTiles())if("loaded"!==e.state&&"errored"!==e.state)return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,l,d){return c._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,l,d)}catch(l){e.state="errored",404!==l.status?this._source.fire(new c.k(l,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const l of this._inViewTiles.getAllTiles())l.upload(e),l.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(e){var l;return this._inViewTiles.getRenderableIds(null===(l=this.transform)||void 0===l?void 0:l.bearingInRadians,e)}hasRenderableParent(e){const l=e.overscaledZ-1;if(l>=this._source.minzoom){const c=this.getLoadedTile(e.scaledTo(l));if(c)return this._inViewTiles.isIdRenderable(c.tileID.key)}return!1}reload(e,l=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const c of this._inViewTiles.getAllIds()){const d=this._inViewTiles.getTileById(c);l&&!this._source.shouldReloadTile(d,l)||(e?this._reloadTile(c,"expired"):"errored"!==d.state&&this._reloadTile(c,"reloading"))}}}_reloadTile(e,l){return c._(this,void 0,void 0,(function*(){const c=this._inViewTiles.getTileById(e);c&&("loading"!==c.state&&(c.state=l),yield this._loadTile(c,e,l))}))}_tileLoaded(e,l,d){e.timeAdded=b(),e.selfFading&&(e.fadeEndTime=e.timeAdded+this._rasterFadeDuration),"expired"===d&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(l,e),"raster-dem"===this.getSource().type&&e.dem&&function(e,l){var c,d;const p=l.getRenderableIds();for(const f of p){if(!e.neighboringTiles||!e.neighboringTiles[f])continue;const p=l.getTileById(f);e.neighboringTiles[f].backfilled||vt(e,p),(null===(d=null===(c=p.neighboringTiles)||void 0===c?void 0:c[e.tileID.key])||void 0===d?void 0:d.backfilled)||vt(p,e)}}(e,this._inViewTiles),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:e,coord:e.tileID}))}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._inViewTiles.getTileById(e)}_retainLoadedChildren(e,l){const c=this._getLoadedDescendents(l),d=new Set;for(const p of l){const l=c[p.key];if(!(null==l?void 0:l.length)){d.add(p);continue}const f=p.overscaledZ+ke.maxOverzooming,m=l.filter((e=>e.tileID.overscaledZ<=f));if(!m.length){d.add(p);continue}const _=Math.min(...m.map((e=>e.tileID.overscaledZ))),g=m.filter((e=>e.tileID.overscaledZ===_)).map((e=>e.tileID));for(const l of g)e[l.key]=l;this._areDescendentsComplete(g,_,p.overscaledZ)||d.add(p)}return d}_getLoadedDescendents(e){var l;const c={};for(const d of this._inViewTiles.getAllTiles().filter((e=>e.hasData())))for(const p of e)d.tileID.isChildOf(p)&&(c[l=p.key]||(c[l]=[])).push(d);return c}_areDescendentsComplete(e,l,c){return 1===e.length&&e[0].isOverscaled()?e[0].overscaledZ===l:Math.pow(4,l-c)===e.length}getLoadedTile(e){return this._inViewTiles.getLoadedTile(e)}updateCacheSize(e){const l=Math.ceil(e.width/this._source.tileSize)+1,d=Math.ceil(e.height/this._source.tileSize)+1,p=Math.floor(l*d*(null===this._maxTileCacheZoomLevels?c.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,p):p;this._outOfViewCache.setMaxSize(f)}handleWrapJump(e){const l=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);this._prevLng=e,l&&(this._inViewTiles.handleWrapJump(l),this._resetTileReloadTimers())}update(e,l){if(!this._sourceLoaded||this._paused)return;let d;this.transform=e,this.terrain=l,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new c.a2(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(d=it(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:"vector"===this._source.type&&void 0!==this.map._zoomLevelsToOverscale?e.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:l,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(d=d.filter((e=>this._source.hasTile(e))))):d=[],this.usedForTerrain&&(d=this._addTerrainIdealTiles(d));const p=0===d.length&&!this._updated&&this._didEmitContent;this._updated=!0,p&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const f=tt(e,this._source),m=this._updateRetainedTiles(d,f),_=ot(this._source.type);_&&this._rasterFadeDuration>0&&!l&&function(e,l,d,p,f,m,_){const g=b(),y=c.av(l);for(const c of l){const l=e.getTileById(c.key);l.fadingDirection!==Me.Departing&&0!==l.fadeOpacity||l.resetFadeLogic(),at(e,l,d,g,p,f,_)||ft(e,l,d,g,m,_)||yt(l,y,g,_)||l.resetFadeLogic()}}(this._inViewTiles,d,m,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),_?this._cleanUpRasterTiles(m):this._cleanUpVectorTiles(m)}_cleanUpRasterTiles(e){for(const l of this._inViewTiles.getAllIds())e[l]||this._removeTile(l)}_cleanUpVectorTiles(e){for(const l of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(l);e[l]?c.clearSymbolFadeHold():c.hasSymbolBuckets?c.holdingForSymbolFade()?c.symbolFadeFinished()&&this._removeTile(l):c.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(l)}}_addTerrainIdealTiles(e){const l=[];for(const c of e)if(c.canonical.z>this._source.minzoom){const e=c.scaledTo(c.canonical.z-1);l.push(e);const d=c.scaledTo(Math.max(this._source.minzoom,Math.min(c.canonical.z,5)));l.push(d)}return e.concat(l)}releaseSymbolFadeTiles(){for(const e of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(e).holdingForSymbolFade()&&this._removeTile(e)}_updateRetainedTiles(e,l){var c;const d=new Set;for(const l of e)this._addTile(l).hasData()||d.add(l);const p=e.reduce(((e,l)=>(e[l.key]=l,e)),{}),f=this._retainLoadedChildren(p,d),m={},_=Math.max(l-ke.maxUnderzooming,this._source.minzoom);for(const e of f){let l=this._inViewTiles.getTileById(e.key),d=null==l?void 0:l.wasRequested();for(let f=e.overscaledZ-1;f>=_;--f){const _=e.scaledTo(f);if(m[_.key])break;if(m[_.key]=!0,l=this.getTile(_),!l&&d&&(l=this._addTile(_)),l){const e=l.hasData();if((e||!(null===(c=this.map)||void 0===c?void 0:c.cancelPendingTileRequestsWhileZooming)||d)&&(p[_.key]=_),d=l.wasRequested(),e)break}}}return p}_addTile(e){let l=this._inViewTiles.getTileById(e.key);if(l)return l;l=this._outOfViewCache.getAndRemove(e),l&&(l.resetFadeLogic(),this._setTileReloadTimer(e.key,l),l.tileID=e,this._state.initializeTileState(l,this.map?this.map.painter:null));const d=l;return l||(l=new de(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(l,e.key,l.state)),l.uses++,this._inViewTiles.setTile(e.key,l),d||this._source.fire(new c.l("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(e,l){this._clearTileReloadTimer(e);const c=l.getExpiryTimeout();c&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),c))}_clearTileReloadTimer(e){const l=this._timers[e];l&&(clearTimeout(l),delete this._timers[e])}_resetTileReloadTimers(){for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(e);this._setTileReloadTimer(e,l)}}refreshTiles(e){for(const l of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(l);(this._inViewTiles.isIdRenderable(l)||"errored"==c.state)&&e.some((e=>e.equals(c.tileID.canonical)))&&this._reloadTile(l,"expired")}}_removeTile(e){const l=this._inViewTiles.getTileById(e);l&&(l.uses--,this._inViewTiles.deleteTileById(e),this._clearTileReloadTimer(e),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._outOfViewCache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}_dataHandler(e){"source"===e.dataType&&("metadata"!==e.sourceDataType?"content"===e.sourceDataType&&this._sourceLoaded&&!this._paused&&(this.reload(e.sourceDataChanged,e.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e of this._inViewTiles.getAllIds())this._removeTile(e);this._outOfViewCache.reset()}tilesIn(e,l,d){const p=[],f=this.transform;if(!f)return p;const m=f.getCoveringTilesDetailsProvider().allowWorldCopies(),_=d?f.getCameraQueryGeometry(e):e,g=e=>f.screenPointToMercatorCoordinate(e,this.terrain),y=this.transformBbox(e,g,!m),b=this.transformBbox(_,g,!m),T=this.getIds(),S=c.aa.fromPoints(b);for(let e=0;e<T.length;e++){const d=this._inViewTiles.getTileById(T[e]);if(d.holdingForSymbolFade())continue;const _=m?[d.tileID]:[d.tileID.unwrapTo(-1),d.tileID.unwrapTo(0)],g=Math.pow(2,f.zoom-d.tileID.overscaledZ),P=l*d.queryPadding*c.a5/d.tileSize/g;for(const e of _){const l=S.map((l=>e.getTilePoint(new c.a9(l.x,l.y))));if(l.expandBy(P),l.intersects(rt)){const l=y.map((l=>e.getTilePoint(l))),c=b.map((l=>e.getTilePoint(l)));p.push({tile:d,tileID:m?e:e.unwrapTo(0),queryGeometry:l,cameraQueryGeometry:c,scale:g})}}}return p}transformBbox(e,l,d){let p=e.map(l);if(d){const d=c.aa.fromPoints(e);d.shrinkBy(.001*Math.min(d.width(),d.height()));const f=d.map(l);c.aa.fromPoints(p).covers(f)||(p=p.map((e=>e.x>.5?new c.a9(e.x-1,e.y,e.z):e)))}return p}getVisibleCoordinates(e){const l=this.getRenderableIds(e).map((e=>this._inViewTiles.getTileById(e).tileID));return this.transform&&this.transform.populateCache(l),l}hasTransition(){return!!this._source.hasTransition()||!(!ot(this._source.type)||!function(e,l){if(l<=0)return!1;const c=b();for(const l of e.getAllTiles())if(l.fadeEndTime>=c)return!0;return!1}(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(e){this._rasterFadeDuration=e}setFeatureState(e,l,d){this._state.updateState(e=e||c.ai,l,d)}removeFeatureState(e,l,d){this._state.removeFeatureState(e=e||c.ai,l,d)}getFeatureState(e,l){return this._state.getState(e=e||c.ai,l)}setDependencies(e,l,c){const d=this._inViewTiles.getTileById(e);d&&d.setDependencies(l,c)}reloadTilesForDependencies(e,l){for(const c of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(c).hasDependency(e,l)&&this._reloadTile(c,"reloading");this._outOfViewCache.filter((c=>!c.hasDependency(e,l)))}areTilesLoaded(){for(const e of this._inViewTiles.getAllTiles())if("loaded"!==e.state&&"errored"!==e.state)return!1;return!0}}ke.maxUnderzooming=10,ke.maxOverzooming=3;class Fe{constructor(e,l){this.reset(e,l)}reset(e,l){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=c.an(e,0,1);let l=1,d=this._distances[l];const p=e*this.paddedLength+this.padding;for(;d<p&&l<this._distances.length;)d=this._distances[++l];const f=l-1,m=this._distances[f],_=d-m,g=_>0?(p-m)/_:0;return this.points[f].mult(1-g).add(this.points[l].mult(g))}}function bt(e,l){let c=!0;return"always"===e||"never"!==e&&"never"!==l||(c=!1),c}class Oe{constructor(e,l,c){const d=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/c),this.yCellCount=Math.ceil(l/c);for(let e=0;e<this.xCellCount*this.yCellCount;e++)d.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=l,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,l,c,d,p){this._forEachCell(l,c,d,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(l),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(p)}insertCircle(e,l,c,d){this._forEachCell(l-d,c-d,l+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(l),this.circles.push(c),this.circles.push(d)}_insertBoxCell(e,l,c,d,p,f){this.boxCells[p].push(f)}_insertCircleCell(e,l,c,d,p,f){this.circleCells[p].push(f)}_query(e,l,c,d,p,f,m){if(c<0||e>this.width||d<0||l>this.height)return[];const _=[];if(e<=0&&l<=0&&this.width<=c&&this.height<=d){if(p)return[{key:null,x1:e,y1:l,x2:c,y2:d}];for(let e=0;e<this.boxKeys.length;e++)_.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const l=this.circles[3*e],c=this.circles[3*e+1],d=this.circles[3*e+2];_.push({key:this.circleKeys[e],x1:l-d,y1:c-d,x2:l+d,y2:c+d})}}else this._forEachCell(e,l,c,d,this._queryCell,_,{hitTest:p,overlapMode:f,seenUids:{box:{},circle:{}}},m);return _}query(e,l,c,d){return this._query(e,l,c,d,!1,null)}hitTest(e,l,c,d,p,f){return this._query(e,l,c,d,!0,p,f).length>0}hitTestCircle(e,l,c,d,p){const f=e-c,m=e+c,_=l-c,g=l+c;if(m<0||f>this.width||g<0||_>this.height)return!1;const y=[];return this._forEachCell(f,_,m,g,this._queryCellCircle,y,{hitTest:!0,overlapMode:d,circle:{x:e,y:l,radius:c},seenUids:{box:{},circle:{}}},p),y.length>0}_queryCell(e,l,c,d,p,f,m,_){const{seenUids:g,hitTest:y,overlapMode:b}=m,T=this.boxCells[p];if(null!==T){const p=this.bboxes;for(const m of T)if(!g.box[m]){g.box[m]=!0;const T=4*m,S=this.boxKeys[m];if(e<=p[T+2]&&l<=p[T+3]&&c>=p[T+0]&&d>=p[T+1]&&(!_||_(S))&&(!y||!bt(b,S.overlapMode))&&(f.push({key:S,x1:p[T],y1:p[T+1],x2:p[T+2],y2:p[T+3]}),y))return!0}}const S=this.circleCells[p];if(null!==S){const p=this.circles;for(const m of S)if(!g.circle[m]){g.circle[m]=!0;const T=3*m,S=this.circleKeys[m];if(this._circleAndRectCollide(p[T],p[T+1],p[T+2],e,l,c,d)&&(!_||_(S))&&(!y||!bt(b,S.overlapMode))){const e=p[T],l=p[T+1],c=p[T+2];if(f.push({key:S,x1:e-c,y1:l-c,x2:e+c,y2:l+c}),y)return!0}}}return!1}_queryCellCircle(e,l,c,d,p,f,m,_){const{circle:g,seenUids:y,overlapMode:b}=m,T=this.boxCells[p];if(null!==T){const e=this.bboxes;for(const l of T)if(!y.box[l]){y.box[l]=!0;const c=4*l,d=this.boxKeys[l];if(this._circleAndRectCollide(g.x,g.y,g.radius,e[c+0],e[c+1],e[c+2],e[c+3])&&(!_||_(d))&&!bt(b,d.overlapMode))return f.push(!0),!0}}const S=this.circleCells[p];if(null!==S){const e=this.circles;for(const l of S)if(!y.circle[l]){y.circle[l]=!0;const c=3*l,d=this.circleKeys[l];if(this._circlesCollide(e[c],e[c+1],e[c+2],g.x,g.y,g.radius)&&(!_||_(d))&&!bt(b,d.overlapMode))return f.push(!0),!0}}}_forEachCell(e,l,c,d,p,f,m,_){const g=this._convertToXCellCoord(e),y=this._convertToYCellCoord(l),b=this._convertToXCellCoord(c),T=this._convertToYCellCoord(d);for(let S=g;S<=b;S++)for(let g=y;g<=T;g++)if(p.call(this,e,l,c,d,this.xCellCount*g+S,f,m,_))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,l,c,d,p,f){const m=d-e,_=p-l,g=c+f;return g*g>m*m+_*_}_circleAndRectCollide(e,l,c,d,p,f,m){const _=(f-d)/2,g=Math.abs(e-(d+_));if(g>_+c)return!1;const y=(m-p)/2,b=Math.abs(l-(p+y));if(b>y+c)return!1;if(g<=_||b<=y)return!0;const T=g-_,S=b-y;return T*T+S*S<=c*c}}function wt(e,l,d){const f=c.N();if(!e){const{vecSouth:e,vecEast:c}=Mt(l),d=p();d[0]=c[0],d[1]=c[1],d[2]=e[0],d[3]=e[1],m=d,(S=(g=(_=d)[0])*(T=_[3])-(b=_[2])*(y=_[1]))&&(m[0]=T*(S=1/S),m[1]=-y*S,m[2]=-b*S,m[3]=g*S),f[0]=d[0],f[1]=d[1],f[4]=d[2],f[5]=d[3]}var m,_,g,y,b,T,S;return c.Q(f,f,[1/d,1/d,1]),f}function Tt(e,l,d,p){if(e){const e=c.N();if(!l){const{vecSouth:l,vecEast:c}=Mt(d);e[0]=c[0],e[1]=c[1],e[4]=l[0],e[5]=l[1]}return c.Q(e,e,[p,p,1]),e}return d.pixelsToClipSpaceMatrix}function Mt(e){const l=Math.cos(e.rollInRadians),d=Math.sin(e.rollInRadians),p=Math.cos(e.pitchInRadians),f=Math.cos(e.bearingInRadians),m=Math.sin(e.bearingInRadians),_=c.aC();_[0]=-f*p*d-m*l,_[1]=-m*p*d+f*l;const g=c.aD(_);g<1e-9?c.aE(_):c.aF(_,_,1/g);const y=c.aC();y[0]=f*p*l-m*d,y[1]=m*p*l+f*d;const b=c.aD(y);return b<1e-9?c.aE(y):c.aF(y,y,1/b),{vecEast:y,vecSouth:_}}function At(e,l,d,p){let f;p?(f=[e,l,p(e,l),1],c.aH(f,f,d)):(f=[e,l,0,1],mi(f,f,d));const m=f[3];return{point:new c.P(f[0]/m,f[1]/m),signedDistanceFromCamera:m,isOccluded:!1}}function Lt(e,l){return.5+e/l*.5}function Ft(e,l){return e.x>=-l[0]&&e.x<=l[0]&&e.y>=-l[1]&&e.y<=l[1]}function Ot(e,l,d,p,f,m,_,g,y,b,T,S,P){const I=d?e.textSizeData:e.iconSizeData,C=c.ay(I,l.transform.zoom),R=[256/l.width*2+1,256/l.height*2+1],L=d?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;L.clear();const F=e.lineVertexArray,B=d?e.text.placedSymbolArray:e.icon.placedSymbolArray,O=l.transform.width/l.transform.height;let V=!1;for(let d=0;d<B.length;d++){const j=B.get(d);if(j.hidden||j.writingMode===c.az.vertical&&!V){fi(j.numGlyphs,L);continue}V=!1;const G=new c.P(j.anchorX,j.anchorY),U={getElevation:P,pitchedLabelPlaneMatrix:p,lineVertexArray:F,pitchWithMap:m,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:l.transform,tileAnchorPoint:G,unwrappedTileID:y,width:b,height:T,translation:S},q=ni(j.anchorX,j.anchorY,U);if(!Ft(q.point,R)){fi(j.numGlyphs,L);continue}const Z=Lt(l.transform.cameraToCenterDistance,q.signedDistanceFromCamera),W=c.aA(I,C,j),Q=m?W*l.transform.getPitchedTextCorrection(j.anchorX,j.anchorY,y)/Z:W*Z,J=Ht({projectionContext:U,pitchedLabelPlaneMatrixInverse:f,symbol:j,fontSize:Q,flip:!1,keepUpright:_,glyphOffsetArray:e.glyphOffsetArray,dynamicLayoutVertexArray:L,aspectRatio:O,rotateToLine:g});V=J.useVertical,(J.notEnoughRoom||V||J.needsFlipping&&Ht({projectionContext:U,pitchedLabelPlaneMatrixInverse:f,symbol:j,fontSize:Q,flip:!0,keepUpright:_,glyphOffsetArray:e.glyphOffsetArray,dynamicLayoutVertexArray:L,aspectRatio:O,rotateToLine:g}).notEnoughRoom)&&fi(j.numGlyphs,L)}d?e.text.dynamicLayoutVertexBuffer.updateData(L):e.icon.dynamicLayoutVertexBuffer.updateData(L)}function Ut(e,l,c,d,p,f,m,_){const g=f.glyphStartIndex+f.numGlyphs,y=f.lineStartIndex,b=f.lineStartIndex+f.lineLength,T=l.getoffsetX(f.glyphStartIndex),S=l.getoffsetX(g-1),P=ui(e*T,c,d,p,f.segment,y,b,_,m);if(!P)return null;const I=ui(e*S,c,d,p,f.segment,y,b,_,m);return I?_.projectionCache.anyProjectionOccluded?null:{first:P,last:I}:null}function Zt(e,l,d,p){return e===c.az.horizontal&&Math.abs(d.y-l.y)>Math.abs(d.x-l.x)*p?{useVertical:!0}:(e===c.az.vertical?l.y<d.y:l.x>d.x)?{needsFlipping:!0}:null}function Ht(e){const{projectionContext:l,pitchedLabelPlaneMatrixInverse:d,symbol:p,fontSize:f,flip:m,keepUpright:_,glyphOffsetArray:g,dynamicLayoutVertexArray:y,aspectRatio:b,rotateToLine:T}=e,S=f/24,P=p.lineOffsetX*S,I=p.lineOffsetY*S;let C;if(p.numGlyphs>1){const e=p.glyphStartIndex+p.numGlyphs,c=p.lineStartIndex,f=p.lineStartIndex+p.lineLength,y=Ut(S,g,P,I,m,p,T,l);if(!y)return{notEnoughRoom:!0};const R=ri(y.first.point.x,y.first.point.y,l,d),L=ri(y.last.point.x,y.last.point.y,l,d);if(_&&!m){const e=Zt(p.writingMode,R,L,b);if(e)return e}C=[y.first];for(let d=p.glyphStartIndex+1;d<e-1;d++){const e=ui(S*g.getoffsetX(d),P,I,m,p.segment,c,f,l,T);if(!e)return{notEnoughRoom:!0};C.push(e)}C.push(y.last)}else{if(_&&!m){const e=Jt(l.tileAnchorPoint.x,l.tileAnchorPoint.y,l).point,f=p.lineStartIndex+p.segment+1,m=new c.P(l.lineVertexArray.getx(f),l.lineVertexArray.gety(f)),_=Jt(m.x,m.y,l),g=_.signedDistanceFromCamera>0?_.point:Xt(l.tileAnchorPoint,m,e,1,l),y=ri(e.x,e.y,l,d),T=ri(g.x,g.y,l,d),S=Zt(p.writingMode,y,T,b);if(S)return S}const e=ui(S*g.getoffsetX(p.glyphStartIndex),P,I,m,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,l,T);if(!e||l.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};C=[e]}for(const e of C)c.aG(y,e.point,e.angle);return{}}function Xt(e,l,c,d,p){const f=e.add(e.sub(l)._unit()),m=Jt(f.x,f.y,p).point,_=c.sub(m);return c.add(_._mult(d/_.mag()))}function Kt(e,l,d){const p=l.projectionCache;if(p.projections[e])return p.projections[e];const f=new c.P(l.lineVertexArray.getx(e),l.lineVertexArray.gety(e)),m=Jt(f.x,f.y,l);if(m.signedDistanceFromCamera>0)return p.projections[e]=m.point,p.anyProjectionOccluded=p.anyProjectionOccluded||m.isOccluded,m.point;const _=e-d.direction;return Xt(0===d.distanceFromAnchor?l.tileAnchorPoint:new c.P(l.lineVertexArray.getx(_),l.lineVertexArray.gety(_)),f,d.previousVertex,d.absOffsetX-d.distanceFromAnchor+1,l)}function Jt(e,l,c){const d=e+c.translation[0],p=l+c.translation[1];let f;return c.pitchWithMap?(f=At(d,p,c.pitchedLabelPlaneMatrix,c.getElevation),f.isOccluded=!1):(f=c.transform.projectTileCoordinates(d,p,c.unwrappedTileID,c.getElevation),f.point.x=(.5*f.point.x+.5)*c.width,f.point.y=(.5*-f.point.y+.5)*c.height),f}function ri(e,l,d,p){if(d.pitchWithMap){const f=[e,l,0,1];return c.aH(f,f,p),d.transform.projectTileCoordinates(f[0]/f[3],f[1]/f[3],d.unwrappedTileID,d.getElevation).point}return{x:e/d.width*2-1,y:1-l/d.height*2}}function ni(e,l,c){return c.transform.projectTileCoordinates(e,l,c.unwrappedTileID,c.getElevation)}function li(e,l,c){return e._unit()._perp()._mult(l*c)}function ci(e,l,d,p,f,m,_,g,y){if(g.projectionCache.offsets[e])return g.projectionCache.offsets[e];const b=d.add(l);if(e+y.direction<p||e+y.direction>=f)return g.projectionCache.offsets[e]=b,b;const T=Kt(e+y.direction,g,y),S=li(T.sub(d),_,y.direction),P=d.add(S),I=T.add(S);return g.projectionCache.offsets[e]=c.aI(m,b,P,I)||b,g.projectionCache.offsets[e]}function ui(e,l,c,d,p,f,m,_,g){const y=d?e-l:e+l;let b=y>0?1:-1,T=0;d&&(b*=-1,T=Math.PI),b<0&&(T+=Math.PI);let S,P=b>0?f+p:f+p+1;_.projectionCache.cachedAnchorPoint?S=_.projectionCache.cachedAnchorPoint:(S=Jt(_.tileAnchorPoint.x,_.tileAnchorPoint.y,_).point,_.projectionCache.cachedAnchorPoint=S);let I,C,R=S,L=S,F=0,B=0;const O=Math.abs(y),V=[];let j;for(;F+B<=O;){if(P+=b,P<f||P>=m)return null;F+=B,L=R,C=I;const e={absOffsetX:O,direction:b,distanceFromAnchor:F,previousVertex:L};if(R=Kt(P,_,e),0===c)V.push(L),j=R.sub(L);else{let l;const d=R.sub(L);l=0===d.mag()?li(Kt(P+b,_,e).sub(R),c,b):li(d,c,b),C||(C=L.add(l)),I=ci(P,l,R,f,m,C,c,_,e),V.push(C),j=I.sub(C)}B=j.mag()}const G=j._mult((O-F)/B)._add(C||L),U=T+Math.atan2(R.y-L.y,R.x-L.x);return V.push(G),{point:G,angle:g?U:0,path:V}}const pi=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function fi(e,l){for(let c=0;c<e;c++){const e=l.length;l.resize(e+4),l.float32.set(pi,3*e)}}function mi(e,l,c){const d=l[0],p=l[1];return e[0]=c[0]*d+c[4]*p+c[12],e[1]=c[1]*d+c[5]*p+c[13],e[3]=c[3]*d+c[7]*p+c[15],e}const _i=100;class nt{constructor(e,l=new Oe(e.width+200,e.height+200,25),c=new Oe(e.width+200,e.height+200,25)){this.transform=e,this.grid=l,this.ignoredGrid=c,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+_i,this.screenBottomBoundary=e.height+_i,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,l,c,d,p,f,m,_,g,y,b,T){const S=this.projectAndGetPerspectiveRatio(e.anchorPointX+_[0],e.anchorPointY+_[1],p,y,T),P=c*S.perspectiveRatio;let I;if(f||m)I=this._projectCollisionBox(e,P,d,p,f,m,_,S,y,b,T);else{const l=S.x+(b?b.x*P:0),c=S.y+(b?b.y*P:0);I={allPointsOccluded:!1,box:[l+e.x1*P,c+e.y1*P,l+e.x2*P,c+e.y2*P]}}const[C,R,L,F]=I.box,B=f?I.allPointsOccluded:S.isOccluded;let O=B;return O||(O=S.perspectiveRatio<this.perspectiveRatioCutoff),O||(O=!this.isInsideGrid(C,R,L,F)),O||"always"!==l&&this.grid.hitTest(C,R,L,F,l,g)?{box:[C,R,L,F],placeable:!1,offscreen:!1,occluded:B}:{box:[C,R,L,F],placeable:!0,offscreen:this.isOffscreen(C,R,L,F),occluded:B}}placeCollisionCircles(e,l,d,p,f,m,_,g,y,b,T,S,P,I){const C=[],R=new c.P(l.anchorX,l.anchorY),L=this.getPerspectiveRatio(R.x,R.y,m,I),F=(y?f*this.transform.getPitchedTextCorrection(l.anchorX,l.anchorY,m)/L:f*L)/c.aM,B={getElevation:I,pitchedLabelPlaneMatrix:_,lineVertexArray:d,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:R,unwrappedTileID:m,width:this.transform.width,height:this.transform.height,translation:P},O=Ut(F,p,l.lineOffsetX*F,l.lineOffsetY*F,!1,l,!1,B);let V=!1,j=!1,G=!0;if(O){const l=.5*T*L+S,d=new c.P(-100,-100),p=new c.P(this.screenRightBoundary,this.screenBottomBoundary),f=new Fe,m=O.first,_=O.last;let P=[];for(let e=m.path.length-1;e>=1;e--)P.push(m.path[e]);for(let e=1;e<_.path.length;e++)P.push(_.path[e]);const I=2.5*l;if(y){const e=this.projectPathToScreenSpace(P,B);P=e.some((e=>e.signedDistanceFromCamera<=0))?[]:e.map((e=>e.point))}let R=[];if(P.length>0){const e=P[0].clone(),l=P[0].clone();for(let c=1;c<P.length;c++)e.x=Math.min(e.x,P[c].x),e.y=Math.min(e.y,P[c].y),l.x=Math.max(l.x,P[c].x),l.y=Math.max(l.y,P[c].y);R=e.x>=d.x&&l.x<=p.x&&e.y>=d.y&&l.y<=p.y?[P]:l.x<d.x||e.x>p.x||l.y<d.y||e.y>p.y?[]:c.aJ([P],d.x,d.y,p.x,p.y)}for(const c of R){f.reset(c,.25*l);let d=0;d=f.length<=.5*l?1:Math.ceil(f.paddedLength/I)+1;for(let c=0;c<d;c++){const p=c/Math.max(d-1,1),m=f.lerp(p),_=m.x+_i,y=m.y+_i;C.push(_,y,l,0);const T=_-l,S=y-l,P=_+l,I=y+l;if(G=G&&this.isOffscreen(T,S,P,I),j=j||this.isInsideGrid(T,S,P,I),"always"!==e&&this.grid.hitTestCircle(_,y,l,e,b)&&(V=!0,!g))return{circles:[],offscreen:!1,collisionDetected:V}}}}return{circles:!g&&V||!j||L<this.perspectiveRatioCutoff?[]:C,offscreen:G,collisionDetected:V}}projectPathToScreenSpace(e,l){const d=function(e,l){const d=c.N();return c.aB(d,l.pitchedLabelPlaneMatrix),e.map((e=>{const c=At(e.x,e.y,d,l.getElevation),p=l.transform.projectTileCoordinates(c.point.x,c.point.y,l.unwrappedTileID,l.getElevation);return p.point.x=(.5*p.point.x+.5)*l.width,p.point.y=(.5*-p.point.y+.5)*l.height,p}))}(e,l);return function(e){let l=0,c=0,d=0,p=0;for(let f=0;f<e.length;f++)e[f].isOccluded?(d=f+1,p=0):(p++,p>c&&(c=p,l=d));return e.slice(l,l+c)}(d)}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[],d=new c.aa;for(const p of e){const e=new c.P(p.x+_i,p.y+_i);d.extend(e),l.push(e)}const{minX:p,minY:f,maxX:m,maxY:_}=d,g=this.grid.query(p,f,m,_).concat(this.ignoredGrid.query(p,f,m,_)),y={},b={};for(const e of g){const d=e.key;if(void 0===y[d.bucketInstanceId]&&(y[d.bucketInstanceId]={}),y[d.bucketInstanceId][d.featureIndex])continue;const p=[new c.P(e.x1,e.y1),new c.P(e.x2,e.y1),new c.P(e.x2,e.y2),new c.P(e.x1,e.y2)];c.aK(l,p)&&(y[d.bucketInstanceId][d.featureIndex]=!0,void 0===b[d.bucketInstanceId]&&(b[d.bucketInstanceId]=[]),b[d.bucketInstanceId].push(d.featureIndex))}return b}insertCollisionBox(e,l,c,d,p,f){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:p,collisionGroupID:f,overlapMode:l},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,l,c,d,p,f){const m=c?this.ignoredGrid:this.grid,_={bucketInstanceId:d,featureIndex:p,collisionGroupID:f,overlapMode:l};for(let l=0;l<e.length;l+=4)m.insertCircle(_,e[l],e[l+1],e[l+2])}projectAndGetPerspectiveRatio(e,l,d,p,f){if(f){let d;p?(d=[e,l,p(e,l),1],c.aH(d,d,f)):(d=[e,l,0,1],mi(d,d,f));const m=d[3];return{x:(d[0]/m+1)/2*this.transform.width+_i,y:(-d[1]/m+1)/2*this.transform.height+_i,perspectiveRatio:.5+this.transform.cameraToCenterDistance/m*.5,isOccluded:!1,signedDistanceFromCamera:m}}{const c=this.transform.projectTileCoordinates(e,l,d,p);return{x:(c.point.x+1)/2*this.transform.width+_i,y:(1-c.point.y)/2*this.transform.height+_i,perspectiveRatio:.5+this.transform.cameraToCenterDistance/c.signedDistanceFromCamera*.5,isOccluded:c.isOccluded,signedDistanceFromCamera:c.signedDistanceFromCamera}}}getPerspectiveRatio(e,l,c,d){const p=this.transform.projectTileCoordinates(e,l,c,d);return.5+this.transform.cameraToCenterDistance/p.signedDistanceFromCamera*.5}isOffscreen(e,l,c,d){return c<_i||e>=this.screenRightBoundary||d<_i||l>this.screenBottomBoundary}isInsideGrid(e,l,c,d){return c>=0&&e<this.gridRightBoundary&&d>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const e=c.ar([]);return c.O(e,e,[-100,-100,0]),e}_projectCollisionBox(e,l,d,p,f,m,_,g,y,b,T){let S=1,P=0,I=0,C=1;const R=e.anchorPointX+_[0],L=e.anchorPointY+_[1];if(m&&!f){const e=this.projectAndGetPerspectiveRatio(R+1,L,p,y,T),l=e.x-g.x,c=Math.atan((e.y-g.y)/l)+(l<0?Math.PI:0),d=Math.sin(c),f=Math.cos(c);S=f,P=d,I=-d,C=f}else if(!m&&f){const e=Mt(this.transform);S=e.vecEast[0],P=e.vecEast[1],I=e.vecSouth[0],C=e.vecSouth[1]}let F=g.x,B=g.y,O=l;f&&(F=R,B=L,O=Math.pow(2,-(this.transform.zoom-d.overscaledZ)),O*=this.transform.getPitchedTextCorrection(R,L,p),b||(O*=c.an(.5+g.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),b&&(F+=S*b.x*O+I*b.y*O,B+=P*b.x*O+C*b.y*O);const V=e.x1*O,j=e.x2*O,G=(V+j)/2,U=e.y1*O,q=e.y2*O,Z=(U+q)/2,W=[{offsetX:V,offsetY:U},{offsetX:G,offsetY:U},{offsetX:j,offsetY:U},{offsetX:j,offsetY:Z},{offsetX:j,offsetY:q},{offsetX:G,offsetY:q},{offsetX:V,offsetY:q},{offsetX:V,offsetY:Z}];let Q=[];for(const{offsetX:e,offsetY:l}of W)Q.push(new c.P(F+S*e+I*l,B+P*e+C*l));let J=!1;if(f){const e=Q.map((e=>this.projectAndGetPerspectiveRatio(e.x,e.y,p,y,T)));J=e.some((e=>!e.isOccluded)),Q=e.map((e=>new c.P(e.x,e.y)))}else J=!0;return{box:c.aL(Q),allPointsOccluded:!J}}}class lt{constructor(e,l,c,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?l:-l))):d&&c?1:0,this.placed=c}isHidden(){return 0===this.opacity&&!this.placed}}class ct{constructor(e,l,c,d,p){this.text=new lt(e?e.text:null,l,c,p),this.icon=new lt(e?e.icon:null,l,d,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ht{constructor(e,l,c){this.text=e,this.icon=l,this.skipFade=c}}class ut{constructor(e,l,c,d,p){this.bucketInstanceId=e,this.featureIndex=l,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=p}}class dt{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const l=++this.maxGroupID;this.collisionGroups[e]={ID:l,predicate:e=>e.collisionGroupID===l}}return this.collisionGroups[e]}}function gi(e,l,d,p,f){const{horizontalAlign:m,verticalAlign:_}=c.aS(e);return new c.P(-(m-.5)*l+p[0]*f,-(_-.5)*d+p[1]*f)}class pt{constructor(e,l,c,d,p){this.transform=e.clone(),this.terrain=l,this.collisionIndex=new nt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new dt(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const l=this.terrain;return l?(c,d)=>l.getElevation(e,c,d):null}getBucketParts(e,l,d,p){const f=d.getBucket(l),m=d.latestFeatureIndex;if(!f||!m||l.id!==f.layerIds[0])return;const _=d.collisionBoxArray,g=f.layers[0].layout,y=f.layers[0].paint,b=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),T=d.tileSize/c.a5,S=d.tileID.toUnwrapped(),P="map"===g.get("text-rotation-alignment"),I=c.aN(d,1,this.transform.zoom),C=c.aO(this.collisionIndex.transform,d,y.get("text-translate"),y.get("text-translate-anchor")),R=c.aO(this.collisionIndex.transform,d,y.get("icon-translate"),y.get("icon-translate-anchor")),L=wt(P,this.transform,I);this.retainedQueryData[f.bucketInstanceId]=new ut(f.bucketInstanceId,m,f.sourceLayerIndex,f.index,d.tileID);const F={bucket:f,layout:g,translationText:C,translationIcon:R,unwrappedTileID:S,pitchedLabelPlaneMatrix:L,scale:b,textPixelRatio:T,holdingForFade:d.holdingForSymbolFade(),collisionBoxArray:_,partiallyEvaluatedTextSize:c.ay(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(p)for(const l of f.sortKeyRanges){const{sortKey:c,symbolInstanceStart:d,symbolInstanceEnd:p}=l;e.push({sortKey:c,symbolInstanceStart:d,symbolInstanceEnd:p,parameters:F})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:F})}attemptAnchorPlacement(e,l,d,p,f,m,_,g,y,b,T,S,P,I,C,R,L,F,B,O){const V=c.aP[e.textAnchor],j=[e.textOffset0,e.textOffset1],G=gi(V,d,p,j,f),U=this.collisionIndex.placeCollisionBox(l,S,g,y,b,_,m,R,T.predicate,B,G,O);if((!F||this.collisionIndex.placeCollisionBox(F,S,g,y,b,_,m,L,T.predicate,B,G,O).placeable)&&U.placeable){let e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[P.crossTileID]&&this.prevPlacement.placements[P.crossTileID]&&this.prevPlacement.placements[P.crossTileID].text&&(e=this.prevPlacement.variableOffsets[P.crossTileID].anchor),0===P.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[P.crossTileID]={textOffset:j,width:d,height:p,anchor:V,textBoxScale:f,prevAnchor:e},this.markUsedJustification(I,V,P,C),I.allowVerticalPlacement&&(this.markUsedOrientation(I,C,P),this.placedOrientations[P.crossTileID]=C),{shift:G,placedGlyphBoxes:U}}}placeLayerBucketPart(e,l,d){const{bucket:p,layout:f,translationText:m,translationIcon:_,unwrappedTileID:g,pitchedLabelPlaneMatrix:y,textPixelRatio:b,holdingForFade:T,collisionBoxArray:S,partiallyEvaluatedTextSize:P,collisionGroup:I}=e.parameters,C=f.get("text-optional"),R=f.get("icon-optional"),L=c.aQ(f,"text-overlap","text-allow-overlap"),F="always"===L,B=c.aQ(f,"icon-overlap","icon-allow-overlap"),O="always"===B,V="map"===f.get("text-rotation-alignment"),j="map"===f.get("text-pitch-alignment"),G="none"!==f.get("icon-text-fit"),U="viewport-y"===f.get("symbol-z-order"),q=F&&(O||!p.hasIconData()||R),Z=O&&(F||!p.hasTextData()||C);!p.collisionArrays&&S&&p.deserializeCollisionBoxes(S);const W=this.retainedQueryData[p.bucketInstanceId].tileID,Q=this._getTerrainElevationFunc(W),J=this.transform.getFastPathSimpleProjectionMatrix(W),re=(e,S,O)=>{var U,re;if(l[e.crossTileID])return;if(T)return void(this.placements[e.crossTileID]=new ht(!1,!1,!1));let oe=!1,le=!1,ce=!0,he=null,ue={box:null,placeable:!1,offscreen:null,occluded:!1},pe={placeable:!1},fe=null,me=null,ge=null,ye=0,xe=0,ve=0;S.textFeatureIndex?ye=S.textFeatureIndex:e.useRuntimeCollisionCircles&&(ye=e.featureIndex),S.verticalTextFeatureIndex&&(xe=S.verticalTextFeatureIndex);const be=S.textBox;if(be){const l=l=>{let d=c.az.horizontal;if(p.allowVerticalPlacement&&!l&&this.prevPlacement){const l=this.prevPlacement.placedOrientations[e.crossTileID];l&&(this.placedOrientations[e.crossTileID]=l,d=l,this.markUsedOrientation(p,d,e))}return d},f=(l,d)=>{if(p.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&S.verticalTextBox){for(const e of p.writingModes)if(e===c.az.vertical?(ue=d(),pe=ue):ue=l(),ue&&ue.placeable)break}else ue=l()},y=e.textAnchorOffsetStartIndex,T=e.textAnchorOffsetEndIndex;if(T===y){const d=(l,c)=>{const d=this.collisionIndex.placeCollisionBox(l,L,b,W,g,j,V,m,I.predicate,Q,void 0,J);return d&&d.placeable&&(this.markUsedOrientation(p,c,e),this.placedOrientations[e.crossTileID]=c),d};f((()=>d(be,c.az.horizontal)),(()=>{const l=S.verticalTextBox;return p.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&l?d(l,c.az.vertical):{box:null,offscreen:null}})),l(ue&&ue.placeable)}else{let P=c.aP[null===(re=null===(U=this.prevPlacement)||void 0===U?void 0:U.variableOffsets[e.crossTileID])||void 0===re?void 0:re.anchor];const C=(l,c,f)=>{const S=l.x2-l.x1,C=l.y2-l.y1,R=e.textBoxScale,F=G&&"never"===B?c:null;let O=null,U="never"===L?1:2,q="never";P&&U++;for(let c=0;c<U;c++){for(let c=y;c<T;c++){const d=p.textAnchorOffsets.get(c);if(P&&d.textAnchor!==P)continue;const y=this.attemptAnchorPlacement(d,l,S,C,R,V,j,b,W,g,I,q,e,p,f,m,_,F,Q);if(y&&(O=y.placedGlyphBoxes,O&&O.placeable))return oe=!0,he=y.shift,O}P?P=null:q=L}return d&&!O&&(O={box:this.collisionIndex.placeCollisionBox(be,"always",b,W,g,j,V,m,I.predicate,Q,void 0,J).box,offscreen:!1,placeable:!1,occluded:!1}),O};f((()=>C(be,S.iconBox,c.az.horizontal)),(()=>{const l=S.verticalTextBox;return p.allowVerticalPlacement&&(!ue||!ue.placeable)&&e.numVerticalGlyphVertices>0&&l?C(l,S.verticalIconBox,c.az.vertical):{box:null,occluded:!0,offscreen:null}})),ue&&(oe=ue.placeable,ce=ue.offscreen);const R=l(ue&&ue.placeable);if(!oe&&this.prevPlacement){const l=this.prevPlacement.variableOffsets[e.crossTileID];l&&(this.variableOffsets[e.crossTileID]=l,this.markUsedJustification(p,l.anchor,e,R))}}}if(fe=ue,oe=fe&&fe.placeable,ce=fe&&fe.offscreen,e.useRuntimeCollisionCircles&&e.centerJustifiedTextSymbolIndex>=0){const l=p.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),_=c.aA(p.textSizeData,P,l),b=f.get("text-padding");me=this.collisionIndex.placeCollisionCircles(L,l,p.lineVertexArray,p.glyphOffsetArray,_,g,y,d,j,I.predicate,e.collisionCircleDiameter,b,m,Q),me.circles.length&&me.collisionDetected&&!d&&c.w("Collisions detected, but collision boxes are not shown"),oe=F||me.circles.length>0&&!me.collisionDetected,ce=ce&&me.offscreen}if(S.iconFeatureIndex&&(ve=S.iconFeatureIndex),S.iconBox){const e=e=>this.collisionIndex.placeCollisionBox(e,B,b,W,g,j,V,_,I.predicate,Q,G&&he?he:void 0,J);pe&&pe.placeable&&S.verticalIconBox?(ge=e(S.verticalIconBox),le=ge.placeable):(ge=e(S.iconBox),le=ge.placeable),ce=ce&&ge.offscreen}const we=C||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,Se=R||0===e.numIconVertices;we||Se?Se?we||(le=le&&oe):oe=le&&oe:le=oe=le&&oe;const Me=le&&ge.placeable;if(oe&&fe.placeable&&this.collisionIndex.insertCollisionBox(fe.box,L,f.get("text-ignore-placement"),p.bucketInstanceId,pe&&pe.placeable&&xe?xe:ye,I.ID),Me&&this.collisionIndex.insertCollisionBox(ge.box,B,f.get("icon-ignore-placement"),p.bucketInstanceId,ve,I.ID),me&&oe&&this.collisionIndex.insertCollisionCircles(me.circles,L,f.get("text-ignore-placement"),p.bucketInstanceId,ye,I.ID),d&&this.storeCollisionData(p.bucketInstanceId,O,S,fe,ge,me),0===e.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===p.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[e.crossTileID]=new ht((oe||q)&&!(null==fe?void 0:fe.occluded),(le||Z)&&!(null==ge?void 0:ge.occluded),ce||p.justReloaded),l[e.crossTileID]=!0};if(U){if(0!==e.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const l=p.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let e=l.length-1;e>=0;--e){const c=l[e];re(p.symbolInstances.get(c),p.collisionArrays[c],c)}}else for(let l=e.symbolInstanceStart;l<e.symbolInstanceEnd;l++)re(p.symbolInstances.get(l),p.collisionArrays[l],l);p.justReloaded=!1}storeCollisionData(e,l,c,d,p,f){if(c.textBox||c.iconBox){let f,m;this.collisionBoxArrays.has(e)?f=this.collisionBoxArrays.get(e):(f=new Map,this.collisionBoxArrays.set(e,f)),f.has(l)?m=f.get(l):(m={text:null,icon:null},f.set(l,m)),c.textBox&&(m.text=d.box),c.iconBox&&(m.icon=p.box)}if(f){let l=this.collisionCircleArrays[e];void 0===l&&(l=this.collisionCircleArrays[e]=[]);for(let e=0;e<f.circles.length;e+=4)l.push(f.circles[e+0]-_i),l.push(f.circles[e+1]-_i),l.push(f.circles[e+2]),l.push(f.collisionDetected?1:0)}}markUsedJustification(e,l,d,p){let f;f=p===c.az.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[c.aR(l)];const m=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const l of m)l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=f>=0&&l!==f?0:d.crossTileID)}markUsedOrientation(e,l,d){const p=l===c.az.horizontal||l===c.az.horizontalOnly?l:0,f=l===c.az.vertical?l:0,m=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const l of m)e.text.placedSymbolArray.get(l).placedOrientation=p;d.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let c=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const d=l?l.symbolFadeChange(e):1,p=l?l.opacities:{},f=l?l.variableOffsets:{},m=l?l.placedOrientations:{};for(const e in this.placements){const l=this.placements[e],f=p[e];f?(this.opacities[e]=new ct(f,d,l.text,l.icon),c=c||l.text!==f.text.placed||l.icon!==f.icon.placed):(this.opacities[e]=new ct(null,d,l.text,l.icon,l.skipFade),c=c||l.text||l.icon)}for(const e in p){const l=p[e];if(!this.opacities[e]){const p=new ct(l,d,!1,!1);p.isHidden()||(this.opacities[e]=p,c=c||l.text.placed||l.icon.placed)}}for(const e in f)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=f[e]);for(const e in m)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=m[e]);if(l&&void 0===l.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:e)}updateLayerOpacities(e,l){const c={};for(const d of l){const l=d.getBucket(e);l&&d.latestFeatureIndex&&e.id===l.layerIds[0]&&this.updateBucketOpacities(l,d.tileID,c,d.collisionBoxArray)}}updateBucketOpacities(e,l,d,p){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const f=e.layers[0],m=f.layout,_=new ct(null,0,!1,!1,!0),g=m.get("text-allow-overlap"),y=m.get("icon-allow-overlap"),b=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),T="map"===m.get("text-rotation-alignment"),S="map"===m.get("text-pitch-alignment"),P="none"!==m.get("icon-text-fit"),I=new ct(null,0,g&&(y||!e.hasIconData()||m.get("icon-optional")),y&&(g||!e.hasTextData()||m.get("text-optional")),!0);!e.collisionArrays&&p&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(p);const C=(e,l,c)=>{for(let d=0;d<l/4;d++)e.opacityVertexArray.emplaceBack(c);e.hasVisibleVertices=e.hasVisibleVertices||c!==Li},R=this.collisionBoxArrays.get(e.bucketInstanceId);for(let l=0;l<e.symbolInstances.length;l++){const p=e.symbolInstances.get(l),{numHorizontalGlyphVertices:f,numVerticalGlyphVertices:m,crossTileID:g}=p;let y=this.opacities[g];d[g]?y=_:y||(y=I,this.opacities[g]=y),d[g]=!0;const L=p.numIconVertices>0,F=this.placedOrientations[p.crossTileID],B=F===c.az.vertical,O=F===c.az.horizontal||F===c.az.horizontalOnly;if(f>0||m>0){const l=Ai(y.text);C(e.text,f,B?Li:l),C(e.text,m,O?Li:l);const c=y.text.isHidden();[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((l=>{l>=0&&(e.text.placedSymbolArray.get(l).hidden=c||B?1:0)})),p.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).hidden=c||O?1:0);const d=this.variableOffsets[p.crossTileID];d&&this.markUsedJustification(e,d.anchor,p,F);const _=this.placedOrientations[p.crossTileID];_&&(this.markUsedJustification(e,"left",p,_),this.markUsedOrientation(e,_,p))}if(L){const l=Ai(y.icon),c=!(P&&p.verticalPlacedIconSymbolIndex&&B);p.placedIconSymbolIndex>=0&&(C(e.icon,p.numIconVertices,c?l:Li),e.icon.placedSymbolArray.get(p.placedIconSymbolIndex).hidden=y.icon.isHidden()),p.verticalPlacedIconSymbolIndex>=0&&(C(e.icon,p.numVerticalIconVertices,c?Li:l),e.icon.placedSymbolArray.get(p.verticalPlacedIconSymbolIndex).hidden=y.icon.isHidden())}const V=R&&R.has(l)?R.get(l):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const d=e.collisionArrays[l];if(d){let l=new c.P(0,0);if(d.textBox||d.verticalTextBox){let c=!0;if(b){const e=this.variableOffsets[g];e?(l=gi(e.anchor,e.width,e.height,e.textOffset,e.textBoxScale),T&&l._rotate(S?-this.transform.bearingInRadians:this.transform.bearingInRadians)):c=!1}if(d.textBox||d.verticalTextBox){let p;d.textBox&&(p=B),d.verticalTextBox&&(p=O),yi(e.textCollisionBox.collisionVertexArray,y.text.placed,!c||p,V.text,l.x,l.y)}}if(d.iconBox||d.verticalIconBox){const c=Boolean(!O&&d.verticalIconBox);let p;d.iconBox&&(p=c),d.verticalIconBox&&(p=!c),yi(e.iconCollisionBox.collisionVertexArray,y.icon.placed,p,V.icon,P?l.x:0,P?l.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,l){const c=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*c>e}setStale(){this.stale=!0}}function yi(e,l,c,d,p,f){d&&0!==d.length||(d=[0,0,0,0]);const m=d[0]-_i,_=d[1]-_i,g=d[2]-_i,y=d[3]-_i;e.emplaceBack(l?1:0,c?1:0,p||0,f||0,m,_),e.emplaceBack(l?1:0,c?1:0,p||0,f||0,g,_),e.emplaceBack(l?1:0,c?1:0,p||0,f||0,g,y),e.emplaceBack(l?1:0,c?1:0,p||0,f||0,m,y)}const xi=Math.pow(2,25),vi=Math.pow(2,24),bi=Math.pow(2,17),wi=Math.pow(2,16),Ii=Math.pow(2,9),Ei=Math.pow(2,8),Ci=Math.pow(2,1);function Ai(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const l=e.placed?1:0,c=Math.floor(127*e.opacity);return c*xi+l*vi+c*bi+l*wi+c*Ii+l*Ei+c*Ci+l}const Li=0;class Ct{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,l,c,d,p){const f=this._bucketParts;for(;this._currentTileIndex<e.length;)if(l.getBucketParts(f,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,f.sort(((e,l)=>e.sortKey-l.sortKey)));this._currentPartIndex<f.length;)if(l.placeLayerBucketPart(f[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,p())return!0;return!1}}class It{constructor(e,l,c,d,p,f,m,_){this.placement=new pt(e,l,f,m,_),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,l,c){const d=b(),p=()=>!this._forceFullPlacement&&b()-d>2;for(;this._currentPlacementIndex>=0;){const d=l[e[this._currentPlacementIndex]],f=this.placement.collisionIndex.transform.zoom;if("symbol"===d.type&&(!d.minzoom||d.minzoom<=f)&&(!d.maxzoom||d.maxzoom>f)){if(this._inProgressLayer||(this._inProgressLayer=new Ct(d)),this._inProgressLayer.continuePlacement(c[d.source],this.placement,this._showCollisionBoxes,d,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Fi=512/c.a5/2;class Et{constructor(e,l,d){this.tileID=e,this.bucketInstanceId=d,this._symbolsByKey={};const p=new Map;for(let e=0;e<l.length;e++){const c=l.get(e),d=c.key,f=p.get(d);f?f.push(c):p.set(d,[c])}for(const[e,l]of p){const d={positions:l.map((e=>({x:Math.floor(e.anchorX*Fi),y:Math.floor(e.anchorY*Fi)}))),crossTileIDs:l.map((e=>e.crossTileID))};if(d.positions.length>128){const e=new c.aT(d.positions.length,16,Uint16Array);for(const{x:l,y:c}of d.positions)e.add(l,c);e.finish(),delete d.positions,d.index=e}this._symbolsByKey[e]=d}}getScaledCoordinates(e,l){const{x:d,y:p,z:f}=this.tileID.canonical,{x:m,y:_,z:g}=l.canonical,y=Fi/Math.pow(2,g-f),b=(_*c.a5+e.anchorY)*y,T=p*c.a5*Fi;return{x:Math.floor((m*c.a5+e.anchorX)*y-d*c.a5*Fi),y:Math.floor(b-T)}}findMatches(e,l,c){const d=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let p=0;p<e.length;p++){const f=e.get(p);if(f.crossTileID)continue;const m=this._symbolsByKey[f.key];if(!m)continue;const _=this.getScaledCoordinates(f,l);if(m.index){const e=m.index.range(_.x-d,_.y-d,_.x+d,_.y+d).sort();for(const l of e){const e=m.crossTileIDs[l];if(!c[e]){c[e]=!0,f.crossTileID=e;break}}}else if(m.positions)for(let e=0;e<m.positions.length;e++){const l=m.positions[e],p=m.crossTileIDs[e];if(Math.abs(l.x-_.x)<=d&&Math.abs(l.y-_.y)<=d&&!c[p]){c[p]=!0,f.crossTileID=p;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class St{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const l=Math.round((e-this.lng)/360);if(0!==l)for(const e in this.indexes){const c=this.indexes[e],d={};for(const e in c){const p=c[e];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+l),d[p.tileID.key]=p}this.indexes[e]=d}this.lng=e}addBucket(e,l,c){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<l.symbolInstances.length;e++)l.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const c in this.indexes){const p=this.indexes[c];if(Number(c)>e.overscaledZ)for(const c in p){const f=p[c];f.tileID.isChildOf(e)&&f.findMatches(l.symbolInstances,e,d)}else{const f=p[e.scaledTo(Number(c)).key];f&&f.findMatches(l.symbolInstances,e,d)}}for(let e=0;e<l.symbolInstances.length;e++){const p=l.symbolInstances.get(e);p.crossTileID||(p.crossTileID=c.generate(),d[p.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Et(e,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(e,l){for(const c of l.getCrossTileIDsLists())for(const l of c)delete this.usedCrossTileIDs[e][l]}removeStaleBuckets(e){let l=!1;for(const c in this.indexes){const d=this.indexes[c];for(const p in d)e[d[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[p]),delete d[p],l=!0)}return l}}class Rt{constructor(){this.layerIndexes={},this.crossTileIDs=new St,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,l,c){let d=this.layerIndexes[e.id];void 0===d&&(d=this.layerIndexes[e.id]=new zt);let p=!1;const f={};d.handleWrapJump(c);for(const c of l){const l=c.getBucket(e);l&&e.id===l.layerIds[0]&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(c.tileID,l,this.crossTileIDs)&&(p=!0),f[l.bucketInstanceId]=!0)}return d.removeStaleBuckets(f)&&(p=!0),p}pruneUnusedLayers(e){const l={};e.forEach((e=>{l[e]=!0}));for(const e in this.layerIndexes)l[e]||delete this.layerIndexes[e]}}var Oi="void main() {fragColor=vec4(1.0);}";const Vi={prelude:ji("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nout highp vec4 fragColor;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c\n);}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\n#ifdef GLOBE\nif ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}\n#endif\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;"),projectionMercator:ji("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ji("","#define GLOBE_RADIUS 6371008.8\nuniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos\n);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); \nif (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len\n);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}"),background:ji("uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ji("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ji("in vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {\n#ifdef GLOBE\nvec3 center_vector=projectToSphere(circle_center);\n#endif\nfloat angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {\n#ifdef GLOBE\nvec4 projected_center=interpolateProjection(circle_center,center_vector,ele);\n#else\nvec4 projected_center=projectTileWithElevation(circle_center,ele);\n#endif\ncorner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}\n#ifdef GLOBE\nvec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);\n#else\ngl_Position=projectTileWithElevation(corner_position,ele);\n#endif\n} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:ji(Oi,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ji("uniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);\n#ifdef GLOBE\nvec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);\n#else\ngl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));\n#endif\n}"),heatmapTexture:ji("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ji("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ji("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:ji("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else\n{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:ji("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ji(Oi,"in vec2 a_pos;void main() {\n#ifdef GLOBE\ngl_Position=projectTileFor3D(a_pos,0.0);\n#else\ngl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);\n#endif\n}"),fill:ji("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nfragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_fill_translate;in vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);}"),fillOutline:ji("in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillOutlinePattern:ji("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillPattern:ji("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:ji("in vec4 v_color;void main() {fragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\nout vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);\n#ifdef GLOBE\nmat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);\n#endif\ndirectional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:ji("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\n#ifdef GLOBE\nout vec3 v_sphere_pos;\n#endif\nout vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nvec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:ji("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ji("uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];\n#define PI 3.141592653589793\n#define STANDARD 0\n#define COMBINED 1\n#define IGOR 2\n#define MULTIDIRECTIONAL 3\n#define BASIC 4\nfloat get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else\n{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else\n{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ji("uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:ji("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:ji("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:ji("uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nfloat u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}"),lineGradientSDF:ji("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nfloat u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}"),raster:ji("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;\n#ifdef GLOBE\nif (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}\n#endif\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ji("uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:ji("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:ji("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:ji("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ji("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ji("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ji("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ji("#ifdef GL_ES\nprecision highp float;\n#endif\nin vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758\n);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}","in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ji("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ji(e,l){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=l.match(/in ([\w]+) ([\w]+)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=f?f.concat(p):p,_={};return{fragmentSource:e=e.replace(c,((e,l,c,d,p)=>(_[p]=!0,"define"===l?`\n#ifndef HAS_UNIFORM_u_${p}\nin ${c} ${d} ${p};\n#else\nuniform ${c} ${d} u_${p};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${p}\n    ${c} ${d} ${p} = u_${p};\n#endif\n`))),vertexSource:l=l.replace(c,((e,l,c,d,p)=>{const f="float"===d?"vec2":"vec4",m=p.match(/color/)?"color":f;return _[p]?"define"===l?`\n#ifndef HAS_UNIFORM_u_${p}\nuniform lowp float u_${p}_t;\nin ${c} ${f} a_${p};\nout ${c} ${d} ${p};\n#else\nuniform ${c} ${d} u_${p};\n#endif\n`:"vec4"===m?`\n#ifndef HAS_UNIFORM_u_${p}\n    ${p} = a_${p};\n#else\n    ${c} ${d} ${p} = u_${p};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${p}\n    ${p} = unpack_mix_${m}(a_${p}, u_${p}_t);\n#else\n    ${c} ${d} ${p} = u_${p};\n#endif\n`:"define"===l?`\n#ifndef HAS_UNIFORM_u_${p}\nuniform lowp float u_${p}_t;\nin ${c} ${f} a_${p};\n#else\nuniform ${c} ${d} u_${p};\n#endif\n`:"vec4"===m?`\n#ifndef HAS_UNIFORM_u_${p}\n    ${c} ${d} ${p} = a_${p};\n#else\n    ${c} ${d} ${p} = u_${p};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${p}\n    ${c} ${d} ${p} = unpack_mix_${m}(a_${p}, u_${p}_t);\n#else\n    ${c} ${d} ${p} = u_${p};\n#endif\n`})),staticAttributes:d,staticUniforms:m}}class kt{constructor(e,l,c){this.vertexBuffer=e,this.indexBuffer=l,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ni=c.aU([{name:"a_pos",type:"Int16",components:2}]);const Gi="#define PROJECTION_MERCATOR",Ui="mercator";class jt{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Ui}get shaderDefine(){return Gi}get shaderPreludeCode(){return Vi.projectionMercator}get vertexShaderPreludeCode(){return Vi.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,l,d,p,f){if(this._cachedMesh)return this._cachedMesh;const m=new c.aW;m.emplaceBack(0,0),m.emplaceBack(c.a5,0),m.emplaceBack(0,c.a5),m.emplaceBack(c.a5,c.a5);const _=e.createVertexBuffer(m,Ni.members),g=c.aX.simpleSegment(0,0,4,2),y=new c.aY;y.emplaceBack(1,0,2),y.emplaceBack(1,2,3);const b=e.createIndexBuffer(y);return this._cachedMesh=new kt(_,b,g),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Nt{constructor(e=0,l=0,c=0,d=0){if(isNaN(e)||e<0||isNaN(l)||l<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=l,this.left=c,this.right=d}interpolate(e,l,d){return null!=l.top&&null!=e.top&&(this.top=c.G.number(e.top,l.top,d)),null!=l.bottom&&null!=e.bottom&&(this.bottom=c.G.number(e.bottom,l.bottom,d)),null!=l.left&&null!=e.left&&(this.left=c.G.number(e.left,l.left,d)),null!=l.right&&null!=e.right&&(this.right=c.G.number(e.right,l.right,d)),this}getCenter(e,l){const d=c.an((this.left+e-this.right)/2,0,e),p=c.an((this.top+l-this.bottom)/2,0,l);return new c.P(d,p)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Nt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function qi(e,l){if(!e.renderWorldCopies||e.lngRange)return;const c=l.lng-e.center.lng;l.lng+=c>180?-360:c<-180?360:0}function $i(e){return Math.max(0,Math.floor(e))}class Gt{constructor(e,l){var d;this.applyConstrain=(e,l)=>null!==this._constrainOverride?this._constrainOverride(e,l):this._callbacks.defaultConstrain(e,l),this._callbacks=e,this._tileSize=512,this._renderWorldCopies=void 0===(null==l?void 0:l.renderWorldCopies)||!!(null==l?void 0:l.renderWorldCopies),this._minZoom=(null==l?void 0:l.minZoom)||0,this._maxZoom=(null==l?void 0:l.maxZoom)||22,this._minPitch=null==(null==l?void 0:l.minPitch)?0:null==l?void 0:l.minPitch,this._maxPitch=null==(null==l?void 0:l.maxPitch)?60:null==l?void 0:l.maxPitch,this._constrainOverride=null!==(d=null==l?void 0:l.constrainOverride)&&void 0!==d?d:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=$i(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Nt,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,l,d){this._constrainOverride=e.constrainOverride,this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=$i(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Nt(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!d&&e.autoCalculateNearFarZ,l&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get constrainOverride(){return this._constrainOverride}setConstrainOverride(e){void 0===e&&(e=null),this._constrainOverride!==e&&(this._constrainOverride=e,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const l=c.W(e,-180,180)*Math.PI/180;var d,f,m,_,g,y,b,T,S;this._bearingInRadians!==l&&(this._unmodified=!1,this._bearingInRadians=l,this._calcMatrices(),this._rotationMatrix=p(),d=this._rotationMatrix,m=-this._bearingInRadians,_=(f=this._rotationMatrix)[0],g=f[1],y=f[2],b=f[3],T=Math.sin(m),S=Math.cos(m),d[0]=_*S+y*T,d[1]=g*S+b*T,d[2]=_*-T+y*S,d[3]=g*-T+b*S)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const l=c.an(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==l&&(this._unmodified=!1,this._pitchInRadians=l,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const l=e/180*Math.PI;this._rollInRadians!==l&&(this._unmodified=!1,this._rollInRadians=l,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aZ(this._fovInRadians)}setFov(e){e=c.an(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=c.ap(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const l=this.applyConstrain(this._center,e).zoom;this._zoom!==l&&(this._unmodified=!1,this._zoom=l,this._tileZoom=Math.max(0,Math.floor(l)),this._scale=c.aq(l),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,l){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=l,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,l,c){this._unmodified=!1,this._edgeInsets.interpolate(e,l,c),this.constrainInternal(),this._calcMatrices()}resize(e,l,c=!0){this._width=e,this._height=l,c&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&2===this._latRange.length&&this._lngRange&&2===this._lngRange.length?new $([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-c.ao,c.ao])}getCameraQueryGeometry(e,l){if(1===l.length)return[l[0],e];{const{minX:d,minY:p,maxX:f,maxY:m}=c.aa.fromPoints(l).extend(e);return[new c.P(d,p),new c.P(f,p),new c.P(f,m),new c.P(d,m),new c.P(d,p)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:l,zoom:c}=this.applyConstrain(this.center,this.zoom);this.setCenter(l),this.setZoom(c),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=c.ar(new Float64Array(16));c.Q(e,e,[this._width/2,-this._height/2,1]),c.O(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=c.ar(new Float64Array(16)),c.Q(e,e,[1,-1,1]),c.O(e,e,[-1,-1,0]),c.Q(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,l,d,p){const f=void 0!==d?d:this.bearing,m=p=void 0!==p?p:this.pitch,{distanceToCenter:_,clampedElevation:g}=this._distanceToCenterFromAltElevationPitch(l,this.elevation,m),{x:y,y:b}=qe(m,f),T=c.a9.fromLngLat(e,l);let S,P,I=c.a_(1,T.y),C=0;do{if(C+=1,C>10)break;P=_/I,S=new c.a9(T.x+y*P,T.y+b*P),I=1/S.meterInMercatorCoordinateUnits()}while(Math.abs(_-P*I)>1e-12);return{center:S.toLngLat(),elevation:g,zoom:c.at(this.height/2/Math.tan(this.fovInRadians/2)/P/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const l=1/this.worldSize,d=c.as(1,this.center.lat)*this.worldSize,p=c.a9.fromLngLat(this.center,this.elevation),f=p.x/l,m=p.y/l,_=p.z/l,g=this.pitch,y=this.bearing,{x:b,y:T,z:S}=qe(g,y),P=this.cameraToCenterDistance,I=f+P*-b,C=m+P*-T,R=_+P*S,{distanceToCenter:L,clampedElevation:F}=this._distanceToCenterFromAltElevationPitch(R/d,e,g),B=L*d,O=new c.a9((I+b*B)*l,(C+T*B)*l,0).toLngLat(),V=c.as(1,O.lat),j=c.at(this.height/2/Math.tan(this.fovInRadians/2)/L/V/this.tileSize);this._elevation=F,this._center=O,this.setZoom(j)}_distanceToCenterFromAltElevationPitch(e,l,d){const p=-Math.cos(c.ap(d)),f=e-l;let m,_=l;return p*f>=0||Math.abs(p)<.1?(m=1e4,_=e+m*p):m=-f/p,{distanceToCenter:m,clampedElevation:_}}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=c.as(1,this.center.lat)*this.worldSize;return Ue(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const l=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/l,e.canonical.y/l,1/l/c.a5,1/l/c.a5]}}class Vt{constructor(e,l){this.min=e,this.max=l,this.center=c.a$([],c.b0([],this.min,this.max),.5)}quadrant(e){const l=[e%2==0,e<2],d=c.b1(this.min),p=c.b1(this.max);for(let e=0;e<l.length;e++)d[e]=l[e]?this.min[e]:this.center[e],p[e]=l[e]?this.center[e]:this.max[e];return p[2]=this.max[2],new Vt(d,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let l=!0;for(let c=0;c<e.planes.length;c++){const d=this.intersectsPlane(e.planes[c]);if(0===d)return 0;1===d&&(l=!1)}return l?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let l=e[3],c=e[3];for(let d=0;d<3;d++)e[d]>0?(l+=e[d]*this.min[d],c+=e[d]*this.max[d]):(c+=e[d]*this.min[d],l+=e[d]*this.max[d]);return l>=0?2:c<0?0:1}}class qt{distanceToTile2d(e,l,c,d){const p=d.distanceX([e,l]),f=d.distanceY([e,l]);return Math.hypot(p,f)}getWrap(e,l,c){return c}getTileBoundingVolume(e,l,d,p){var f,m;let _=0,g=0;if(null==p?void 0:p.terrain){const y=new c.a2(e.z,l,e.z,e.x,e.y),b=p.terrain.getMinMaxElevation(y);_=null!==(f=b.minElevation)&&void 0!==f?f:Math.min(0,d),g=null!==(m=b.maxElevation)&&void 0!==m?m:Math.max(0,d)}const y=1<<e.z;return new Vt([l+e.x/y,e.y/y,_],[l+(e.x+1)/y,(e.y+1)/y,g])}allowVariableZoom(e,l){const d=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,p=c.an(78.5-d/2,0,60);return!!l.terrain||e.pitch>p}allowWorldCopies(){return!0}prepareNextFrame(){}}class Wt{constructor(e,l,c){this.points=e,this.planes=l,this.aabb=c}static fromInvProjectionMatrix(e,l=1,d=0,p,f){const m=f?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],_=Math.pow(2,d),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((d=>function(e,l,d,p){const f=c.aH([],e,l),m=1/f[3]/d*p;return c.b6(f,f,[m,m,1/f[3],m])}(d,e,l,_)));p&&function(e,l,d,p){const f=p?4:0,m=p?0:4;let _=0;const g=[],y=[];for(let l=0;l<4;l++){const d=c.b2([],e[l+m],e[l+f]),p=c.b7(d);c.a$(d,d,1/p),g.push(p),y.push(d)}for(let l=0;l<4;l++){const p=c.b8(e[l+f],y[l],d);_=null!==p&&p>=0?Math.max(_,p):Math.max(_,g[l])}const b=function(e,l){const d=c.b2([],e[l[0]],e[l[1]]),p=c.b2([],e[l[2]],e[l[1]]),f=[0,0,0,0];return c.b3(f,c.b4([],d,p)),f[3]=-c.b5(f,e[l[0]]),f}(e,l),T=function(e,l){const d=c.b9(e),p=c.ba([],e,1/d),f=c.b2([],l,c.a$([],p,c.b5(l,p))),m=c.b9(f);if(m>0){const e=Math.sqrt(1-p[3]*p[3]),d=c.a$([],p,-p[3]),_=c.b0([],d,c.a$([],f,e/m));return c.bb(l,_)}return null}(d,b);if(null!==T){const e=T/c.b5(y[0],b);_=Math.min(_,e)}for(let l=0;l<4;l++){const c=Math.min(_,g[l]);e[l+m]=[e[l+f][0]+y[l][0]*c,e[l+f][1]+y[l][1]*c,e[l+f][2]+y[l][2]*c,1]}}(g,m[0],p,f);const y=m.map((e=>{const l=c.b2([],g[e[0]],g[e[1]]),d=c.b2([],g[e[2]],g[e[1]]),p=c.b3([],c.b4([],l,d)),f=-c.b5(p,g[e[1]]);return p.concat(f)})),b=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],T=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const e of g)for(let l=0;l<3;l++)b[l]=Math.min(b[l],e[l]),T[l]=Math.max(T[l],e[l]);return new Wt(g,y,new Vt(b,T))}}class $t{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,l,c){return this._helper.interpolatePadding(e,l,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,l,c=!0){this._helper.resize(e,l,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,l){this._helper.overrideNearFarZ(e,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,l){}constructor(e){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(e,l)=>{l=c.an(+l,this.minZoom,this.maxZoom);const d={center:new c.V(e.lng,e.lat),zoom:l};let p=this._helper._lngRange;if(!this._helper._renderWorldCopies&&null===p){const e=180-1e-10;p=[-e,e]}const f=this.tileSize*c.aq(d.zoom);let m=0,_=f,g=0,y=f,b=0,T=0;const{x:S,y:P}=this.size;if(this._helper._latRange){const e=this._helper._latRange;m=c.X(e[1])*f,_=c.X(e[0])*f,_-m<P&&(b=P/(_-m))}p&&(g=c.W(c.Y(p[0])*f,0,f),y=c.W(c.Y(p[1])*f,0,f),y<g&&(y+=f),y-g<S&&(T=S/(y-g)));const{x:I,y:C}=Ce(f,e);let R,L;const F=Math.max(T||0,b||0);if(F){const e=new c.P(T?(y+g)/2:I,b?(_+m)/2:C);return d.center=Ae(f,e).wrap(),d.zoom+=c.at(F),d}if(this._helper._latRange){const e=P/2;C-e<m&&(L=m+e),C+e>_&&(L=_-e)}if(p){const e=(g+y)/2;let l=I;this._helper._renderWorldCopies&&(l=c.W(I,e-f/2,e+f/2));const d=S/2;l-d<g&&(R=g+d),l+d>y&&(R=y-d)}if(void 0!==R||void 0!==L){const e=new c.P(null!=R?R:I,null!=L?L:C);d.center=Ae(f,e).wrap()}return d},this.applyConstrain=(e,l)=>this._helper.applyConstrain(e,l),this._helper=new Gt({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(e,l)=>this.defaultConstrain(e,l)},e),this._coveringTilesDetailsProvider=new qt}clone(){const e=new $t;return e.apply(this,!1),e}apply(e,l,c){this._helper.apply(e,l,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const l=[new c.bc(0,e)];if(this._helper._renderWorldCopies){const d=this.screenPointToMercatorCoordinate(new c.P(0,0)),p=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),f=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),m=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),_=Math.floor(Math.min(d.x,p.x,f.x,m.x)),g=Math.floor(Math.max(d.x,p.x,f.x,m.x)),y=1;for(let d=_-y;d<=g+y;d++)0!==d&&l.push(new c.bc(d,e))}return l}getCameraFrustum(){return Wt.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const l=this.screenPointToLocation(this.centerPoint,e),c=e?e.getElevationForLngLatZoom(l,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(e,l){const d=c.as(this.elevation,this.center.lat),p=this.screenPointToMercatorCoordinateAtZ(l,d),f=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,d),m=c.a9.fromLngLat(e),_=new c.a9(m.x-(p.x-f.x),m.y-(p.y-f.y));this.setCenter(null==_?void 0:_.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,l){return l?this.coordinatePoint(c.a9.fromLngLat(e),l.getElevationForLngLat(e,this),this._pixelMatrix3D):this.coordinatePoint(c.a9.fromLngLat(e))}screenPointToLocation(e,l){var c;return null===(c=this.screenPointToMercatorCoordinate(e,l))||void 0===c?void 0:c.toLngLat()}screenPointToMercatorCoordinate(e,l){if(l){const c=l.pointCoordinate(e);if(null!=c)return c}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,l){const d=l||0,p=[e.x,e.y,0,1],f=[e.x,e.y,1,1];c.aH(p,p,this._pixelMatrixInverse),c.aH(f,f,this._pixelMatrixInverse);const m=p[3],_=f[3],g=p[1]/m,y=f[1]/_,b=p[2]/m,T=f[2]/_,S=b===T?0:(d-b)/(T-b);return new c.a9(c.G.number(p[0]/m,f[0]/_,S)/this.worldSize,c.G.number(g,y,S)/this.worldSize,d)}coordinatePoint(e,l=0,d=this._pixelMatrix){const p=[e.x*this.worldSize,e.y*this.worldSize,l,1];return c.aH(p,p,d),new c.P(p[0]/p[3],p[1]/p[3])}getBounds(){const e=Math.max(0,this._helper._height/2-Ne(this));return(new $).extend(this.screenPointToLocation(new c.P(0,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(e,l){return l?null!=l.pointCoordinate(e):e.y>this.height/2-Ne(this)}calculatePosMatrix(e,l=!1,d){var p;const f=null!==(p=e.key)&&void 0!==p?p:c.bd(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),m=l?this._alignedPosMatrixCache:this._posMatrixCache;if(m.has(f)){const e=m.get(f);return d?e.f32:e.f64}const _=Ge(e,this.worldSize);c.S(_,l?this._alignedProjMatrix:this._viewProjMatrix,_);const g={f64:_,f32:new Float32Array(_)};return m.set(f,g),d?g.f32:g.f64}calculateFogMatrix(e){const l=e.key,d=this._fogMatrixCacheF32;if(d.has(l))return d.get(l);const p=Ge(e,this.worldSize);return c.S(p,this._fogMatrix,p),d.set(l,new Float32Array(p)),d.get(l)}calculateCenterFromCameraLngLatAlt(e,l,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,l,c,d)}_calculateNearFarZIfNeeded(e,l,d){if(!this._helper.autoCalculateNearFarZ)return;const p=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),f=e-p*this._helper._pixelPerMeter/Math.cos(l),m=p<0?f:e,_=Math.PI/2+this.pitchInRadians,g=c.ap(this.fov)*(Math.abs(Math.cos(c.ap(this.roll)))*this.height+Math.abs(Math.sin(c.ap(this.roll)))*this.width)/this.height*(.5+d.y/this.height),y=Math.sin(g)*m/Math.sin(c.an(Math.PI-_-g,.01,Math.PI-.01)),b=Ne(this),T=Math.atan(b/this._helper.cameraToCenterDistance),S=c.ap(.75),P=T>S?2*T*(.5+d.y/(2*b)):S,I=Math.sin(P)*m/Math.sin(c.an(Math.PI-_-P,.01,Math.PI-.01)),C=Math.min(y,I);this._helper._farZ=1.01*(Math.cos(Math.PI/2-l)*C+m),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,l=Ce(this.worldSize,this.center),d=l.x,p=l.y;this._helper._pixelPerMeter=c.as(1,this.center.lat)*this.worldSize;const f=c.ap(Math.min(this.pitch,Ee)),m=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(f));let _;this._calculateNearFarZIfNeeded(m,f,e),_=new Float64Array(16),c.be(_,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.aB(this._invProjMatrix,_),_[8]=2*-e.x/this._helper._width,_[9]=2*e.y/this._helper._height,this._projectionMatrix=c.bf(_),c.Q(_,_,[1,-1,1]),c.O(_,_,[0,0,-this._helper.cameraToCenterDistance]),c.bg(_,_,-this.rollInRadians),c.bh(_,_,this.pitchInRadians),c.bg(_,_,-this.bearingInRadians),c.O(_,_,[-d,-p,0]),this._mercatorMatrix=c.Q([],_,[this.worldSize,this.worldSize,this.worldSize]),c.Q(_,_,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,_),c.O(_,_,[0,0,-this.elevation]),this._viewProjMatrix=_,this._invViewProjMatrix=c.aB([],_);const g=[0,0,-1,1];c.aH(g,g,this._invViewProjMatrix),this._cameraPosition=[g[0]/g[3],g[1]/g[3],g[2]/g[3]],this._fogMatrix=new Float64Array(16),c.be(this._fogMatrix,this.fovInRadians,this.width/this.height,m,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,c.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.O(this._fogMatrix,this._fogMatrix,[-d,-p,0]),c.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,_);const y=this._helper._width%2/2,b=this._helper._height%2/2,T=Math.cos(this.bearingInRadians),S=Math.sin(-this.bearingInRadians),P=d-Math.round(d)+T*y+S*b,I=p-Math.round(p)+T*b+S*y,C=new Float64Array(_);if(c.O(C,C,[P>.5?P-1:P,I>.5?I-1:I,0]),this._alignedProjMatrix=C,_=c.aB(new Float64Array(16),this._pixelMatrix),!_)throw new Error("failed to invert matrix");this._pixelMatrixInverse=_,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new c.P(0,0)),l=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.aH(l,l,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=c.as(1,this.center.lat)*this.worldSize;return Ue(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,l){const d=c.a9.fromLngLat(e),p=[d.x*this.worldSize,d.y*this.worldSize,l,1];return c.aH(p,p,this._viewProjMatrix),p[2]/p[3]}getProjectionData(e){const{overscaledTileID:l,aligned:d,applyTerrainMatrix:p}=e,f=this._helper.getMercatorTileCoordinates(l),m=l?this.calculatePosMatrix(l,d,!0):null;let _;return _=l&&l.terrainRttPosMatrix32f&&p?l.terrainRttPosMatrix32f:m||c.bi(),{mainMatrix:_,tileMercatorCoords:f,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:_}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,l,c){return 1}transformLightDirection(e){return c.b1(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,l,d,p){const f=this.calculatePosMatrix(d);let m;p?(m=[e,l,p(e,l),1],c.aH(m,m,f)):(m=[e,l,0,1],mi(m,m,f));const _=m[3];return{point:new c.P(m[0]/_,m[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}populateCache(e){for(const l of e)this.calculatePosMatrix(l)}getMatrixForModel(e,l){const d=c.a9.fromLngLat(e,l),p=d.meterInMercatorCoordinateUnits(),f=c.bj();return c.O(f,f,[d.x,d.y,d.z]),c.bg(f,f,Math.PI),c.bh(f,f,Math.PI/2),c.Q(f,f,[-p,p,p]),f}getProjectionDataForCustomLayer(e=!0){const l=new c.a2(0,0,0,0,0),d=this.getProjectionData({overscaledTileID:l,applyGlobeMatrix:e}),p=Ge(l,this.worldSize);c.S(p,this._viewProjMatrix,p),d.tileMercatorCoords=[0,0,1,1];const f=[c.a5,c.a5,this.worldSize/this._helper.pixelsPerMeter],m=c.bk();return c.Q(m,p,f),d.fallbackMatrix=m,d.mainMatrix=m,d}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Wi(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Hi(e){if(e.useSlerp)if(e.k<1){const l=c.bl(e.startEulerAngles.roll,e.startEulerAngles.pitch,e.startEulerAngles.bearing),d=c.bl(e.endEulerAngles.roll,e.endEulerAngles.pitch,e.endEulerAngles.bearing),p=new Float64Array(4);c.bm(p,l,d,e.k);const f=c.bn(p);e.tr.setRoll(f.roll),e.tr.setPitch(f.pitch),e.tr.setBearing(f.bearing)}else e.tr.setRoll(e.endEulerAngles.roll),e.tr.setPitch(e.endEulerAngles.pitch),e.tr.setBearing(e.endEulerAngles.bearing);else e.tr.setRoll(c.G.number(e.startEulerAngles.roll,e.endEulerAngles.roll,e.k)),e.tr.setPitch(c.G.number(e.startEulerAngles.pitch,e.endEulerAngles.pitch,e.k)),e.tr.setBearing(c.G.number(e.startEulerAngles.bearing,e.endEulerAngles.bearing,e.k))}function Xi(e,l,d,p,f){const m=f.padding,_=Ce(f.worldSize,d.getNorthWest()),g=Ce(f.worldSize,d.getNorthEast()),y=Ce(f.worldSize,d.getSouthEast()),b=Ce(f.worldSize,d.getSouthWest()),T=c.ap(-p),S=_.rotate(T),P=g.rotate(T),I=y.rotate(T),C=b.rotate(T),R=new c.P(Math.max(S.x,P.x,C.x,I.x),Math.max(S.y,P.y,C.y,I.y)),L=new c.P(Math.min(S.x,P.x,C.x,I.x),Math.min(S.y,P.y,C.y,I.y)),F=R.sub(L),B=(f.width-(m.left+m.right+l.left+l.right))/F.x,O=(f.height-(m.top+m.bottom+l.top+l.bottom))/F.y;if(O<0||B<0)return void Wi();const V=Math.min(c.at(f.scale*Math.min(B,O)),e.maxZoom),j=c.P.convert(e.offset),G=new c.P((l.left-l.right)/2,(l.top-l.bottom)/2).rotate(c.ap(p)),U=j.add(G).mult(f.scale/c.aq(V));return{center:Ae(f.worldSize,_.add(y).div(2).sub(U)),zoom:V,bearing:p}}class Yt{get useGlobeControls(){return!1}handlePanInertia(e,l){const c=e.mag(),d=Math.abs(Ne(l));return{easingOffset:e.mult(Math.min(.75*d/c,1)),easingCenter:l.center}}handleMapControlsRollPitchBearingZoom(e,l){e.bearingDelta&&l.setBearing(l.bearing+e.bearingDelta),e.pitchDelta&&l.setPitch(l.pitch+e.pitchDelta),e.rollDelta&&l.setRoll(l.roll+e.rollDelta),e.zoomDelta&&l.setZoom(l.zoom+e.zoomDelta)}handleMapControlsPan(e,l,c){e.around.distSqr(l.centerPoint)<.01||l.setLocationAtPoint(c,e.around)}cameraForBoxAndBearing(e,l,c,d,p){return Xi(e,l,c,d,p)}handleJumpToCenterZoom(e,l){e.zoom!==(void 0!==l.zoom?+l.zoom:e.zoom)&&e.setZoom(+l.zoom),void 0!==l.center&&e.setCenter(c.V.convert(l.center))}handleEaseTo(e,l){const d=e.zoom,p=e.padding,f={roll:e.roll,pitch:e.pitch,bearing:e.bearing},m={roll:void 0===l.roll?e.roll:l.roll,pitch:void 0===l.pitch?e.pitch:l.pitch,bearing:void 0===l.bearing?e.bearing:l.bearing},_=void 0!==l.zoom,g=!e.isPaddingEqual(l.padding);let y=!1;const b=_?+l.zoom:e.zoom;let T=e.centerPoint.add(l.offsetAsPoint);const S=e.screenPointToLocation(T),{center:P,zoom:I}=e.applyConstrain(c.V.convert(l.center||S),null!=b?b:d);qi(e,P);const C=Ce(e.worldSize,S),R=Ce(e.worldSize,P).sub(C),L=c.aq(I-d);return y=I!==d,{easeFunc:_=>{if(y&&e.setZoom(c.G.number(d,I,_)),c.bo(f,m)||Hi({startEulerAngles:f,endEulerAngles:m,tr:e,k:_,useSlerp:f.roll!=m.roll}),g&&(e.interpolatePadding(p,l.padding,_),T=e.centerPoint.add(l.offsetAsPoint)),l.around)e.setLocationAtPoint(l.around,l.aroundPoint);else{const l=c.aq(e.zoom-d),p=I>d?Math.min(2,L):Math.max(.5,L),f=Math.pow(p,1-_),m=Ae(e.worldSize,C.add(R.mult(_*f)).mult(l));e.setLocationAtPoint(e.renderWorldCopies?m.wrap():m,T)}},isZooming:y,elevationCenter:P}}handleFlyTo(e,l){const d=void 0!==l.zoom,p=e.zoom,f=e.applyConstrain(c.V.convert(l.center||l.locationAtOffset),d?+l.zoom:p),m=f.center,_=f.zoom;qi(e,m);const g=Ce(e.worldSize,l.locationAtOffset),y=Ce(e.worldSize,m).sub(g),b=y.mag(),T=c.aq(_-p);let S;if(void 0!==l.minZoom){const d=Math.min(+l.minZoom,p,_),f=e.applyConstrain(m,d).zoom;S=c.aq(f-p)}return{easeFunc:(l,d,f,b)=>{e.setZoom(1===l?_:p+c.at(d));const T=1===l?m:Ae(e.worldSize,g.add(y.mult(f)).mult(d));e.setLocationAtPoint(e.renderWorldCopies?T.wrap():T,b)},scaleOfZoom:T,targetCenter:m,scaleOfMinZoom:S,pixelPathLength:b}}}class Qt{constructor(e,l,c){this.blendFunction=e,this.blendColor=l,this.mask=c}}Qt.Replace=[1,0],Qt.disabled=new Qt(Qt.Replace,c.bp.transparent,[!1,!1,!1,!1]),Qt.unblended=new Qt(Qt.Replace,c.bp.transparent,[!0,!0,!0,!0]),Qt.alphaBlended=new Qt([1,771],c.bp.transparent,[!0,!0,!0,!0]);const Yi=2305;class ei{constructor(e,l,c){this.enable=e,this.mode=l,this.frontFace=c}}ei.disabled=new ei(!1,1029,Yi),ei.backCCW=new ei(!0,1029,Yi),ei.frontCCW=new ei(!0,1028,Yi);class ti{constructor(e,l,c){this.func=e,this.mask=l,this.range=c}}ti.ReadOnly=!1,ti.ReadWrite=!0,ti.disabled=new ti(519,ti.ReadOnly,[0,1]);const Ki=7680;class ai{constructor(e,l,c,d,p,f){this.test=e,this.ref=l,this.mask=c,this.fail=d,this.depthFail=p,this.pass=f}}ai.disabled=new ai({func:519,mask:0},0,0,Ki,Ki,Ki);const Qi=new WeakMap;function Ji(e){var l;if(Qi.has(e))return Qi.get(e);{const c=null===(l=e.getParameter(e.VERSION))||void 0===l?void 0:l.startsWith("WebGL 2.0");return Qi.set(e,c),c}}class si{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const l=e.context,d=l.gl;this._texFormat=d.RGBA,this._texType=d.UNSIGNED_BYTE;const p=new c.aW;p.emplaceBack(-1,-1),p.emplaceBack(2,-1),p.emplaceBack(-1,2);const f=new c.aY;f.emplaceBack(0,1,2),this._fullscreenTriangle=new kt(l.createVertexBuffer(p,Ni.members),l.createIndexBuffer(f),c.aX.simpleSegment(0,0,p.length,f.length)),this._resultBuffer=new Uint8Array(4),l.activeTexture.set(d.TEXTURE1);const m=d.createTexture();d.bindTexture(d.TEXTURE_2D,m),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texImage2D(d.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=l.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(m),Ji(d)&&(this._pbo=d.createBuffer(),d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.bufferData(d.PIXEL_PACK_BUFFER,4,d.STREAM_READ),d.bindBuffer(d.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,l){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,l),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,l=e.gl;e.activeTexture.set(l.TEXTURE1),l.bindTexture(l.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,l){const d=this._cachedRenderContext.context,p=d.gl;if(this._bindFramebuffer(),d.viewport.set([0,0,this._texWidth,this._texHeight]),d.clear({color:c.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(d,p.TRIANGLES,ti.disabled,ai.disabled,Qt.unblended,ei.disabled,((e,l)=>({u_input:e,u_output_expected:l}))(e,l),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Ji(p)){p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.readBuffer(p.COLOR_ATTACHMENT0),p.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),p.bindBuffer(p.PIXEL_PACK_BUFFER,null);const e=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);p.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:e}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Ji(e)){const l=e.clientWaitSync(this._readbackQueue.sync,0,0);if(l===e.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(l===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=si._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let l=0;return l+=e[0]/256,l+=e[1]/65536,l+=e[2]/16777216,e[3]<127&&(l=-l),l/128}}const ar=c.a5/128;function ur(e,l){const d=void 0!==e.granularity?Math.max(e.granularity,1):1,p=d+(e.generateBorders?2:0),f=d+(e.extendToNorthPole||e.generateBorders?1:0)+(e.extendToSouthPole||e.generateBorders?1:0),m=p+1,_=f+1,g=e.generateBorders?-1:0,y=e.generateBorders||e.extendToNorthPole?-1:0,b=d+(e.generateBorders?1:0),T=d+(e.generateBorders||e.extendToSouthPole?1:0),S=m*_,P=p*f*6,I=m*_>65536;if(I&&"16bit"===l)throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const C=I||"32bit"===l,R=new Int16Array(2*S);let L=0;for(let l=y;l<=T;l++)for(let p=g;p<=b;p++){let f=p/d*c.a5;-1===p&&(f=-ar),p===d+1&&(f=c.a5+ar);let m=l/d*c.a5;-1===l&&(m=e.extendToNorthPole?c.br:-ar),l===d+1&&(m=e.extendToSouthPole?c.bs:c.a5+ar),R[L++]=f,R[L++]=m}const F=C?new Uint32Array(P):new Uint16Array(P);let B=0;for(let e=0;e<f;e++)for(let l=0;l<p;l++){const c=l+1+e*m,d=l+(e+1)*m,p=l+1+(e+1)*m;F[B++]=l+e*m,F[B++]=d,F[B++]=c,F[B++]=c,F[B++]=d,F[B++]=p}return{vertices:R.buffer.slice(0),indices:F.buffer.slice(0),uses32bitIndices:C}}const gr=new c.aV({fill:new c.bt(128,2),line:new c.bt(512,0),tile:new c.bt(128,32),stencil:new c.bt(128,1),circle:3});class hi{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Vi.projectionGlobe}get vertexShaderPreludeCode(){return Vi.projectionMercator.vertexSource}get subdivisionGranularity(){return gr}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new si(e));const l=c.X(this._errorQueryLatitudeDegrees),d=2*Math.atan(Math.exp(Math.PI-l*Math.PI*2))-.5*Math.PI,p=this._errorMeasurement.updateErrorLoop(l,d),f=b();p!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=p,this._errorMeasurementLastChangeTime=f);const m=Math.min(Math.max((f-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bv(m))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,l,c,d,p){const f=("stencil"===p?gr.stencil:gr.tile).getGranularityForZoomLevel(l.z);return this._getMesh(e,{granularity:f,generateBorders:c,extendToNorthPole:0===l.y&&d,extendToSouthPole:l.y===(1<<l.z)-1&&d})}_getMesh(e,l){const d=this._getMeshKey(l);if(d in this._tileMeshCache)return this._tileMeshCache[d];const p=function(e,l){const d=ur(l,"16bit"),p=c.aW.deserialize({arrayBuffer:d.vertices,length:d.vertices.byteLength/2/2}),f=c.aY.deserialize({arrayBuffer:d.indices,length:d.indices.byteLength/2/3});return new kt(e.createVertexBuffer(p,Ni.members),e.createIndexBuffer(f),c.aX.simpleSegment(0,0,p.length,f.length))}(e,l);return this._tileMeshCache[d]=p,p}recalculate(e){}hasTransition(){const e=b();let l=!1;return l=l||(e-this._errorMeasurementLastChangeTime)/1e3<.7,l=l||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,l}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const vr=new c.t({type:new c.D(c.u.projection.type)});class di extends c.E{constructor(e){super(),this._transitionable=new c.x(vr,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0)),this._mercatorProjection=new jt,this._verticalPerspectiveProjection=new hi}get transitionState(){const e=this.properties.get("type");if("string"==typeof e&&"mercator"===e)return 0;if("string"==typeof e&&"vertical-perspective"===e)return 1;if(e instanceof c.bw){if("vertical-perspective"===e.from&&"mercator"===e.to)return 1-e.transition;if("mercator"===e.from&&"vertical-perspective"===e.to)return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,l,c,d,p){return this.currentProjection.getMeshFromTileID(e,l,c,d,p)}setProjection(e){this._transitionable.setValue("type",(null==e?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function wr(e){const l=zr(e.worldSize,e.center.lat);return 2*Math.PI*l}function Cr(e,l,d,p,f){const m=1/(1<<f),_=l/c.a5*m+p*m,g=c.bz((e/c.a5*m+d*m)*Math.PI*2+Math.PI,2*Math.PI),y=2*Math.atan(Math.exp(Math.PI-_*Math.PI*2))-.5*Math.PI,b=Math.cos(y),T=new Float64Array(3);return T[0]=Math.sin(g)*b,T[1]=Math.sin(y),T[2]=Math.cos(g)*b,T}function Dr(e){return function(e,l){const c=Math.cos(l),d=new Float64Array(3);return d[0]=Math.sin(e)*c,d[1]=Math.sin(l),d[2]=Math.cos(e)*c,d}(e.lng*Math.PI/180,e.lat*Math.PI/180)}function zr(e,l){return e/(2*Math.PI)/Math.cos(l*Math.PI/180)}function kr(e){const l=Math.asin(e[1])/Math.PI*180,d=Math.sqrt(e[0]*e[0]+e[2]*e[2]);if(d>1e-6){const p=e[0]/d,f=Math.acos(e[2]/d),m=(p>0?f:-f)/Math.PI*180;return new c.V(c.W(m,-180,180),l)}return new c.V(0,l)}function Lr(e){return Math.cos(e*Math.PI/180)}function qr(e,l){const d=Lr(e),p=Lr(l);return c.at(p/d)}function $r(e,l){const d=e.rotate(l.bearingInRadians),p=l.zoom+qr(l.center.lat,0),f=c.bu(1/Lr(l.center.lat),1/Lr(Math.min(Math.abs(l.center.lat),60)),c.bx(p,7,3,0,1)),m=360/wr({worldSize:l.worldSize,center:{lat:l.center.lat}});return new c.V(l.center.lng-d.x*m*f,c.an(l.center.lat+d.y*m,-c.ao,c.ao))}function Kr(e){const l=.5*e,c=Math.sin(l),d=Math.cos(l);return Math.log(c+d)-Math.log(d-c)}function en(e,l,d,p){const f=e.lat+d*p;if(Math.abs(d)>1){const m=(Math.sign(e.lat+d)!==Math.sign(e.lat)?-Math.abs(e.lat):Math.abs(e.lat))*Math.PI/180,_=Math.abs(e.lat+d)*Math.PI/180,g=Kr(m+p*(_-m)),y=Kr(m),b=Kr(_);return new c.V(e.lng+l*((g-y)/(b-y)),f)}return new c.V(e.lng+l*p,f)}class Ti{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,l,c,d){const p=`${e.z}_${e.x}_${e.y}_${(null==d?void 0:d.terrain)?"t":""}`,f=this._cache.get(p);if(f)return f;const m=this._cachePrevious.get(p);if(m)return this._cache.set(p,m),m;const _=this._boundingVolumeFactory(e,l,c,d);return this._cache.set(p,_),this._hadAnyChanges=!0,_}}class Pi{constructor(e,l,c,d){this.min=c,this.max=d,this.points=e,this.planes=l}static fromAabb(e,l){const c=[];for(let d=0;d<8;d++)c.push([1&~d?e[0]:l[0],1==(d>>1&1)?l[1]:e[1],1==(d>>2&1)?l[2]:e[2]]);return new Pi(c,[[-1,0,0,l[0]],[1,0,0,-e[0]],[0,-1,0,l[1]],[0,1,0,-e[1]],[0,0,-1,l[2]],[0,0,1,-e[2]]],e,l)}static fromCenterSizeAngles(e,l,d){const p=c.bB([],d[0],d[1],d[2]),f=c.bC([],[l[0],0,0],p),m=c.bC([],[0,l[1],0],p),_=c.bC([],[0,0,l[2]],p),g=[...e],y=[...e];for(let l=0;l<8;l++)for(let c=0;c<3;c++){const d=e[c]+f[c]*(1&~l?-1:1)+m[c]*(1==(l>>1&1)?1:-1)+_[c]*(1==(l>>2&1)?1:-1);g[c]=Math.min(g[c],d),y[c]=Math.max(y[c],d)}const b=[];for(let l=0;l<8;l++){const d=[...e];c.b0(d,d,c.a$([],f,1&~l?-1:1)),c.b0(d,d,c.a$([],m,1==(l>>1&1)?1:-1)),c.b0(d,d,c.a$([],_,1==(l>>2&1)?1:-1)),b.push(d)}return new Pi(b,[[...f,-c.b5(f,b[0])],[...m,-c.b5(m,b[0])],[..._,-c.b5(_,b[0])],[-f[0],-f[1],-f[2],-c.b5(f,b[7])],[-m[0],-m[1],-m[2],-c.b5(m,b[7])],[-_[0],-_[1],-_[2],-c.b5(_,b[7])]],g,y)}intersectsFrustum(e){let l=!0;const c=this.points.length,d=this.planes.length,p=e.planes.length,f=e.points.length;for(let d=0;d<p;d++){const p=e.planes[d];let f=0;for(let e=0;e<c;e++){const l=this.points[e];p[0]*l[0]+p[1]*l[1]+p[2]*l[2]+p[3]>=0&&f++}if(0===f)return 0;f<c&&(l=!1)}if(l)return 2;for(let l=0;l<d;l++){const c=this.planes[l];let d=0;for(let l=0;l<f;l++){const p=e.points[l];c[0]*p[0]+c[1]*p[1]+c[2]*p[2]+c[3]>=0&&d++}if(0===d)return 0}return 1}intersectsPlane(e){const l=this.points.length;let c=0;for(let d=0;d<l;d++){const l=this.points[d];e[0]*l[0]+e[1]*l[1]+e[2]*l[2]+e[3]>=0&&c++}return c===l?2:0===c?0:1}}function tn(e,l,c){const d=e-l;return d<0?-d:Math.max(0,d-c)}function rn(e,l,c,d,p){const f=e-c;let m;return m=f<0?Math.min(-f,1+f-p):f>1?Math.min(Math.max(f-p,0),1-f):0,Math.max(m,tn(l,d,p))}class Mi{constructor(){this._boundingVolumeCache=new Ti(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,l,c,d){const p=1<<c.z,f=1/p,m=c.x/p,_=c.y/p;let g=2;return g=Math.min(g,rn(e,l,m,_,f)),g=Math.min(g,rn(e,l,m+.5,-_-f,f)),g=Math.min(g,rn(e,l,m+.5,2-_-f,f)),g}getWrap(e,l,c){const d=1<<l.z,p=1/d,f=l.x/d,m=tn(e.x,f,p),_=tn(e.x,f-1,p),g=tn(e.x,f+1,p),y=Math.min(m,_,g);return y===g?1:y===_?-1:0}allowVariableZoom(e,l){return tt(e,l)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,l,c,d){return this._boundingVolumeCache.getTileBoundingVolume(e,l,c,d)}_computeTileBoundingVolume(e,l,d,p){var f,m;let _=0,g=0;if(null==p?void 0:p.terrain){const y=new c.a2(e.z,l,e.z,e.x,e.y),b=p.terrain.getMinMaxElevation(y);_=null!==(f=b.minElevation)&&void 0!==f?f:Math.min(0,d),g=null!==(m=b.maxElevation)&&void 0!==m?m:Math.max(0,d)}if(_/=c.bE,g/=c.bE,_+=1,g+=1,e.z<=0)return Pi.fromAabb([-g,-g,-g],[g,g,g]);if(1===e.z)return Pi.fromAabb([0===e.x?-g:0,0===e.y?0:-g,-g],[0===e.x?0:g,0===e.y?g:0,g]);{const l=[Cr(0,0,e.x,e.y,e.z),Cr(c.a5,0,e.x,e.y,e.z),Cr(c.a5,c.a5,e.x,e.y,e.z),Cr(0,c.a5,e.x,e.y,e.z)],d=[];for(const e of l)d.push(c.a$([],e,g));if(g!==_)for(const e of l)d.push(c.a$([],e,_));0===e.y&&d.push([0,1,0]),e.y===(1<<e.z)-1&&d.push([0,-1,0]);const p=[1,1,1],f=[-1,-1,-1];for(const e of d)for(let l=0;l<3;l++)p[l]=Math.min(p[l],e[l]),f[l]=Math.max(f[l],e[l]);const m=Cr(c.a5/2,c.a5/2,e.x,e.y,e.z),y=c.b4([],[0,1,0],m);c.b3(y,y);const b=c.b4([],m,y);c.b3(b,b);const T=c.b4([],l[2],l[1]);c.b3(T,T);const S=c.b4([],l[0],l[3]);c.b3(S,S),d.push(c.a$([],m,g)),e.y>=(1<<e.z)/2&&d.push(c.a$([],Cr(c.a5/2,0,e.x,e.y,e.z),g)),e.y<(1<<e.z)/2&&d.push(c.a$([],Cr(c.a5/2,c.a5,e.x,e.y,e.z),g));const P=nn(m,d),I=nn(b,d),C=[-m[0],-m[1],-m[2],P.max],R=[m[0],m[1],m[2],-P.min],L=[-b[0],-b[1],-b[2],I.max],F=[b[0],b[1],b[2],-I.min],B=[...T,0],O=[...S,0],V=[];return 0===e.y?V.push(c.bD(O,B,C),c.bD(O,B,R)):V.push(c.bD(L,B,C),c.bD(L,B,R),c.bD(L,O,C),c.bD(L,O,R)),e.y===(1<<e.z)-1?V.push(c.bD(O,B,C),c.bD(O,B,R)):V.push(c.bD(F,B,C),c.bD(F,B,R),c.bD(F,O,C),c.bD(F,O,R)),new Pi(V,[C,R,L,F,B,O],p,f)}}}function nn(e,l){let d=1/0,p=-1/0;for(const f of l){const l=c.b5(e,f);d=Math.min(d,l),p=Math.max(p,l)}return{min:d,max:p}}class Si{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,l,c){return this._helper.interpolatePadding(e,l,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,l){this._helper.resize(e,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,l){this._helper.overrideNearFarZ(e,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(e){this._cachedClippingPlane=c.bF(),this._projectionMatrix=c.bj(),this._globeViewProjMatrix32f=c.bi(),this._globeViewProjMatrixNoCorrection=c.bj(),this._globeViewProjMatrixNoCorrectionInverted=c.bj(),this._globeProjMatrixInverted=c.bj(),this._cameraPosition=c.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(e,l)=>{const d=c.an(e.lat,-c.ao,c.ao),p=c.an(+l,this.minZoom+qr(0,d),this.maxZoom);return{center:new c.V(e.lng,d),zoom:p}},this.applyConstrain=(e,l)=>this._helper.applyConstrain(e,l),this._helper=new Gt({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(e,l)=>this.defaultConstrain(e,l)},e),this._coveringTilesDetailsProvider=new Mi}clone(){const e=new Si;return e.apply(this,!1),e}apply(e,l,c){this._globeLatitudeErrorCorrectionRadians=c||0,this._helper.apply(e,l)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=c.bA();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:l,applyGlobeMatrix:c}=e,d=this._helper.getMercatorTileCoordinates(l);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:d,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const l=this.pitchInRadians,d=this.cameraToCenterDistance/e,p=Math.sin(l)*d,f=Math.cos(l)*d+1,m=1/Math.sqrt(p*p+f*f)*1;let _=-p,g=f;const y=Math.sqrt(_*_+g*g);_/=y,g/=y;const b=[0,_,g];c.bG(b,b,[0,0,0],-this.bearingInRadians),c.bH(b,b,[0,0,0],-1*this.center.lat*Math.PI/180),c.bI(b,b,[0,0,0],this.center.lng*Math.PI/180);const T=1/c.b7(b);return c.a$(b,b,T),[...b,-m*T]}isLocationOccluded(e){return!this.isSurfacePointVisible(Dr(e))}transformLightDirection(e){const l=this._helper._center.lng*Math.PI/180,d=this._helper._center.lat*Math.PI/180,p=Math.cos(d),f=[Math.sin(l)*p,Math.sin(d),Math.cos(l)*p],m=[f[2],0,-f[0]],_=[0,0,0];c.b4(_,m,f),c.b3(m,m),c.b3(_,_);const g=[0,0,0];return c.b3(g,[m[0]*e[0]+_[0]*e[1]+f[0]*e[2],m[1]*e[0]+_[1]*e[1]+f[1]*e[2],m[2]*e[0]+_[2]*e[1]+f[2]*e[2]]),g}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,l,d){const p=function(e,l,d){const p=1/(1<<d.z);return new c.a9(e/c.a5*p+d.x*p,l/c.a5*p+d.y*p)}(e,l,d.canonical),f=(m=p.y,[c.bz(p.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-m*Math.PI*2))-.5*Math.PI]);var m;return this.getCircleRadiusCorrection()/Math.cos(f[1])}projectTileCoordinates(e,l,d,p){const f=d.canonical,m=Cr(e,l,f.x,f.y,f.z),_=1+(p?p(e,l):0)/c.bE,g=[m[0]*_,m[1]*_,m[2]*_,1];c.aH(g,g,this._globeViewProjMatrixNoCorrection);const y=this._cachedClippingPlane,b=y[0]*m[0]+y[1]*m[1]+y[2]*m[2]+y[3]<0;return{point:new c.P(g[0]/g[3],g[1]/g[3]),signedDistanceFromCamera:g[3],isOccluded:b}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=zr(this.worldSize,this.center.lat),l=c.bk(),d=c.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),c.be(l,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const p=this.centerOffset;l[8]=2*-p.x/this._helper._width,l[9]=2*p.y/this._helper._height,this._projectionMatrix=c.bf(l),this._globeProjMatrixInverted=c.bk(),c.aB(this._globeProjMatrixInverted,l),c.O(l,l,[0,0,-this.cameraToCenterDistance]),c.bg(l,l,this.rollInRadians),c.bh(l,l,-this.pitchInRadians),c.bg(l,l,this.bearingInRadians),c.O(l,l,[0,0,-e]);const f=c.bA();f[0]=e,f[1]=e,f[2]=e,c.bh(d,l,this.center.lat*Math.PI/180),c.bJ(d,d,-this.center.lng*Math.PI/180),c.Q(d,d,f),this._globeViewProjMatrixNoCorrection=d,c.bh(l,l,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bJ(l,l,-this.center.lng*Math.PI/180),c.Q(l,l,f),this._globeViewProjMatrix32f=new Float32Array(l),this._globeViewProjMatrixNoCorrectionInverted=c.bk(),c.aB(this._globeViewProjMatrixNoCorrectionInverted,d);const m=c.bA();this._cameraPosition=c.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/e,c.bG(this._cameraPosition,this._cameraPosition,m,-this.rollInRadians),c.bH(this._cameraPosition,this._cameraPosition,m,this.pitchInRadians),c.bG(this._cameraPosition,this._cameraPosition,m,-this.bearingInRadians),c.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bH(this._cameraPosition,this._cameraPosition,m,-this.center.lat*Math.PI/180),c.bI(this._cameraPosition,this._cameraPosition,m,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const _=c.bf(this._globeViewProjMatrixNoCorrectionInverted);c.Q(_,_,[1,1,-1]),this._cachedFrustum=Wt.fromInvProjectionMatrix(_,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){c.w("calculateFogMatrix is not supported on globe projection.");const l=c.bk();return c.ar(l),l}getVisibleUnwrappedCoordinates(e){return[new c.bc(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,l){if(!this._globeViewProjMatrixNoCorrection)return 1;const d=Dr(e);c.a$(d,d,1+l/c.bE);const p=c.bF();return c.aH(p,[d[0],d[1],d[2],1],this._globeViewProjMatrixNoCorrection),p[2]/p[3]}populateCache(e){}getBounds(){const e=.5*this.width,l=.5*this.height,d=[new c.P(0,0),new c.P(e,0),new c.P(this.width,0),new c.P(this.width,l),new c.P(this.width,this.height),new c.P(e,this.height),new c.P(0,this.height),new c.P(0,l)],p=[];for(const e of d)p.push(this.unprojectScreenPoint(e));let f=0,m=0,_=0,g=0;const y=this.center;for(const e of p){const l=c.bK(y.lng,e.lng),d=c.bK(y.lat,e.lat);l<m&&(m=l),l>f&&(f=l),d<g&&(g=d),d>_&&(_=d)}const b=[y.lng+m,y.lat+g,y.lng+f,y.lat+_];return this.isSurfacePointOnScreen([0,1,0])&&(b[3]=90,b[0]=-180,b[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(b[1]=-90,b[0]=-180,b[2]=180),new $(b)}calculateCenterFromCameraLngLatAlt(e,l,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,l,c,d)}setLocationAtPoint(e,l){const d=Dr(this.unprojectScreenPoint(l)),p=Dr(e),f=c.bA();c.bL(f);const m=c.bA();c.bI(m,d,f,-this.center.lng*Math.PI/180),c.bH(m,m,f,this.center.lat*Math.PI/180);const _=p[0]*p[0]+p[2]*p[2],g=m[0]*m[0];if(_<g)return;const y=Math.sqrt(_-g),b=-y,T=c.bM(p[0],p[2],m[0],y),S=c.bM(p[0],p[2],m[0],b),P=c.bA();c.bI(P,p,f,-T);const I=c.bM(P[1],P[2],m[1],m[2]),C=c.bA();c.bI(C,p,f,-S);const R=c.bM(C[1],C[2],m[1],m[2]),L=.5*Math.PI,F=I>=-L&&I<=L,B=R>=-L&&R<=L;let O,V;if(F&&B){const e=this.center.lng*Math.PI/180,l=this.center.lat*Math.PI/180;c.bN(T,e)+c.bN(I,l)<c.bN(S,e)+c.bN(R,l)?(O=T,V=I):(O=S,V=R)}else if(F)O=T,V=I;else{if(!B)return;O=S,V=R}const j=O/Math.PI*180,G=V/Math.PI*180,U=this.center.lat;this.setCenter(new c.V(j,c.an(G,-90,90))),this.setZoom(this.zoom+qr(U,this.center.lat))}locationToScreenPoint(e,l){const d=Dr(e);if(l){const p=l.getElevationForLngLatZoom(e,this._helper._tileZoom);c.a$(d,d,1+p/c.bE)}return this._projectSurfacePointToScreen(d)}_projectSurfacePointToScreen(e){const l=c.bF();return c.aH(l,[...e,1],this._globeViewProjMatrixNoCorrection),l[0]/=l[3],l[1]/=l[3],new c.P((.5*l[0]+.5)*this.width,(.5*-l[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,l){if(l){const c=l.pointCoordinate(e);if(c)return c}return c.a9.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,l){var c;return null===(c=this.screenPointToMercatorCoordinate(e,l))||void 0===c?void 0:c.toLngLat()}isPointOnMapSurface(e,l){const c=this._cameraPosition,d=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(c,d)}getRayDirectionFromPixel(e){const l=c.bF();l[0]=e.x/this.width*2-1,l[1]=-1*(e.y/this.height*2-1),l[2]=1,l[3]=1,c.aH(l,l,this._globeViewProjMatrixNoCorrectionInverted),l[0]/=l[3],l[1]/=l[3],l[2]/=l[3];const d=c.bA();d[0]=l[0]-this._cameraPosition[0],d[1]=l[1]-this._cameraPosition[1],d[2]=l[2]-this._cameraPosition[2];const p=c.bA();return c.b3(p,d),p}isSurfacePointVisible(e){const l=this._cachedClippingPlane;return l[0]*e[0]+l[1]*e[1]+l[2]*e[2]+l[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const l=c.bF();return c.aH(l,[...e,1],this._globeViewProjMatrixNoCorrection),l[0]/=l[3],l[1]/=l[3],l[2]/=l[3],l[0]>-1&&l[0]<1&&l[1]>-1&&l[1]<1&&l[2]>-1&&l[2]<1}rayPlanetIntersection(e,l){const d=c.b5(e,l),p=c.bA(),f=c.bA();c.a$(f,l,d),c.b2(p,e,f);const m=1-c.b5(p,p);if(m<0)return null;const _=c.b5(e,e)-1,g=-d+(d<0?1:-1)*Math.sqrt(m),y=_/g,b=g;return{tMin:Math.min(y,b),tMax:Math.max(y,b)}}unprojectScreenPoint(e){const l=this._cameraPosition,d=this.getRayDirectionFromPixel(e),p=this.rayPlanetIntersection(l,d);if(p){const e=c.bA();c.b0(e,l,[d[0]*p.tMin,d[1]*p.tMin,d[2]*p.tMin]);const f=c.bA();return c.b3(f,e),kr(f)}const f=this._cachedClippingPlane,m=f[0]*d[0]+f[1]*d[1]+f[2]*d[2],_=-c.bb(f,l)/m,g=c.bA();if(_>0)c.b0(g,l,[d[0]*_,d[1]*_,d[2]*_]);else{const e=c.bA();c.b0(e,l,[2*d[0],2*d[1],2*d[2]]);const p=c.bb(this._cachedClippingPlane,e);c.b2(g,e,[this._cachedClippingPlane[0]*p,this._cachedClippingPlane[1]*p,this._cachedClippingPlane[2]*p])}const y=function(e){const l=c.bA();return l[0]=e[0]*-e[3],l[1]=e[1]*-e[3],l[2]=e[2]*-e[3],{center:l,radius:Math.sqrt(1-e[3]*e[3])}}(f);return kr(function(e,l,d){const p=c.bA();c.b2(p,d,e);const f=c.bA();return c.by(f,e,p,l/c.b9(p)),f}(y.center,y.radius,g))}getMatrixForModel(e,l){const d=c.V.convert(e),p=1/c.bE,f=c.bj();return c.bJ(f,f,d.lng/180*Math.PI),c.bh(f,f,-d.lat/180*Math.PI),c.O(f,f,[0,0,1+l/c.bE]),c.bh(f,f,.5*Math.PI),c.Q(f,f,[p,p,p]),f}getProjectionDataForCustomLayer(e=!0){const l=this.getProjectionData({overscaledTileID:new c.a2(0,0,0,0,0),applyGlobeMatrix:e});return l.tileMercatorCoords=[0,0,1,1],l}getFastPathSimpleProjectionMatrix(e){}}class zi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,l,c){return this._helper.interpolatePadding(e,l,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,l,c=!0){this._helper.resize(e,l,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,l){this._helper.overrideNearFarZ(e,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,l){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=l,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(e){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(e,l)=>this.currentTransform.defaultConstrain(e,l),this.applyConstrain=(e,l)=>this._helper.applyConstrain(e,l),this._helper=new Gt({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(e,l)=>this.defaultConstrain(e,l)},e),this._globeness=1,this._mercatorTransform=new $t,this._verticalPerspectiveTransform=new Si}clone(){const e=new zi;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this,!1),e}apply(e,l){this._helper.apply(e,l),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const l=this._mercatorTransform.getProjectionData(e),c=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:l.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:l.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return c.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,l,d){const p=this._mercatorTransform.getPitchedTextCorrection(e,l,d),f=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,l,d);return c.bu(p,f,this._globeness)}projectTileCoordinates(e,l,c,d){return this.currentTransform.projectTileCoordinates(e,l,c,d)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,l){return this.currentTransform.lngLatToCameraDepth(e,l)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(e,l,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,l,c,d)}setLocationAtPoint(e,l){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,l),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(e,l),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(e,l){return this.currentTransform.locationToScreenPoint(e,l)}screenPointToMercatorCoordinate(e,l){return this.currentTransform.screenPointToMercatorCoordinate(e,l)}screenPointToLocation(e,l){return this.currentTransform.screenPointToLocation(e,l)}isPointOnMapSurface(e,l){return this.currentTransform.isPointOnMapSurface(e,l)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,l){return this.currentTransform.getMatrixForModel(e,l)}getProjectionDataForCustomLayer(e=!0){const l=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return l;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return c.fallbackMatrix=l.mainMatrix,c}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Ri{get useGlobeControls(){return!0}handlePanInertia(e,l){const d=$r(e,l);return Math.abs(d.lng-l.center.lng)>180&&(d.lng=l.center.lng+179.5*Math.sign(d.lng-l.center.lng)),{easingCenter:d,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,l){const d=e.around,p=l.screenPointToLocation(d);e.bearingDelta&&l.setBearing(l.bearing+e.bearingDelta),e.pitchDelta&&l.setPitch(l.pitch+e.pitchDelta),e.rollDelta&&l.setRoll(l.roll+e.rollDelta);const f=l.zoom;e.zoomDelta&&l.setZoom(l.zoom+e.zoomDelta);const m=l.zoom-f;if(0===m)return;const _=c.bK(l.center.lng,p.lng),g=_/(Math.abs(_/180)+1),y=c.bK(l.center.lat,p.lat),b=l.getRayDirectionFromPixel(d),T=l.cameraPosition,S=-1*c.b5(T,b),P=c.bA();c.b0(P,T,[b[0]*S,b[1]*S,b[2]*S]);const I=c.b7(P)-1,C=Math.exp(.5*-Math.max(I-.3,0)),R=zr(l.worldSize,l.center.lat)/Math.min(l.width,l.height),L=c.bx(R,.9,.5,1,.25),F=(1-c.aq(-m))*Math.min(C,L),B=l.center.lat,O=l.zoom,V=new c.V(l.center.lng+g*F,c.an(l.center.lat+y*F,-c.ao,c.ao));l.setLocationAtPoint(p,d);const j=l.center,G=c.bx(Math.abs(_),45,85,0,1),U=c.bx(R,.75,.35,0,1),q=Math.pow(Math.max(G,U),.25),Z=c.bK(j.lng,V.lng),W=c.bK(j.lat,V.lat);l.setCenter(new c.V(j.lng+Z*q,j.lat+W*q).wrap()),l.setZoom(O+qr(B,l.center.lat))}handleMapControlsPan(e,l,c){if(!e.panDelta)return;const d=l.center.lat,p=l.zoom;l.setCenter($r(e.panDelta,l).wrap()),l.setZoom(p+qr(d,l.center.lat))}cameraForBoxAndBearing(e,l,d,p,f){const m=Xi(e,l,d,p,f),_=l.left/f.width*2-1,g=(f.width-l.right)/f.width*2-1,y=l.top/f.height*-2+1,b=(f.height-l.bottom)/f.height*-2+1,T=c.bK(d.getWest(),d.getEast())<0,S=T?d.getEast():d.getWest(),P=T?d.getWest():d.getEast(),I=Math.max(d.getNorth(),d.getSouth()),C=Math.min(d.getNorth(),d.getSouth()),R=S+.5*c.bK(S,P),L=I+.5*c.bK(I,C),F=f.clone();F.setCenter(m.center),F.setBearing(m.bearing),F.setPitch(0),F.setRoll(0),F.setZoom(m.zoom);const B=F.modelViewProjectionMatrix,O=[Dr(d.getNorthWest()),Dr(d.getNorthEast()),Dr(d.getSouthWest()),Dr(d.getSouthEast()),Dr(new c.V(P,L)),Dr(new c.V(S,L)),Dr(new c.V(R,I)),Dr(new c.V(R,C))],V=Dr(m.center);let j=Number.POSITIVE_INFINITY;for(const e of O)_<0&&(j=Ri.getLesserNonNegativeNonNull(j,Ri.solveVectorScale(e,V,B,"x",_))),g>0&&(j=Ri.getLesserNonNegativeNonNull(j,Ri.solveVectorScale(e,V,B,"x",g))),y>0&&(j=Ri.getLesserNonNegativeNonNull(j,Ri.solveVectorScale(e,V,B,"y",y))),b<0&&(j=Ri.getLesserNonNegativeNonNull(j,Ri.solveVectorScale(e,V,B,"y",b)));if(Number.isFinite(j)&&0!==j)return m.zoom=F.zoom+c.at(j),m;Wi()}handleJumpToCenterZoom(e,l){const d=e.center.lat,p=e.applyConstrain(l.center?c.V.convert(l.center):e.center,e.zoom).center;e.setCenter(p.wrap());const f=void 0!==l.zoom?+l.zoom:e.zoom+qr(d,p.lat);e.zoom!==f&&e.setZoom(f)}handleEaseTo(e,l){const d=e.zoom,p=e.center,f=e.padding,m={roll:e.roll,pitch:e.pitch,bearing:e.bearing},_={roll:void 0===l.roll?e.roll:l.roll,pitch:void 0===l.pitch?e.pitch:l.pitch,bearing:void 0===l.bearing?e.bearing:l.bearing},g=void 0!==l.zoom,y=!e.isPaddingEqual(l.padding);let b=!1;const T=l.center?c.V.convert(l.center):p,S=e.applyConstrain(T,d).center;qi(e,S);const P=e.clone();P.setCenter(S),P.setZoom(g?+l.zoom:d+qr(p.lat,T.lat)),P.setBearing(l.bearing);const I=new c.P(c.an(e.centerPoint.x+l.offsetAsPoint.x,0,e.width),c.an(e.centerPoint.y+l.offsetAsPoint.y,0,e.height));P.setLocationAtPoint(S,I);const C=(l.offset&&l.offsetAsPoint.mag())>0?P.center:S,R=g?+l.zoom:d+qr(p.lat,C.lat),L=d+qr(p.lat,0),F=R+qr(C.lat,0),B=c.bK(p.lng,C.lng),O=c.bK(p.lat,C.lat),V=c.aq(F-L);return b=R!==d,{easeFunc:d=>{if(c.bo(m,_)||Hi({startEulerAngles:m,endEulerAngles:_,tr:e,k:d,useSlerp:m.roll!=_.roll}),y&&e.interpolatePadding(f,l.padding,d),l.around)c.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(l.around,l.aroundPoint);else{const l=F>L?Math.min(2,V):Math.max(.5,V),c=Math.pow(l,1-d),f=en(p,B,O,d*c);e.setCenter(f.wrap())}if(b){const l=c.G.number(L,F,d)+qr(0,e.center.lat);e.setZoom(l)}},isZooming:b,elevationCenter:C}}handleFlyTo(e,l){const d=void 0!==l.zoom,p=e.center,f=e.zoom,m=e.padding,_=!e.isPaddingEqual(l.padding),g=e.applyConstrain(c.V.convert(l.center||l.locationAtOffset),f).center,y=d?+l.zoom:e.zoom+qr(e.center.lat,g.lat),b=e.clone();b.setCenter(g),b.setZoom(y),b.setBearing(l.bearing);const T=new c.P(c.an(e.centerPoint.x+l.offsetAsPoint.x,0,e.width),c.an(e.centerPoint.y+l.offsetAsPoint.y,0,e.height));b.setLocationAtPoint(g,T);const S=b.center;qi(e,S);const P=function(e,l,d){const p=Dr(l),f=Dr(d),m=c.b5(p,f),_=Math.acos(m),g=wr(e);return _/(2*Math.PI)*g}(e,p,S),I=f+qr(p.lat,0),C=y+qr(S.lat,0),R=c.aq(C-I);let L;if("number"==typeof l.minZoom){const d=+l.minZoom+qr(S.lat,0),p=Math.min(d,I,C)+qr(0,S.lat),f=e.applyConstrain(S,p).zoom+qr(S.lat,0);L=c.aq(f-I)}const F=c.bK(p.lng,S.lng),B=c.bK(p.lat,S.lat);return{easeFunc:(d,f,g,b)=>{const T=en(p,F,B,g);_&&e.interpolatePadding(m,l.padding,d);const P=1===d?S:T;e.setCenter(P.wrap());const C=I+c.at(f);e.setZoom(1===d?y:C+qr(0,P.lat))},scaleOfZoom:R,targetCenter:S,scaleOfMinZoom:L,pixelPathLength:P}}static solveVectorScale(e,l,c,d,p){const f="x"===d?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],m=[c[3],c[7],c[11],c[15]],_=e[0]*f[0]+e[1]*f[1]+e[2]*f[2],g=e[0]*m[0]+e[1]*m[1]+e[2]*m[2],y=l[0]*f[0]+l[1]*f[1]+l[2]*f[2],b=l[0]*m[0]+l[1]*m[1]+l[2]*m[2];return y+p*g===_+p*b||m[3]*(_-y)+f[3]*(b-g)+_*b==y*g?null:(y+f[3]-p*b-p*m[3])/(y-_-p*b+p*g)}static getLesserNonNegativeNonNull(e,l){return null!==l&&l>=0&&l<e?l:e}}class Di{constructor(e){this._globe=e,this._mercatorCameraHelper=new Yt,this._verticalPerspectiveCameraHelper=new Ri}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,l){return this.currentHelper.handlePanInertia(e,l)}handleMapControlsRollPitchBearingZoom(e,l){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,l)}handleMapControlsPan(e,l,c){this.currentHelper.handleMapControlsPan(e,l,c)}cameraForBoxAndBearing(e,l,c,d,p){return this.currentHelper.cameraForBoxAndBearing(e,l,c,d,p)}handleJumpToCenterZoom(e,l){this.currentHelper.handleJumpToCenterZoom(e,l)}handleEaseTo(e,l){return this.currentHelper.handleEaseTo(e,l)}handleFlyTo(e,l){return this.currentHelper.handleFlyTo(e,l)}}const sn=(e,l)=>c.B(e,l&&l.filter((e=>"source.canvas"!==e.identifier))),an=c.bO();class ki extends c.E{constructor(e,l={}){var d,p;super(),this._rtlPluginLoaded=()=>{for(const e in this.tileManagers){const l=this.tileManagers[e].getSource().type;"vector"!==l&&"geojson"!==l||this.tileManagers[e].reload()}},this.map=e,this.dispatcher=new N(oe(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((e,l)=>this.getGlyphs(e,l))),this.dispatcher.registerMessageHandler("GI",((e,l)=>this.getImages(e,l))),this.dispatcher.registerMessageHandler("GDA",((e,l)=>this.getDashes(e,l))),this.imageManager=new w,this.imageManager.setEventedParent(this);const f=(null===(d=e._container)||void 0===d?void 0:d.lang)||"undefined"!=typeof document&&(null===(p=document.documentElement)||void 0===p?void 0:p.lang)||void 0;this.glyphManager=new M(e._requestManager,l.localIdeographFontFamily,f),this.lineAtlas=new A(256,512),this.crossTileSymbolIndex=new Rt,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",c.bP()),we().on(ve,this._rtlPluginLoaded),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const l=this.tileManagers[e.sourceId];if(!l)return;const c=l.getSource();if(c&&c.vectorLayerIds)for(const e in this._layers){const l=this._layers[e];l.source===c.id&&this._validateLayer(l)}}))}_setInitialValues(){var e;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new c.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new((null===(e=this.crossTileSymbolIndex)||void 0===e?void 0:e.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(e,l){var d,p,f;this._checkLoaded();const m=null===l?null!==(f=null===(p=null===(d=this.stylesheet.state)||void 0===d?void 0:d[e])||void 0===p?void 0:p.default)&&void 0!==f?f:null:l;if(c.bR(m,this._globalState[e]))return this;this._globalState[e]=m,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const l=[];for(const d in e)!c.bR(this._globalState[d],e[d].default)&&(l.push(d),this._globalState[d]=e[d].default);this._applyGlobalStateChanges(l)}_applyGlobalStateChanges(e){if(0===e.length)return;const l=new Set,c={};for(const d of e){c[d]=this._globalState[d];for(const e in this._layers){const c=this._layers[e],p=c.getLayoutAffectingGlobalStateRefs(),f=c.getPaintAffectingGlobalStateRefs(),m=c.getVisibilityAffectingGlobalStateRefs();if(p.has(d)&&l.add(c.source),f.has(d))for(const{name:e,value:l}of f.get(d))this._updatePaintProperty(c,e,l);(null==m?void 0:m.has(d))&&(c.recalculateVisibility(),this._updateLayer(c))}}this.dispatcher.broadcast("UGS",c);for(const e in this.tileManagers)l.has(e)&&(this._reloadSource(e),this._changed=!0)}loadURL(e,l={},d){this.fire(new c.l("dataloading",{dataType:"style"})),l.validate="boolean"!=typeof l.validate||l.validate;const p=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const f=this._loadStyleRequest;c.j(p,this._loadStyleRequest).then((e=>{this._loadStyleRequest=null,this._load(e.data,l,d)})).catch((e=>{this._loadStyleRequest=null,e&&!f.signal.aborted&&this.fire(new c.k(e))}))}loadJSON(e,l={},d){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,g.frameAsync(this._frameRequest,this.map._ownerWindow).then((()=>{this._frameRequest=null,l.validate=!1!==l.validate,this._load(e,l,d)})).catch((()=>{}))}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(an,{validate:!1})}_load(e,l,d){var p,f;let m=l.transformStyle?l.transformStyle(d,e):e;if(!l.validate||!sn(this,c.C(m))){m=Object.assign({},m),this._loaded=!0,this.stylesheet=m;for(const e in m.sources)this.addSource(e,m.sources[e],{validate:!1});m.sprite?this._loadSprite(m.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(m.glyphs),this._createLayers(),this.light=new z(this.stylesheet.light),this._setProjectionInternal((null===(p=this.stylesheet.projection)||void 0===p?void 0:p.type)||"mercator"),this.sky=new D(this.stylesheet.sky),this.map.setTerrain(null!==(f=this.stylesheet.terrain)&&void 0!==f?f:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){var e,l,d;const p=c.bS(this.stylesheet.layers);this.setGlobalState(null!==(e=this.stylesheet.state)&&void 0!==e?e:null),this.dispatcher.broadcast("SL",p),this._order=p.map((e=>e.id)),this._layers={},this._serializedLayers=null;for(const e of p){const p=c.bT(e,this._globalState);if(p.setEventedParent(this,{layer:{id:e.id}}),this._layers[e.id]=p,c.bU(p)&&this.tileManagers[p.source]){const c=null!==(d=null===(l=e.paint)||void 0===l?void 0:l["raster-fade-duration"])&&void 0!==d?d:p.paint.get("raster-fade-duration");this.tileManagers[p.source].setRasterFadeDuration(c)}}}_loadSprite(e,l=!1,d=void 0){this.imageManager.setLoaded(!1);const p=new AbortController;let f;this._spriteRequest=p,function(e,l,d,p){return c._(this,void 0,void 0,(function*(){const f=F(e),m=d>1?"@2x":"",_={},y={};for(const{id:e,url:d}of f){const f=l.transformRequest(B(d,m,".json"),"SpriteJSON");_[e]=c.j(f,p);const g=l.transformRequest(B(d,m,".png"),"SpriteImage");y[e]=L.getImage(g,p)}return yield Promise.all([...Object.values(_),...Object.values(y)]),function(e,l){return c._(this,void 0,void 0,(function*(){const c={};for(const d in e){c[d]={};const p=g.getImageCanvasContext((yield l[d]).data),f=(yield e[d]).data;for(const e in f){const{width:l,height:m,x:_,y:g,sdf:y,pixelRatio:b,stretchX:T,stretchY:S,content:P,textFitWidth:I,textFitHeight:C}=f[e];c[d][e]={data:null,pixelRatio:b,sdf:y,stretchX:T,stretchY:S,content:P,textFitWidth:I,textFitHeight:C,spriteData:{width:l,height:m,x:_,y:g,context:p}}}}return c}))}(_,y)}))}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((e=>{if(this._spriteRequest=null,e)for(const c in e){this._spritesImagesIds[c]=[];const d=this._spritesImagesIds[c]?this._spritesImagesIds[c].filter((l=>!(l in e))):[];for(const e of d)this.imageManager.removeImage(e),this._changedImages[e]=!0;for(const d in e[c]){const p="default"===c?d:`${c}:${d}`;this._spritesImagesIds[c].push(p),p in this.imageManager.images?this.imageManager.updateImage(p,e[c][d],!1):this.imageManager.addImage(p,e[c][d]),l&&(this._changedImages[p]=!0)}}})).catch((e=>{this._spriteRequest=null,f=e,p.signal.aborted||this.fire(new c.k(f))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),l&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),d&&d(f)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(e){const l=this.tileManagers[e.source];if(!l)return;const d=e.sourceLayer;if(!d)return;const p=l.getSource();("geojson"===p.type||p.vectorLayerIds&&-1===p.vectorLayerIds.indexOf(d))&&this.fire(new c.k(new Error(`Source layer "${d}" does not exist on source "${p.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this.tileManagers)if(!this.tileManagers[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,l=!1){const d=this._serializedAllLayers();if(!e||0===e.length)return Object.values(l?c.bV(d):d);const p=[];for(const f of e)if(d[f]){const e=l?c.bV(d[f]):d[f];p.push(e)}return p}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const l=Object.keys(this._layers);for(const c of l){const l=this._layers[c];"custom"!==l.type&&(e[c]=l.serialize())}return e}hasTransitions(){var e,l,c;if(null===(e=this.light)||void 0===e?void 0:e.hasTransition())return!0;if(null===(l=this.sky)||void 0===l?void 0:l.hasTransition())return!0;if(null===(c=this.projection)||void 0===c?void 0:c.hasTransition())return!0;for(const e in this.tileManagers)if(this.tileManagers[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const l=this._changed;if(l){const l=Object.keys(this._updatedLayers),c=Object.keys(this._removedLayers);(l.length||c.length)&&this._updateWorkerLayers(l,c);for(const e in this._updatedSources){const l=this._updatedSources[e];if("reload"===l)this._reloadSource(e);else{if("clear"!==l)throw new Error(`Invalid action ${l}`);this._clearSource(e)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const l in this._updatedPaintProps)this._layers[l].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const d={};for(const e in this.tileManagers){const l=this.tileManagers[e];d[e]=l.used,l.used=!1}for(const l of this._order){const c=this._layers[l];c.recalculate(e,this._availableImages),!c.isHidden(e.zoom)&&c.source&&(this.tileManagers[c.source].used=!0)}for(const e in d){const l=this.tileManagers[e];!!d[e]!=!!l.used&&l.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:e}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,l&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const l in this.tileManagers)this.tileManagers[l].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.tileManagers)this.tileManagers[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,l){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,l={}){var d;this._checkLoaded();const p=this.serialize();if(e=l.transformStyle?l.transformStyle(p,e):e,(null===(d=l.validate)||void 0===d||d)&&sn(this,c.C(e)))return!1;(e=c.bV(e)).layers=c.bS(e.layers);const f=c.bW(p,e),m=this._getOperationsToPerform(f);if(m.unimplemented.length>0)throw new Error(`Unimplemented: ${m.unimplemented.join(", ")}.`);if(0===m.operations.length)return!1;for(const e of m.operations)e();return this.stylesheet=e,this._serializedLayers=null,this.fire(new c.l("style.load",{style:this})),!0}_getOperationsToPerform(e){const l=[],c=[];for(const d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":l.push((()=>this.addLayer.apply(this,d.args)));break;case"removeLayer":l.push((()=>this.removeLayer.apply(this,d.args)));break;case"setPaintProperty":l.push((()=>this.setPaintProperty.apply(this,d.args)));break;case"setLayoutProperty":l.push((()=>this.setLayoutProperty.apply(this,d.args)));break;case"setFilter":l.push((()=>this.setFilter.apply(this,d.args)));break;case"addSource":l.push((()=>this.addSource.apply(this,d.args)));break;case"removeSource":l.push((()=>this.removeSource.apply(this,d.args)));break;case"setLayerZoomRange":l.push((()=>this.setLayerZoomRange.apply(this,d.args)));break;case"setLight":l.push((()=>this.setLight.apply(this,d.args)));break;case"setGeoJSONSourceData":l.push((()=>this.setGeoJSONSourceData.apply(this,d.args)));break;case"setGlyphs":l.push((()=>this.setGlyphs.apply(this,d.args)));break;case"setSprite":l.push((()=>this.setSprite.apply(this,d.args)));break;case"setTerrain":l.push((()=>this.map.setTerrain.apply(this,d.args)));break;case"setSky":l.push((()=>this.setSky.apply(this,d.args)));break;case"setProjection":this.setProjection.apply(this,d.args);break;case"setGlobalState":l.push((()=>this.setGlobalState.apply(this,d.args)));break;case"setTransition":l.push((()=>{}));break;default:c.push(d.command)}return{operations:l,unimplemented:c}}addImage(e,l){if(this.getImage(e))return this.fire(new c.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,l),this._afterImageUpdated(e)}updateImage(e,l){this.imageManager.updateImage(e,l)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,l,d={}){if(this._checkLoaded(),void 0!==this.tileManagers[e])throw new Error(`Source "${e}" already exists.`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(c.C.source,`sources.${e}`,l,null,d))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const p=this.tileManagers[e]=new ke(e,l,this.dispatcher);p.style=this,p.setEventedParent(this,(()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:e}))),p.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),void 0===this.tileManagers[e])throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new c.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const l=this.tileManagers[e];delete this.tileManagers[e],delete this._updatedSources[e],l.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),l.setEventedParent(null),l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,l){if(this._checkLoaded(),void 0===this.tileManagers[e])throw new Error(`There is no source with this ID=${e}`);const c=this.tileManagers[e].getSource();if("geojson"!==c.type)throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(l),this._changed=!0}getSource(e){return this.tileManagers[e]&&this.tileManagers[e].getSource()}addLayer(e,l,d={}){this._checkLoaded();const p=e.id;if(this.getLayer(p))return void this.fire(new c.k(new Error(`Layer "${p}" already exists on this map.`)));let f;if("custom"===e.type){if(sn(this,c.bX(e)))return;f=c.bT(e,this._globalState)}else{if("source"in e&&"object"==typeof e.source&&(this.addSource(p,e.source),e=c.bV(e),e=c.e(e,{source:p})),this._validate(c.C.layer,`layers.${p}`,e,{arrayIndex:-1},d))return;f=c.bT(e,this._globalState),this._validateLayer(f),f.setEventedParent(this,{layer:{id:p}})}const m=l?this._order.indexOf(l):this._order.length;if(l&&-1===m)this.fire(new c.k(new Error(`Cannot add layer "${p}" before non-existing layer "${l}".`)));else{if(this._order.splice(m,0,p),this._layerOrderChanged=!0,this._layers[p]=f,this._removedLayers[p]&&f.source&&"custom"!==f.type){const e=this._removedLayers[p];delete this._removedLayers[p],e.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.tileManagers[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(e,l){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===l)return;const d=this._order.indexOf(e);this._order.splice(d,1);const p=l?this._order.indexOf(l):this._order.length;l&&-1===p?this.fire(new c.k(new Error(`Cannot move layer "${e}" before non-existing layer "${l}".`))):(this._order.splice(p,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const l=this._layers[e];if(!l)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${e}".`)));l.setEventedParent(null);const d=this._order.indexOf(e);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=l,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],l.onRemove&&l.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,l,d){this._checkLoaded();const p=this.getLayer(e);p?p.minzoom===l&&p.maxzoom===d||(null!=l&&(p.minzoom=l),null!=d&&(p.maxzoom=d),this._updateLayer(p)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,l,d={}){this._checkLoaded();const p=this.getLayer(e);if(p){if(!c.bR(p.filter,l))return null==l?(p.setFilter(void 0),void this._updateLayer(p)):void(this._validate(c.C.filter,`layers.${p.id}.filter`,l,null,d)||(p.setFilter(c.bV(l)),this._updateLayer(p)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.bV(this.getLayer(e).filter)}setLayoutProperty(e,l,d,p={}){this._checkLoaded();const f=this.getLayer(e);f?c.bR(f.getLayoutProperty(l),d)||(f.setLayoutProperty(l,d,p),this._updateLayer(f)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,l){const d=this.getLayer(e);if(d)return d.getLayoutProperty(l);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,l,d,p={}){this._checkLoaded();const f=this.getLayer(e);f?c.bR(f.getPaintProperty(l),d)||this._updatePaintProperty(f,l,d,p):this.fire(new c.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,l,d,p={}){e.setPaintProperty(l,d,p)&&this._updateLayer(e),c.bU(e)&&"raster-fade-duration"===l&&this.tileManagers[e.source].setRasterFadeDuration(d),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,l){return this.getLayer(e).getPaintProperty(l)}setFeatureState(e,l){this._checkLoaded();const d=e.source,p=e.sourceLayer,f=this.tileManagers[d];if(void 0===f)return void this.fire(new c.k(new Error(`The source '${d}' does not exist in the map's style.`)));const m=f.getSource().type;"geojson"===m&&p?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==m||p?(void 0===e.id&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),f.setFeatureState(p,e.id,l)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,l){this._checkLoaded();const d=e.source,p=this.tileManagers[d];if(void 0===p)return void this.fire(new c.k(new Error(`The source '${d}' does not exist in the map's style.`)));const f=p.getSource().type,m="vector"===f?e.sourceLayer:void 0;"vector"!==f||m?l&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(m,e.id,l):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const l=e.source,d=e.sourceLayer,p=this.tileManagers[l];if(void 0!==p)return"vector"!==p.getSource().type||d?(void 0===e.id&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),p.getFeatureState(d,e.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.bY(this.tileManagers,(e=>e.serialize())),l=this._serializeByIds(this._order,!0),d=this.map.getTerrain()||void 0,p=this.stylesheet;return c.bZ({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,projection:p.projection,sources:e,layers:l,terrain:d},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&"raster"!==this.tileManagers[e.source].getSource().type&&(this._updatedSources[e.source]="reload",this.tileManagers[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const l=e=>"fill-extrusion"===this._layers[e].type,c={},d=[];for(let p=this._order.length-1;p>=0;p--){const f=this._order[p];if(l(f)){c[f]=p;for(const l of e){const e=l[f];if(e)for(const l of e)d.push(l)}}}d.sort(((e,l)=>l.intersectionZ-e.intersectionZ));const p=[];for(let f=this._order.length-1;f>=0;f--){const m=this._order[f];if(l(m))for(let e=d.length-1;e>=0;e--){const l=d[e].feature;if(c[l.layer.id]<f)break;p.push(l),d.pop()}else for(const l of e){const e=l[m];if(e)for(const l of e)p.push(l.feature)}}return p}queryRenderedFeatures(e,l,d){l&&l.filter&&this._validate(c.C.filter,"queryRenderedFeatures.filter",l.filter,null,l);const p={};if(l&&l.layers){if(!(Array.isArray(l.layers)||l.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const e of l.layers){const l=this._layers[e];if(!l)return this.fire(new c.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];p[l.source]=!0}}const f=[];l.availableImages=this._availableImages;const m=this._serializedAllLayers(),_=l.layers instanceof Set?l.layers:Array.isArray(l.layers)?new Set(l.layers):null,g=Object.assign(Object.assign({},l),{layers:_,globalState:this._globalState});for(const c in this.tileManagers)l.layers&&!p[c]||f.push(he(this.tileManagers[c],this._layers,m,e,g,d,this.map.terrain?(e,l,c)=>this.map.terrain.getElevation(e,l,c):void 0));return this.placement&&f.push(function(e,l,c,d,p,f,m){const _={},g=f.queryRenderedSymbols(d),y=[];for(const e of Object.keys(g).map(Number))y.push(m[e]);y.sort(ue);for(const c of y){const d=c.featureIndex.lookupSymbolFeatures(g[c.bucketInstanceId],l,c.bucketIndex,c.sourceLayerIndex,{filterSpec:p.filter,globalState:p.globalState},p.layers,p.availableImages,e);for(const e in d){const l=_[e]=_[e]||[],p=d[e];p.sort(((e,l)=>{const d=c.featureSortOrder;if(d){const c=d.indexOf(e.featureIndex);return d.indexOf(l.featureIndex)-c}return l.featureIndex-e.featureIndex}));for(const e of p)l.push(e)}}return function(e,l,c){for(const d in e)for(const p of e[d])pe(p,c[l[d].source]);return e}(_,e,c)}(this._layers,m,this.tileManagers,e,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(e,l){(null==l?void 0:l.filter)&&this._validate(c.C.filter,"querySourceFeatures.filter",l.filter,null,l);const d=this.tileManagers[e];return d?function(e,l){const c=e.getRenderableIds().map((l=>e.getTileByID(l))),d=[],p={};for(let e=0;e<c.length;e++){const f=c[e],m=f.tileID.canonical.key;p[m]||(p[m]=!0,f.querySourceFeatures(d,l))}return d}(d,l?Object.assign(Object.assign({},l),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,l={}){this._checkLoaded();const d=this.light.getLight();let p=!1;for(const l in e)if(!c.bR(e[l],d[l])){p=!0;break}if(!p)return;const f={now:b(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,l),this.light.updateTransitions(f)}getProjection(){var e;return null===(e=this.stylesheet)||void 0===e?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return null===(e=this.stylesheet)||void 0===e?void 0:e.sky}setSky(e,l={}){this._checkLoaded();const d=this.getSky();let p=!1;if(!e&&!d)return;if(e&&!d)p=!0;else if(!e&&d)p=!0;else for(const l in e)if(!c.bR(e[l],d[l])){p=!0;break}if(!p)return;const f={now:b(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,l),this.sky.updateTransitions(f)}_setProjectionInternal(e){const l=function(e,l){const d={constrainOverride:l};if(Array.isArray(e)){const l=new di({type:e});return{projection:l,transform:new zi(d),cameraHelper:new Di(l)}}switch(e){case"mercator":return{projection:new jt,transform:new $t(d),cameraHelper:new Yt};case"globe":{const e=new di({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:e,transform:new zi(d),cameraHelper:new Di(e)}}case"vertical-perspective":return{projection:new hi,transform:new Si(d),cameraHelper:new Ri};default:return c.w(`Unknown projection name: ${e}. Falling back to mercator projection.`),{projection:new jt,transform:new $t(d),cameraHelper:new Yt}}}(e,this.map.transformConstrain);this.projection=l.projection,this.map.migrateProjection(l.transform,l.cameraHelper);for(const e in this.tileManagers)this.tileManagers[e].reload()}_validate(e,l,d,p,f={}){return(!f||!1!==f.validate)&&sn(this,e.call(c.C,c.e({key:l,style:this.serialize(),value:d,styleSpec:c.u},p)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),we().off(ve,this._rtlPluginLoaded);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this.tileManagers){const l=this.tileManagers[e];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.tileManagers[e].clearTiles()}_reloadSource(e){this.tileManagers[e].resume(),this.tileManagers[e].reload()}_updateSources(e){for(const l in this.tileManagers)this.tileManagers[l].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.tileManagers)this._reloadSource(e)}_updatePlacement(e,l,c,d,p=!1){let f=!1,m=!1;const _={};for(const l of this._order){const c=this._layers[l];if("symbol"!==c.type)continue;if(!_[c.source]){const e=this.tileManagers[c.source];_[c.source]=e.getRenderableIds(!0).map((l=>e.getTileByID(l))).sort(((e,l)=>l.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(l.tileID)?-1:1)))}const d=this.crossTileSymbolIndex.addLayer(c,_[c.source],e.center.lng);f=f||d}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||0===c)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(b(),e.zoom))&&(this.pauseablePlacement=new It(e,this.map.terrain,this._order,p,l,c,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,_),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(b()),m=!0),f&&this.pauseablePlacement.placement.setStale()),m||f)for(const e of this._order){const l=this._layers[e];"symbol"===l.type&&this.placement.updateLayerOpacities(l,_[l.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(b())}_releaseSymbolFadeTiles(){for(const e in this.tileManagers)this.tileManagers[e].releaseSymbolFadeTiles()}getImages(e,l){return c._(this,void 0,void 0,(function*(){const e=yield this.imageManager.getImages(l.icons);this._updateTilesForChangedImages();const c=this.tileManagers[l.source];return c&&c.setDependencies(l.tileID.key,l.type,l.icons),e}))}getGlyphs(e,l){return c._(this,void 0,void 0,(function*(){const e=yield this.glyphManager.getGlyphs(l.stacks),c=this.tileManagers[l.source];return c&&c.setDependencies(l.tileID.key,l.type,[""]),e}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,l={}){this._checkLoaded(),e&&this._validate(c.C.glyphs,"glyphs",e,null,l)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,l){return c._(this,void 0,void 0,(function*(){const e={};for(const[c,d]of Object.entries(l.dashes))e[c]=this.lineAtlas.getDash(d.dasharray,d.round);return e}))}addSprite(e,l,d={},p){this._checkLoaded();const f=[{id:e,url:l}],m=[...F(this.stylesheet.sprite),...f];this._validate(c.C.sprite,"sprite",m,null,d)||(this.stylesheet.sprite=m,this._loadSprite(f,!0,p))}removeSprite(e){this._checkLoaded();const l=F(this.stylesheet.sprite);if(l.find((l=>l.id===e))){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;l.splice(l.findIndex((l=>l.id===e)),1),this.stylesheet.sprite=l.length>0?l:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return F(this.stylesheet.sprite)}setSprite(e,l={},d){this._checkLoaded(),e&&this._validate(c.C.sprite,"sprite",e,null,l)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,d):(this._unloadSprite(),d&&d(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const e in this.tileManagers){const l=this.tileManagers[e];l.setEventedParent(null),l.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const e in this._layers){const l=this._layers[e];l.setEventedParent(null),l.onRemove&&l.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var ln=c.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Bi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,l,c,d,p,f,m,_,g){this.context=e;let y=this.boundPaintVertexBuffers.length!==d.length;for(let e=0;!y&&e<d.length;e++)this.boundPaintVertexBuffers[e]!==d[e]&&(y=!0);!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==c||y||this.boundIndexBuffer!==p||this.boundVertexOffset!==f||this.boundDynamicVertexBuffer!==m||this.boundDynamicVertexBuffer2!==_||this.boundDynamicVertexBuffer3!==g?this.freshBind(l,c,d,p,f,m,_,g):(e.bindVertexArray.set(this.vao),m&&m.bind(),p&&p.dynamicDraw&&p.bind(),_&&_.bind(),g&&g.bind())}freshBind(e,l,c,d,p,f,m,_){const g=e.numAttributes,y=this.context,b=y.gl;this.vao&&this.destroy(),this.vao=y.createVertexArray(),y.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=f,this.boundDynamicVertexBuffer2=m,this.boundDynamicVertexBuffer3=_,l.enableAttributes(b,e);for(const l of c)l.enableAttributes(b,e);f&&f.enableAttributes(b,e),m&&m.enableAttributes(b,e),_&&_.enableAttributes(b,e),l.bind(),l.setVertexAttribPointers(b,e,p);for(const l of c)l.bind(),l.setVertexAttribPointers(b,e,p);f&&(f.bind(),f.setVertexAttribPointers(b,e,p)),d&&d.bind(),m&&(m.bind(),m.setVertexAttribPointers(b,e,p)),_&&(_.bind(),_.setVertexAttribPointers(b,e,p)),y.currentNumAttributes=g}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const cn=(e,l,d,p,f)=>({u_texture:0,u_ele_delta:e,u_fog_matrix:l,u_fog_color:d?d.properties.get("fog-color"):c.bp.white,u_fog_ground_blend:d?d.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?0:d?d.calculateFogBlendOpacity(p):0,u_horizon_color:d?d.properties.get("horizon-color"):c.bp.white,u_horizon_fog_blend:d?d.properties.get("horizon-fog-blend"):1,u_is_globe_mode:f?1:0}),hn={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function un(e){const l=[];for(let c=0;c<e.length;c++){if(null===e[c])continue;const d=e[c].split(" ");l.push(d.pop())}return l}class Zi{constructor(e,l,d,p,f,m,_,g,y=[]){const b=e.gl;this.program=b.createProgram();const T=un(l.staticAttributes),S=d?d.getBinderAttributes():[],P=T.concat(S),I=Vi.prelude.staticUniforms?un(Vi.prelude.staticUniforms):[],C=_.staticUniforms?un(_.staticUniforms):[],R=l.staticUniforms?un(l.staticUniforms):[],L=d?d.getBinderUniforms():[],F=I.concat(C).concat(R).concat(L),B=[];for(const e of F)B.indexOf(e)<0&&B.push(e);const O=d?d.defines():[];Ji(b)&&O.unshift("#version 300 es"),f&&O.push("#define OVERDRAW_INSPECTOR;"),m&&O.push("#define TERRAIN3D;"),g&&O.push(g),y&&O.push(...y);let V=O.concat(Vi.prelude.fragmentSource,_.fragmentSource,l.fragmentSource).join("\n"),j=O.concat(Vi.prelude.vertexSource,_.vertexSource,l.vertexSource).join("\n");Ji(b)||(V=function(e){return e.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(V),j=function(e){return e.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(j));const G=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(G,V),b.compileShader(G),!b.getShaderParameter(G,b.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${b.getShaderInfoLog(G)}`);b.attachShader(this.program,G);const U=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(U,j),b.compileShader(U),!b.getShaderParameter(U,b.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${b.getShaderInfoLog(U)}`);b.attachShader(this.program,U),this.attributes={};const q={};this.numAttributes=P.length;for(let e=0;e<this.numAttributes;e++)P[e]&&(b.bindAttribLocation(this.program,e,P[e]),this.attributes[P[e]]=e);if(b.linkProgram(this.program),!b.getProgramParameter(this.program,b.LINK_STATUS))throw new Error(`Program failed to link: ${b.getProgramInfoLog(this.program)}`);b.deleteShader(U),b.deleteShader(G);for(let e=0;e<B.length;e++){const l=B[e];if(l&&!q[l]){const e=b.getUniformLocation(this.program,l);e&&(q[l]=e)}}this.fixedUniforms=p(e,q),this.terrainUniforms=((e,l)=>({u_depth:new c.b_(e,l.u_depth),u_terrain:new c.b_(e,l.u_terrain),u_terrain_dim:new c.bq(e,l.u_terrain_dim),u_terrain_matrix:new c.c0(e,l.u_terrain_matrix),u_terrain_unpack:new c.c1(e,l.u_terrain_unpack),u_terrain_exaggeration:new c.bq(e,l.u_terrain_exaggeration)}))(e,q),this.projectionUniforms=((e,l)=>({u_projection_matrix:new c.c0(e,l.u_projection_matrix),u_projection_tile_mercator_coords:new c.c1(e,l.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.c1(e,l.u_projection_clipping_plane),u_projection_transition:new c.bq(e,l.u_projection_transition),u_projection_fallback_matrix:new c.c0(e,l.u_projection_fallback_matrix)}))(e,q),this.binderUniforms=d?d.getUniforms(e,q):[]}draw(e,l,c,d,p,f,m,_,g,y,b,T,S,P,I,C,R,L,F){const B=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(c),e.setStencilMode(d),e.setColorMode(p),e.setCullFace(f),_){e.activeTexture.set(B.TEXTURE2),B.bindTexture(B.TEXTURE_2D,_.depthTexture),e.activeTexture.set(B.TEXTURE3),B.bindTexture(B.TEXTURE_2D,_.texture);for(const e in this.terrainUniforms)this.terrainUniforms[e].set(_[e])}if(g)for(const e in g)this.projectionUniforms[hn[e]].set(g[e]);if(m)for(const e in this.fixedUniforms)this.fixedUniforms[e].set(m[e]);C&&C.setUniforms(e,this.binderUniforms,P,{zoom:I});let O=0;switch(l){case B.LINES:O=2;break;case B.TRIANGLES:O=3;break;case B.LINE_STRIP:O=1}for(const c of S.get()){const d=c.vaos||(c.vaos={});(d[y]||(d[y]=new Bi)).bind(e,this,b,C?C.getPaintVertexBuffers():[],T,c.vertexOffset,R,L,F),B.drawElements(l,c.primitiveLength*O,B.UNSIGNED_SHORT,c.primitiveOffset*O*2)}}}function dn(e,l,d){const p=1/c.aN(d,1,l.transform.tileZoom),f=Math.pow(2,d.tileID.overscaledZ),m=d.tileSize*Math.pow(2,l.transform.tileZoom)/f,_=m*(d.tileID.canonical.x+d.tileID.wrap*f),g=m*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[p,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[_>>16,g>>16],u_pixel_coord_lower:[65535&_,65535&g]}}const pn=(e,l,d,p)=>{const f=e.style.light,m=f.properties.get("position"),_=[m.x,m.y,m.z],g=c.c4();"viewport"===f.properties.get("anchor")&&c.c5(g,e.transform.bearingInRadians),c.c6(_,_,g);const y=e.transform.transformLightDirection(_),b=f.properties.get("color");return{u_lightpos:_,u_lightpos_globe:y,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+l,u_opacity:d,u_fill_translate:p}},fn=(e,l,d,p,f,m,_)=>c.e(pn(e,l,d,p),dn(m,e,_),{u_height_factor:-Math.pow(2,f.overscaledZ)/_.tileSize/8}),mn=(e,l,d,p)=>c.e(dn(l,e,d),{u_fill_translate:p}),_n=(e,l)=>({u_world:e,u_fill_translate:l}),gn=(e,l,d,p,f)=>c.e(mn(e,l,d,f),{u_world:p}),yn=(e,l,d,p,f)=>{const m=e.transform;let _,g,y=0;if("map"===d.paint.get("circle-pitch-alignment")){const e=c.aN(l,1,m.zoom);_=!0,g=[e,e],y=e/(c.a5*Math.pow(2,l.tileID.overscaledZ))*2*Math.PI*f}else _=!1,g=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+("map"===d.paint.get("circle-pitch-scale")),u_pitch_with_map:+_,u_device_pixel_ratio:e.pixelRatio,u_extrude_scale:g,u_globe_extrude_scale:y,u_translate:p}},xn=e=>({u_pixel_extrude_scale:[1/e.width,1/e.height]}),vn=e=>({u_viewport_size:[e.width,e.height]}),bn=(e,l=1)=>({u_color:e,u_overlay:0,u_overlay_scale:l}),wn=(e,l,d,p)=>{const f=c.aN(e,1,l)/(c.a5*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*p;return{u_extrude_scale:c.aN(e,1,l),u_intensity:d,u_globe_extrude_scale:f}},Tn=(e,l,d,p)=>{const f=c.N();c.c7(f,0,e.width,e.height,0,0,1);const m=e.context.gl;return{u_matrix:f,u_world:[m.drawingBufferWidth,m.drawingBufferHeight],u_image:d,u_color_ramp:p,u_opacity:l.paint.get("heatmap-opacity")}},Sn=(e,l,c)=>{const d=c.paint.get("hillshade-accent-color");let p;switch(c.paint.get("hillshade-method")){case"basic":p=4;break;case"combined":p=1;break;case"igor":p=2;break;case"multidirectional":p=3;break;default:p=0}const f=c.getIlluminationProperties();for(let l=0;l<f.directionRadians.length;l++)"viewport"===c.paint.get("hillshade-illumination-anchor")&&(f.directionRadians[l]+=e.transform.bearingInRadians);return{u_image:0,u_latrange:In(0,l.tileID),u_exaggeration:c.paint.get("hillshade-exaggeration"),u_altitudes:f.altitudeRadians,u_azimuths:f.directionRadians,u_accent:d,u_method:p,u_highlights:f.highlightColor,u_shadows:f.shadowColor}},Pn=(e,l)=>{const d=l.stride,p=c.N();return c.c7(p,0,c.a5,-c.a5,0,0,1),c.O(p,p,[0,-c.a5,0]),{u_matrix:p,u_image:1,u_dimension:[d,d],u_zoom:e.overscaledZ,u_unpack:l.getUnpackVector()}};function In(e,l){const d=Math.pow(2,l.canonical.z),p=l.canonical.y;return[new c.a9(0,p/d).toLngLat().lat,new c.a9(0,(p+1)/d).toLngLat().lat]}const En=(e,l,c=0)=>({u_image:0,u_unpack:l.getUnpackVector(),u_dimension:[l.stride,l.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:c,u_opacity:e.paint.get("color-relief-opacity")}),Cn=(e,l,d,p)=>{const f=e.transform;return{u_translation:Bn(e,l,d),u_ratio:p/c.aN(l,1,f.zoom),u_device_pixel_ratio:e.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},An=(e,l,d,p,f)=>c.e(Cn(e,l,d,p),{u_image:0,u_image_height:f}),Dn=(e,l,d,p,f)=>{const m=e.transform,_=Ln(l,m);return{u_translation:Bn(e,l,d),u_texsize:l.imageAtlasTexture.size,u_ratio:p/c.aN(l,1,m.zoom),u_device_pixel_ratio:e.pixelRatio,u_image:0,u_scale:[_,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},kn=(e,l,d,p,f)=>{const m=Ln(l,e.transform);return c.e(Cn(e,l,d,p),{u_tileratio:m,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image:0,u_mix:f.t,u_lineatlas_width:e.lineAtlas.width,u_lineatlas_height:e.lineAtlas.height})},Rn=(e,l,d,p,f,m)=>{const _=Ln(l,e.transform);return c.e(Cn(e,l,d,p),{u_image:0,u_image_height:m,u_tileratio:_,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image_dash:1,u_mix:f.t,u_lineatlas_width:e.lineAtlas.width,u_lineatlas_height:e.lineAtlas.height})};function Ln(e,l){return 1/c.aN(e,1,l.tileZoom)}function Bn(e,l,d){return c.aO(e.transform,l,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const On=(e,l,c,d,p)=>{return{u_tl_parent:e,u_scale_parent:l,u_buffer_scale:1,u_fade_t:c.mix,u_opacity:c.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(m=d.paint.get("raster-saturation"),m>0?1-1/(1.001-m):-m),u_contrast_factor:(f=d.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:Vn(d.paint.get("raster-hue-rotate")),u_coords_top:[p[0].x,p[0].y,p[1].x,p[1].y],u_coords_bottom:[p[3].x,p[3].y,p[2].x,p[2].y]};var f,m};function Vn(e){e*=Math.PI/180;const l=Math.sin(e),c=Math.cos(e);return[(2*c+1)/3,(-Math.sqrt(3)*l-c+1)/3,(Math.sqrt(3)*l-c+1)/3]}const jn=(e,l,c,d,p,f,m,_,g,y,b,T,S)=>{const P=m.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:P.cameraToCenterDistance,u_pitch:P.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:P.width/P.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_label_plane_matrix:_,u_coord_matrix:g,u_is_text:+b,u_pitch_with_map:+d,u_is_along_line:p,u_is_variable_anchor:f,u_texsize:T,u_texture:0,u_translation:y,u_pitched_scale:S}},Nn=(e,l,d,p,f,m,_,g,y,b,T,S,P,I)=>{const C=_.transform;return c.e(jn(e,l,d,p,f,m,_,g,y,b,T,S,I),{u_gamma_scale:p?Math.cos(C.pitch*Math.PI/180)*C.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:1})},Gn=(e,l,d,p,f,m,_,g,y,b,T,S,P)=>c.e(Nn(e,l,d,p,f,m,_,g,y,b,!0,T,0,P),{u_texsize_icon:S,u_texture_icon:1}),Un=(e,l)=>({u_opacity:e,u_color:l}),qn=(e,l,d,p,f)=>c.e(function(e,l,d,p){const f=d.imageManager.getPattern(e.from.toString()),m=d.imageManager.getPattern(e.to.toString()),{width:_,height:g}=d.imageManager.getPixelSize(),y=Math.pow(2,p.tileID.overscaledZ),b=p.tileSize*Math.pow(2,d.transform.tileZoom)/y,T=b*(p.tileID.canonical.x+p.tileID.wrap*y),S=b*p.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:f.tl,u_pattern_br_a:f.br,u_pattern_tl_b:m.tl,u_pattern_br_b:m.br,u_texsize:[_,g],u_mix:l.t,u_pattern_size_a:f.displaySize,u_pattern_size_b:m.displaySize,u_scale_a:l.fromScale,u_scale_b:l.toScale,u_tile_units_to_pixels:1/c.aN(p,1,d.transform.tileZoom),u_pixel_coord_upper:[T>>16,S>>16],u_pixel_coord_lower:[65535&T,65535&S]}}(d,f,l,p),{u_opacity:e}),Zn=(e,l)=>{},$n={fillExtrusion:(e,l)=>({u_lightpos:new c.c2(e,l.u_lightpos),u_lightpos_globe:new c.c2(e,l.u_lightpos_globe),u_lightintensity:new c.bq(e,l.u_lightintensity),u_lightcolor:new c.c2(e,l.u_lightcolor),u_vertical_gradient:new c.bq(e,l.u_vertical_gradient),u_opacity:new c.bq(e,l.u_opacity),u_fill_translate:new c.c3(e,l.u_fill_translate)}),fillExtrusionPattern:(e,l)=>({u_lightpos:new c.c2(e,l.u_lightpos),u_lightpos_globe:new c.c2(e,l.u_lightpos_globe),u_lightintensity:new c.bq(e,l.u_lightintensity),u_lightcolor:new c.c2(e,l.u_lightcolor),u_vertical_gradient:new c.bq(e,l.u_vertical_gradient),u_height_factor:new c.bq(e,l.u_height_factor),u_opacity:new c.bq(e,l.u_opacity),u_fill_translate:new c.c3(e,l.u_fill_translate),u_image:new c.b_(e,l.u_image),u_texsize:new c.c3(e,l.u_texsize),u_pixel_coord_upper:new c.c3(e,l.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(e,l.u_pixel_coord_lower),u_scale:new c.c2(e,l.u_scale),u_fade:new c.bq(e,l.u_fade)}),fill:(e,l)=>({u_fill_translate:new c.c3(e,l.u_fill_translate)}),fillPattern:(e,l)=>({u_image:new c.b_(e,l.u_image),u_texsize:new c.c3(e,l.u_texsize),u_pixel_coord_upper:new c.c3(e,l.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(e,l.u_pixel_coord_lower),u_scale:new c.c2(e,l.u_scale),u_fade:new c.bq(e,l.u_fade),u_fill_translate:new c.c3(e,l.u_fill_translate)}),fillOutline:(e,l)=>({u_world:new c.c3(e,l.u_world),u_fill_translate:new c.c3(e,l.u_fill_translate)}),fillOutlinePattern:(e,l)=>({u_world:new c.c3(e,l.u_world),u_image:new c.b_(e,l.u_image),u_texsize:new c.c3(e,l.u_texsize),u_pixel_coord_upper:new c.c3(e,l.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(e,l.u_pixel_coord_lower),u_scale:new c.c2(e,l.u_scale),u_fade:new c.bq(e,l.u_fade),u_fill_translate:new c.c3(e,l.u_fill_translate)}),circle:(e,l)=>({u_camera_to_center_distance:new c.bq(e,l.u_camera_to_center_distance),u_scale_with_map:new c.b_(e,l.u_scale_with_map),u_pitch_with_map:new c.b_(e,l.u_pitch_with_map),u_extrude_scale:new c.c3(e,l.u_extrude_scale),u_device_pixel_ratio:new c.bq(e,l.u_device_pixel_ratio),u_globe_extrude_scale:new c.bq(e,l.u_globe_extrude_scale),u_translate:new c.c3(e,l.u_translate)}),collisionBox:(e,l)=>({u_pixel_extrude_scale:new c.c3(e,l.u_pixel_extrude_scale)}),collisionCircle:(e,l)=>({u_viewport_size:new c.c3(e,l.u_viewport_size)}),debug:(e,l)=>({u_color:new c.b$(e,l.u_color),u_overlay:new c.b_(e,l.u_overlay),u_overlay_scale:new c.bq(e,l.u_overlay_scale)}),depth:Zn,clippingMask:Zn,heatmap:(e,l)=>({u_extrude_scale:new c.bq(e,l.u_extrude_scale),u_intensity:new c.bq(e,l.u_intensity),u_globe_extrude_scale:new c.bq(e,l.u_globe_extrude_scale)}),heatmapTexture:(e,l)=>({u_matrix:new c.c0(e,l.u_matrix),u_world:new c.c3(e,l.u_world),u_image:new c.b_(e,l.u_image),u_color_ramp:new c.b_(e,l.u_color_ramp),u_opacity:new c.bq(e,l.u_opacity)}),hillshade:(e,l)=>({u_image:new c.b_(e,l.u_image),u_latrange:new c.c3(e,l.u_latrange),u_exaggeration:new c.bq(e,l.u_exaggeration),u_altitudes:new c.c9(e,l.u_altitudes),u_azimuths:new c.c9(e,l.u_azimuths),u_accent:new c.b$(e,l.u_accent),u_method:new c.b_(e,l.u_method),u_shadows:new c.c8(e,l.u_shadows),u_highlights:new c.c8(e,l.u_highlights)}),hillshadePrepare:(e,l)=>({u_matrix:new c.c0(e,l.u_matrix),u_image:new c.b_(e,l.u_image),u_dimension:new c.c3(e,l.u_dimension),u_zoom:new c.bq(e,l.u_zoom),u_unpack:new c.c1(e,l.u_unpack)}),colorRelief:(e,l)=>({u_image:new c.b_(e,l.u_image),u_unpack:new c.c1(e,l.u_unpack),u_dimension:new c.c3(e,l.u_dimension),u_elevation_stops:new c.b_(e,l.u_elevation_stops),u_color_stops:new c.b_(e,l.u_color_stops),u_color_ramp_size:new c.b_(e,l.u_color_ramp_size),u_opacity:new c.bq(e,l.u_opacity)}),line:(e,l)=>({u_translation:new c.c3(e,l.u_translation),u_ratio:new c.bq(e,l.u_ratio),u_device_pixel_ratio:new c.bq(e,l.u_device_pixel_ratio),u_units_to_pixels:new c.c3(e,l.u_units_to_pixels)}),lineGradient:(e,l)=>({u_translation:new c.c3(e,l.u_translation),u_ratio:new c.bq(e,l.u_ratio),u_device_pixel_ratio:new c.bq(e,l.u_device_pixel_ratio),u_units_to_pixels:new c.c3(e,l.u_units_to_pixels),u_image:new c.b_(e,l.u_image),u_image_height:new c.bq(e,l.u_image_height)}),linePattern:(e,l)=>({u_translation:new c.c3(e,l.u_translation),u_texsize:new c.c3(e,l.u_texsize),u_ratio:new c.bq(e,l.u_ratio),u_device_pixel_ratio:new c.bq(e,l.u_device_pixel_ratio),u_image:new c.b_(e,l.u_image),u_units_to_pixels:new c.c3(e,l.u_units_to_pixels),u_scale:new c.c2(e,l.u_scale),u_fade:new c.bq(e,l.u_fade)}),lineSDF:(e,l)=>({u_translation:new c.c3(e,l.u_translation),u_ratio:new c.bq(e,l.u_ratio),u_device_pixel_ratio:new c.bq(e,l.u_device_pixel_ratio),u_units_to_pixels:new c.c3(e,l.u_units_to_pixels),u_image:new c.b_(e,l.u_image),u_mix:new c.bq(e,l.u_mix),u_tileratio:new c.bq(e,l.u_tileratio),u_crossfade_from:new c.bq(e,l.u_crossfade_from),u_crossfade_to:new c.bq(e,l.u_crossfade_to),u_lineatlas_width:new c.bq(e,l.u_lineatlas_width),u_lineatlas_height:new c.bq(e,l.u_lineatlas_height)}),lineGradientSDF:(e,l)=>({u_translation:new c.c3(e,l.u_translation),u_ratio:new c.bq(e,l.u_ratio),u_device_pixel_ratio:new c.bq(e,l.u_device_pixel_ratio),u_units_to_pixels:new c.c3(e,l.u_units_to_pixels),u_image:new c.b_(e,l.u_image),u_image_height:new c.bq(e,l.u_image_height),u_tileratio:new c.bq(e,l.u_tileratio),u_crossfade_from:new c.bq(e,l.u_crossfade_from),u_crossfade_to:new c.bq(e,l.u_crossfade_to),u_image_dash:new c.b_(e,l.u_image_dash),u_mix:new c.bq(e,l.u_mix),u_lineatlas_width:new c.bq(e,l.u_lineatlas_width),u_lineatlas_height:new c.bq(e,l.u_lineatlas_height)}),raster:(e,l)=>({u_tl_parent:new c.c3(e,l.u_tl_parent),u_scale_parent:new c.bq(e,l.u_scale_parent),u_buffer_scale:new c.bq(e,l.u_buffer_scale),u_fade_t:new c.bq(e,l.u_fade_t),u_opacity:new c.bq(e,l.u_opacity),u_image0:new c.b_(e,l.u_image0),u_image1:new c.b_(e,l.u_image1),u_brightness_low:new c.bq(e,l.u_brightness_low),u_brightness_high:new c.bq(e,l.u_brightness_high),u_saturation_factor:new c.bq(e,l.u_saturation_factor),u_contrast_factor:new c.bq(e,l.u_contrast_factor),u_spin_weights:new c.c2(e,l.u_spin_weights),u_coords_top:new c.c1(e,l.u_coords_top),u_coords_bottom:new c.c1(e,l.u_coords_bottom)}),symbolIcon:(e,l)=>({u_is_size_zoom_constant:new c.b_(e,l.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(e,l.u_is_size_feature_constant),u_size_t:new c.bq(e,l.u_size_t),u_size:new c.bq(e,l.u_size),u_camera_to_center_distance:new c.bq(e,l.u_camera_to_center_distance),u_pitch:new c.bq(e,l.u_pitch),u_rotate_symbol:new c.b_(e,l.u_rotate_symbol),u_aspect_ratio:new c.bq(e,l.u_aspect_ratio),u_fade_change:new c.bq(e,l.u_fade_change),u_label_plane_matrix:new c.c0(e,l.u_label_plane_matrix),u_coord_matrix:new c.c0(e,l.u_coord_matrix),u_is_text:new c.b_(e,l.u_is_text),u_pitch_with_map:new c.b_(e,l.u_pitch_with_map),u_is_along_line:new c.b_(e,l.u_is_along_line),u_is_variable_anchor:new c.b_(e,l.u_is_variable_anchor),u_texsize:new c.c3(e,l.u_texsize),u_texture:new c.b_(e,l.u_texture),u_translation:new c.c3(e,l.u_translation),u_pitched_scale:new c.bq(e,l.u_pitched_scale)}),symbolSDF:(e,l)=>({u_is_size_zoom_constant:new c.b_(e,l.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(e,l.u_is_size_feature_constant),u_size_t:new c.bq(e,l.u_size_t),u_size:new c.bq(e,l.u_size),u_camera_to_center_distance:new c.bq(e,l.u_camera_to_center_distance),u_pitch:new c.bq(e,l.u_pitch),u_rotate_symbol:new c.b_(e,l.u_rotate_symbol),u_aspect_ratio:new c.bq(e,l.u_aspect_ratio),u_fade_change:new c.bq(e,l.u_fade_change),u_label_plane_matrix:new c.c0(e,l.u_label_plane_matrix),u_coord_matrix:new c.c0(e,l.u_coord_matrix),u_is_text:new c.b_(e,l.u_is_text),u_pitch_with_map:new c.b_(e,l.u_pitch_with_map),u_is_along_line:new c.b_(e,l.u_is_along_line),u_is_variable_anchor:new c.b_(e,l.u_is_variable_anchor),u_texsize:new c.c3(e,l.u_texsize),u_texture:new c.b_(e,l.u_texture),u_gamma_scale:new c.bq(e,l.u_gamma_scale),u_device_pixel_ratio:new c.bq(e,l.u_device_pixel_ratio),u_is_halo:new c.b_(e,l.u_is_halo),u_translation:new c.c3(e,l.u_translation),u_pitched_scale:new c.bq(e,l.u_pitched_scale)}),symbolTextAndIcon:(e,l)=>({u_is_size_zoom_constant:new c.b_(e,l.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(e,l.u_is_size_feature_constant),u_size_t:new c.bq(e,l.u_size_t),u_size:new c.bq(e,l.u_size),u_camera_to_center_distance:new c.bq(e,l.u_camera_to_center_distance),u_pitch:new c.bq(e,l.u_pitch),u_rotate_symbol:new c.b_(e,l.u_rotate_symbol),u_aspect_ratio:new c.bq(e,l.u_aspect_ratio),u_fade_change:new c.bq(e,l.u_fade_change),u_label_plane_matrix:new c.c0(e,l.u_label_plane_matrix),u_coord_matrix:new c.c0(e,l.u_coord_matrix),u_is_text:new c.b_(e,l.u_is_text),u_pitch_with_map:new c.b_(e,l.u_pitch_with_map),u_is_along_line:new c.b_(e,l.u_is_along_line),u_is_variable_anchor:new c.b_(e,l.u_is_variable_anchor),u_texsize:new c.c3(e,l.u_texsize),u_texsize_icon:new c.c3(e,l.u_texsize_icon),u_texture:new c.b_(e,l.u_texture),u_texture_icon:new c.b_(e,l.u_texture_icon),u_gamma_scale:new c.bq(e,l.u_gamma_scale),u_device_pixel_ratio:new c.bq(e,l.u_device_pixel_ratio),u_is_halo:new c.b_(e,l.u_is_halo),u_translation:new c.c3(e,l.u_translation),u_pitched_scale:new c.bq(e,l.u_pitched_scale)}),background:(e,l)=>({u_opacity:new c.bq(e,l.u_opacity),u_color:new c.b$(e,l.u_color)}),backgroundPattern:(e,l)=>({u_opacity:new c.bq(e,l.u_opacity),u_image:new c.b_(e,l.u_image),u_pattern_tl_a:new c.c3(e,l.u_pattern_tl_a),u_pattern_br_a:new c.c3(e,l.u_pattern_br_a),u_pattern_tl_b:new c.c3(e,l.u_pattern_tl_b),u_pattern_br_b:new c.c3(e,l.u_pattern_br_b),u_texsize:new c.c3(e,l.u_texsize),u_mix:new c.bq(e,l.u_mix),u_pattern_size_a:new c.c3(e,l.u_pattern_size_a),u_pattern_size_b:new c.c3(e,l.u_pattern_size_b),u_scale_a:new c.bq(e,l.u_scale_a),u_scale_b:new c.bq(e,l.u_scale_b),u_pixel_coord_upper:new c.c3(e,l.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(e,l.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bq(e,l.u_tile_units_to_pixels)}),terrain:(e,l)=>({u_texture:new c.b_(e,l.u_texture),u_ele_delta:new c.bq(e,l.u_ele_delta),u_fog_matrix:new c.c0(e,l.u_fog_matrix),u_fog_color:new c.b$(e,l.u_fog_color),u_fog_ground_blend:new c.bq(e,l.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bq(e,l.u_fog_ground_blend_opacity),u_horizon_color:new c.b$(e,l.u_horizon_color),u_horizon_fog_blend:new c.bq(e,l.u_horizon_fog_blend),u_is_globe_mode:new c.bq(e,l.u_is_globe_mode)}),terrainDepth:(e,l)=>({u_ele_delta:new c.bq(e,l.u_ele_delta)}),terrainCoords:(e,l)=>({u_texture:new c.b_(e,l.u_texture),u_terrain_coords_id:new c.bq(e,l.u_terrain_coords_id),u_ele_delta:new c.bq(e,l.u_ele_delta)}),projectionErrorMeasurement:(e,l)=>({u_input:new c.bq(e,l.u_input),u_output_expected:new c.bq(e,l.u_output_expected)}),atmosphere:(e,l)=>({u_sun_pos:new c.c2(e,l.u_sun_pos),u_atmosphere_blend:new c.bq(e,l.u_atmosphere_blend),u_globe_position:new c.c2(e,l.u_globe_position),u_globe_radius:new c.bq(e,l.u_globe_radius),u_inv_proj_matrix:new c.c0(e,l.u_inv_proj_matrix)}),sky:(e,l)=>({u_sky_color:new c.b$(e,l.u_sky_color),u_horizon_color:new c.b$(e,l.u_horizon_color),u_horizon:new c.c3(e,l.u_horizon),u_horizon_normal:new c.c3(e,l.u_horizon_normal),u_sky_horizon_blend:new c.bq(e,l.u_sky_horizon_blend),u_sky_blend:new c.bq(e,l.u_sky_blend)})};class ba{constructor(e,l,c){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const l=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Wn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class wa{constructor(e,l,c,d){this.length=l.length,this.attributes=c,this.itemSize=l.bytesPerElement,this.dynamicDraw=d,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,l){for(let c=0;c<this.attributes.length;c++){const d=l.attributes[this.attributes[c].name];void 0!==d&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,l,c){for(let d=0;d<this.attributes.length;d++){const p=this.attributes[d],f=l.attributes[p.name];void 0!==f&&e.vertexAttribPointer(f,p.components,e[Wn[p.type]],!1,this.itemSize,p.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ta{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Pa extends Ta{getDefault(){return c.bp.transparent}set(e){const l=this.current;(e.r!==l.r||e.g!==l.g||e.b!==l.b||e.a!==l.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ca extends Ta{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Ia extends Ta{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Ma extends Ta{getDefault(){return[!0,!0,!0,!0]}set(e){const l=this.current;(e[0]!==l[0]||e[1]!==l[1]||e[2]!==l[2]||e[3]!==l[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ea extends Ta{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Sa extends Ta{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class za extends Ta{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const l=this.current;(e.func!==l.func||e.ref!==l.ref||e.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Ra extends Ta{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const l=this.current;(e[0]!==l[0]||e[1]!==l[1]||e[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Da extends Ta{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;e?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=e,this.dirty=!1}}class Aa extends Ta{getDefault(){return[0,1]}set(e){const l=this.current;(e[0]!==l[0]||e[1]!==l[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class La extends Ta{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;e?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=e,this.dirty=!1}}class ka extends Ta{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Fa extends Ta{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;e?l.enable(l.BLEND):l.disable(l.BLEND),this.current=e,this.dirty=!1}}class Ba extends Ta{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const l=this.current;(e[0]!==l[0]||e[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Oa extends Ta{getDefault(){return c.bp.transparent}set(e){const l=this.current;(e.r!==l.r||e.g!==l.g||e.b!==l.b||e.a!==l.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ja extends Ta{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Na extends Ta{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;e?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=e,this.dirty=!1}}class Za extends Ta{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ua extends Ta{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Ga extends Ta{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Va extends Ta{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class qa extends Ta{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const l=this.current;(e[0]!==l[0]||e[1]!==l[1]||e[2]!==l[2]||e[3]!==l[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Wa extends Ta{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class $a extends Ta{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ha extends Ta{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Xa extends Ta{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ka extends Ta{getDefault(){return null}set(e){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ya extends Ta{getDefault(){return null}set(e){var l;if(e===this.current&&!this.dirty)return;const c=this.gl;Ji(c)?c.bindVertexArray(e):null===(l=c.getExtension("OES_vertex_array_object"))||void 0===l||l.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Qa extends Ta{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Ja extends Ta{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class eo extends Ta{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class to extends Ta{constructor(e,l){super(e),this.context=e,this.parent=l}getDefault(){return null}}class io extends to{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ao extends to{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class oo extends to{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Hn="Framebuffer is not complete";class so{constructor(e,l,c,d,p){this.context=e,this.width=l,this.height=c;const f=e.gl,m=this.framebuffer=f.createFramebuffer();if(this.colorAttachment=new io(e,m),d)this.depthAttachment=p?new oo(e,m):new ao(e,m);else if(p)throw new Error("Stencil cannot be set without depth");if(f.checkFramebufferStatus(f.FRAMEBUFFER)!==f.FRAMEBUFFER_COMPLETE)throw new Error(Hn)}destroy(){const e=this.context.gl,l=this.colorAttachment.get();if(l&&e.deleteTexture(l),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class no{constructor(e){var l,c;if(this.gl=e,this.clearColor=new Pa(this),this.clearDepth=new Ca(this),this.clearStencil=new Ia(this),this.colorMask=new Ma(this),this.depthMask=new Ea(this),this.stencilMask=new Sa(this),this.stencilFunc=new za(this),this.stencilOp=new Ra(this),this.stencilTest=new Da(this),this.depthRange=new Aa(this),this.depthTest=new La(this),this.depthFunc=new ka(this),this.blend=new Fa(this),this.blendFunc=new Ba(this),this.blendColor=new Oa(this),this.blendEquation=new ja(this),this.cullFace=new Na(this),this.cullFaceSide=new Za(this),this.frontFace=new Ua(this),this.program=new Ga(this),this.activeTexture=new Va(this),this.viewport=new qa(this),this.bindFramebuffer=new Wa(this),this.bindRenderbuffer=new $a(this),this.bindTexture=new Ha(this),this.bindVertexBuffer=new Xa(this),this.bindElementBuffer=new Ka(this),this.bindVertexArray=new Ya(this),this.pixelStoreUnpack=new Qa(this),this.pixelStoreUnpackPremultiplyAlpha=new Ja(this),this.pixelStoreUnpackFlipY=new eo(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Ji(e)){this.HALF_FLOAT=e.HALF_FLOAT;const d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(l=e.RGBA16F)&&void 0!==l?l:null==d?void 0:d.RGBA16F_EXT,this.RGB16F=null!==(c=e.RGB16F)&&void 0!==c?c:null==d?void 0:d.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const l=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==l?void 0:l.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,l){return new ba(this,e,l)}createVertexBuffer(e,l,c){return new wa(this,e,l,c)}createRenderbuffer(e,l,c){const d=this.gl,p=d.createRenderbuffer();return this.bindRenderbuffer.set(p),d.renderbufferStorage(d.RENDERBUFFER,e,l,c),this.bindRenderbuffer.set(null),p}createFramebuffer(e,l,c,d){return new so(this,e,l,c,d)}clear({color:e,depth:l,stencil:c}){const d=this.gl;let p=0;e&&(p|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(p|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==c&&(p|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),d.clear(p)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.bR(e.blendFunction,Qt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Ji(this.gl)?this.gl.createVertexArray():null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var l;return Ji(this.gl)?this.gl.deleteVertexArray(e):null===(l=this.gl.getExtension("OES_vertex_array_object"))||void 0===l?void 0:l.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Xn;function Yn(e,l,d,p,f){const m=e.context,_=e.transform,g=m.gl,y=e.useProgram("collisionBox"),b=[];let T=0,S=0;for(let c=0;c<p.length;c++){const P=p[c],I=l.getTile(P).getBucket(d);if(!I)continue;const C=f?I.textCollisionBox:I.iconCollisionBox,R=I.collisionCircleArray;R.length>0&&(b.push({circleArray:R,circleOffset:S,coord:P}),T+=R.length/4,S=T),C&&y.draw(m,g.LINES,ti.disabled,ai.disabled,e.colorModeForRenderPass(),ei.disabled,xn(e.transform),e.style.map.terrain&&e.style.map.terrain.getTerrainData(P),_.getProjectionData({overscaledTileID:P,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),d.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,null,e.transform.zoom,null,null,C.collisionVertexBuffer)}if(!f||!b.length)return;const P=e.useProgram("collisionCircle"),I=new c.ca;I.resize(4*T),I._trim();let C=0;for(const e of b)for(let l=0;l<e.circleArray.length/4;l++){const c=4*l,d=e.circleArray[c+0],p=e.circleArray[c+1],f=e.circleArray[c+2],m=e.circleArray[c+3];I.emplace(C++,d,p,f,m,0),I.emplace(C++,d,p,f,m,1),I.emplace(C++,d,p,f,m,2),I.emplace(C++,d,p,f,m,3)}(!Xn||Xn.length<2*T)&&(Xn=function(e){const l=2*e,d=new c.cc;d.resize(l),d._trim();for(let e=0;e<l;e++){const l=6*e;d.uint16[l+0]=4*e+0,d.uint16[l+1]=4*e+1,d.uint16[l+2]=4*e+2,d.uint16[l+3]=4*e+2,d.uint16[l+4]=4*e+3,d.uint16[l+5]=4*e+0}return d}(T));const R=m.createIndexBuffer(Xn,!0),L=m.createVertexBuffer(I,c.cb.members,!0);for(const l of b){const p=vn(e.transform);P.draw(m,g.TRIANGLES,ti.disabled,ai.disabled,e.colorModeForRenderPass(),ei.disabled,p,e.style.map.terrain&&e.style.map.terrain.getTerrainData(l.coord),null,d.id,L,R,c.aX.simpleSegment(0,2*l.circleOffset,l.circleArray.length,l.circleArray.length/2),null,e.transform.zoom,null,null,null)}L.destroy(),R.destroy()}const Kn=c.ar(new Float32Array(16));function Qn(e,l,d,p,f,m){const{horizontalAlign:_,verticalAlign:g}=c.aS(e);return new c.P((-(_-.5)*l/f+p[0])*m,(-(g-.5)*d/f+p[1])*m)}function Jn(e,l,d,p,f,m){const _=l.tileAnchorPoint.add(new c.P(l.translation[0],l.translation[1]));if(l.pitchWithMap){let e=p.mult(m);d||(e=e.rotate(-f));const c=_.add(e);return At(c.x,c.y,l.pitchedLabelPlaneMatrix,l.getElevation).point}if(d){const c=Jt(l.tileAnchorPoint.x+1,l.tileAnchorPoint.y,l).point.sub(e),d=Math.atan(c.y/c.x)+(c.x<0?Math.PI:0);return e.add(p.rotate(d))}return e.add(p)}function es(e,l,d,p,f,m,_,g,y,b,T,S){const P=e.text.placedSymbolArray,I=e.text.dynamicLayoutVertexArray,C=e.icon.dynamicLayoutVertexArray,R={};I.clear();for(let C=0;C<P.length;C++){const L=P.get(C),F=L.hidden||!L.crossTileID||e.allowVerticalPlacement&&!L.placedOrientation?null:p[L.crossTileID];if(F){const p=new c.P(L.anchorX,L.anchorY),P={getElevation:S,width:f.width,height:f.height,pitchedLabelPlaneMatrix:m,pitchWithMap:d,transform:f,tileAnchorPoint:p,translation:b,unwrappedTileID:T},C=d?ni(p.x,p.y,P):Jt(p.x,p.y,P),B=Lt(f.cameraToCenterDistance,C.signedDistanceFromCamera);let O=c.aA(e.textSizeData,g,L)*B/c.aM;d&&(O*=e.tilePixelRatio/_);const{width:V,height:j,anchor:G,textOffset:U,textBoxScale:q}=F,Z=Qn(G,V,j,U,q,O),W=f.getPitchedTextCorrection(p.x+b[0],p.y+b[1],T),Q=Jn(C.point,P,l,Z,-f.bearingInRadians,W),J=e.allowVerticalPlacement&&L.placedOrientation===c.az.vertical?Math.PI/2:0;for(let e=0;e<L.numGlyphs;e++)c.aG(I,Q,J);y&&L.associatedIconIndex>=0&&(R[L.associatedIconIndex]={shiftedAnchor:Q,angle:J})}else fi(L.numGlyphs,I)}if(y){C.clear();const l=e.icon.placedSymbolArray;for(let e=0;e<l.length;e++){const d=l.get(e);if(d.hidden)fi(d.numGlyphs,C);else{const l=R[e];if(l)for(let e=0;e<d.numGlyphs;e++)c.aG(C,l.shiftedAnchor,l.angle);else fi(d.numGlyphs,C)}}e.icon.dynamicLayoutVertexBuffer.updateData(C)}e.text.dynamicLayoutVertexBuffer.updateData(I)}function ns(e,l,c){return c.iconsInText&&l?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function ss(e,l,d,p,f,m,_,g,y,b,T,S,P){const I=e.context,C=I.gl,R=e.transform,L="map"===g,F="map"===y,B="viewport"!==g&&"point"!==d.layout.get("symbol-placement"),O=L&&!F&&!B,V=!d.layout.get("symbol-sort-key").isConstant();let j=!1;const G=e.getDepthModeForSublayer(0,ti.ReadOnly),U=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),q=[],Z=R.getCircleRadiusCorrection();for(const g of p){const p=l.getTile(g),y=p.getBucket(d);if(!y)continue;const T=f?y.text:y.icon;if(!T||!T.segments.get().length||!T.hasVisibleVertices)continue;const S=T.programConfigurations.get(d.id),I=f||y.sdfIcons,G=f?y.textSizeData:y.iconSizeData,W=F||0!==R.pitch,Q=e.useProgram(ns(I,f,y),S),J=c.ay(G,R.zoom),re=e.style.map.terrain&&e.style.map.terrain.getTerrainData(g);let oe,le,ce,he,ue=[0,0],pe=null;if(f)le=p.glyphAtlasTexture,ce=C.LINEAR,oe=p.glyphAtlasTexture.size,y.iconsInText&&(ue=p.imageAtlasTexture.size,pe=p.imageAtlasTexture,he=W||e.options.rotating||e.options.zooming||"composite"===G.kind||"camera"===G.kind?C.LINEAR:C.NEAREST);else{const l=1!==d.layout.get("icon-size").constantOr(0)||y.iconsNeedLinear;le=p.imageAtlasTexture,ce=I||e.options.rotating||e.options.zooming||l||W?C.LINEAR:C.NEAREST,oe=p.imageAtlasTexture.size}const fe=c.aN(p,1,e.transform.zoom),me=wt(L,e.transform,fe),ge=c.N();c.aB(ge,me);const ye=Tt(F,L,e.transform,fe),xe=c.aO(R,p,m,_),ve=R.getProjectionData({overscaledTileID:g,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),be=U&&y.hasTextData(),we="none"!==d.layout.get("icon-text-fit")&&be&&y.hasIconData();if(B){const l=e.style.map.terrain?(l,c)=>e.style.map.terrain.getElevation(g,l,c):null,c="map"===d.layout.get("text-rotation-alignment");Ot(y,e,f,me,ge,F,b,c,g.toUnwrapped(),R.width,R.height,xe,l)}const Se=f&&U||we,Me=B||Se?Kn:F?me:e.transform.clipSpaceToPixelsMatrix,Ee=I&&0!==d.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1);let Ce;Ce=I?y.iconsInText?Gn(G.kind,J,O,F,B,Se,e,Me,ye,xe,oe,ue,Z):Nn(G.kind,J,O,F,B,Se,e,Me,ye,xe,f,oe,0,Z):jn(G.kind,J,O,F,B,Se,e,Me,ye,xe,f,oe,Z);const Ae={program:Q,buffers:T,uniformValues:Ce,projectionData:ve,atlasTexture:le,atlasTextureIcon:pe,atlasInterpolation:ce,atlasInterpolationIcon:he,isSDF:I,hasHalo:Ee};if(V&&y.canOverlap){j=!0;const e=T.segments.get();for(const l of e)q.push({segments:new c.aX([l]),sortKey:l.sortKey,state:Ae,terrainData:re})}else q.push({segments:T.segments,sortKey:0,state:Ae,terrainData:re})}j&&q.sort(((e,l)=>e.sortKey-l.sortKey));for(const l of q){const c=l.state;if(I.activeTexture.set(C.TEXTURE0),c.atlasTexture.bind(c.atlasInterpolation,C.CLAMP_TO_EDGE),c.atlasTextureIcon&&(I.activeTexture.set(C.TEXTURE1),c.atlasTextureIcon&&c.atlasTextureIcon.bind(c.atlasInterpolationIcon,C.CLAMP_TO_EDGE)),c.isSDF){const p=c.uniformValues;c.hasHalo&&(p.u_is_halo=1,os(c.buffers,l.segments,d,e,c.program,G,T,S,p,c.projectionData,l.terrainData)),p.u_is_halo=0}os(c.buffers,l.segments,d,e,c.program,G,T,S,c.uniformValues,c.projectionData,l.terrainData)}}function os(e,l,c,d,p,f,m,_,g,y,b){const T=d.context;p.draw(T,T.gl.TRIANGLES,f,m,_,ei.backCCW,g,b,y,c.id,e.layoutVertexBuffer,e.indexBuffer,l,c.paint,d.transform.zoom,e.programConfigurations.get(c.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function ls(e,l,d,p,f){const m=e.context,_=m.gl,g=ai.disabled,y=new Qt([_.ONE,_.ONE],c.bp.transparent,[!0,!0,!0,!0]),b=l.getBucket(d);if(!b)return;const T=p.key;let S=d.heatmapFbos.get(T);S||(S=ds(m,l.tileSize,l.tileSize),d.heatmapFbos.set(T,S)),m.bindFramebuffer.set(S.framebuffer),m.viewport.set([0,0,l.tileSize,l.tileSize]),m.clear({color:c.bp.transparent});const P=b.programConfigurations.get(d.id),I=e.useProgram("heatmap",P,!f),C=e.transform.getProjectionData({overscaledTileID:l.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),R=e.style.map.terrain.getTerrainData(p);I.draw(m,_.TRIANGLES,ti.disabled,g,y,ei.disabled,wn(l,e.transform.zoom,d.paint.get("heatmap-intensity"),1),R,C,d.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,d.paint,e.transform.zoom,P)}function us(e,l,c,d,p){const f=e.context,m=f.gl,_=e.transform;f.setColorMode(e.colorModeForRenderPass());const g=ps(f,l),y=c.key,b=l.heatmapFbos.get(y);if(!b)return;f.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,b.colorAttachment.get()),f.activeTexture.set(m.TEXTURE1),g.bind(m.LINEAR,m.CLAMP_TO_EDGE);const T=_.getProjectionData({overscaledTileID:c,applyTerrainMatrix:p,applyGlobeMatrix:!d});e.useProgram("heatmapTexture").draw(f,m.TRIANGLES,ti.disabled,ai.disabled,e.colorModeForRenderPass(),ei.disabled,Tn(e,l,0,1),null,T,l.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments,l.paint,_.zoom),b.destroy(),l.heatmapFbos.delete(y)}function ds(e,l,c){var d,p;const f=e.gl,m=f.createTexture();f.bindTexture(f.TEXTURE_2D,m),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);const _=null!==(d=e.HALF_FLOAT)&&void 0!==d?d:f.UNSIGNED_BYTE,g=null!==(p=e.RGBA16F)&&void 0!==p?p:f.RGBA;f.texImage2D(f.TEXTURE_2D,0,g,l,c,0,f.RGBA,_,null);const y=e.createFramebuffer(l,c,!1,!1);return y.colorAttachment.set(m),y}function ps(e,l){return l.colorRampTexture||(l.colorRampTexture=new c.T(e,l.colorRamp,e.gl.RGBA)),l.colorRampTexture}function fs(e,l,d,p,f,m,_,g){let y=256;if(f.stepInterpolant){const p=l.getSource().maxzoom,f=_.canonical.z===p?Math.ceil(1<<e.transform.maxZoom-_.canonical.z):1;y=c.an(c.ce(m.maxLineLength/c.a5*1024*f),256,d.maxTextureSize)}return g.gradient=c.cf({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:y,image:g.gradient||void 0,clips:m.lineClipsArray}),g.texture?g.texture.update(g.gradient):g.texture=new c.T(d,g.gradient,p.RGBA),g.version=f.gradientVersion,g.texture}function _s(e,l,c,d,p){e.activeTexture.set(l.TEXTURE0),c.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),d.updatePaintBuffers(p)}function gs(e,l,c,d,p,f){(p||e.lineAtlas.dirty)&&(l.activeTexture.set(c.TEXTURE0),e.lineAtlas.bind(l)),d.updatePaintBuffers(f)}function ys(e,l,c,d,p,f,m){const _=f.gradients[p.id];let g=_.texture;p.gradientVersion!==_.version&&(g=fs(e,l,c,d,p,f,m,_)),c.activeTexture.set(d.TEXTURE0),g.bind(p.stepInterpolant?d.NEAREST:d.LINEAR,d.CLAMP_TO_EDGE)}function vs(e,l,c,d,p,f,m,_,g){const y=f.gradients[p.id];let b=y.texture;p.gradientVersion!==y.version&&(b=fs(e,l,c,d,p,f,m,y)),c.activeTexture.set(d.TEXTURE0),b.bind(p.stepInterpolant?d.NEAREST:d.LINEAR,d.CLAMP_TO_EDGE),c.activeTexture.set(d.TEXTURE1),e.lineAtlas.bind(c),_.updatePaintBuffers(g)}function bs(e,l,c,d,p){if(!c||!d||!d.imageAtlas)return;const f=d.imageAtlas.patternPositions;let m=f[c.to.toString()],_=f[c.from.toString()];if(!m&&_&&(m=_),!_&&m&&(_=m),!m||!_){const e=p.getPaintProperty(l);m=f[e],_=f[e]}m&&_&&e.setConstantPatternPositions(m,_)}function ws(e,l,d,p,f,m,_,g){const y=e.context.gl,b="fill-pattern",T=d.paint.get(b),S=T&&T.constantOr(1),P=d.getCrossfadeParameters();let I,C,R,L,F;const B=e.transform,O=d.paint.get("fill-translate"),V=d.paint.get("fill-translate-anchor");_?(C=S&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=y.LINES):(C=S?"fillPattern":"fill",I=y.TRIANGLES);const j=T.constantOr(null);for(const T of p){const p=l.getTile(T);if(S&&!p.patternsLoaded())continue;const G=p.getBucket(d);if(!G)continue;const U=G.programConfigurations.get(d.id),q=e.useProgram(C,U),Z=e.style.map.terrain&&e.style.map.terrain.getTerrainData(T);S&&(e.context.activeTexture.set(y.TEXTURE0),p.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),U.updatePaintBuffers(P)),bs(U,b,j,p,d);const W=B.getProjectionData({overscaledTileID:T,applyGlobeMatrix:!g,applyTerrainMatrix:!0}),Q=c.aO(B,p,O,V);if(_){L=G.indexBuffer2,F=G.segments2;const l=[y.drawingBufferWidth,y.drawingBufferHeight];R="fillOutlinePattern"===C&&S?gn(e,P,p,l,Q):_n(l,Q)}else L=G.indexBuffer,F=G.segments,R=S?mn(e,P,p,Q):{u_fill_translate:Q};const J=e.stencilModeForClipping(T);q.draw(e.context,I,f,J,m,ei.backCCW,R,Z,W,d.id,G.layoutVertexBuffer,L,F,d.paint,e.transform.zoom,U)}}function Ts(e,l,d,p,f,m,_,g){const y=e.context,b=y.gl,T="fill-extrusion-pattern",S=d.paint.get(T),P=S.constantOr(1),I=d.getCrossfadeParameters(),C=d.paint.get("fill-extrusion-opacity"),R=S.constantOr(null),L=e.transform;for(const S of p){const p=l.getTile(S),F=p.getBucket(d);if(!F)continue;const B=e.style.map.terrain&&e.style.map.terrain.getTerrainData(S),O=F.programConfigurations.get(d.id),V=e.useProgram(P?"fillExtrusionPattern":"fillExtrusion",O);P&&(e.context.activeTexture.set(b.TEXTURE0),p.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),O.updatePaintBuffers(I));const j=L.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!g,applyTerrainMatrix:!0});bs(O,T,R,p,d);const G=c.aO(L,p,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),U=d.paint.get("fill-extrusion-vertical-gradient"),q=P?fn(e,U,C,G,S,I,p):pn(e,U,C,G);V.draw(y,y.gl.TRIANGLES,f,m,_,ei.backCCW,q,B,j,d.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,d.paint,e.transform.zoom,O,e.style.map.terrain&&F.centroidVertexBuffer)}}function Ss(e,l,c,d,p,f,m,_,g){var y;const b=e.style.projection,T=e.context,S=e.transform,P=T.gl,I=[`#define NUM_ILLUMINATION_SOURCES ${c.paint.get("hillshade-highlight-color").values.length}`],C=e.useProgram("hillshade",null,!1,I),R=!e.options.moving;for(const I of d){const d=l.getTile(I),L=d.fbo;if(!L)continue;const F=b.getMeshFromTileID(T,I.canonical,_,!0,"raster"),B=null===(y=e.style.map.terrain)||void 0===y?void 0:y.getTerrainData(I);T.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,L.colorAttachment.get());const O=S.getProjectionData({overscaledTileID:I,aligned:R,applyGlobeMatrix:!g,applyTerrainMatrix:!0});C.draw(T,P.TRIANGLES,f,p[I.overscaledZ],m,ei.backCCW,Sn(e,d,c),B,O,c.id,F.vertexBuffer,F.indexBuffer,F.segments)}}function Ms(e,l,d,p,f,m,_,g,y){var b;const T=e.style.projection,S=e.context,P=e.transform,I=S.gl,C=e.useProgram("colorRelief"),R=!e.options.moving;let L=!0,F=0;for(const B of p){const p=l.getTile(B),O=p.dem;if(L){const e=I.getParameter(I.MAX_TEXTURE_SIZE),{elevationTexture:l,colorTexture:c}=d.getColorRampTextures(S,e,O.getUnpackVector());S.activeTexture.set(I.TEXTURE1),l.bind(I.NEAREST,I.CLAMP_TO_EDGE),S.activeTexture.set(I.TEXTURE4),c.bind(I.LINEAR,I.CLAMP_TO_EDGE),L=!1,F=l.size[0]}if(!O||!O.data)continue;const V=O.stride,j=O.getPixels();if(S.activeTexture.set(I.TEXTURE0),S.pixelStoreUnpackPremultiplyAlpha.set(!1),p.demTexture=p.demTexture||e.getTileTexture(V),p.demTexture){const e=p.demTexture;e.update(j,{premultiply:!1}),e.bind(I.LINEAR,I.CLAMP_TO_EDGE)}else p.demTexture=new c.T(S,j,I.RGBA,{premultiply:!1}),p.demTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE);const G=T.getMeshFromTileID(S,B.canonical,g,!0,"raster"),U=null===(b=e.style.map.terrain)||void 0===b?void 0:b.getTerrainData(B),q=P.getProjectionData({overscaledTileID:B,aligned:R,applyGlobeMatrix:!y,applyTerrainMatrix:!0});C.draw(S,I.TRIANGLES,m,f[B.overscaledZ],_,ei.backCCW,En(d,p.dem,F),U,q,d.id,G.vertexBuffer,G.indexBuffer,G.segments)}}const Is=[new c.P(0,0),new c.P(c.a5,0),new c.P(c.a5,c.a5),new c.P(0,c.a5)];function Es(e,l,c,d,p,f,m,_,g=!1,y=!1){const b=d[d.length-1].overscaledZ,T=e.context,S=T.gl,P=e.useProgram("raster"),I=e.transform,C=e.style.projection,R=e.colorModeForRenderPass(),L=!e.options.moving,F=c.paint.get("raster-opacity"),B=c.paint.get("raster-resampling"),O=c.paint.get("raster-fade-duration"),V=!!e.style.map.terrain;for(const j of d){const d=e.getDepthModeForSublayer(j.overscaledZ-b,1===F?ti.ReadWrite:ti.ReadOnly,S.LESS),G=l.getTile(j),U="nearest"===B?S.NEAREST:S.LINEAR;T.activeTexture.set(S.TEXTURE0),G.texture.bind(U,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),T.activeTexture.set(S.TEXTURE1);const{parentTile:q,parentScaleBy:Z,parentTopLeft:W,fadeValues:Q}=As(G,l,O,V);G.fadeOpacity=Q.tileOpacity,q?(q.fadeOpacity=Q.parentTileOpacity,q.texture.bind(U,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST)):G.texture.bind(U,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),G.texture.useMipmap&&T.extTextureFilterAnisotropic&&e.transform.pitch>20&&S.texParameterf(S.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax);const J=e.style.map.terrain&&e.style.map.terrain.getTerrainData(j),re=I.getProjectionData({overscaledTileID:j,aligned:L,applyGlobeMatrix:!y,applyTerrainMatrix:!0}),oe=On(W,Z,Q.fadeMix,c,_),le=C.getMeshFromTileID(T,j.canonical,f,m,"raster");P.draw(T,S.TRIANGLES,d,p?p[j.overscaledZ]:ai.disabled,R,g?ei.frontCCW:ei.backCCW,oe,J,re,c.id,le.vertexBuffer,le.indexBuffer,le.segments)}}function As(e,l,d,p){const f={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(0===d||p)return f;if(e.fadingParentID){const p=l.getLoadedTile(e.fadingParentID);if(!p)return f;const m=Math.pow(2,p.tileID.overscaledZ-e.tileID.overscaledZ),_=[e.tileID.canonical.x*m%1,e.tileID.canonical.y*m%1],g=function(e,l,d){const p=b(),f=(p-l.timeAdded)/d,m=e.fadingDirection===Me.Incoming,_=c.an((p-e.timeAdded)/d,0,1),g=c.an(1-f,0,1),y=m?_:g;return{tileOpacity:y,parentTileOpacity:m?g:_,fadeMix:{opacity:1,mix:1-y}}}(e,p,d);return{parentTile:p,parentScaleBy:m,parentTopLeft:_,fadeValues:g}}if(e.selfFading){const l=function(e,l){const d=(b()-e.timeAdded)/l,p=c.an(d,0,1);return{tileOpacity:p,fadeMix:{opacity:p,mix:0}}}(e,d);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:l}}return f}const Ds=new c.bp(1,0,0,1),zs=new c.bp(0,1,0,1),ks=new c.bp(0,0,1,1),Fs=new c.bp(1,0,1,1),Bs=new c.bp(0,1,1,1);function Vs(e,l,c,d){Js(e,0,l+c/2,e.transform.width,c,d)}function Ws(e,l,c,d){Js(e,l-c/2,0,c,e.transform.height,d)}function Js(e,l,c,d,p,f){const m=e.context,_=m.gl;_.enable(_.SCISSOR_TEST),_.scissor(l*e.pixelRatio,c*e.pixelRatio,d*e.pixelRatio,p*e.pixelRatio),m.clear({color:f}),_.disable(_.SCISSOR_TEST)}function ro(e,l,d){const p=e.context,f=p.gl,m=e.useProgram("debug"),_=ti.disabled,g=ai.disabled,y=e.colorModeForRenderPass(),b="$debug",T=e.style.map.terrain&&e.style.map.terrain.getTerrainData(d);p.activeTexture.set(f.TEXTURE0);const S=l.getTileByID(d.key).latestRawTileData,P=Math.floor((S&&S.byteLength||0)/1024),I=l.getTile(d).tileSize,C=512/Math.min(I,512)*(d.overscaledZ/e.transform.zoom)*.5;let R=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(R+=` => ${d.overscaledZ}`),function(e,l){e.initDebugOverlayCanvas();const c=e.debugOverlayCanvas,d=e.context.gl,p=e.debugOverlayCanvas.getContext("2d");p.clearRect(0,0,c.width,c.height),p.shadowColor="white",p.shadowBlur=2,p.lineWidth=1.5,p.strokeStyle="white",p.textBaseline="top",p.font="bold 36px Open Sans, sans-serif",p.fillText(l,5,5),p.strokeText(l,5,5),e.debugOverlayTexture.update(c),e.debugOverlayTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}(e,`${R} ${P}kB`);const L=e.transform.getProjectionData({overscaledTileID:d,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(p,f.TRIANGLES,_,g,Qt.alphaBlended,ei.disabled,bn(c.bp.transparent,C),null,L,b,e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments),m.draw(p,f.LINE_STRIP,_,g,y,ei.disabled,bn(c.bp.red),T,L,b,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments)}function lo(e,l,c,d){const{isRenderingGlobe:p}=d,f=e.context,m=f.gl,_=e.transform,g=e.colorModeForRenderPass(),y=e.getDepthModeFor3D(),b=e.useProgram("terrain");f.bindFramebuffer.set(null),f.viewport.set([0,0,e.width,e.height]);for(const d of c){const c=l.getTerrainMesh(d.tileID),T=e.renderToTexture.getTexture(d),S=l.getTerrainData(d.tileID);f.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,T.texture);const P=l.getMeshFrameDelta(_.zoom),I=_.calculateFogMatrix(d.tileID.toUnwrapped()),C=cn(P,I,e.style.sky,_.pitch,p),R=_.getProjectionData({overscaledTileID:d.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});b.draw(f,m.TRIANGLES,y,ai.disabled,g,ei.backCCW,C,S,R,"terrain",c.vertexBuffer,c.indexBuffer,c.segments)}}function co(e,l){if(!l.mesh){const d=new c.aW;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(1,1),d.emplaceBack(-1,1);const p=new c.aY;p.emplaceBack(0,1,2),p.emplaceBack(0,2,3),l.mesh=new kt(e.createVertexBuffer(d,Ni.members),e.createIndexBuffer(p),c.aX.simpleSegment(0,0,d.length,p.length))}return l.mesh}class Wo{constructor(e,l){this.context=new no(e),this.transform=l,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ke.maxOverzooming+ke.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Rt}resize(e,l,c){if(this.width=Math.floor(e*c),this.height=Math.floor(l*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style._order)this.style._layers[e].resize()}setup(){const e=this.context,l=new c.aW;l.emplaceBack(0,0),l.emplaceBack(c.a5,0),l.emplaceBack(0,c.a5),l.emplaceBack(c.a5,c.a5),this.tileExtentBuffer=e.createVertexBuffer(l,Ni.members),this.tileExtentSegments=c.aX.simpleSegment(0,0,4,2);const d=new c.aW;d.emplaceBack(0,0),d.emplaceBack(c.a5,0),d.emplaceBack(0,c.a5),d.emplaceBack(c.a5,c.a5),this.debugBuffer=e.createVertexBuffer(d,Ni.members),this.debugSegments=c.aX.simpleSegment(0,0,4,5);const p=new c.ch;p.emplaceBack(0,0,0,0),p.emplaceBack(c.a5,0,c.a5,0),p.emplaceBack(0,c.a5,0,c.a5),p.emplaceBack(c.a5,c.a5,c.a5,c.a5),this.rasterBoundsBuffer=e.createVertexBuffer(p,ln.members),this.rasterBoundsSegments=c.aX.simpleSegment(0,0,4,2);const f=new c.aW;f.emplaceBack(0,0),f.emplaceBack(c.a5,0),f.emplaceBack(0,c.a5),f.emplaceBack(c.a5,c.a5),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(f,Ni.members),this.rasterBoundsSegmentsPosOnly=c.aX.simpleSegment(0,0,4,5);const m=new c.aW;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(m,Ni.members),this.viewportSegments=c.aX.simpleSegment(0,0,4,2);const _=new c.ci;_.emplaceBack(0),_.emplaceBack(1),_.emplaceBack(3),_.emplaceBack(2),_.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(_);const g=new c.aY;g.emplaceBack(1,0,2),g.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(g);const y=this.context.gl;this.stencilClearMode=new ai({func:y.ALWAYS,mask:0},0,255,y.ZERO,y.ZERO,y.ZERO),this.tileExtentMesh=new kt(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,l=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=c.N();c.c7(d,0,this.width,this.height,0,0,1),c.Q(d,d,[l.drawingBufferWidth,l.drawingBufferHeight,0]);const p={mainMatrix:d,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:d};this.useProgram("clippingMask",null,!0).draw(e,l.TRIANGLES,ti.disabled,this.stencilClearMode,Qt.disabled,ei.disabled,null,null,p,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,l,c){if(this.currentStencilSource===e.source||!e.isTileClipped()||!l||!l.length)return;this.currentStencilSource=e.source,this.nextStencilID+l.length>256&&this.clearStencil();const d=this.context;d.setColorMode(Qt.disabled),d.setDepthMode(ti.disabled);const p={};for(const e of l)p[e.key]=this.nextStencilID++;this._renderTileMasks(p,l,c,!0),this._renderTileMasks(p,l,c,!1),this._tileClippingMaskIDs=p}_renderTileMasks(e,l,c,d){const p=this.context,f=p.gl,m=this.style.projection,_=this.transform,g=this.useProgram("clippingMask");for(const y of l){const l=e[y.key],b=this.style.map.terrain&&this.style.map.terrain.getTerrainData(y),T=m.getMeshFromTileID(this.context,y.canonical,d,!0,"stencil"),S=_.getProjectionData({overscaledTileID:y,applyGlobeMatrix:!c,applyTerrainMatrix:!0});g.draw(p,f.TRIANGLES,ti.disabled,new ai({func:f.ALWAYS,mask:0},l,255,f.KEEP,f.KEEP,f.REPLACE),Qt.disabled,c?ei.disabled:ei.backCCW,null,b,S,"$clipping",T.vertexBuffer,T.indexBuffer,T.segments)}}_renderTilesDepthBuffer(){const e=this.context,l=e.gl,c=this.style.projection,d=this.transform,p=this.useProgram("depth"),f=this.getDepthModeFor3D(),m=it(d,{tileSize:d.tileSize});for(const _ of m){const m=this.style.map.terrain&&this.style.map.terrain.getTerrainData(_),g=c.getMeshFromTileID(this.context,_.canonical,!0,!0,"raster"),y=d.getProjectionData({overscaledTileID:_,applyGlobeMatrix:!0,applyTerrainMatrix:!0});p.draw(e,l.TRIANGLES,f,ai.disabled,Qt.disabled,ei.backCCW,null,m,y,"$clipping",g.vertexBuffer,g.indexBuffer,g.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,l=this.context.gl;return new ai({func:l.NOTEQUAL,mask:255},e,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(e){const l=this.context.gl;return new ai({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,l.KEEP,l.KEEP,l.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const l=this.context.gl,c=e.sort(((e,l)=>l.overscaledZ-e.overscaledZ)),d=c[c.length-1].overscaledZ,p=c[0].overscaledZ-d+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const e={};for(let c=0;c<p;c++)e[c+d]=new ai({func:l.GEQUAL,mask:255},c+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=p,[e,c]}return[{[d]:ai.disabled},c]}stencilConfigForOverlapTwoPass(e){const l=this.context.gl,c=e.sort(((e,l)=>l.overscaledZ-e.overscaledZ)),d=c[c.length-1].overscaledZ,p=c[0].overscaledZ-d+1;if(this.clearStencil(),p>1){const e={},f={};for(let c=0;c<p;c++)e[c+d]=new ai({func:l.GREATER,mask:255},p+1+c,255,l.KEEP,l.KEEP,l.REPLACE),f[c+d]=new ai({func:l.GREATER,mask:255},1+c,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID=2*p+1,[e,f,c]}return this.nextStencilID=3,[{[d]:new ai({func:l.GREATER,mask:255},2,255,l.KEEP,l.KEEP,l.REPLACE)},{[d]:new ai({func:l.GREATER,mask:255},1,255,l.KEEP,l.KEEP,l.REPLACE)},c]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const l=1/8;return new Qt([e.CONSTANT_COLOR,e.ONE],new c.bp(l,l,l,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Qt.unblended:Qt.alphaBlended}getDepthModeForSublayer(e,l,c){if(!this.opaquePassEnabledForLayer())return ti.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ti(c||this.context.gl.LEQUAL,l,[d,d])}getDepthModeFor3D(){return new ti(this.context.gl.LEQUAL,ti.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,l){var d,p;this.style=e,this.options=l,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(b()),this.imageManager.beginFrame();const f=this.style._order,m=this.style.tileManagers,_={},g={},y={},T={isRenderingToTexture:!1,isRenderingGlobe:(null===(d=e.projection)||void 0===d?void 0:d.transitionState)>0};for(const e in m){const l=m[e];l.used&&l.prepare(this.context),_[e]=l.getVisibleCoordinates(!1),g[e]=_[e].slice().reverse(),y[e]=l.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<f.length;e++)if(this.style._layers[f[e]].is3D()){this.opaquePassCutoff=e;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const e of f){const l=this.style._layers[e];if(!l.hasOffscreenPass()||l.isHidden(this.transform.zoom))continue;const c=g[l.source];("custom"===l.type||c.length)&&this.renderLayer(this,m[l.source],l,c,T)}if(null===(p=this.style.projection)||void 0===p||p.updateGPUdependent({context:this.context,useProgram:e=>this.useProgram(e)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:l.showOverdrawInspector?c.bp.black:c.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(e,l){const c=e.context,d=c.gl,p=((e,l,c)=>{const d=Math.cos(l.rollInRadians),p=Math.sin(l.rollInRadians),f=Ne(l),m=l.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:e.properties.get("sky-color"),u_horizon_color:e.properties.get("horizon-color"),u_horizon:[(l.width/2-f*p)*c,(l.height/2+f*d)*c],u_horizon_normal:[-p,d],u_sky_horizon_blend:e.properties.get("sky-horizon-blend")*l.height/2*c,u_sky_blend:m}})(l,e.style.map.transform,e.pixelRatio),f=new ti(d.LEQUAL,ti.ReadWrite,[0,1]),m=ai.disabled,_=e.colorModeForRenderPass(),g=e.useProgram("sky"),y=co(c,l);g.draw(c,d.TRIANGLES,f,m,_,ei.disabled,p,null,void 0,"sky",y.vertexBuffer,y.indexBuffer,y.segments)}(this,this.style.sky),this._showOverdrawInspector=l.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[f[this.currentLayer]],l=m[e.source],c=_[e.source];this._renderTileClippingMasks(e,c,!1),this.renderLayer(this,l,e,c,T)}this.renderPass="translucent";let S=!1;for(this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const e=this.style._layers[f[this.currentLayer]],l=m[e.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(e,T))continue;this.opaquePassEnabledForLayer()||S||(S=!0,T.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const c=("symbol"===e.type?y:g)[e.source];this._renderTileClippingMasks(e,_[e.source],!!this.renderToTexture),this.renderLayer(this,l,e,c,T)}if(T.isRenderingGlobe&&function(e,l,d){const p=e.context,f=p.gl,m=e.useProgram("atmosphere"),_=new ti(f.LEQUAL,ti.ReadOnly,[0,1]),g=e.transform,y=function(e,l){const d=e.properties.get("position"),p=[-d.x,-d.y,-d.z],f=c.ar(new Float64Array(16));return"map"===e.properties.get("anchor")&&(c.bg(f,f,l.rollInRadians),c.bh(f,f,-l.pitchInRadians),c.bg(f,f,l.bearingInRadians),c.bh(f,f,l.center.lat*Math.PI/180),c.bJ(f,f,-l.center.lng*Math.PI/180)),c.cg(p,p,f),p}(d,e.transform),b=g.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),T=l.properties.get("atmosphere-blend")*b.projectionTransition;if(0===T)return;const S=zr(g.worldSize,g.center.lat),P=g.inverseProjectionMatrix,I=new Float64Array(4);I[3]=1,c.aH(I,I,g.modelViewProjectionMatrix),I[0]/=I[3],I[1]/=I[3],I[2]/=I[3],I[3]=1,c.aH(I,I,P),I[0]/=I[3],I[1]/=I[3],I[2]/=I[3],I[3]=1;const C=((e,l,c,d,p)=>({u_sun_pos:e,u_atmosphere_blend:l,u_globe_position:c,u_globe_radius:d,u_inv_proj_matrix:p}))(y,T,[I[0],I[1],I[2]],S,P),R=co(p,l);m.draw(p,f.TRIANGLES,_,ai.disabled,Qt.alphaBlended,ei.disabled,C,null,null,"atmosphere",R.vertexBuffer,R.indexBuffer,R.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const e=function(e,l){let c=null;const d=Object.values(e._layers).flatMap((c=>c.source&&!c.isHidden(l)?[e.tileManagers[c.source]]:[])),p=d.filter((e=>"vector"===e.getSource().type)),f=d.filter((e=>"vector"!==e.getSource().type)),m=e=>{(!c||c.getSource().maxzoom<e.getSource().maxzoom)&&(c=e)};return p.forEach((e=>m(e))),c||f.forEach((e=>m(e))),c}(this.style,this.transform.zoom);e&&function(e,l,c){for(let d=0;d<c.length;d++)ro(e,l,c[d])}(this,e,e.getVisibleCoordinates())}this.options.showPadding&&function(e){const l=e.transform.padding;Vs(e,e.transform.height-(l.top||0),3,Ds),Vs(e,l.bottom||0,3,zs),Ws(e,l.left||0,3,ks),Ws(e,e.transform.width-(l.right||0),3,Fs);const c=e.transform.centerPoint;!function(e,l,c,d){Js(e,l-1,c-10,2,20,d),Js(e,l-10,c-1,20,2,d)}(e,c.x,e.transform.height-c.y,Bs)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const l=this.terrainFacilitator.matrix,d=this.transform.modelViewProjectionMatrix;let p=this.terrainFacilitator.dirty;p||(p=e?!c.cj(l,d):!c.ck(l,d)),p||(p=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),p&&(c.cl(l,d),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(e,l){const d=e.context,p=d.gl,f=e.transform,m=Qt.unblended,_=new ti(p.LEQUAL,ti.ReadWrite,[0,1]),g=l.tileManager.getRenderableTiles(),y=e.useProgram("terrainDepth");d.bindFramebuffer.set(l.getFramebuffer("depth").framebuffer),d.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),d.clear({color:c.bp.transparent,depth:1});for(const e of g){const c=l.getTerrainMesh(e.tileID),g=l.getTerrainData(e.tileID),b=f.getProjectionData({overscaledTileID:e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),T={u_ele_delta:l.getMeshFrameDelta(f.zoom)};y.draw(d,p.TRIANGLES,_,ai.disabled,m,ei.backCCW,T,g,b,"terrain",c.vertexBuffer,c.indexBuffer,c.segments)}d.bindFramebuffer.set(null),d.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain),function(e,l){const d=e.context,p=d.gl,f=e.transform,m=Qt.unblended,_=new ti(p.LEQUAL,ti.ReadWrite,[0,1]),g=l.getCoordsTexture(),y=l.tileManager.getRenderableTiles(),b=e.useProgram("terrainCoords");d.bindFramebuffer.set(l.getFramebuffer("coords").framebuffer),d.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),d.clear({color:c.bp.transparent,depth:1}),l.coordsIndex=[];for(const e of y){const c=l.getTerrainMesh(e.tileID),y=l.getTerrainData(e.tileID);d.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,g.texture);const T={u_terrain_coords_id:(255-l.coordsIndex.length)/255,u_texture:0,u_ele_delta:l.getMeshFrameDelta(f.zoom)},S=f.getProjectionData({overscaledTileID:e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});b.draw(d,p.TRIANGLES,_,ai.disabled,m,ei.backCCW,T,y,S,"terrain",c.vertexBuffer,c.indexBuffer,c.segments),l.coordsIndex.push(e.tileID.key)}d.bindFramebuffer.set(null),d.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain))}renderLayer(e,l,d,p,f){d.isHidden(this.transform.zoom)||("background"===d.type||"custom"===d.type||(p||[]).length)&&(this.id=d.id,c.cm(d)?function(e,l,d,p,f,m){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:_}=m,g=ai.disabled,y=e.colorModeForRenderPass();(d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(e,l,d,p,f,m,_,g,y){const b=l.transform,T=l.style.map.terrain,S="map"===f,P="map"===m;for(const f of e){const e=p.getTile(f),m=e.getBucket(d);if(!m||!m.text||!m.text.segments.get().length)continue;const I=c.ay(m.textSizeData,b.zoom),C=c.aN(e,1,l.transform.zoom),R=wt(S,l.transform,C),L="none"!==d.layout.get("icon-text-fit")&&m.hasIconData();if(I){const l=Math.pow(2,b.zoom-e.tileID.overscaledZ),d=T?(e,l)=>T.getElevation(f,e,l):null;es(m,S,P,y,b,R,l,I,L,c.aO(b,e,_,g),f.toUnwrapped(),d)}}}(p,e,d,l,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),f),0!==d.paint.get("icon-opacity").constantOr(1)&&ss(e,l,d,p,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),g,y,_),0!==d.paint.get("text-opacity").constantOr(1)&&ss(e,l,d,p,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),g,y,_),l.map.showCollisionBoxes&&(Yn(e,l,d,p,!0),Yn(e,l,d,p,!1))}(e,l,d,p,this.style.placement.variableOffsets,f):c.cn(d)?function(e,l,d,p,f){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:m}=f,_=d.paint.get("circle-opacity"),g=d.paint.get("circle-stroke-width"),y=d.paint.get("circle-stroke-opacity"),b=!d.layout.get("circle-sort-key").isConstant();if(0===_.constantOr(1)&&(0===g.constantOr(1)||0===y.constantOr(1)))return;const T=e.context,S=T.gl,P=e.transform,I=e.getDepthModeForSublayer(0,ti.ReadOnly),C=ai.disabled,R=e.colorModeForRenderPass(),L=[],F=P.getCircleRadiusCorrection();for(let f=0;f<p.length;f++){const _=p[f],g=l.getTile(_),y=g.getBucket(d);if(!y)continue;const T=d.paint.get("circle-translate"),S=d.paint.get("circle-translate-anchor"),I=c.aO(P,g,T,S),C=y.programConfigurations.get(d.id),R=e.useProgram("circle",C),B=y.layoutVertexBuffer,O=y.indexBuffer,V=e.style.map.terrain&&e.style.map.terrain.getTerrainData(_),j={programConfiguration:C,program:R,layoutVertexBuffer:B,indexBuffer:O,uniformValues:yn(e,g,d,I,F),terrainData:V,projectionData:P.getProjectionData({overscaledTileID:_,applyGlobeMatrix:!m,applyTerrainMatrix:!0})};if(b){const e=y.segments.get();for(const l of e)L.push({segments:new c.aX([l]),sortKey:l.sortKey,state:j})}else L.push({segments:y.segments,sortKey:0,state:j})}b&&L.sort(((e,l)=>e.sortKey-l.sortKey));for(const l of L){const{programConfiguration:c,program:p,layoutVertexBuffer:f,indexBuffer:m,uniformValues:_,terrainData:g,projectionData:y}=l.state;p.draw(T,S.TRIANGLES,I,C,R,ei.backCCW,_,g,y,d.id,f,m,l.segments,d.paint,e.transform.zoom,c)}}(e,l,d,p,f):c.co(d)?function(e,l,d,p,f){if(0===d.paint.get("heatmap-opacity"))return;const m=e.context,{isRenderingToTexture:_,isRenderingGlobe:g}=f;if(e.style.map.terrain){for(const c of p){const p=l.getTile(c);l.hasRenderableParent(c)||("offscreen"===e.renderPass?ls(e,p,d,c,g):"translucent"===e.renderPass&&us(e,d,c,_,g))}m.viewport.set([0,0,e.width,e.height])}else"offscreen"===e.renderPass?function(e,l,d,p){const f=e.context,m=f.gl,_=e.transform,g=ai.disabled,y=new Qt([m.ONE,m.ONE],c.bp.transparent,[!0,!0,!0,!0]);(function(e,l,d){const p=e.gl;e.activeTexture.set(p.TEXTURE1),e.viewport.set([0,0,l.width/4,l.height/4]);let f=d.heatmapFbos.get(c.cd);f?(p.bindTexture(p.TEXTURE_2D,f.colorAttachment.get()),e.bindFramebuffer.set(f.framebuffer)):(f=ds(e,l.width/4,l.height/4),d.heatmapFbos.set(c.cd,f))})(f,e,d),f.clear({color:c.bp.transparent});for(let c=0;c<p.length;c++){const b=p[c];if(l.hasRenderableParent(b))continue;const T=l.getTile(b),S=T.getBucket(d);if(!S)continue;const P=S.programConfigurations.get(d.id),I=e.useProgram("heatmap",P),C=_.getProjectionData({overscaledTileID:b,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),R=_.getCircleRadiusCorrection();I.draw(f,m.TRIANGLES,ti.disabled,g,y,ei.backCCW,wn(T,_.zoom,d.paint.get("heatmap-intensity"),R),null,C,d.id,S.layoutVertexBuffer,S.indexBuffer,S.segments,d.paint,_.zoom,P)}f.viewport.set([0,0,e.width,e.height])}(e,l,d,p):"translucent"===e.renderPass&&function(e,l){const d=e.context,p=d.gl;d.setColorMode(e.colorModeForRenderPass());const f=l.heatmapFbos.get(c.cd);f&&(d.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,f.colorAttachment.get()),d.activeTexture.set(p.TEXTURE1),ps(d,l).bind(p.LINEAR,p.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(d,p.TRIANGLES,ti.disabled,ai.disabled,e.colorModeForRenderPass(),ei.disabled,Tn(e,l,0,1),null,null,l.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,l.paint,e.transform.zoom))}(e,d)}(e,l,d,p,f):c.cp(d)?function(e,l,c,d,p){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:f}=p,m=c.paint.get("line-opacity"),_=c.paint.get("line-width");if(0===m.constantOr(1)||0===_.constantOr(1))return;const g=e.getDepthModeForSublayer(0,ti.ReadOnly),y=e.colorModeForRenderPass(),b=c.paint.get("line-dasharray"),T=b.constantOr(1),S=c.paint.get("line-pattern"),P=S.constantOr(1),I=c.paint.get("line-gradient"),C=c.getCrossfadeParameters();let R;R=P?"linePattern":T&&I?"lineGradientSDF":T?"lineSDF":I?"lineGradient":"line";const L=e.context,F=L.gl,B=e.transform;let O=!0;for(const p of d){const d=l.getTile(p);if(P&&!d.patternsLoaded())continue;const m=d.getBucket(c);if(!m)continue;const _=m.programConfigurations.get(c.id),V=e.context.program.get(),j=e.useProgram(R,_),G=O||j.program!==V,U=e.style.map.terrain&&e.style.map.terrain.getTerrainData(p),q=S.constantOr(null),Z=b&&b.constantOr(null);if(q&&d.imageAtlas){const e=d.imageAtlas,l=e.patternPositions[q.to.toString()],c=e.patternPositions[q.from.toString()];l&&c&&_.setConstantPatternPositions(l,c)}else if(Z){const l="round"===c.layout.get("line-cap"),d=e.lineAtlas.getDash(Z.to,l),p=e.lineAtlas.getDash(Z.from,l);_.setConstantDashPositions(d,p)}const W=B.getProjectionData({overscaledTileID:p,applyGlobeMatrix:!f,applyTerrainMatrix:!0}),Q=B.getPixelScale();let J;P?(J=Dn(e,d,c,Q,C),_s(L,F,d,_,C)):T&&I?(J=Rn(e,d,c,Q,C,m.lineClipsArray.length),vs(e,l,L,F,c,m,p,_,C)):T?(J=kn(e,d,c,Q,C),gs(e,L,F,_,G,C)):I?(J=An(e,d,c,Q,m.lineClipsArray.length),ys(e,l,L,F,c,m,p)):J=Cn(e,d,c,Q);const re=e.stencilModeForClipping(p);j.draw(L,F.TRIANGLES,g,re,y,ei.disabled,J,U,W,c.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,c.paint,e.transform.zoom,_,m.layoutVertexBuffer2),O=!1}}(e,l,d,p,f):c.cq(d)?function(e,l,d,p,f){const m=d.paint.get("fill-color"),_=d.paint.get("fill-opacity");if(0===_.constantOr(1))return;const{isRenderingToTexture:g}=f,y=e.colorModeForRenderPass(),b=d.paint.get("fill-pattern"),T=e.opaquePassEnabledForLayer()&&!b.constantOr(1)&&1===m.constantOr(c.bp.transparent).a&&1===_.constantOr(0)?"opaque":"translucent";if(e.renderPass===T){const c=e.getDepthModeForSublayer(1,"opaque"===e.renderPass?ti.ReadWrite:ti.ReadOnly);ws(e,l,d,p,c,y,!1,g)}if("translucent"===e.renderPass&&d.paint.get("fill-antialias")){const c=e.getDepthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,ti.ReadOnly);ws(e,l,d,p,c,y,!0,g)}}(e,l,d,p,f):c.cr(d)?function(e,l,c,d,p){const f=c.paint.get("fill-extrusion-opacity");if(0===f)return;const{isRenderingToTexture:m}=p;if("translucent"===e.renderPass){const p=new ti(e.context.gl.LEQUAL,ti.ReadWrite,e.depthRangeFor3D);if(1!==f||c.paint.get("fill-extrusion-pattern").constantOr(1))Ts(e,l,c,d,p,ai.disabled,Qt.disabled,m),Ts(e,l,c,d,p,e.stencilModeFor3D(),e.colorModeForRenderPass(),m);else{const f=e.colorModeForRenderPass();Ts(e,l,c,d,p,ai.disabled,f,m)}}}(e,l,d,p,f):c.cs(d)?function(e,l,d,p,f){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const{isRenderingToTexture:m}=f,_=e.context,g=e.style.projection.useSubdivision,y=e.getDepthModeForSublayer(0,ti.ReadOnly),b=e.colorModeForRenderPass();if("offscreen"===e.renderPass)!function(e,l,d,p,f,m,_){const g=e.context,y=g.gl;for(const b of d){const d=l.getTile(b),T=d.dem;if(!T||!T.data)continue;if(!d.needsHillshadePrepare)continue;const S=T.dim,P=T.stride,I=T.getPixels();if(g.activeTexture.set(y.TEXTURE1),g.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||e.getTileTexture(P),d.demTexture){const e=d.demTexture;e.update(I,{premultiply:!1}),e.bind(y.NEAREST,y.CLAMP_TO_EDGE)}else d.demTexture=new c.T(g,I,y.RGBA,{premultiply:!1}),d.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);g.activeTexture.set(y.TEXTURE0);let C=d.fbo;if(!C){const e=new c.T(g,{width:S,height:S,data:null},y.RGBA);e.bind(y.LINEAR,y.CLAMP_TO_EDGE),C=d.fbo=g.createFramebuffer(S,S,!0,!1),C.colorAttachment.set(e.texture)}g.bindFramebuffer.set(C.framebuffer),g.viewport.set([0,0,S,S]),e.useProgram("hillshadePrepare").draw(g,y.TRIANGLES,f,m,_,ei.disabled,Pn(d.tileID,T),null,null,p.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),d.needsHillshadePrepare=!1}}(e,l,p,d,y,ai.disabled,b),_.viewport.set([0,0,e.width,e.height]);else if("translucent"===e.renderPass)if(g){const[c,f,_]=e.stencilConfigForOverlapTwoPass(p);Ss(e,l,d,_,c,y,b,!1,m),Ss(e,l,d,_,f,y,b,!0,m)}else{const[c,f]=e.getStencilConfigForOverlapAndUpdateStencilID(p);Ss(e,l,d,f,c,y,b,!1,m)}}(e,l,d,p,f):c.ct(d)?function(e,l,c,d,p){if("translucent"!==e.renderPass)return;if(!d.length)return;const{isRenderingToTexture:f}=p,m=e.style.projection.useSubdivision,_=e.getDepthModeForSublayer(0,ti.ReadOnly),g=e.colorModeForRenderPass();if(m){const[p,m,y]=e.stencilConfigForOverlapTwoPass(d);Ms(e,l,c,y,p,_,g,!1,f),Ms(e,l,c,y,m,_,g,!0,f)}else{const[p,m]=e.getStencilConfigForOverlapAndUpdateStencilID(d);Ms(e,l,c,m,p,_,g,!1,f)}}(e,l,d,p,f):c.bU(d)?function(e,l,c,d,p){if("translucent"!==e.renderPass)return;if(0===c.paint.get("raster-opacity"))return;if(!d.length)return;const{isRenderingToTexture:f}=p,m=l.getSource(),_=e.style.projection.useSubdivision;if(m instanceof te)Es(e,l,c,d,null,!1,!1,m.tileCoords,m.flippedWindingOrder,f);else if(_){const[p,m,_]=e.stencilConfigForOverlapTwoPass(d);Es(e,l,c,_,p,!1,!0,Is,!1,f),Es(e,l,c,_,m,!0,!0,Is,!1,f)}else{const[p,m]=e.getStencilConfigForOverlapAndUpdateStencilID(d);Es(e,l,c,m,p,!1,!0,Is,!1,f)}}(e,l,d,p,f):c.cu(d)?function(e,l,c,d,p){const f=c.paint.get("background-color"),m=c.paint.get("background-opacity");if(0===m)return;const{isRenderingToTexture:_}=p,g=e.context,y=g.gl,b=e.style.projection,T=e.transform,S=T.tileSize,P=c.paint.get("background-pattern");if(e.isPatternMissing(P))return;const I=!P&&1===f.a&&1===m&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==I)return;const C=ai.disabled,R=e.getDepthModeForSublayer(0,"opaque"===I?ti.ReadWrite:ti.ReadOnly),L=e.colorModeForRenderPass(),F=e.useProgram(P?"backgroundPattern":"background"),B=d||it(T,{tileSize:S,terrain:e.style.map.terrain});P&&(g.activeTexture.set(y.TEXTURE0),e.imageManager.bind(e.context));const O=c.getCrossfadeParameters();for(const l of B){const d=T.getProjectionData({overscaledTileID:l,applyGlobeMatrix:!_,applyTerrainMatrix:!0}),p=P?qn(m,e,P,{tileID:l,tileSize:S},O):Un(m,f),I=e.style.map.terrain&&e.style.map.terrain.getTerrainData(l),B=b.getMeshFromTileID(g,l.canonical,!1,!0,"raster");F.draw(g,y.TRIANGLES,R,C,L,ei.backCCW,p,I,d,c.id,B.vertexBuffer,B.indexBuffer,B.segments)}}(e,0,d,p,f):c.cv(d)&&function(e,l,c,d){const{isRenderingGlobe:p}=d,f=e.context,m=c.implementation,_=e.style.projection,g=e.transform,y=g.getProjectionDataForCustomLayer(p),b={farZ:g.farZ,nearZ:g.nearZ,fov:g.fov*Math.PI/180,modelViewProjectionMatrix:g.modelViewProjectionMatrix,projectionMatrix:g.projectionMatrix,shaderData:{variantName:_.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;\nuniform mat4 u_projection_matrix;\n${_.shaderPreludeCode.vertexSource}`,define:_.shaderDefine},defaultProjectionData:y},T=m.renderingMode?m.renderingMode:"2d";if("offscreen"===e.renderPass){const l=m.prerender;l&&(e.setCustomLayerDefaults(),f.setColorMode(e.colorModeForRenderPass()),l.call(m,f.gl,b),f.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),f.setColorMode(e.colorModeForRenderPass()),f.setStencilMode(ai.disabled);const l="3d"===T?e.getDepthModeFor3D():e.getDepthModeForSublayer(0,ti.ReadOnly);f.setDepthMode(l),m.render(f.gl,b),f.setDirty(),e.setBaseState(),f.bindFramebuffer.set(null)}}(e,0,d,f))}saveTileTexture(e){const l=this._tileTextures[e.size[0]];l?l.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const l=this._tileTextures[e];return l&&l.length>0?l.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const l=this.imageManager.getPattern(e.from.toString()),c=this.imageManager.getPattern(e.to.toString());return!l||!c}useProgram(e,l,c=!1,d=[]){this.cache=this.cache||{};const p=!!this.style.map.terrain,f=this.style.projection,m=c?Vi.projectionMercator:f.shaderPreludeCode,_=c?Gi:f.shaderDefine,g=e+(l?l.cacheKey:"")+`/${c?Ui:f.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(p?"/terrain":"")+(d?`/${d.join("/")}`:"");return this.cache[g]||(this.cache[g]=new Zi(this.context,Vi[e],l,$n[e],this._showOverdrawInspector,p,m,_,d)),this.cache[g]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var e,l;if(this._tileTextures){for(const e in this._tileTextures){const l=this._tileTextures[e];if(l)for(const e of l)e.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&(null===(e=this.tileExtentMesh.vertexBuffer)||void 0===e||e.destroy()),this.tileExtentMesh&&(null===(l=this.tileExtentMesh.indexBuffer)||void 0===l||l.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const e in this.cache){const l=this.cache[e];l&&l.program&&this.context.gl.deleteProgram(l.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:l}=this.context.gl;return this.width!==e||this.height!==l}}function ho(l,c){let d,p=!1,f=null,m=null;const _=()=>{f=null,p&&(l.apply(m,d),f=setTimeout(_,c),p=!1)};return(...l)=>(p=!0,m=this||e,d=l,f||_(),f)}class Ho{constructor(e){this._getCurrentHash=()=>{const e=window.location.hash.replace("#","");if(this._hashName){let l;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(l=e)})),(l&&l[1]||"").split("/")}return e.split("/")},this._onHashChange=()=>{const e=this._getCurrentHash();if(!this._isValidHash(e))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:l,pitch:+(e[4]||0)}),!0},this._updateHashUnthrottled=()=>{const e=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,e)},this._removeHash=()=>{const e=this._getCurrentHash();if(0===e.length)return;const l=e.join("/");let c=l;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${l}`);let d=window.location.hash.replace(c,"");d.startsWith("#&")?d=d.slice(0,1)+d.slice(2):"#"===d&&(d="");let p=window.location.href.replace(/(#.+)?$/,d);p=p.replace("&&","&"),window.history.replaceState(window.history.state,null,p)},this._updateHash=ho(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const l=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,d),f=Math.round(l.lng*p)/p,m=Math.round(l.lat*p)/p,_=this._map.getBearing(),g=this._map.getPitch();let y="";if(y+=e?`/${f}/${m}/${c}`:`${c}/${m}/${f}`,(_||g)&&(y+="/"+Math.round(10*_)/10),g&&(y+=`/${Math.round(g)}`),this._hashName){const e=this._hashName;let l=!1;const c=window.location.hash.slice(1).split("&").map((c=>{const d=c.split("=")[0];return d===e?(l=!0,`${d}=${y}`):c})).filter((e=>e));return l||c.push(`${e}=${y}`),`#${c.join("&")}`}return`#${y}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new c.V(+e[2],+e[1])}catch(e){return!1}const l=+e[0],d=+(e[3]||0),p=+(e[4]||0);return l>=this._map.getMinZoom()&&l<=this._map.getMaxZoom()&&d>=-180&&d<=180&&p>=this._map.getMinPitch()&&p<=this._map.getMaxPitch()}}const uo={linearity:.3,easing:c.cw(0,0,.3,1)},po=c.e({deceleration:2500,maxSpeed:1400},uo),fo=c.e({deceleration:20,maxSpeed:1400},uo),mo=c.e({deceleration:1e3,maxSpeed:360},uo),yo=c.e({deceleration:1e3,maxSpeed:90},uo),xo=c.e({deceleration:1e3,maxSpeed:360},uo);class tr{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:b(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,l=b();for(;e.length>0&&l-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)l.zoom+=e.zoomDelta||0,l.bearing+=e.bearingDelta||0,l.pitch+=e.pitchDelta||0,l.roll+=e.rollDelta||0,e.panDelta&&l.pan._add(e.panDelta),e.around&&(l.around=e.around),e.pinchAround&&(l.pinchAround=e.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(l.pan.mag()){const f=bo(l.pan.mag(),d,c.e({},po,e||{})),m=l.pan.mult(f.amount/l.pan.mag()),_=this._map.cameraHelper.handlePanInertia(m,this._map.transform);p.center=_.easingCenter,p.offset=_.easingOffset,vo(p,f)}if(l.zoom){const e=bo(l.zoom,d,fo),f=c.cx(this._map.transform.zoom+e.amount,this._map.getZoomSnap(),e.amount);p.zoom=f,vo(p,e)}if(l.bearing){const e=bo(l.bearing,d,mo);p.bearing=this._map.transform.bearing+c.an(e.amount,-179,179),vo(p,e)}if(l.pitch){const e=bo(l.pitch,d,yo);p.pitch=this._map.transform.pitch+e.amount,vo(p,e)}if(l.roll){const e=bo(l.roll,d,xo);p.roll=this._map.transform.roll+c.an(e.amount,-179,179),vo(p,e)}if(p.zoom||p.bearing){const e=void 0===l.pinchAround?l.around:l.pinchAround;p.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),c.e(p,{noMoveStart:!0})}}function vo(e,l){(!e.duration||e.duration<l.duration)&&(e.duration=l.duration,e.easing=l.easing)}function bo(e,l,d){const{maxSpeed:p,linearity:f,deceleration:m}=d,_=c.an(e*f/(l/1e3),-p,p),g=Math.abs(_)/(m*f);return{easing:d.easing,duration:1e3*g,amount:_*(g/2)}}class or extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,l,d,p={}){d=d instanceof MouseEvent?d:new MouseEvent(e,d);const f=h.mousePos(l.getCanvas(),d),m=l.unproject(f);super(e,c.e({point:f,lngLat:m,originalEvent:d},p)),this._defaultPrevented=!1,this.target=l}}class rr extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,l,d){const p="touchend"===e?d.changedTouches:d.touches,f=h.touchPos(l.getCanvasContainer(),p),m=f.map((e=>l.unproject(e))),_=f.reduce(((e,l,c,d)=>e.add(l.div(d.length))),new c.P(0,0));super(e,{points:f,point:_,lngLats:m,lngLat:l.unproject(_),originalEvent:d}),this._defaultPrevented=!1}}class sr extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,l,c){super(e,{originalEvent:c}),this._defaultPrevented=!1}}class nr{constructor(e,l){this._map=e,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new sr(e.type,this._map,e))}mousedown(e,l){return this._mousedownPos=l,this._firePreventable(new or(e.type,this._map,e))}mouseup(e){this._map.fire(new or(e.type,this._map,e))}click(e,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||this._map.fire(new or(e.type,this._map,e))}dblclick(e){return this._firePreventable(new or(e.type,this._map,e))}mouseover(e){this._map.fire(new or(e.type,this._map,e))}mouseout(e){this._map.fire(new or(e.type,this._map,e))}touchstart(e){return this._firePreventable(new rr(e.type,this._map,e))}touchmove(e){this._map.fire(new rr(e.type,this._map,e))}touchend(e){this._map.fire(new rr(e.type,this._map,e))}touchcancel(e){this._map.fire(new rr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new or(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new or("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new or(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cr{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(c.P.convert(e),this._map.terrain)}}class hr{constructor(e,l){this._map=e,this._tr=new cr(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,l){this.isEnabled()&&e.shiftKey&&0===e.button&&(h.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(e,l){if(!this._active)return;const c=l;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=c,this._box||(this._box=h.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(d.x,c.x),f=Math.max(d.x,c.x),m=Math.min(d.y,c.y),_=Math.max(d.y,c.y);h.setTransform(this._box,`translate(${p}px,${m}px)`),this._box.style.width=f-p+"px",this._box.style.height=_-m+"px"}mouseupWindow(e,l){if(!this._active)return;if(0!==e.button)return;const d=this._startPos,p=l;if(this.reset(),h.suppressClick(),d.x!==p.x||d.y!==p.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(d,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(h.remove(this._box),this._box=null),h.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,l){return this._map.fire(new c.l(e,{originalEvent:l}))}}function Eo(e,l){if(e.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${e.length}, points ${l.length}`);const c={};for(let d=0;d<e.length;d++)c[e[d].identifier]=l[d];return c}class dr{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,l,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),d.length===this.numTouches&&(this.centroid=function(e){const l=new c.P(0,0);for(const c of e)l._add(c);return l.div(e.length)}(l),this.touches=Eo(d,l)))}touchmove(e,l,c){if(this.aborted||!this.centroid)return;const d=Eo(c,l);for(const e in this.touches){const l=d[e];(!l||l.dist(this.touches[e])>30)&&(this.aborted=!0)}}touchend(e,l,c){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===c.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class _r{constructor(e){this.singleTap=new dr(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,l,c){this.singleTap.touchstart(e,l,c)}touchmove(e,l,c){this.singleTap.touchmove(e,l,c)}touchend(e,l,c){const d=this.singleTap.touchend(e,l,c);if(d){const l=e.timeStamp-this.lastTime<500,c=!this.lastTap||this.lastTap.dist(d)<30;if(l&&c||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class pr{constructor(e){this._tr=new cr(e),this._zoomIn=new _r({numTouches:1,numTaps:2}),this._zoomOut=new _r({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,l,c){this._zoomIn.touchstart(e,l,c),this._zoomOut.touchstart(e,l,c)}touchmove(e,l,c){this._zoomIn.touchmove(e,l,c),this._zoomOut.touchmove(e,l,c)}touchend(e,l,d){const p=this._zoomIn.touchend(e,l,d),f=this._zoomOut.touchend(e,l,d),m=this._tr;return p?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:l=>l.easeTo({duration:300,zoom:c.cx(m.zoom+1,l.getZoomSnap()),around:m.unproject(p)},{originalEvent:e})}):f?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:l=>l.easeTo({duration:300,zoom:c.cx(m.zoom-1,l.getZoomSnap()),around:m.unproject(f)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mr{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const l=this._moveFunction(...e);if(l.bearingDelta||l.pitchDelta||l.rollDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(e,l){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(l)?l[0]:l,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,l){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const d=Array.isArray(l)?l[0]:l;return!this._moved&&d.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(c,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&h.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Co=0,ko=2,Ro={[Co]:1,[ko]:2};class xr{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const l=h.mouseButton(e);this._eventButton=l}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(e,l){const c=Ro[l];return void 0===e.buttons||(e.buttons&c)!==c}(e,this._eventButton)}isValidEndEvent(e){return h.mouseButton(e)===this._eventButton}}class br{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return 1===e.targetTouches.length}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class yr{constructor(e=new xr({checkCorrectEvent:()=>!0}),l=new br){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=l}_executeRelevantHandler(e,l,c){return e instanceof MouseEvent?l(e):"undefined"!=typeof TouchEvent&&e instanceof TouchEvent?c(e):void 0}startMove(e){this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.startMove(e)),(e=>this.oneFingerTouchMoveStateManager.startMove(e)))}endMove(e){this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.endMove(e)),(e=>this.oneFingerTouchMoveStateManager.endMove(e)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.isValidStartEvent(e)),(e=>this.oneFingerTouchMoveStateManager.isValidStartEvent(e)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.isValidMoveEvent(e)),(e=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(e)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.isValidEndEvent(e)),(e=>this.oneFingerTouchMoveStateManager.isValidEndEvent(e)))}}const Lo=e=>{e.mousedown=e.dragStart,e.mousemoveWindow=e.dragMove,e.mouseup=e.dragEnd,e.contextmenu=e=>{e.preventDefault()}};class Tr{constructor(e,l){this._clickTolerance=e.clickTolerance||1,this._map=l,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,l,c){return this._calculateTransform(e,l,c)}touchmove(e,l,c){if(this._active){if(!this._shouldBePrevented(c.length))return e.preventDefault(),this._calculateTransform(e,l,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,l,c){this._calculateTransform(e,l,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,l,d){d.length>0&&(this._active=!0);const p=Eo(d,l),f=new c.P(0,0),m=new c.P(0,0);let _=0;for(const e in p){const l=p[e],c=this._touches[e];c&&(f._add(l),m._add(l.sub(c)),_++,p[e]=l)}if(this._touches=p,this._shouldBePrevented(_)||!m.mag())return;const g=m.div(_);return this._sum._add(g),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(_),panDelta:g}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,l,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([l[0],l[1]]))}touchmove(e,l,c){if(!this._firstTwoTouches)return;e.preventDefault();const[d,p]=this._firstTwoTouches,f=Oo(c,l,d),m=Oo(c,l,p);if(!f||!m)return;const _=this._aroundCenter?null:f.add(m).div(2);return this._move([f,m],_,e)}touchend(e,l,c){if(!this._firstTwoTouches)return;const[d,p]=this._firstTwoTouches,f=Oo(c,l,d),m=Oo(c,l,p);f&&m||(this._active&&h.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Oo(e,l,c){for(let d=0;d<e.length;d++)if(e[d].identifier===c)return l[d]}function No(e,l){return Math.log(e/l)/Math.LN2}class Mr extends Pr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,l){const c=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(No(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:No(this._distance,c),pinchAround:l}}}function Go(e,l){return 180*e.angleWith(l)/Math.PI}class Sr extends Pr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,l,c){const d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Go(this._vector,d),pinchAround:l}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const l=25/(Math.PI*this._minDiameter)*360,c=Go(e,this._startVector);return Math.abs(c)<l}}function Uo(e){return Math.abs(e.y)>Math.abs(e.x)}class Rr extends Pr{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,l,c){super.touchstart(e,l,c),this._currentTouchCount=c.length}_start(e){this._lastPoints=e,Uo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,l,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,p,c.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,l,c){if(void 0!==this._valid)return this._valid;const d=e.mag()>=2,p=l.mag()>=2;if(!d&&!p)return;if(!d||!p)return void 0===this._firstMove&&(this._firstMove=c),c-this._firstMove<100&&void 0;const f=e.y>0==l.y>0;return Uo(e)&&Uo(l)&&f}}const qo={panStep:100,bearingStep:15,pitchStep:10};class Ar{constructor(e){this._tr=new cr(e);const l=qo;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let l=0,d=0,p=0,f=0,m=0;switch(e.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:e.shiftKey?d=-1:(e.preventDefault(),f=-1);break;case 39:e.shiftKey?d=1:(e.preventDefault(),f=1);break;case 38:e.shiftKey?p=1:(e.preventDefault(),m=-1);break;case 40:e.shiftKey?p=-1:(e.preventDefault(),m=1);break;default:return}return this._rotationDisabled&&(d=0,p=0),{cameraAnimation:_=>{const g=this._tr;_.easeTo({duration:300,easeId:"keyboardHandler",easing:Zo,zoom:l?c.cx(g.zoom+l*(e.shiftKey?2:1),_.getZoomSnap()):g.zoom,bearing:g.bearing+d*this._bearingStep,pitch:g.pitch+p*this._pitchStep,offset:[-f*this._panStep,-m*this._panStep],center:g.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zo(e){return e*(2-e)}const $o=4.000244140625,Xo=1/450;class Br{constructor(e,l){this._onTimeout=e=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)},this._map=e,this._tr=new cr(e),this._triggerRenderFrame=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Xo}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around)}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let l=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const c=b(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,0!==l&&l%$o==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),e.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=e,this._delta-=l,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=h.mousePos(this._map.getCanvas(),e),d=this._tr;this._aroundPoint=this._aroundCenter?d.transform.locationToScreenPoint(c.V.convert(d.center)):l,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._tr.transform;if("number"==typeof this._lastExpectedZoom){const l=e.zoom-this._lastExpectedZoom;"number"==typeof this._startZoom&&(this._startZoom+=l),"number"==typeof this._targetZoom&&(this._targetZoom+=l)}if(0!==this._delta){const l="wheel"===this._type&&Math.abs(this._delta)>$o?this._wheelZoomRate:this._defaultZoomRate;let d=2/(1+Math.exp(-Math.abs(this._delta*l)));this._delta<0&&0!==d&&(d=1/d);const p="number"!=typeof this._targetZoom?e.scale:c.aq(this._targetZoom),f=e.applyConstrain(e.getCameraLngLat(),c.at(p*d)).zoom,m=this._map.getZoomSnap();if("wheel"===this._type&&m>0){const l=c.cx(e.zoom,m);this._targetZoom=c.cx(f,m,f-l)}else this._targetZoom=f;"wheel"===this._type&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const l="number"!=typeof this._targetZoom?e.zoom:this._targetZoom,d=this._startZoom,p=this._easing;let f,m=!1;if("wheel"===this._type&&d&&p){const e=b()-this._lastWheelEventTime,_=Math.min((e+5)/200,1),g=p(_);f=c.G.number(d,l,g),_<1?this._frameId||(this._frameId=!0):m=!0}else f=l,m=!0;return this._active=!0,m&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=f,{noInertia:!0,needsRenderFrame:!m,zoomDelta:f-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let l=c.cz;if(this._prevEase){const e=this._prevEase,d=(b()-e.start)/e.duration,p=e.easing(d+.01)-e.easing(d),f=.27/Math.sqrt(p*p+1e-4)*.01,m=Math.sqrt(.0729-f*f);l=c.cw(f,m,.25,1)}return this._prevEase={start:b(),duration:e,easing:l},l}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Or{constructor(e,l){this._clickZoom=e,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jr{constructor(e){this._tr=new cr(e),this.reset()}reset(){this._active=!1}dblclick(e,l){return e.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:c.cx(this._tr.zoom+(e.shiftKey?-1:1),d.getZoomSnap()),around:this._tr.unproject(l)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nr{constructor(){this._tap=new _r({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,l,c){if(!this._swipePoint)if(this._tapTime){const d=l[0],p=e.timeStamp-this._tapTime<500,f=this._tapPoint.dist(d)<30;p&&f?c.length>0&&(this._swipePoint=d,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(e,l,c)}touchmove(e,l,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const d=l[0],p=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,l,c)}touchend(e,l,c){if(this._tapTime)this._swipePoint&&0===c.length&&this.reset();else{const d=this._tap.touchend(e,l,c);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zr{constructor(e,l,c){this._el=e,this._mousePan=l,this._touchPan=c}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ur{constructor(e,l,c,d){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=l,this._mousePitch=c,this._mouseRoll=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Gr{constructor(e,l,c,d){this._el=e,this._touchZoom=l,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Vr{constructor(e,l){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=e,this._options=l,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=h.create("div","maplibregl-cooperative-gesture-screen",e);let l=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(l=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=l,this._container.appendChild(d);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=c,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(h.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,l){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:e,originalEvent:l})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Yo=e=>e.zoom||e.drag||e.roll||e.pitch||e.rotate;class Wr extends c.l{}function Ko(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta||e.rollDelta}class Hr{get _ownerDocument(){var e;return(null===(e=this._el)||void 0===e?void 0:e.ownerDocument)||document}get _ownerWindow(){var e,l;return(null===(l=null===(e=this._el)||void 0===e?void 0:e.ownerDocument)||void 0===l?void 0:l.defaultView)||window}constructor(e,l){this.handleWindowEvent=e=>{this.handleEvent(e,`${e.type}Window`)},this.handleEvent=(e,l)=>{if("blur"===e.type)return void this.stop(!0);this._updatingCamera=!0;const d="renderFrame"===e.type?void 0:e,p={needsRenderFrame:!1},f={},m={};for(const{handlerName:_,handler:g,allowed:y}of this._handlers){if(!g.isEnabled())continue;let b;if(this._blockedByActive(m,y,_))g.reset();else if(g[l||e.type]){if(c.cA(e,l||e.type)){const c=h.mousePos(this._map.getCanvas(),e);b=g[l||e.type](e,c)}else if(c.cB(e,l||e.type)){const c=this._getMapTouches(e.touches),d=h.touchPos(this._map.getCanvas(),c);b=g[l||e.type](e,d,c)}else c.cC(l||e.type)||(b=g[l||e.type](e));this.mergeHandlerResult(p,f,b,_,d),b&&b.needsRenderFrame&&this._triggerRenderFrame()}(b||g.isActive())&&(m[_]=g)}const _={};for(const e in this._previousActiveHandlers)m[e]||(_[e]=d);this._previousActiveHandlers=m,(Object.keys(_).length||Ko(p))&&(this._changes.push([p,f,_]),this._triggerRenderFrame()),(Object.keys(m).length||Ko(p))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:g}=p;g&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],g(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tr(e),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(l);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[this._ownerDocument,"mousemove",{capture:!0}],[this._ownerDocument,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[this._ownerWindow,"blur",void 0]];for(const[e,l,c]of this._listeners)h.addEventListener(e,l,e===this._ownerDocument?this.handleWindowEvent:this.handleEvent,c)}destroy(){for(const[e,l,c]of this._listeners)h.removeEventListener(e,l,e===this._ownerDocument?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(e){const l=this._map,d=l.getCanvasContainer();this._add("mapEvent",new nr(l,e));const p=l.boxZoom=new hr(l,e);this._add("boxZoom",p),e.interactive&&e.boxZoom&&p.enable();const f=l.cooperativeGestures=new Vr(l,e.cooperativeGestures);this._add("cooperativeGestures",f),e.cooperativeGestures&&f.enable();const m=new pr(l),_=new jr(l);l.doubleClickZoom=new Or(_,m),this._add("tapZoom",m),this._add("clickZoom",_),e.interactive&&e.doubleClickZoom&&l.doubleClickZoom.enable();const g=new Nr;this._add("tapDragZoom",g);const y=l.touchPitch=new Rr(l);this._add("touchPitch",y),e.interactive&&e.touchPitch&&l.touchPitch.enable(e.touchPitch);const b=()=>l.project(l.getCenter()),T=function({enable:e,clickTolerance:l,aroundCenter:d=!0,minPixelCenterThreshold:p=100,rotateDegreesPerPixelMoved:f=.8},m){const _=new xr({checkCorrectEvent:e=>0===h.mouseButton(e)&&e.ctrlKey||2===h.mouseButton(e)&&!e.ctrlKey});return new mr({clickTolerance:l,move:(e,l)=>{const _=m();if(d&&Math.abs(_.y-e.y)>p)return{bearingDelta:c.cy(new c.P(e.x,l.y),l,_)};let g=(l.x-e.x)*f;return d&&l.y<_.y&&(g=-g),{bearingDelta:g}},moveStateManager:_,enable:e,assignEvents:Lo})}(e,b),S=function({enable:e,clickTolerance:l,pitchDegreesPerPixelMoved:c=-.5}){const d=new xr({checkCorrectEvent:e=>0===h.mouseButton(e)&&e.ctrlKey||2===h.mouseButton(e)});return new mr({clickTolerance:l,move:(e,l)=>({pitchDelta:(l.y-e.y)*c}),moveStateManager:d,enable:e,assignEvents:Lo})}(e),P=function({enable:e,clickTolerance:l,rollDegreesPerPixelMoved:c=.3},d){const p=new xr({checkCorrectEvent:e=>2===h.mouseButton(e)&&e.ctrlKey});return new mr({clickTolerance:l,move:(e,l)=>{const p=d();let f=(l.x-e.x)*c;return l.y<p.y&&(f=-f),{rollDelta:f}},moveStateManager:p,enable:e,assignEvents:Lo})}(e,b);l.dragRotate=new Ur(e,T,S,P),this._add("mouseRotate",T,["mousePitch"]),this._add("mousePitch",S,["mouseRotate","mouseRoll"]),this._add("mouseRoll",P,["mousePitch"]),e.interactive&&e.dragRotate&&l.dragRotate.enable();const I=function({enable:e,clickTolerance:l}){const c=new xr({checkCorrectEvent:e=>0===h.mouseButton(e)&&!e.ctrlKey});return new mr({clickTolerance:l,move:(e,l)=>({around:l,panDelta:l.sub(e)}),activateOnStart:!0,moveStateManager:c,enable:e,assignEvents:Lo})}(e),C=new Tr(e,l);l.dragPan=new Zr(d,I,C),this._add("mousePan",I),this._add("touchPan",C,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&l.dragPan.enable(e.dragPan);const R=new Sr,L=new Mr;l.touchZoomRotate=new Gr(d,L,R,g),this._add("touchRotate",R,["touchPan","touchZoom"]),this._add("touchZoom",L,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&l.touchZoomRotate.enable(e.touchZoomRotate),this._add("blockableMapEvent",new lr(l));const F=l.scrollZoom=new Br(l,(()=>this._triggerRenderFrame()));this._add("scrollZoom",F,["mousePan"]),e.interactive&&e.scrollZoom&&l.scrollZoom.enable(e.scrollZoom);const B=l.keyboard=new Ar(l);this._add("keyboard",B),e.interactive&&e.keyboard&&l.keyboard.enable()}_add(e,l,c){this._handlers.push({handlerName:e,handler:l,allowed:c}),this._handlersById[e]=l}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Yo(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,l,c){for(const d in e)if(d!==c&&(!l||l.indexOf(d)<0))return!0;return!1}_getMapTouches(e){const l=[];for(const c of e)this._el.contains(c.target)&&l.push(c);return l}mergeHandlerResult(e,l,d,p,f){if(!d)return;c.e(e,d);const m={handlerName:p,originalEvent:d.originalEvent||f};void 0!==d.zoomDelta&&(l.zoom=m),void 0!==d.panDelta&&(l.drag=m),void 0!==d.rollDelta&&(l.roll=m),void 0!==d.pitchDelta&&(l.pitch=m),void 0!==d.bearingDelta&&(l.rotate=m)}_applyChanges(){const e={},l={},d={};for(const[p,f,m]of this._changes)p.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(p.panDelta)),p.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+p.pitchDelta),p.rollDelta&&(e.rollDelta=(e.rollDelta||0)+p.rollDelta),void 0!==p.around&&(e.around=p.around),void 0!==p.pinchAround&&(e.pinchAround=p.pinchAround),p.noInertia&&(e.noInertia=p.noInertia),c.e(l,f),c.e(d,m);this._updateMapTransform(e,l,d),this._changes=[]}_updateMapTransform(e,l,c){const d=this._map,p=d._getTransformForUpdate(),f=d.terrain;if(!(Ko(e)||f&&this._terrainMovement))return this._fireEvents(l,c,!0);d._stop(!0);let{panDelta:m,zoomDelta:_,bearingDelta:g,pitchDelta:y,rollDelta:b,around:T,pinchAround:S}=e;void 0!==S&&(T=S),T=T||d.transform.centerPoint,f&&!p.isPointOnMapSurface(T)&&(T=p.centerPoint);const P={panDelta:m,zoomDelta:_,rollDelta:b,pitchDelta:y,bearingDelta:g,around:T};this._map.cameraHelper.useGlobeControls&&!p.isPointOnMapSurface(T)&&(T=p.centerPoint);const I=T.distSqr(p.centerPoint)<.01?p.center:p.screenPointToLocation(m?T.sub(m):T);this._handleMapControls({terrain:f,tr:p,deltasForHelper:P,preZoomAroundLoc:I,combinedEventsInProgress:l,panDelta:m}),d._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(l,c,!0)}_handleMapControls({terrain:e,tr:l,deltasForHelper:c,preZoomAroundLoc:d,combinedEventsInProgress:p,panDelta:f}){const m=this._map.cameraHelper;if(m.handleMapControlsRollPitchBearingZoom(c,l),e)return m.useGlobeControls?(this._terrainMovement||!p.drag&&!p.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void m.handleMapControlsPan(c,l,d)):this._terrainMovement||!p.drag&&!p.zoom?void(p.drag&&this._terrainMovement&&f?l.setCenter(l.screenPointToLocation(l.centerPoint.sub(f))):m.handleMapControlsPan(c,l,d)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void m.handleMapControlsPan(c,l,d));m.handleMapControlsPan(c,l,d)}_fireEvents(e,l,d){const p=Yo(this._eventsInProgress),f=Yo(e),m={};for(const l in e){const{originalEvent:c}=e[l];this._eventsInProgress[l]||(m[`${l}start`]=c),this._eventsInProgress[l]=e[l]}!p&&f&&this._fireEvent("movestart",f.originalEvent);for(const e in m)this._fireEvent(e,m[e]);f&&this._fireEvent("move",f.originalEvent);for(const l in e){const{originalEvent:c}=e[l];this._fireEvent(l,c)}const _={};let y;for(const e in this._eventsInProgress){const{handlerName:c,originalEvent:d}=this._eventsInProgress[e];this._handlersById[c].isActive()||(delete this._eventsInProgress[e],y=l[c]||d,_[`${e}end`]=y)}for(const e in _)this._fireEvent(e,_[e]);const b=Yo(this._eventsInProgress),T=(p||f)&&!b;if(T&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const e=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&e.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(e)}if(d&&T){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),l=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;!e||!e.essential&&g.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:y})),l(this._map.getBearing())&&this._map.resetNorth()):(l(e.bearing||this._map.getBearing())&&(e.bearing=0),e.freezeElevation=!0,this._map.easeTo(e,{originalEvent:y})),this._updatingCamera=!1}}_fireEvent(e,l){this._map.fire(new c.l(e,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Wr("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Xr extends c.E{constructor(e,l,c){super(),this._renderFrameCallback=()=>{const e=Math.min((b()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=c.bearingSnap,this._zoomSnap=c.zoomSnap,this.cameraHelper=l,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,l){e.apply(this.transform,!0),this.transform=e,this.cameraHelper=l}getCenter(){return new c.V(this.transform.center.lng,this.transform.center.lat)}setCenter(e,l){return this.jumpTo({center:e},l)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,l){return this.jumpTo({elevation:e},l),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,l,d){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},l),d)}panTo(e,l,d){return this.easeTo(c.e({center:e},l),d)}getZoom(){return this.transform.zoom}setZoom(e,l){return this.jumpTo({zoom:e},l),this}zoomTo(e,l,d){return this.easeTo(c.e({zoom:e},l),d)}zoomIn(e,l){return this.zoomTo(c.cx(this.getZoom()+1,this._zoomSnap),e,l),this}zoomOut(e,l){return this.zoomTo(c.cx(this.getZoom()-1,this._zoomSnap),e,l),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,l){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new c.l("movestart",l)).fire(new c.l("move",l)).fire(new c.l("moveend",l))),this}getBearing(){return this.transform.bearing}setZoomSnap(e){return this._zoomSnap=e,this}getZoomSnap(){return this._zoomSnap}setBearing(e,l){return this.jumpTo({bearing:e},l),this}getPadding(){return this.transform.padding}setPadding(e,l){return this.jumpTo({padding:e},l),this}rotateTo(e,l,d){return this.easeTo(c.e({bearing:e},l),d)}resetNorth(e,l){return this.rotateTo(0,c.e({duration:1e3},e),l),this}resetNorthPitch(e,l){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},e),l),this}snapToNorth(e,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,l):this}getPitch(){return this.transform.pitch}setPitch(e,l){return this.jumpTo({pitch:e},l),this}getRoll(){return this.transform.roll}setRoll(e,l){return this.jumpTo({roll:e},l),this}cameraForBounds(e,l){e=$.convert(e).adjustAntiMeridian();const c=l&&l.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),c,l)}_cameraForBoxAndBearing(e,l,d,p){const f={top:0,bottom:0,right:0,left:0};if("number"==typeof(p=c.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding){const e=p.padding;p.padding={top:e,bottom:e,right:e,left:e}}const m=c.e(f,p.padding);p.padding=m;const _=this.transform,g=new $(e,l);return this.cameraHelper.cameraForBoxAndBearing(p,m,g,d,_)}fitBounds(e,l,c){return this._fitInternal(this.cameraForBounds(e,l),l,c)}fitScreenCoordinates(e,l,d,p,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(e)),this.transform.screenPointToLocation(c.P.convert(l)),d,p),p,f)}_fitInternal(e,l,d){return e?(delete(l=c.e(e,l)).padding,l.linear?this.easeTo(l,d):this.flyTo(l,d)):this}jumpTo(e,l){this.stop();const d=this._getTransformForUpdate();let p=!1,f=!1,m=!1;const _=d.zoom;this.cameraHelper.handleJumpToCenterZoom(d,e);const g=d.zoom!==_;return"elevation"in e&&d.elevation!==+e.elevation&&d.setElevation(+e.elevation),"bearing"in e&&d.bearing!==+e.bearing&&(p=!0,d.setBearing(+e.bearing)),"pitch"in e&&d.pitch!==+e.pitch&&(f=!0,d.setPitch(+e.pitch)),"roll"in e&&d.roll!==+e.roll&&(m=!0,d.setRoll(+e.roll)),null==e.padding||d.isPaddingEqual(e.padding)||d.setPadding(e.padding),this._applyUpdatedTransform(d),this.fire(new c.l("movestart",l)).fire(new c.l("move",l)),g&&this.fire(new c.l("zoomstart",l)).fire(new c.l("zoom",l)).fire(new c.l("zoomend",l)),p&&this.fire(new c.l("rotatestart",l)).fire(new c.l("rotate",l)).fire(new c.l("rotateend",l)),f&&this.fire(new c.l("pitchstart",l)).fire(new c.l("pitch",l)).fire(new c.l("pitchend",l)),m&&this.fire(new c.l("rollstart",l)).fire(new c.l("roll",l)).fire(new c.l("rollend",l)),this.fire(new c.l("moveend",l))}calculateCameraOptionsFromTo(e,l,d,p=0){const f=c.a9.fromLngLat(e,l),m=c.a9.fromLngLat(d,p),_=m.x-f.x,g=m.y-f.y,y=m.z-f.z,b=Math.hypot(_,g,y);if(0===b)throw new Error("Can't calculate camera options with same From and To");const T=Math.hypot(_,g),S=c.at(this.transform.cameraToCenterDistance/b/this.transform.tileSize),P=180*Math.atan2(_,-g)/Math.PI;let I=180*Math.acos(T/b)/Math.PI;return I=y<0?90-I:90+I,{center:m.toLngLat(),elevation:p,zoom:S,pitch:I,bearing:P}}calculateCameraOptionsFromCameraLngLatAltRotation(e,l,c,d,p){const f=this.transform.calculateCenterFromCameraLngLatAlt(e,l,c,d);return{center:f.center,elevation:f.elevation,zoom:f.zoom,bearing:c,pitch:d,roll:p}}easeTo(e,l){this._stop(!1,e.easeId),(!1===(e=c.e({offset:[0,0],duration:500,easing:c.cz},e)).animate||!e.essential&&g.prefersReducedMotion)&&(e.duration=0);const d=this._getTransformForUpdate(),p=this.getBearing(),f=d.pitch,m=d.roll,_="bearing"in e?this._normalizeBearing(e.bearing,p):p,y="pitch"in e?+e.pitch:f,b="roll"in e?this._normalizeBearing(e.roll,m):m,T="padding"in e?e.padding:d.padding,S=c.P.convert(e.offset);let P,I;e.around&&(P=c.V.convert(e.around),I=d.locationToScreenPoint(P));const C={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},R=this.cameraHelper.handleEaseTo(d,{bearing:_,pitch:y,roll:b,padding:T,around:P,aroundPoint:I,offsetAsPoint:S,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||p!==_,this._pitching=this._pitching||y!==f,this._rolling=this._rolling||b!==m,this._padding=!d.isPaddingEqual(T),this._zooming=this._zooming||R.isZooming,this._easeId=e.easeId,this._prepareEase(l,e.noMoveStart,C),this.terrain&&this._prepareElevation(R.elevationCenter),this._ease((c=>{R.easeFunc(c),this.terrain&&!e.freezeElevation&&this._updateElevation(c),this._applyUpdatedTransform(d),this._fireMoveEvents(l)}),(c=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(l,c)}),e),this}_prepareEase(e,l,d={}){this._moving=!0,l||d.moving||this.fire(new c.l("movestart",e)),this._zooming&&!d.zooming&&this.fire(new c.l("zoomstart",e)),this._rotating&&!d.rotating&&this.fire(new c.l("rotatestart",e)),this._pitching&&!d.pitching&&this.fire(new c.l("pitchstart",e)),this._rolling&&!d.rolling&&this.fire(new c.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){void 0!==this._elevationStart&&void 0!==this._elevationCenter||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const l=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&l!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(c-(l-(c*e+this._elevationStart))/(1-e)),this._elevationTarget=l}this.transform.setElevation(c.G.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const l=e.getCameraLngLat(),c=e.getCameraAltitude(),d=this.terrain?this.terrain.getElevationForLngLatZoom(l,e.zoom):0;if(c<d){const c=this.calculateCameraOptionsFromTo(l,d,e.center,e.elevation);return{pitch:c.pitch,zoom:c.zoom}}return{}}_applyUpdatedTransform(e){const l=[];if(l.push((e=>this._elevateCameraIfInsideTerrain(e))),this.transformCameraUpdate&&l.push((e=>this.transformCameraUpdate(e))),!l.length)return;const c=e.clone();for(const e of l){const l=c.clone(),{center:d,zoom:p,roll:f,pitch:m,bearing:_,elevation:g}=e(l);d&&l.setCenter(d),void 0!==g&&l.setElevation(g),void 0!==p&&l.setZoom(p),void 0!==f&&l.setRoll(f),void 0!==m&&l.setPitch(m),void 0!==_&&l.setBearing(_),c.apply(l,!1)}this.transform.apply(c,!1)}_fireMoveEvents(e){this.fire(new c.l("move",e)),this._zooming&&this.fire(new c.l("zoom",e)),this._rotating&&this.fire(new c.l("rotate",e)),this._pitching&&this.fire(new c.l("pitch",e)),this._rolling&&this.fire(new c.l("roll",e))}_afterEase(e,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId;const d=this._zooming,p=this._rotating,f=this._pitching,m=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,d&&this.fire(new c.l("zoomend",e)),p&&this.fire(new c.l("rotateend",e)),f&&this.fire(new c.l("pitchend",e)),m&&this.fire(new c.l("rollend",e)),this.fire(new c.l("moveend",e))}flyTo(e,l){if(!e.essential&&g.prefersReducedMotion){const d=c.U(e,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(d,l)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cz},e);const d=this._getTransformForUpdate(),p=d.bearing,f=d.pitch,m=d.roll,_=d.padding,y="bearing"in e?this._normalizeBearing(e.bearing,p):p,b="pitch"in e?+e.pitch:f,T="roll"in e?this._normalizeBearing(e.roll,m):m,S="padding"in e?e.padding:d.padding,P=c.P.convert(e.offset);let I=d.centerPoint.add(P);const C=d.screenPointToLocation(I),R=this.cameraHelper.handleFlyTo(d,{bearing:y,pitch:b,roll:T,padding:S,locationAtOffset:C,offsetAsPoint:P,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let L=e.curve;const F=Math.max(d.width,d.height),B=F/R.scaleOfZoom,O=R.pixelPathLength;"number"==typeof R.scaleOfMinZoom&&(L=Math.sqrt(F/R.scaleOfMinZoom/O*2));const V=L*L;function j(e){const l=(B*B-F*F+(e?-1:1)*V*V*O*O)/(2*(e?B:F)*V*O);return Math.log(Math.sqrt(l*l+1)-l)}function G(e){return(Math.exp(e)-Math.exp(-e))/2}function U(e){return(Math.exp(e)+Math.exp(-e))/2}const q=j(!1);let Z=function(e){return U(q)/U(q+L*e)},W=function(e){return F*((U(q)*(G(l=q+L*e)/U(l))-G(q))/V)/O;var l},Q=(j(!0)-q)/L;if(Math.abs(O)<2e-6||!isFinite(Q)){if(Math.abs(F-B)<1e-6)return this.easeTo(e,l);const c=B<F?-1:1;Q=Math.abs(Math.log(B/F))/L,W=()=>0,Z=e=>Math.exp(c*L*e)}return e.duration="duration"in e?+e.duration:1e3*Q/("screenSpeed"in e?+e.screenSpeed/L:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=p!==y,this._pitching=b!==f,this._rolling=T!==m,this._padding=!d.isPaddingEqual(S),this._prepareEase(l,!1),this.terrain&&this._prepareElevation(R.targetCenter),this._ease((g=>{const C=g*Q,L=1/Z(C),F=W(C);this._rotating&&d.setBearing(c.G.number(p,y,g)),this._pitching&&d.setPitch(c.G.number(f,b,g)),this._rolling&&d.setRoll(c.G.number(m,T,g)),this._padding&&(d.interpolatePadding(_,S,g),I=d.centerPoint.add(P)),R.easeFunc(g,L,F,I),this.terrain&&!e.freezeElevation&&this._updateElevation(g),this._applyUpdatedTransform(d),this._fireMoveEvents(l)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(l)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,l){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,l)}return e||null===(c=this.handlers)||void 0===c||c.stop(!1),this}_ease(e,l,c){!1===c.animate||0===c.duration?(e(1),l()):(this._easeStart=b(),this._easeOptions=c,this._onEaseFrame=e,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,l){e=c.W(e,-180,180);const d=Math.abs(e-l);return Math.abs(e-360-l)<d&&(e-=360),Math.abs(e+360-l)<d&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLat(c.V.convert(e),this.transform):null}}const Qo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Yr{constructor(e=Qo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=e=>{!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType&&"terrain"!==e.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=h.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=h.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=h.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){h.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,l){const c=this._map._getUIString(`AttributionControl.${l}`);e.title=c,e.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((e=>"string"!=typeof e?"":e))):"string"==typeof this.options.customAttribution&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const l=this._map.style.tileManagers;for(const c in l){const d=l[c];if(d.used||d.usedForTerrain){const l=d.getSource();l.attribution&&e.indexOf(l.attribution)<0&&e.push(l.attribution)}}e=e.filter((e=>String(e).trim())),e.sort(((e,l)=>e.length-l.length)),e=e.filter(((l,c)=>{for(let d=c+1;d<e.length;d++)if(e[d].indexOf(l)>=0)return!1;return!0}));const c=e.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,e.length?(this._innerContainer.innerHTML=h.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Qr{constructor(e={}){this._updateCompact=()=>{const e=this._container.children;if(e.length){const l=e[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=h.create("div","maplibregl-ctrl");const l=h.create("a","maplibregl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://maplibre.org/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){h.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Jr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const l=++this._id;return this._queue.push({callback:e,id:l,cancelled:!1}),l}remove(e){const l=this._currentlyRunning,c=l?this._queue.concat(l):this._queue;for(const l of c)if(l.id===e)return void(l.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const l=this._currentlyRunning=this._queue;this._queue=[];for(const c of l)if(!c.cancelled&&(c.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Jo=c.aU([{name:"a_pos3d",type:"Int16",components:3}]);class ts extends c.E{constructor(e){super(),this._lastTilesetChange=b(),this.tileManager=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(e,l){this.tileManager.update(e,l),this._renderableTilesKeys=[];const d={};for(const p of it(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:l,calculateTileZoom:this.tileManager._source.calculateTileZoom}))d[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.terrainRttPosMatrix32f=new Float64Array(16),c.c7(p.terrainRttPosMatrix32f,0,c.a5,c.a5,0,0,1),this._tiles[p.key]=new de(p,this.tileSize),this._lastTilesetChange=b());for(const e in this._tiles)d[e]||delete this._tiles[e]}freeRtt(e){for(const l in this._tiles){const c=this._tiles[l];(!e||c.tileID.equals(e)||c.tileID.isChildOf(e)||e.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,l){return l?this._getTerrainCoordsForTileRanges(e,l):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const l={};for(const d of this._renderableTilesKeys){const p=this._tiles[d].tileID,f=e.clone(),m=c.bk();if(p.canonical.equals(e.canonical))c.c7(m,0,c.a5,c.a5,0,0,1);else if(p.canonical.isChildOf(e.canonical)){const l=p.canonical.z-e.canonical.z,d=p.canonical.x-(p.canonical.x>>l<<l),f=p.canonical.y-(p.canonical.y>>l<<l),_=c.a5>>l;c.c7(m,0,_,_,0,0,1),c.O(m,m,[-d*_,-f*_,0])}else{if(!e.canonical.isChildOf(p.canonical))continue;{const l=e.canonical.z-p.canonical.z,d=e.canonical.x-(e.canonical.x>>l<<l),f=e.canonical.y-(e.canonical.y>>l<<l),_=c.a5>>l;c.c7(m,0,c.a5,c.a5,0,0,1),c.O(m,m,[d*_,f*_,0]),c.Q(m,m,[1/2**l,1/2**l,0])}}f.terrainRttPosMatrix32f=new Float32Array(m),l[d]=f}return l}_getTerrainCoordsForTileRanges(e,l){const d={};for(const p of this._renderableTilesKeys){const f=this._tiles[p].tileID;if(!this._isWithinTileRanges(f,l))continue;const m=e.clone(),_=c.bk();if(f.canonical.z===e.canonical.z){const l=e.canonical.x-f.canonical.x+e.wrap*(1<<e.canonical.z),d=e.canonical.y-f.canonical.y;c.c7(_,0,c.a5,c.a5,0,0,1),c.O(_,_,[l*c.a5,d*c.a5,0])}else if(f.canonical.z>e.canonical.z){const l=f.canonical.z-e.canonical.z,d=f.canonical.x-(f.canonical.x>>l<<l)+e.wrap*(1<<f.canonical.z),p=f.canonical.y-(f.canonical.y>>l<<l),m=e.canonical.x-(f.canonical.x>>l),g=e.canonical.y-(f.canonical.y>>l),y=c.a5>>l;c.c7(_,0,y,y,0,0,1),c.O(_,_,[-d*y+m*c.a5,-p*y+g*c.a5,0])}else{const l=e.canonical.z-f.canonical.z,d=e.canonical.x-(e.canonical.x>>l<<l)+e.wrap*(1<<e.canonical.z),p=e.canonical.y-(e.canonical.y>>l<<l),m=(e.canonical.x>>l)-f.canonical.x,g=(e.canonical.y>>l)-f.canonical.y,y=c.a5<<l;c.c7(_,0,y,y,0,0,1),c.O(_,_,[d*c.a5+m*y,p*c.a5+g*y,0])}m.terrainRttPosMatrix32f=new Float32Array(_),d[p]=m}return d}getSourceTile(e,l){const c=this.tileManager._source;let d=e.overscaledZ-this.deltaZoom;if(d>c.maxzoom&&(d=c.maxzoom),d<c.minzoom)return;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let p=this.findTileInCaches(this._sourceTileCache[e.key]);if(!(null==p?void 0:p.dem)&&l)for(;d>=c.minzoom&&!(null==p?void 0:p.dem);)p=this.findTileInCaches(e.scaledTo(d--).key);return p}findTileInCaches(e){let l=this.tileManager.getTileByID(e);return l||(l=this.tileManager._outOfViewCache.getByKey(e),l)}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,l){const c=l[e.canonical.z];return!!c&&(e.wrap>c.minWrap||e.wrap<c.maxWrap||e.canonical.x>=c.minTileXWrapped&&e.canonical.x<=c.maxTileXWrapped&&e.canonical.y>=c.minTileY&&e.canonical.y<=c.maxTileY)}}class is{constructor(e,l,c){this._meshCache={},this.painter=e,this.tileManager=new ts(l),this.options=c,this.exaggeration="number"==typeof c.exaggeration?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,l,d,p=c.a5){var f;if(!(l>=0&&l<p&&d>=0&&d<p))return 0;const m=this.getTerrainData(e),_=null===(f=m.tile)||void 0===f?void 0:f.dem;if(!_)return 0;const g=c.cD([],[l/p*c.a5,d/p*c.a5],m.u_terrain_matrix),y=[g[0]*_.dim,g[1]*_.dim],b=Math.floor(y[0]),T=Math.floor(y[1]),S=y[0]-b,P=y[1]-T;return _.get(b,T)*(1-S)*(1-P)+_.get(b+1,T)*S*(1-P)+_.get(b,T+1)*(1-S)*P+_.get(b+1,T+1)*S*P}getElevationForLngLatZoom(e,l){if(!c.cE(l,e.wrap()))return 0;const{tileID:d,mercatorX:p,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(e,l);return this.getElevation(d,p%c.a5,f%c.a5,c.a5)}getElevationForLngLat(e,l){const c=it(l,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let d=0;for(const e of c)e.canonical.z>d&&(d=Math.min(e.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(e,d)}getElevation(e,l,d,p=c.a5){return this.getDEMElevation(e,l,d,p)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const e=this.painter.context,l=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(e,l,e.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(e,new c.R({width:1,height:1}),e.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ar([])}const l=this.tileManager.getSourceTile(e,!0);if(l&&l.dem&&(!l.demTexture||l.needsTerrainPrepare)){const e=this.painter.context;l.demTexture=this.painter.getTileTexture(l.dem.stride),l.demTexture?l.demTexture.update(l.dem.getPixels(),{premultiply:!1}):l.demTexture=new c.T(e,l.dem.getPixels(),e.gl.RGBA,{premultiply:!1}),l.demTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),l.needsTerrainPrepare=!1}const d=l&&l.toString()+l.tileID.key+e.key;if(d&&!this._demMatrixCache[d]){const d=this.tileManager.getSource().maxzoom;let p=e.canonical.z-l.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?p=e.canonical.z-d:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const f=e.canonical.x-(e.canonical.x>>p<<p),m=e.canonical.y-(e.canonical.y>>p<<p),_=c.cF(new Float64Array(16),[1/(c.a5<<p),1/(c.a5<<p),0]);c.O(_,_,[f*c.a5,m*c.a5,0]),this._demMatrixCache[e.key]={matrix:_,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:l&&l.dem&&l.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:l&&l.dem&&l.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(l&&l.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:l}}getFramebuffer(e){const l=this.painter,d=l.width/devicePixelRatio,p=l.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(l.context,{width:d,height:p,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(l.context,{width:d,height:p,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=l.context.createFramebuffer(d,p,!0,!1),this._fbo.depthAttachment.set(l.context.createRenderbuffer(l.context.gl.DEPTH_COMPONENT16,d,p))),this._fbo.colorAttachment.set("coords"===e?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const l=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let e=0,c=0;e<this._coordsTextureSize;e++)for(let d=0;d<this._coordsTextureSize;d++,c+=4)l[c+0]=255&d,l[c+1]=255&e,l[c+2]=d>>8<<4|e>>8,l[c+3]=0;const d=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(l.buffer)),p=new c.T(e,d,e.gl.RGBA,{premultiply:!1});return p.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const l=new Uint8Array(4),d=this.painter.context,p=d.gl,f=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),m=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),_=Math.round(this.painter.height/devicePixelRatio);d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(f,_-m-1,1,1,p.RGBA,p.UNSIGNED_BYTE,l),d.bindFramebuffer.set(null);const g=l[0]+(l[2]>>4<<8),y=l[1]+((15&l[2])<<8),b=this.coordsIndex[255-l[3]],T=b&&this.tileManager.getTileByID(b);if(!T)return null;const S=this._coordsTextureSize,P=(1<<T.tileID.canonical.z)*S;return new c.a9((T.tileID.canonical.x*S+g)/P+T.tileID.wrap,(T.tileID.canonical.y*S+y)/P,this.getElevation(T.tileID,g,y,S))}depthAtPoint(e){const l=new Uint8Array(4),c=this.painter.context,d=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,l),c.bindFramebuffer.set(null),(l[0]/16777216+l[1]/65536+l[2]/256+l[3])/256}getTerrainMesh(e){var l;const d=(null===(l=this.painter.style.projection)||void 0===l?void 0:l.transitionState)>0,p=d&&0===e.canonical.y,f=d&&e.canonical.y===(1<<e.canonical.z)-1,m=`m_${p?"n":""}_${f?"s":""}`;if(this._meshCache[m])return this._meshCache[m];const _=this.painter.context,g=new c.cG,y=new c.aY,b=this.meshSize,T=c.a5/b,S=b*b;for(let e=0;e<=b;e++)for(let l=0;l<=b;l++)g.emplaceBack(l*T,e*T,0);for(let e=0;e<S;e+=b+1)for(let l=0;l<b;l++)y.emplaceBack(l+e,b+l+e+1,b+l+e+2),y.emplaceBack(l+e,b+l+e+2,l+e+1);const P=g.length,I=P+(b+1),C=(b+1)*b,R=p?c.br:0,L=p?0:1,F=f?c.bs:c.a5,B=f?0:1;for(let e=0;e<=b;e++)g.emplaceBack(e*T,R,L);for(let e=0;e<=b;e++)g.emplaceBack(e*T,F,B);for(let e=0;e<b;e++)y.emplaceBack(C+e,I+e,I+e+1),y.emplaceBack(C+e,I+e+1,C+e+1),y.emplaceBack(0+e,P+e+1,P+e),y.emplaceBack(0+e,0+e+1,P+e+1);const O=g.length,V=O+2*(b+1);for(const e of[0,1])for(let l=0;l<=b;l++)for(const d of[0,1])g.emplaceBack(e*c.a5,l*T,d);for(let e=0;e<2*b;e+=2)y.emplaceBack(O+e,O+e+1,O+e+3),y.emplaceBack(O+e,O+e+3,O+e+2),y.emplaceBack(V+e,V+e+3,V+e+1),y.emplaceBack(V+e,V+e+2,V+e+3);const j=new kt(_.createVertexBuffer(g,Jo.members),_.createIndexBuffer(y),c.aX.simpleSegment(0,0,g.length,y.length));return this._meshCache[m]=j,j}getMeshFrameDelta(e){return 2*Math.PI*c.bE/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,l){var d;if(!c.cE(l,e.wrap()))return 0;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(e,l);return null!==(d=this.getMinMaxElevation(p).minElevation)&&void 0!==d?d:0}getMinMaxElevation(e){const l=this.getTerrainData(e).tile,c={minElevation:null,maxElevation:null};return l&&l.dem&&(c.minElevation=l.dem.min*this.exaggeration,c.maxElevation=l.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(e,l){const d=c.a9.fromLngLat(e.wrap()),p=(1<<l)*c.a5,f=d.x*p,m=d.y*p,_=Math.floor(f/c.a5),g=Math.floor(m/c.a5);return{tileID:new c.a2(l,0,l,_,g),mercatorX:f,mercatorY:m}}}class as{constructor(e,l,c){this._context=e,this._size=l,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const l=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),l.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),l.colorAttachment.set(d.texture),{id:e,fbo:l,texture:d,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((l=>e.id!==l)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const e of this._recentlyUsed)if(!this._objects[e].inUse)return this._objects[e];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some((e=>!e.inUse))}}const ta={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class rs{constructor(e,l){this.painter=e,this.terrain=l,this.pool=new as(e.context,30,l.tileManager.tileSize*l.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,l){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=e._order.filter((c=>!e._layers[c].isHidden(l))),this._coordsAscending={};for(const l in e.tileManagers){this._coordsAscending[l]={};const c=e.tileManagers[l].getVisibleCoordinates(),d=e.tileManagers[l].getSource(),p=d instanceof te?d.terrainTileRanges:null;for(const e of c){const c=this.terrain.tileManager.getTerrainCoords(e,p);for(const e in c)this._coordsAscending[l][e]||(this._coordsAscending[l][e]=[]),this._coordsAscending[l][e].push(c[e])}}this._coordsAscendingStr={};for(const l of e._order){const c=e._layers[l],d=c.source;if(ta[c.type]&&!this._coordsAscendingStr[d]){this._coordsAscendingStr[d]={};for(const e in this._coordsAscending[d])this._coordsAscendingStr[d][e]=this._coordsAscending[d][e].map((e=>e.key)).sort().join()}}for(const e of this._renderableTiles)for(const l in this._coordsAscendingStr){const c=this._coordsAscendingStr[l][e.tileID.key];c&&c!==e.rttCoords[l]&&(e.rtt=[])}}renderLayer(e,l){if(e.isHidden(this.painter.transform.zoom))return!1;const d=Object.assign(Object.assign({},l),{isRenderingToTexture:!0}),p=e.type,f=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(ta[p]&&(this._prevType&&ta[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(e.id),!m))return!0;if(ta[this._prevType]||ta[p]&&m){this._prevType=p;const e=this._stacks.length-1,l=this._stacks[e]||[];for(const p of this._renderableTiles){if(this.pool.isFull()&&(lo(this.painter,this.terrain,this._rttTiles,d),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(p),p.rtt[e]){const l=this.pool.getObjectForId(p.rtt[e].id);if(l.stamp===p.rtt[e].stamp){this.pool.useObject(l);continue}}const m=this.pool.getOrCreateFreeObject();this.pool.useObject(m),this.pool.stampObject(m),p.rtt[e]={id:m.id,stamp:m.stamp},f.context.bindFramebuffer.set(m.fbo.framebuffer),f.context.clear({color:c.bp.transparent,stencil:0}),f.currentStencilSource=void 0;for(let e=0;e<l.length;e++){const c=f.style._layers[l[e]],_=c.source?this._coordsAscending[c.source][p.tileID.key]:[p.tileID];f.context.viewport.set([0,0,m.fbo.width,m.fbo.height]),f._renderTileClippingMasks(c,_,!0),f.renderLayer(f,f.style.tileManagers[c.source],c,_,d),c.source&&(p.rttCoords[c.source]=this._coordsAscendingStr[c.source][p.tileID.key])}}return lo(this.painter,this.terrain,this._rttTiles,d),this._rttTiles=[],this.pool.freeAllObjects(),ta[p]}return!1}}const ia={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},na=d,el={hash:!1,interactive:!0,bearingSnap:7,zoomSnap:0,attributionControl:Qo,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},tl={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class hs{constructor(e,l,d=!1){this.mousedown=e=>{this.startMove(e,h.mousePos(this.element,e)),h.addEventListener(window,"mousemove",this.mousemove),h.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=e=>{this.move(e,h.mousePos(this.element,e))},this.mouseup=e=>{this._rotatePitchHandler.dragEnd(e),this.offTemp()},this.touchstart=e=>{1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=h.touchPos(this.element,e.targetTouches)[0],this.startMove(e,this._startPos),h.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),h.addEventListener(window,"touchend",this.touchend))},this.touchmove=e=>{1!==e.targetTouches.length?this.reset():(this._lastPos=h.touchPos(this.element,e.targetTouches)[0],this.move(e,this._lastPos))},this.touchend=e=>{0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=l;const p=new yr;this._rotatePitchHandler=new mr({clickTolerance:3,move:(e,p)=>{const f=l.getBoundingClientRect(),m=new c.P((f.bottom-f.top)/2,(f.right-f.left)/2);return{bearingDelta:c.cy(new c.P(e.x,p.y),p,m),pitchDelta:d?-.5*(p.y-e.y):void 0}},moveStateManager:p,enable:!0,assignEvents:()=>{}}),this.map=e,h.addEventListener(l,"mousedown",this.mousedown),h.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),h.addEventListener(l,"touchcancel",this.reset)}startMove(e,l){this._rotatePitchHandler.dragStart(e,l),h.disableDrag()}move(e,l){const c=this.map,{bearingDelta:d,pitchDelta:p}=this._rotatePitchHandler.dragMove(e,l)||{};d&&c.setBearing(c.getBearing()+d),p&&c.setPitch(c.getPitch()+p)}off(){const e=this.element;h.removeEventListener(e,"mousedown",this.mousedown),h.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),h.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),h.removeEventListener(window,"touchend",this.touchend),h.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){h.enableDrag(),h.removeEventListener(window,"mousemove",this.mousemove),h.removeEventListener(window,"mouseup",this.mouseup),h.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),h.removeEventListener(window,"touchend",this.touchend)}}let il;function rl(e,l,d,p=!1){if(p||!d.getCoveringTilesDetailsProvider().allowWorldCopies())return null==e?void 0:e.wrap();const f=new c.V(e.lng,e.lat);if(e=new c.V(e.lng,e.lat),l){const p=new c.V(e.lng-360,e.lat),f=new c.V(e.lng+360,e.lat),m=d.locationToScreenPoint(e).distSqr(l);d.locationToScreenPoint(p).distSqr(l)<m?e=p:d.locationToScreenPoint(f).distSqr(l)<m&&(e=f)}for(;Math.abs(e.lng-d.center.lng)>180;){const l=d.locationToScreenPoint(e);if(l.x>=0&&l.y>=0&&l.x<=d.width&&l.y<=d.height)break;e.lng>d.center.lng?e.lng-=360:e.lng+=360}return e.lng!==f.lng&&d.isPointOnMapSurface(d.locationToScreenPoint(e))?e:f}const nl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function sl(e,l,c){const d=e.classList;for(const e in nl)d.remove(`maplibregl-${c}-anchor-${e}`);d.add(`maplibregl-${c}-anchor-${l}`)}class ms extends c.E{constructor(e){if(super(),this._onKeyPress=e=>{const l=e.code,c=e.charCode||e.keyCode;"Space"!==l&&"Enter"!==l&&32!==c&&13!==c||this.togglePopup()},this._onMapClick=e=>{const l=e.originalEvent.target,c=this._element;this._popup&&(l===c||c.contains(l))&&this.togglePopup()},this._update=e=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==e?void 0:e.type)||"render"===(null==e?void 0:e.type)&&!l)&&this._map.once("render",this._update),this._lngLat=rl(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let c="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?c=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let d="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?d="rotateX(0deg)":"map"===this._pitchAlignment&&(d=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||e&&"moveend"!==e.type||(this._pos=this._pos.round()),h.setTransform(this._element,`${nl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${d} ${c}`),g.frameAsync(new AbortController,this._map._ownerWindow).then((()=>{this._updateOpacity(e&&"moveend"===e.type)})).catch((()=>{}))},this._onMove=e=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=e=>{this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,this.setOpacity(null==e?void 0:e.opacity,null==e?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=h.create("div");const l=h.createNS("http://www.w3.org/2000/svg","svg"),d=41,p=27;l.setAttributeNS(null,"display","block"),l.setAttributeNS(null,"height",`${d}px`),l.setAttributeNS(null,"width",`${p}px`),l.setAttributeNS(null,"viewBox",`0 0 ${p} ${d}`);const f=h.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const m=h.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"fill-rule","nonzero");const _=h.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(3.0, 29.0)"),_.setAttributeNS(null,"fill","#000000");const g=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const e of g){const l=h.createNS("http://www.w3.org/2000/svg","ellipse");l.setAttributeNS(null,"opacity","0.04"),l.setAttributeNS(null,"cx","10.5"),l.setAttributeNS(null,"cy","5.80029008"),l.setAttributeNS(null,"rx",e.rx),l.setAttributeNS(null,"ry",e.ry),_.appendChild(l)}const y=h.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill",this._color);const b=h.createNS("http://www.w3.org/2000/svg","path");b.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),y.appendChild(b);const T=h.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"opacity","0.25"),T.setAttributeNS(null,"fill","#000000");const S=h.createNS("http://www.w3.org/2000/svg","path");S.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),T.appendChild(S);const P=h.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(6.0, 7.0)"),P.setAttributeNS(null,"fill","#FFFFFF");const I=h.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(8.0, 8.0)");const C=h.createNS("http://www.w3.org/2000/svg","circle");C.setAttributeNS(null,"fill","#000000"),C.setAttributeNS(null,"opacity","0.25"),C.setAttributeNS(null,"cx","5.5"),C.setAttributeNS(null,"cy","5.5"),C.setAttributeNS(null,"r","5.4999962");const R=h.createNS("http://www.w3.org/2000/svg","circle");R.setAttributeNS(null,"fill","#FFFFFF"),R.setAttributeNS(null,"cx","5.5"),R.setAttributeNS(null,"cy","5.5"),R.setAttributeNS(null,"r","5.4999962"),I.appendChild(C),I.appendChild(R),m.appendChild(_),m.appendChild(y),m.appendChild(T),m.appendChild(P),m.appendChild(I),l.appendChild(m),l.setAttributeNS(null,"height",d*this._scale+"px"),l.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(l),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()})),sl(this._element,this._anchor,"marker"),e&&e.className)for(const l of e.className.split(" "))this._element.classList.add(l);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),h.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.V.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const l=38.1,c=13.5,d=Math.abs(c)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-l],"bottom-left":[d,-1*(l-c+d)],"bottom-right":[-d,-1*(l-c+d)],left:[c,-1*(l-c)],right:[-c,-1*(l-c)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var l,d;const p=null===(l=this._map)||void 0===l?void 0:l.terrain,f=this._map.transform.isLocationOccluded(this._lngLat);if(!p||f){const e=f?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==e&&(this._element.style.opacity=e))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const m=this._map,_=m.terrain.depthAtPoint(this._pos),g=m.terrain.getElevationForLngLat(this._lngLat,m.transform);if(m.transform.lngLatToCameraDepth(this._lngLat,g)-_<.006)return void(this._element.style.opacity=this._opacity);const y=-this._offset.y/m.transform.pixelsPerMeter,b=Math.sin(m.getPitch()*Math.PI/180)*y,T=m.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),S=m.transform.lngLatToCameraDepth(this._lngLat,g+b)-T>.006;(null===(d=this._popup)||void 0===d?void 0:d.isOpen())&&S&&this._popup.remove(),this._element.style.opacity=S?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,l){return(void 0===this._opacity||void 0===e&&void 0===l)&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==e&&(this._opacity=e),void 0!==l&&(this._opacityWhenCovered=l),this._map&&this._updateOpacity(!0),this}}const ol={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let al=0,ll=!1;const cl={maxWidth:100,unit:"metric"};function hl(e,l,c){const d=c&&c.maxWidth||100,p=e._container.clientHeight/2,f=e._container.clientWidth/2,m=e.unproject([f-d/2,p]),_=e.unproject([f+d/2,p]),g=Math.round(e.project(_).x-e.project(m).x),y=Math.min(d,g,e._container.clientWidth),b=m.distanceTo(_);if(c&&"imperial"===c.unit){const c=3.2808*b;c>5280?ul(l,y,c/5280,e._getUIString("ScaleControl.Miles")):ul(l,y,c,e._getUIString("ScaleControl.Feet"))}else c&&"nautical"===c.unit?ul(l,y,b/1852,e._getUIString("ScaleControl.NauticalMiles")):b>=1e3?ul(l,y,b/1e3,e._getUIString("ScaleControl.Kilometers")):ul(l,y,b,e._getUIString("ScaleControl.Meters"))}function ul(e,l,c,d){const p=function(e){const l=Math.pow(10,`${Math.floor(e)}`.length-1);let c=e/l;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:c>=1?1:function(e){const l=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*l)/l}(c),l*c}(c);e.style.width=l*(p/c)+"px",e.innerHTML=`${p}&nbsp;${d}`}const dl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},pl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function fl(e){if(e){if("number"==typeof e){const l=Math.round(Math.abs(e)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,e),"top-left":new c.P(l,l),"top-right":new c.P(-l,l),bottom:new c.P(0,-e),"bottom-left":new c.P(l,-l),"bottom-right":new c.P(-l,-l),left:new c.P(e,0),right:new c.P(-e,0)}}if(e instanceof c.P||Array.isArray(e)){const l=c.P.convert(e);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:c.P.convert(e.center||[0,0]),top:c.P.convert(e.top||[0,0]),"top-left":c.P.convert(e["top-left"]||[0,0]),"top-right":c.P.convert(e["top-right"]||[0,0]),bottom:c.P.convert(e.bottom||[0,0]),"bottom-left":c.P.convert(e["bottom-left"]||[0,0]),"bottom-right":c.P.convert(e["bottom-right"]||[0,0]),left:c.P.convert(e.left||[0,0]),right:c.P.convert(e.right||[0,0])}}return fl(new c.P(0,0))}const gl=d;l.AJAXError=c.cJ,l.Event=c.l,l.Evented=c.E,l.LngLat=c.V,l.MercatorCoordinate=c.a9,l.Point=c.P,l.addProtocol=c.cK,l.config=c.c,l.removeProtocol=c.cL,l.AttributionControl=Yr,l.BoxZoomHandler=hr,l.CanvasSource=ae,l.CooperativeGesturesHandler=Vr,l.DoubleClickZoomHandler=Or,l.DragPanHandler=Zr,l.DragRotateHandler=Ur,l.EdgeInsets=Nt,l.FullscreenControl=class extends c.E{constructor(e={}){super(),this._onFullscreenChange=()=>{var e;let l=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(e=null==l?void 0:l.shadowRoot)||void 0===e?void 0:e.fullscreenElement;)l=l.shadowRoot.fullscreenElement;l===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=h.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){h.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const e=this._fullscreenButton=h.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);h.create("span","maplibregl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},l.GeoJSONSource=ee,l.GeolocateControl=class extends c.E{constructor(e){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const l=new c.V(e.coords.longitude,e.coords.latitude),d=e.coords.accuracy,p=this._map.getBearing(),f=c.e({bearing:p},this.options.fitBoundsOptions),m=$.fromLngLat(l,d);this._map.fitBounds(m,f,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const l=new c.V(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&ll)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=h.create("button","maplibregl-ctrl-geolocate",this._container),h.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(!1===e){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=h.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ms({element:this._dotElement}),this._circleElement=h.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ms({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{const l=(null==e?void 0:e[0])instanceof ResizeObserverEntry;e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))}))}},this.options=c.e({},ol,e)}onAdd(e){return this._map=e,this._container=h.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,(function*(e=!1){if(void 0!==il&&!e)return il;if(void 0===window.navigator.permissions)return il=!!window.navigator.geolocation,il;try{const e=yield window.navigator.permissions.query({name:"geolocation"});il="denied"!==e.state}catch(e){il=!!window.navigator.geolocation}return il}))}().then((e=>this._finishSetupUI(e))),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),h.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,al=0,ll=!1}_isOutOfMapMaxBounds(e){const l=this._map.getMaxBounds(),c=e.coords;return l&&(c.longitude<l.getWest()||c.longitude>l.getEast()||c.latitude<l.getSouth()||c.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const e=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&e))return;const l=this._map.project(e),c=this._map.unproject([l.x+100,l.y]),d=e.distanceTo(c)/100,p=2*this._accuracy/d;this._circleElement.style.width=`${p.toFixed(2)}px`,this._circleElement.style.height=`${p.toFixed(2)}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":al--,ll=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),al++,al>1?(e={maximumAge:6e5,timeout:0},ll=!0):(e=this.options.positionOptions,ll=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},l.GlobeControl=class{constructor(){this._toggleProjection=()=>{var e;const l=null===(e=this._map.getProjection())||void 0===e?void 0:e.type;this._map.setProjection("mercator"!==l&&l?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var e;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),"globe"===(null===(e=this._map.getProjection())||void 0===e?void 0:e.type)?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(e){return this._map=e,this._container=h.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=h.create("button","maplibregl-ctrl-globe",this._container),h.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){h.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},l.Hash=Ho,l.ImageSource=te,l.KeyboardHandler=Ar,l.LngLatBounds=$,l.LogoControl=Qr,l.Map=class extends Xr{get _ownerWindow(){var e,l;return(null===(l=null===(e=this._container)||void 0===e?void 0:e.ownerDocument)||void 0===l?void 0:l.defaultView)||window}constructor(e){var l,d;c.cH.mark(c.cI.create);const p=Object.assign(Object.assign(Object.assign({},el),e),{canvasContextAttributes:Object.assign(Object.assign({},el.canvasContextAttributes),e.canvasContextAttributes)});if(null!=p.minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const f=new $t,m=new Yt;void 0!==p.minZoom&&f.setMinZoom(p.minZoom),void 0!==p.maxZoom&&f.setMaxZoom(p.maxZoom),void 0!==p.minPitch&&f.setMinPitch(p.minPitch),void 0!==p.maxPitch&&f.setMaxPitch(p.maxPitch),void 0!==p.renderWorldCopies&&f.setRenderWorldCopies(p.renderWorldCopies),null!==p.transformConstrain&&f.setConstrainOverride(p.transformConstrain),super(f,m,{bearingSnap:p.bearingSnap,zoomSnap:p.zoomSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Jr,this._controls=[],this._mapId=c.af(),this._lostContextStyle={style:null,images:null},this._contextLost=e=>{e.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const e of Object.values(this.style._layers))if("custom"===e.type&&console.warn(`Custom layer with id '${e.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),e._listeners)for(const[l]of Object.entries(e._listeners))console.warn(`Custom layer with id '${e.id}' had event listeners for event '${l}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new c.l("webglcontextlost",{originalEvent:e}))},this._contextRestored=e=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new c.l("webglcontextrestored",{originalEvent:e}))},this._onMapScroll=e=>{if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},p.canvasContextAttributes),this._trackResize=!0===p.trackResize,this._bearingSnap=p.bearingSnap,this._zoomSnap=p.zoomSnap,this._centerClampedToGround=p.centerClampedToGround,this._refreshExpiredTiles=!0===p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=!0===p.crossSourceCollisions,this._collectResourceTiming=!0===p.collectResourceTiming,this._locale=Object.assign(Object.assign({},ia),p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this._zoomLevelsToOverscale=p.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=p.transformCameraUpdate,this.transformConstrain=p.transformConstrain,this.cancelPendingTileRequestsWhileZooming=!0===p.cancelPendingTileRequestsWhileZooming,void 0!==p.reduceMotion&&(g.prefersReducedMotion=p.reduceMotion),this._imageQueueHandle=L.addThrottleControl((()=>this.isMoving())),this._requestManager=new v(p.transformRequest),this._container=this._resolveContainer(p.container),p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),"undefined"!=typeof window&&(this._ownerWindow.addEventListener("online",this._onWindowOnline,!1),this._setupResizeObserver()),this.handlers=new Hr(this,p),this._hash=p.hash&&new Ho("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,elevation:p.elevation,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,roll:p.roll}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,c.e({},p.fitBoundsOptions,{duration:0}))));const _="string"==typeof p.style||!("globe"===(null===(d=null===(l=p.style)||void 0===l?void 0:l.projection)||void 0===d?void 0:d.type));this.resize(null,_),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new Yr("boolean"==typeof p.attributionControl?void 0:p.attributionControl)),p.maplibreLogo&&this.addControl(new Qr,p.logoPosition),this.on("style.load",(()=>{if(_||this._resizeTransform(),this.transform.unmodified){const e=c.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(e)}})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new c.l(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new c.l(`${e.dataType}dataloading`,e))})),this.on("dataabort",(e=>{this.fire(new c.l("sourcedataabort",e))}))}_getMapId(){return this._mapId}setGlobalStateProperty(e,l){return this.style.setGlobalStateProperty(e,l),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(e,l){if(void 0===l&&(l=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=e.onAdd(this);this._controls.push(e);const p=this._controlPositions[l];return-1!==l.indexOf("bottom")?p.insertBefore(d,p.firstChild):p.appendChild(d),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(e);return l>-1&&this._controls.splice(l,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}coveringTiles(e){return it(this.transform,e)}calculateCameraOptionsFromTo(e,l,c,d){return null==d&&this.terrain&&(d=this.terrain.getElevationForLngLat(c,this.transform)),super.calculateCameraOptionsFromTo(e,l,c,d)}resize(e,l=!0){if(null!==this._lostContextStyle.style)return this;this._resizeInternal(l);const d=!this._moving;return d&&(this.stop(),this.fire(new c.l("movestart",e)).fire(new c.l("move",e))),this.fire(new c.l("resize",e)),d&&this.fire(new c.l("moveend",e)),this}_resizeInternal(e=!0){const[l,c]=this._containerDimensions(),d=this._getClampedPixelRatio(l,c);if(this._resizeCanvas(l,c,d),this.painter.resize(l,c,d),this.painter.overLimit()){const e=this.painter.context.gl;this._maxCanvasSize=[e.drawingBufferWidth,e.drawingBufferHeight];const d=this._getClampedPixelRatio(l,c);this._resizeCanvas(l,c,d),this.painter.resize(l,c,d)}this._resizeTransform(e)}_resizeTransform(e=!0){var l;const[c,d]=this._containerDimensions();this.transform.resize(c,d,e),null===(l=this._requestedCameraState)||void 0===l||l.resize(c,d,e)}_getClampedPixelRatio(e,l){const{0:c,1:d}=this._maxCanvasSize,p=this.getPixelRatio(),f=e*p,m=l*p;return Math.min(f>c?c/f:1,m>d?d/m:1)*p}getPixelRatio(){var e;return null!==(e=this._overridePixelRatio)&&void 0!==e?e:devicePixelRatio}setPixelRatio(e){this._overridePixelRatio=e,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(e){return this.transform.setMaxBounds($.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom){const l=this.transform.zoom,d=this._getTransformForUpdate();return d.setMinZoom(e),this._applyUpdatedTransform(d),this._update(),l!==this.transform.zoom&&this.fire(new c.l("zoomstart")).fire(new c.l("zoom")).fire(new c.l("zoomend")).fire(new c.l("movestart")).fire(new c.l("move")).fire(new c.l("moveend")),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom){const l=this.transform.zoom,d=this._getTransformForUpdate();return d.setMaxZoom(e),this._applyUpdatedTransform(d),this._update(),l!==this.transform.zoom&&this.fire(new c.l("zoomstart")).fire(new c.l("zoom")).fire(new c.l("zoomend")).fire(new c.l("movestart")).fire(new c.l("move")).fire(new c.l("moveend")),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch){const l=this.transform.pitch,d=this._getTransformForUpdate();return d.setMinPitch(e),this._applyUpdatedTransform(d),this._update(),l!==this.transform.pitch&&this.fire(new c.l("pitchstart")).fire(new c.l("pitch")).fire(new c.l("pitchend")).fire(new c.l("movestart")).fire(new c.l("move")).fire(new c.l("moveend")),this}throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?60:e)>180)throw new Error("maxPitch must be less than or equal to 180");if(e>=this.transform.minPitch){const l=this.transform.pitch,d=this._getTransformForUpdate();return d.setMaxPitch(e),this._applyUpdatedTransform(d),this._update(),l!==this.transform.pitch&&this.fire(new c.l("pitchstart")).fire(new c.l("pitch")).fire(new c.l("pitchend")).fire(new c.l("movestart")).fire(new c.l("move")).fire(new c.l("moveend")),this}throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.setRenderWorldCopies(e),this._update()}setTransformConstrain(e){return this.transform.setConstrainOverride(e),this._update()}project(e){return this.transform.locationToScreenPoint(c.V.convert(e),this.style&&this.terrain)}unproject(e){return this.transform.screenPointToLocation(c.P.convert(e),this.terrain)}isMoving(){var e;return this._moving||(null===(e=this.handlers)||void 0===e?void 0:e.isMoving())}isZooming(){var e;return this._zooming||(null===(e=this.handlers)||void 0===e?void 0:e.isZooming())}isRotating(){var e;return this._rotating||(null===(e=this.handlers)||void 0===e?void 0:e.isRotating())}_createDelegatedListener(e,l,c){if("mouseenter"===e||"mouseover"===e){let d=!1;const p=p=>{const f=l.filter((e=>this.getLayer(e))),m=0!==f.length?this.queryRenderedFeatures(p.point,{layers:f}):[];m.length?d||(d=!0,c.call(this,new or(e,this,p.originalEvent,{features:m}))):d=!1};return{layers:l,listener:c,delegates:{mousemove:p,mouseout:()=>{d=!1}}}}if("mouseleave"===e||"mouseout"===e){let d=!1;const p=p=>{const f=l.filter((e=>this.getLayer(e)));(0!==f.length?this.queryRenderedFeatures(p.point,{layers:f}):[]).length?d=!0:d&&(d=!1,c.call(this,new or(e,this,p.originalEvent)))},f=l=>{d&&(d=!1,c.call(this,new or(e,this,l.originalEvent)))};return{layers:l,listener:c,delegates:{mousemove:p,mouseout:f}}}{const d=e=>{const d=l.filter((e=>this.getLayer(e))),p=0!==d.length?this.queryRenderedFeatures(e.point,{layers:d}):[];p.length&&(e.features=p,c.call(this,e),delete e.features)};return{layers:l,listener:c,delegates:{[e]:d}}}}_saveDelegatedListener(e,l){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(l)}_removeDelegatedListener(e,l,c){if(!this._delegatedListeners||!this._delegatedListeners[e])return;const d=this._delegatedListeners[e];for(let e=0;e<d.length;e++){const p=d[e];if(p.listener===c&&p.layers.length===l.length&&p.layers.every((e=>l.includes(e)))){for(const e in p.delegates)this.off(e,p.delegates[e]);return void d.splice(e,1)}}}on(e,l,c){if(void 0===c)return super.on(e,l);const d="string"==typeof l?[l]:l,p=this._createDelegatedListener(e,d,c);this._saveDelegatedListener(e,p);for(const e in p.delegates)this.on(e,p.delegates[e]);return{unsubscribe:()=>{this._removeDelegatedListener(e,d,c)}}}once(e,l,c){if(void 0===c)return super.once(e,l);const d="string"==typeof l?[l]:l,p=this._createDelegatedListener(e,d,c);for(const l in p.delegates){const f=p.delegates[l];p.delegates[l]=(...l)=>{this._removeDelegatedListener(e,d,c),f(...l)}}this._saveDelegatedListener(e,p);for(const e in p.delegates)this.once(e,p.delegates[e]);return this}off(e,l,c){return void 0===c?super.off(e,l):(this._removeDelegatedListener(e,"string"==typeof l?[l]:l,c),this)}queryRenderedFeatures(e,l){if(!this.style)return[];let d;const p=e instanceof c.P||Array.isArray(e),f=p?e:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(p?{}:e)||{},f instanceof c.P||"number"==typeof f[0])d=[c.P.convert(f)];else{const e=c.P.convert(f[0]),l=c.P.convert(f[1]);d=[e,new c.P(l.x,e.y),l,new c.P(e.x,l.y),e]}return this.style.queryRenderedFeatures(d,l,this.transform)}querySourceFeatures(e,l){return this.style.querySourceFeatures(e,l)}setStyle(e,l){return!1!==(l=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(e,l))}setTransformRequest(e){return this._requestManager.setTransformRequest(e),this}_getUIString(e){const l=this._locale[e];if(null==l)throw new Error(`Missing UI string '${e}'`);return l}_updateStyle(e,l){var c,d;if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(e,l)));const p=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!e)),e?(this.style=new ki(this,l||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e,l,p):this.style.loadJSON(e,l,p),this):(null===(d=null===(c=this.style)||void 0===c?void 0:c.projection)||void 0===d||d.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ki(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,l){if("string"==typeof e){const d=this._requestManager.transformRequest(e,"Style");c.j(d,new AbortController).then((e=>{this._updateDiff(e.data,l)})).catch((e=>{e&&this.fire(new c.k(e))}))}else"object"==typeof e&&this._updateDiff(e,l)}_updateDiff(e,l){try{this.style.setState(e,l)&&this._update(!0)}catch(d){c.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(e,l)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(e,l){return this._lazyInitEmptyStyle(),this.style.addSource(e,l),this._update(!0)}isSourceLoaded(e){const l=this.style&&this.style.tileManagers[e];if(void 0!==l)return l.loaded();this.fire(new c.k(new Error(`There is no tile manager with ID '${e}'`)))}setTerrain(e){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),e){const l=this.style.tileManagers[e.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${e.source}`);null===this.terrain&&l.reload();for(const l in this.style._layers){const d=this.style._layers[l];"hillshade"===d.type&&d.source===e.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),"color-relief"===d.type&&d.source===e.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new is(this.painter,l,e),this.painter.renderToTexture=new rs(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=l=>{var c;"style"===l.dataType?this.terrain.tileManager.freeRtt():"source"===l.dataType&&l.tile&&(l.sourceId!==e.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),"image"===(null===(c=l.source)||void 0===c?void 0:c.type)?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(l.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:e})),this}getTerrain(){var e,l;return null!==(l=null===(e=this.terrain)||void 0===e?void 0:e.options)&&void 0!==l?l:null}areTilesLoaded(){const e=this.style&&this.style.tileManagers;for(const l of Object.values(e))if(!l.areTilesLoaded())return!1;return!0}removeSource(e){return this.style.removeSource(e),this._update(!0)}getSource(e){return this.style.getSource(e)}setSourceTileLodParams(e,l,c){if(c){const d=this.getSource(c);if(!d)throw new Error(`There is no source with ID "${c}", cannot set LOD parameters`);d.calculateTileZoom=Ye(Math.max(1,e),Math.max(1,l))}else for(const c in this.style.tileManagers)this.style.tileManagers[c].getSource().calculateTileZoom=Ye(Math.max(1,e),Math.max(1,l));return this._update(!0),this}refreshTiles(e,l){const d=this.style.tileManagers[e];if(!d)throw new Error(`There is no tile manager with ID "${e}", cannot refresh tile`);void 0===l?d.reload(!0):d.refreshTiles(l.map((e=>new c.ac(e.z,e.x,e.y))))}addImage(e,l,d={}){const{pixelRatio:p=1,sdf:f=!1,stretchX:m,stretchY:_,content:y,textFitWidth:b,textFitHeight:T}=d;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||c.b(l))){if(void 0===l.width||void 0===l.height)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:d,height:g,data:S}=l,P=l;return this.style.addImage(e,{data:new c.R({width:d,height:g},new Uint8Array(S)),pixelRatio:p,stretchX:m,stretchY:_,content:y,textFitWidth:b,textFitHeight:T,sdf:f,version:0,userImage:P}),P.onAdd&&P.onAdd(this,e),this}}{const{width:d,height:S,data:P}=g.getImageData(l);this.style.addImage(e,{data:new c.R({width:d,height:S},P),pixelRatio:p,stretchX:m,stretchY:_,content:y,textFitWidth:b,textFitHeight:T,sdf:f,version:0})}}updateImage(e,l){const d=this.style.getImage(e);if(!d)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=l instanceof HTMLImageElement||c.b(l)?g.getImageData(l):l,{width:f,height:m,data:_}=p;if(void 0===f||void 0===m)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==d.data.width||m!==d.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const y=!(l instanceof HTMLImageElement||c.b(l));return d.data.replace(_,y),this.style.updateImage(e,d),this}getImage(e){return this.style.getImage(e)}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e){return L.getImage(this._requestManager.transformRequest(e,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(e,l){return this._lazyInitEmptyStyle(),this.style.addLayer(e,l),this._update(!0)}moveLayer(e,l){return this.style.moveLayer(e,l),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(e,l,c){return this.style.setLayerZoomRange(e,l,c),this._update(!0)}setFilter(e,l,c={}){return this.style.setFilter(e,l,c),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,l,c,d={}){return this.style.setPaintProperty(e,l,c,d),this._update(!0)}getPaintProperty(e,l){return this.style.getPaintProperty(e,l)}setLayoutProperty(e,l,c,d={}){return this.style.setLayoutProperty(e,l,c,d),this._update(!0)}getLayoutProperty(e,l){return this.style.getLayoutProperty(e,l)}setGlyphs(e,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(e,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(e,l,c={}){return this._lazyInitEmptyStyle(),this.style.addSprite(e,l,c,(e=>{e||this._update(!0)})),this}removeSprite(e){return this._lazyInitEmptyStyle(),this.style.removeSprite(e),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(e,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(e,l,(e=>{e||this._update(!0)})),this}setLight(e,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,l),this._update(!0)}getLight(){return this.style.getLight()}setSky(e,l={}){return this._lazyInitEmptyStyle(),this.style.setSky(e,l),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(e,l){return this.style.setFeatureState(e,l),this._update()}removeFeatureState(e,l){return this.style.removeFeatureState(e,l),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let e=0,l=0;return this._container&&(e=this._container.clientWidth||400,l=this._container.clientHeight||300),[e,l]}_setupResizeObserver(){var e;let l=!1;const c=ho((e=>{this._trackResize&&!this._removed&&(this.resize(e),this.redraw())}),50),d=null!==(e=this._ownerWindow.ResizeObserver)&&void 0!==e?e:ResizeObserver;this._resizeObserver=new d((e=>{l?c(e):l=!0})),this._resizeObserver.observe(this._container)}_resolveContainer(e){if("string"==typeof e){const l=document.getElementById(e);if(!l)throw new Error(`Container '${e}' not found.`);return l}if(e instanceof HTMLElement)return e;if(e&&"object"==typeof e&&1===e.nodeType)return e;throw new Error("Invalid type: 'container' must be a String or HTMLElement.")}_setupContainer(){const e=this._container;e.classList.add("maplibregl-map");const l=this._canvasContainer=h.create("div","maplibregl-canvas-container",e);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=h.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const c=this._containerDimensions(),d=this._getClampedPixelRatio(c[0],c[1]);this._resizeCanvas(c[0],c[1],d);const p=this._controlContainer=h.create("div","maplibregl-control-container",e),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{f[e]=h.create("div",`maplibregl-ctrl-${e} `,p)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,l,c){this._canvas.width=Math.floor(c*e),this._canvas.height=Math.floor(c*l),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const e=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let l=null;this._canvas.addEventListener("webglcontextcreationerror",(c=>{l={requestedAttributes:e},c&&(l.statusMessage=c.statusMessage,l.type=c.type)}),{once:!0});let c=null;if(c=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,e):this._canvas.getContext("webgl2",e)||this._canvas.getContext("webgl",e),!c){const e="Failed to initialize WebGL";throw l?(l.message=e,new Error(JSON.stringify(l))):new Error(e)}this.painter=new Wo(c,this.transform),T.testSupport(c)}migrateProjection(e,l){super.migrateProjection(e,l),this.painter.transform=e,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_render(e){var l,d,p,f,m;const _=this._idleTriggered?this._fadeDuration:0,g=(null===(l=this.style.projection)||void 0===l?void 0:l.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._removed)return;let y=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,l=b();this.style.zoomHistory.update(e,l);const d=new c.H(e,{now:l,fadeDuration:_,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),p=d.crossFadingFactor();1===p&&p===this._crossFadingFactor||(y=!0,this._crossFadingFactor=p),this.style.update(d)}const T=(null===(d=this.style.projection)||void 0===d?void 0:d.transitionState)>0!==g;null===(p=this.style.projection)||void 0===p||p.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState(null===(f=this.style.projection)||void 0===f?void 0:f.transitionState,null===(m=this.style.projection)||void 0===m?void 0:m.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||T)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,T),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cH.mark(c.cI.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const S=this._sourcesDirty||this._styleDirty||this._placementDirty;return S||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,c.cH.mark(c.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var e;this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&this._ownerWindow.removeEventListener("online",this._onWindowOnline,!1),L.removeThrottleControl(this._imageQueueHandle),null===(e=this._resizeObserver)||void 0===e||e.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");(null==l?void 0:l.loseContext)&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),h.remove(this._canvasContainer),h.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cH.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,g.frame(this._frameRequest,(e=>{c.cH.frame(e),this._frameRequest=null;try{this._render(e)}catch(e){if(!c.Z(e)&&!function(e){return e.message===Hn}(e))throw e}}),(()=>{}),this._ownerWindow))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get version(){return na}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(e){return this._lazyInitEmptyStyle(),this.style.setProjection(e),this._update(!0)}},l.MapMouseEvent=or,l.MapTouchEvent=rr,l.MapWheelEvent=sr,l.Marker=ms,l.NavigationControl=class{constructor(e){this._updateZoomButtons=()=>{const e=this._map.getZoom(),l=e===this._map.getMaxZoom(),c=e===this._map.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,l)=>{const c=this._map._getUIString(`NavigationControl.${l}`);e.title=c,e.setAttribute("aria-label",c)},this.options=c.e({},tl,e),this._container=h.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),h.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),h.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=h.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new hs(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){h.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(e,l){const c=h.create("button",e,this._container);return c.type="button",c.addEventListener("click",l),c}},l.Popup=class extends c.E{constructor(e){super(),this._updateOpacity=()=>{void 0!==this.options.locationOccludedOpacity&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&h.remove(this._content),this._container&&(h.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=h.create("div","maplibregl-popup",this._map.getContainer()),this._tip=h.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const e of this.options.className.split(" "))this._container.classList.add(e);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=rl(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const d=fl(this.options.offset);if(!c){const e=this._container.offsetWidth,p=this._container.offsetHeight,f=function(e){var l,c,d,p;return e?{top:null!==(l=e.top)&&void 0!==l?l:0,right:null!==(c=e.right)&&void 0!==c?c:0,bottom:null!==(d=e.bottom)&&void 0!==d?d:0,left:null!==(p=e.left)&&void 0!==p?p:0}:{top:0,right:0,bottom:0,left:0}}(this.options.padding);let m;m=l.y+d.bottom.y<p+f.top?["top"]:l.y>this._map.transform.height-p-f.bottom?["bottom"]:[],l.x<e/2+f.left?m.push("left"):l.x>this._map.transform.width-e/2-f.right&&m.push("right"),c=0===m.length?"bottom":m.join("-")}let p=l.add(d[c]);this.options.subpixelPositioning||(p=p.round()),h.setTransform(this._container,`${nl[c]} translate(${p.x}px,${p.y}px)`),sl(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(dl),e)}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.V.convert(e),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const l=document.createDocumentFragment(),c=document.createElement("body");let d;for(c.innerHTML=e;d=c.firstChild,d;)l.appendChild(d);return this.setDOMContent(l)}getMaxWidth(){var e;return null===(e=this._container)||void 0===e?void 0:e.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=h.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){return this._container&&this._container.classList.add(e),this}removeClassName(e){return this._container&&this._container.classList.remove(e),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){if(this._container)return this._container.classList.toggle(e)}setSubpixelPositioning(e){this.options.subpixelPositioning=e}setPadding(e){this.options.padding=e,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=h.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(pl);e&&e.focus()}},l.RasterDEMTileSource=Y,l.RasterTileSource=K,l.ScaleControl=class{constructor(e){this._onMove=()=>{hl(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,hl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},cl),e)}getDefaultPosition(){return"bottom-left"}onAdd(e){return this._map=e,this._container=h.create("div","maplibregl-ctrl maplibregl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){h.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},l.ScrollZoomHandler=Br,l.Style=ki,l.TerrainControl=class{constructor(e){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=e}onAdd(e){return this._map=e,this._container=h.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=h.create("button","maplibregl-ctrl-terrain",this._container),h.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){h.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},l.TwoFingersTouchPitchHandler=Rr,l.TwoFingersTouchRotateHandler=Sr,l.TwoFingersTouchZoomHandler=Mr,l.TwoFingersTouchZoomRotateHandler=Gr,l.VectorTileSource=X,l.VideoSource=ie,l.addSourceType=(e,l)=>c._(void 0,void 0,void 0,(function*(){if(xe(e))throw new Error(`A source type called "${e}" already exists.`);((e,l)=>{ye[e]=l})(e,l)})),l.clearPrewarmedResources=function(){const e=J;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(W),J=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},l.createTileMesh=ur,l.getMaxParallelImageRequests=function(){return c.c.MAX_PARALLEL_IMAGE_REQUESTS},l.getRTLTextPluginStatus=function(){return we().getRTLTextPluginStatus()},l.getVersion=function(){return gl},l.getWorkerCount=function(){return k.workerCount},l.getWorkerUrl=function(){return c.c.WORKER_URL},l.importScriptInWorkers=function(e){return le().broadcast("IS",e)},l.isTimeFrozen=function(){return y.isFrozen()},l.now=b,l.prewarm=function(){oe().acquire(W)},l.restoreNow=function(){y.restoreNow()},l.setMaxParallelImageRequests=function(e){c.c.MAX_PARALLEL_IMAGE_REQUESTS=e},l.setNow=function(e){y.setNow(e)},l.setRTLTextPlugin=function(e,l){return we().setRTLTextPlugin(e,l)},l.setWorkerCount=function(e){k.workerCount=e},l.setWorkerUrl=function(e){c.c.WORKER_URL=e}}));var p=l;return p}));var c=l;export{c as default};

